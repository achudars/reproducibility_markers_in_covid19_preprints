An Accurate Solution for Credit Valuation
Adjustment (CVA) and Wrong Way Risk

Tim Xiao1

ABSTRACT
This paper presents a Least Square Monte Carlo approach for accurately calculating credit value
adjustment (CVA). In contrast to previous studies, the model relies on the probability distribution
of a default time/jump rather than the default time itself, as the default time is usually inaccessible.
As such, the model can achieve a high order of accuracy with a relatively easy implementation.
We find that the valuation of a defaultable derivative is normally determined via backward
induction when their payoffs could be positive or negative. Moreover, the model can naturally
capture wrong or right way risk.

Key Words: credit value adjustment (CVA), wrong way risk, right way risk, credit risk modeling,
least square Monte Carlo, default time approach (DTA), default probability approach (DPA),
collateralization, margin and netting.

1

Email: tim_yxiao@yahoo.com Url: https://finpricing.com/

1

For years, a widespread practice in the industry has been to mark derivative portfolios to market
without taking counterparty risk into account. All cash flows are discounted using the LIBOR
curve. But the real parties, in many cases, happen to be of lower credit quality than the
hypothetical LIBOR party and have a chance of default.
As a consequence, the International Accounting Standard (IAS) 39 requires banks to
provide a fair-value adjustment due to counterparty risk. Although credit value adjustment (CVA)
became mandatory in 2000, it received a little attention until the recent financial crises in which
the profit and loss (P&L) swings due to CVA changes were measured in billons of dollars.
Interest in CVA began to grow. Now CVA has become the first line of defense and the central
part of counterparty risk management.
CVA not only allows institutions to move beyond the traditional control mindset of credit
risk limits and to quantify counterparty risk as a single measurable P&L number, but also offers
an opportunity for banks to dynamically manage, price and hedge counterparty risk. The benefits
of CVA are widely acknowledged. Many banks have set up internal credit risk trading desks to
manage counterparty risk on derivatives.
The earlier works on CVA are mainly focused on unilateral CVA that assumes that only
one counterparty is defaultable and the other one is default-free. The unilateral treatment neglects
the fact that both counterparties may default, i.e., counterparty risk can be bilateral. A trend that
has become increasingly relevant and popular has been to consider the bilateral nature of
counterparty credit risk. Although most institutions view bilateral considerations as important in
order to agree on new transactions, Hull and White (2013) argue that bilateral CVA is more
controversial than unilateral CVA as the possibility that a dealer might default is in theory a
benefit to the dealer.
CVA, by definition, is the difference between the risk-free portfolio value and the true (or
risky or defaultable) portfolio value that takes into account the possibility of a counterparty’s
default. The risk-free portfolio value is what brokers quote or what trading systems or models
2

normally report. The risky portfolio value, however, is a relatively less explored and less
transparent area, which is the main challenge and core theme for CVA. In other words, central to
CVA is risky valuation.
In general, risky valuation can be classified into two categories: the default time
approach (DTA) and the default probability approach (DPA). The DTA involves the default time
explicitly. Most CVA models in the literature (Brigo and Capponi (2008), Lipton and Sepp
(2009), Pykhtin and Zhu (2006) and Gregory (2009), etc.) are based on this approach.
Although the DTA is very intuitive, it has the disadvantage that it explicitly involves the
default time. We are very unlikely to have complete information about a firm’s default point,
which is often inaccessible (see Duffie and Huang (1996), Jarrow and Protter (2004), etc.).
Usually, valuation under the DTA is performed via Monte Carlo simulation. On the other hand,
however, the DPA relies on the probability distribution of the default time rather than the default
time itself. Sometimes the DPA yields simple closed form solutions.
The current popular CVA methodology (Pykhtin and Zhu (2006) and Gregory (2009),
etc.) is first derived using DTA and then discretized over a time grid in order to yield a feasible
solution. The discretization, however, is inaccurate. In fact, this model has never been rigorously
proved. Since CVA is used for financial accounting and pricing, its accuracy is essential.
Moreover, this current model is based on a well-known assumption, in which credit exposure and
counterparty’s credit quality are independent. Obviously, it can not capture wrong/right way risk
properly.
In this paper, we present a framework for risky valuation and CVA. In contrast to
previous studies, the model relies on the DPA rather than the DTA. Our study shows that the
pricing process of a defaultable contract normally has a backward recursive nature if its payoff
could be positive or negative.
An intuitive way of understanding these backward recursive behaviours is that we can
think of that any contingent claim embeds two default options. In other words, when entering an
3

OTC derivatives transaction, one party grants the other party an option to default and, at the same
time, also receives an option to default itself. In theory, default may occur at any time. Therefore,
the default options are American style options that normally require a backward induction
valuation.
Wrong way risk occurs when exposure to a counterparty is adversely correlated with the
credit quality of that counterparty, while right way risk occurs when exposure to a counterparty is
positively correlated with the credit quality of that counterparty. For example, in wrong way risk
exposure tends to increase when counterparty credit quality worsens, while in right way risk
exposure tends to decrease when counterparty credit quality declines. Wrong/right way risk, as an
additional source of risk, is rightly of concern to banks and regulators. Since this new model
allows us to incorporate correlated and potentially simultaneous defaults into risky valuation, it
can naturally capture wrong/right way risk.
The rest of this paper is organized as follows: Section 2 discusses unilateral risky
valuation and unilateral CVA. Section 2 elaborates bilateral risky valuation and bilateral CVA.
Section 3 presents numerical results. The conclusions are given in Section 4. . All proofs and a
practical framework that embraces netting agreements, margining agreements and wrong/right
way risk are contained in the appendices.

1. Unilateral Risky Valuation and Unilateral CVA
We consider a filtered probability space (  , F , Ft t 0 , P ) satisfying the usual
conditions, where  denotes a sample space; F

denotes a  -algebra; P

denotes a

probability measure; Ft t 0 denotes a filtration.
The default model is based on the reduced-form approach proposed by Duffie and
Singleton (1999) and Jarrow and Turnbell (1994), which does not explain the event of default
endogenously, but characterizes it exogenously by a jump process. The stopping (or default) time
4

 of a firm is modeled as a Cox arrival process (also known as a doubly stochastic Poisson
process) whose first jump occurs at default and is defined as,



t

 = inf t :  h( s,  s )ds  
0



(1)

where h (t ) or h(t ,  t ) denotes the stochastic hazard rate or arrival intensity dependent on an
exogenous common state t , and  is a unit exponential random variable independent of  t .
It is well-known that the survival probability from time t to s in this framework is defined
by
s
p(t , s) := P(  s |   t , Z ) = exp −  h(u)du 
 t


(2a)

The default probability for the period (t, s) in this framework is defined by
s
q(t , s) := P(  s |   t , Z ) = 1 − p(t , s) = 1 − exp −  h(u)du 
t



(2b)

Two counterparties are denoted as A and B. Let valuation date be t. Consider a financial
contract that promises to pay a X T  0 from party B to party A at maturity date T, and nothing
before date T. All calculations in the paper are from the perspective of party A. The risk free value
of the financial contract is given by



V F (t ) = E D(t , T ) X T Ft



(3a)

where
T
D(t , T ) = exp −  r (u)du 
 t


(3b)

where E • F t  denotes the expectation conditional on the Ft , D(t , T ) denotes the risk-free
discount factor at time t for the maturity T and r (u) denotes the risk-free short rate at time u
( t  u  T ).
Next, we turn to risky valuation. In a unilateral credit risk case, we assume that party A is
default-free and party B is defaultable. Risky valuation can be generally classified into two
5

categories: the default time approach (DTA) and the default probability (intensity) approach
(DPA).
The DTA involves the default time explicitly. If there has been no default before time T
(i.e.,   T ), the value of the contract at T is the payoff X T . If a default happens before T (i.e.,
t    T ), a recovery payoff is made at the default time  as a fraction of the market value2

given by  V ( ) where  is the default recovery rate and V ( ) is the market value at default.
Under a risk-neutral measure, the value of this defaultable contract is the discounted expectation
of all the payoffs and is given by

V (t ) = E(D(t , T ) X T 1 T + D(t , )V ( )1 T ) | Ft 

(4)

where Y is an indicator function that is equal to one if Y is true and zero otherwise.
Although the DTA is very intuitive, it has the disadvantage that it explicitly involves the
default time/jump. We are very unlikely to have complete information about a firm’s default
point, which is often inaccessible. Usually, valuation under the DTA is performed via Monte
Carlo simulation.
The DPA relies on the probability distribution of the default time rather than the default
time itself. We divide the time period (t, T) into n very small time intervals ( t ) and assume that
a default may occur only at the end of each very small period. In our derivation, we use the
approximation exp( y )  1 + y for very small y. The survival and the default probabilities for the
period ( t , t + t ) are given by

pˆ (t ) := p(t , t + t ) = exp(− h(t )t )  1 − h(t )t

(5a)

qˆ (t ) := q(t , t + t ) = 1 − exp(− h(t )t )  h(t )t

(5b)

The binomial default rule considers only two possible states: default or survival. For the
one-period (t , t + t ) economy, at time t + t the asset either defaults with the default
2

Here we use the recovery of market value (RMV) assumption.
6

probability q(t , t + t ) or survives with the survival probability p(t , t + t ) . The survival payoff
is equal to the market value V (t + t ) and the default payoff is a fraction of the market value:

 (t + t )V (t + t ) . Under a risk-neutral measure, the value of the asset at t is the expectation of
all the payoffs discounted at the risk-free rate and is given by
V (t ) = Eexp(− r (t )t )  pˆ (t ) +  (t )qˆ (t )V (t + t ) F t   Eexp(− y(t )t )V (t + t ) F t 

(6)

where y(t ) = r (t ) + h(t )(1 −  (t )) = r (t ) + c(t ) denotes the risky rate and c(t ) = h(t )(1 −  (t ) ) is called
the (short) credit spread.
Similarly, we have

V (t + t ) = Eexp(− y(t + t )t )V (t + 2t ) Ft +t 

(7)

Note that exp(− y(t )t ) is Ft +t -measurable. By definition, an Ft +t -measurable
random variable is a random variable whose value is known at time t + t . Based on the taking
out what is known and tower properties of conditional expectation, we have
V (t ) = E exp(− y (t )t )V (t + t ) F t 





= E exp(− y (t )t )E exp(− y (t + t )t )V (t + 2t ) F t + t F t 

 (

= E exp − 

1
i =0

)

y (t + it )t ) V (t + 2t ) F t



(8)

By recursively deriving from t forward over T and taking the limit as t approaches zero,
the risky value of the asset can be expressed as
T
V (t ) = E exp −  y (u )du V (T ) F t 
t






(9)

We may think of y (u ) as the risk-adjusted short rate. Equation (9) is the same as
Equation (10) in Duffie and Singleton [1999], which is the market model for pricing risky bonds.
Using the DPA, we obtain a closed-form solution for pricing an asset subject to credit risk. Other
good examples of the DPA are the CDS model proposed by J.P. Morgan (1999) and a more
generic risky model presented by Xiao (2013a).

7

In theory, a default may happen at any time, i.e., a risky contract is continuously
defaultable. This Continuous Time Risky Valuation Model is accurate but sometimes complex
and expensive. For simplicity, people sometimes prefer the Discrete Time Risky Valuation Model
that assumes that a default may only happen at some discrete times. A natural selection is to
assume that a default may occur only on the payment dates. Fortunately, the level of accuracy for
this discrete approximation is well inside the typical bid-ask spread for most applications (see
O’Kane and Turnbull (2003)). From now on, we will focus on the discrete setting only, but many
of the points we make are equally applicable to the continuous setting.
For a derivative contract, usually its payoff may be either an asset or a liability to each
party. Thus, we further relax the assumption and suppose that X T may be positive or negative.
In the case of X T  0 , the survival value is equal to the payoff X T and the default payoff
is a fraction of the payoff  X T . Whereas in the case of X T  0 , the contract value is the payoff
itself, because the default risk of party B is irrelevant for unilateral risky valuation in this case.
Therefore, we have
Proposition 1: The unilateral risky value of the single-payment contract in a discrete-time setting
is given by
V (t ) = EF (t , T ) X T Ft 

(10a)

where





F (t , T ) = D(t , T ) 1 − 1X T 0 q(t , T )(1 −  (T ))

(10b)

Proof: See the appendix.
Here F (t , T ) can be regarded as a risk-adjusted discount factor. Proposition 1 says that
the unilateral risky valuation of the single payoff contract has a dependence on the sign of the
payoff. If the payoff is positive, the risky value is equal to the risk-free value minus the
discounted potential loss. Otherwise, the risky value is equal to the risk-free value.

8

Proposition 1 can be easily extended from one-period to multiple-periods. Suppose that a
defaultable contract has m cash flows. Let the m cash flows be represented as X 1 ,…, X m with
payment dates T1 ,…, Tm . Each cash flow may be positive or negative. We have the following
proposition.
Proposition 2: The unilateral risky value of the multiple-payment contract is given by
V (t ) =  i=1 E
m

(

i −1
j =0

) 

F (T j , T j +1 ) X i Ft

(11a)

where t = T0 and





F (T j , T j +1 ) = D(T j , T j +1 ) 1 − 1( X j +1 +V (T j +1 ))  0 q(T j , T j +1 )(1 −  (T j +1 ) )

(11b)

Proof: See the appendix.
The risky valuation in Proposition 2 has a backward nature. The intermediate values are
vital to determine the final price. For a discrete time interval, the current risky value has a
dependence on the future risky value. Only on the final payment date Tm , the value of the
contract and the maximum amount of information needed to determine the risk-adjusted discount
factor are revealed. The coupled valuation behavior allows us to capture wrong/right way risk
properly where counterparty credit quality and market prices may be correlated. This type of
problem can be best solved by working backwards in time, with the later risky value feeding into
the earlier ones, so that the process builds on itself in a recursive fashion, which is referred to as
backward induction. The most popular backward induction valuation algorithms are lattice/tree
and least square Monte Carlo.
For an intuitive explanation, we can posit that a defaultable contract under the unilateral
credit risk assumption has an embedded default option (see Sorensen and Bollier (1994)). In other
words, one party entering a defaultable financial transaction actually grants the other party an
option to default. If we assume that a default may occur at any time, the default option is an

9

American style option. American options normally have backward recursive natures and require
backward induction valuations.
The similarity between American style financial options and American style default
options is that both require a backward recursive valuation procedure. The difference between
them is in the optimal strategy. The American financial option seeks an optimal value by
comparing the exercise value with the continuation value, whereas the American default option
seeks an optimal discount factor based on the option value in time.
The unilateral CVA, by definition, can be expressed as

(

) 

CVA (t ) = V F (t ) − V (t ) =  i =1 E D(t , Ti ) −  j =0 F (T j , T j +1 ) X i Ft
m

i −1

(12)

Proposition 2 provides a general form for pricing a unilateral defaultable contract.
Applying it to a particular situation in which we assume that all the payoffs are nonnegative, we
derive the following corollary:
Corollary 1: If all the payoffs are nonnegative, the risky value of the multiple-payments contract
is given by
V (t ) =  i =1 E
m

(

i −1
j =0

)

F (T j , T j +1 ) X i Ft



(13a)

where t = T0 and





F (T j , T j +1 ) = D(T j , T j +1 ) 1 − q(T j , T j +1 )(1 −  (T j +1 ) )

(13b)

The proof of this corollary is easily obtained according to Proposition 2 by setting

(X

j +1

+ V (T j +1 ))  0 , since the value of the contract at any time is also nonnegative.

The CVA in this case is given by



(

)

CVA (t ) = V F (t ) − V (t ) =  i =1 E D(t , Ti ) 1 −  j =0 (1 − q (T j , T j +1 )(1 −  (T j +1 ))) X i Ft
m

i −1



(14)

The current popular CVA model (e.g., equation (17) in Pykhtin and Zhu (2007) and
equation (3) in Gregory (2009)) is quite different from above either equation (12) or equation (14).
As a matter of fact, the current CVA model has never been rigorously proved. In order to reflect
10

the economic value of counterparty credit risk, to measure the profit and loss of a bank and to
provide proper incentives to traders, a good CVA model must be not only rigorous and accurate
but also feasible to implement.

2. Bilateral Risky Valuation and Bilateral CVA
There is ample evidence that corporate defaults are correlated. The default of a firm’s
counterparty might affect its own default probability. Thus, default correlation and dependence
arise due to the counterparty relations. Default correlation can be positive or negative. The effect
of positive correlation is usually called contagion, whereas the latter is referred to as competition
effect.
Two counterparties are denoted as A and B. The binomial default rule considers only two
possible states: default or survival. Therefore, the default indicator Y j for party j (j=A, B) follows
a Bernoulli distribution, which takes value 1 with default probability q j and value 0 with survival
probability p j , i.e., P{Y j = 0} = p j and P{Y j = 1} = q j . The marginal default distributions can be
determined by the reduced-form models. The joint distributions of a bivariate Bernoulli variable
can be easily obtained via the marginal distributions by introducing extra correlations.
Consider a pair of random variables ( YA , YB ) that has a bivariate Bernoulli distribution.
The joint probability representations are given by
p00 := P(Y A = 0, YB = 0) = p A p B +  AB

(15a)

p01 := P(YA = 0, YB = 1) = p A q B −  AB

(15b)

p10 := P(YA = 1, YB = 0) = q A p B −  AB

(15c)

p11 := P(Y A = 1, YB = 1) = q A q B +  AB

(15d)

where E (Y j ) = q j ,  2j = p j q j ,  AB := E(YA − qA )(YB − qB ) =  AB A B =  AB qA pAqB pB where  AB
denotes the default correlation coefficient and  AB denotes the default covariance.
11

Table 1. Payoffs of a bilaterally defaultable contract
This table displays all possible payoffs at time T. In the case of X T  0 , there are a total of four
possible states at time T: i) Both A and B survive with probability p00 . The contract value is
equal to the payoff X T . ii) A defaults but B survives with probability p10 . The contract value is

B X T , where  B represents the non-default recovery rate 3 .  B =0 represents the one-way
settlement rule, while  B =1 represents the two-way settlement rule. iii) A survives but B defaults
with probability p 01 . The contract value is B X T , where  B represents the default recovery rate.
iv) Both A and B default with probability p11 . The contract value is  AB X T , where  AB denotes
the joint recovery rate when both parties A and B default simultaneously. A similar logic applies
to the case of X T  0 .
State

YA = 0, YB = 0

YA = 1, YB = 0

YA = 0, YB = 1

YA = 1, YB = 1

Comments

A & B survive

A defaults, B survives

A survives, B defaults

A & B default

Probability

p 00

p10

p 01

p11

XT  0

XT

B X T

B X T

 AB X T

XT  0

XT

A XT

A XT

 AB X T

Payoff

3

There are two default settlement rules in the market. The one-way payment rule was specified

by the early ISDA master agreement. The non-defaulting party is not obligated to compensate the
defaulting party if the remaining market value of the instrument is positive for the defaulting
party. The two-way payment rule is based on current ISDA documentation. The non-defaulting
party will pay the full market value of the instrument to the defaulting party if the contract has
positive value to the defaulting party.
12

Suppose that a financial contract that promises to pay a X T from party B to party A at
maturity date T, and nothing before date T where T  t . The payoff X T may be positive or
negative, i.e. the contract may be either an asset or a liability to each party. All calculations are
from the perspective of party A.
2
At time T, there are a total of four ( 2 = 4 ) possible states shown in Table 1. The risky

value of the contract is the discounted expectation of the payoffs and is given by the following
proposition.
Proposition 3: The bilateral risky value of the single-payment contract is given by

 



(

)

V (t ) = E K (t , T ) X T Ft = E D(t , T ) 1 X T 0 k B (t , T ) + 1 X T 0 k A (t , T ) X T Ft



(16a)

where
k B (t , T ) = p B (t , T ) p A (t , T ) +  B (T )q B (t , T ) p A (t , T ) +  B (T ) p B (t , T )q A (t , T )

+  AB (T )q B (t , T )q A (t , T ) +  AB (t , T )(1 −  B (T ) −  B (T ) +  AB (T ) )

k A (t , T ) = p B (t , T ) p A (t , T ) +  A (T )q A (t , T ) p B (t , T ) +  A (T ) p A (t , T )q B (t , T )

+  AB (T )q B (t , T )q A (t , T ) +  AB (t , T ) (1 −  A (T ) −  A (T ) +  AB (T ) )

(16b)

(16c)

Proof: See the appendix.
We may think of K (t , T ) as the risk-adjusted discount factor. Proposition 3 tells us that
the bilateral risky price of a single-payment contract can be expressed as the present value of the
payoff discounted by a risk-adjusted discount factor that has a switching-type dependence on the
sign of the payoff.
Using a similar derivation as in Proposition 2, we can easily extend Proposition 3 from
one-period to multiple-periods. Suppose that a defaultable contract has m cash flows. Let the m
cash flows be represented as X i with payment dates Ti , where i = 1,…,m. Each cash flow may
be positive or negative. The bilateral risky value of the multiple-payment contract is given by
Proposition 4: The bilateral risky value of the multiple-payment contract is given by
V (t ) = i =1 E
m

(

i −1
K (T j , T j +1 )
j =0

)X F 
i

t

(17a)

13

where t = T0 and

(

K (T j , T j +1 ) = D(T j , T j +1 ) 1( X j+1 +V (T j+1 )) 0 k B (T j , T j +1 ) + 1( X j +1 +V (T j+1 )) 0 k A (T j , T j +1 )

)

(17b)

where k A (T j , T j +1 ) and kB (T j ,T j +1) are defined in Proposition 3.
Proof: The proof is similar to Proposition 2 by replacing F (T j , T j −1 ) with K (T j , T j −1 ) .
Proposition 4 says that the pricing process of a multiple-payment contract has a backward
nature since there is no way of knowing which risk-adjusted discounting rate should be used
without knowledge of the future value. Only on the maturity date, the value of the contract and
the decision strategy are clear. Therefore, the evaluation must be done in a backward fashion,
working from the final payment date towards the present. This type of valuation process is
referred to as backward induction.
There is a common misconception in the market. Many people believe that the cash flows
of a defaultable financial contract can be priced independently and then be summed up to give the
final risky price of the contract. We emphasize here that this conclusion is only true of the
financial contracts whose payoffs are always positive. In the cases where the promised payoffs
could be positive or negative, the valuation requires not only a backward recursive induction
procedure, but also a strategic selection of different discount factors according to the market
value in time. This coupled valuation process allows us to capture correlation between
counterparties and market factors.
The bilateral CVA of the multiple-payment contract can be expressed as



CVA(t ) = V F (t ) − V (t ) =  i =1 E D (t , Ti ) X i Ft  − E
m

(

i −1
j =0

)

K (T j , T j +1 ) X i Ft



(18)

3. Numerical Results
In this section, we present some numerical results for CVA calculation based on the
theory described above. First, we study the impact of margin agreements on CVA. The testing

14

portfolio consists of a number of interest rate and equity derivatives. The number of simulation
scenarios (or paths) is 20,000. The time buckets are set weekly. If the computational requirements
exceed the system limit, one can reduce both the number of scenarios and the number of time
buckets. The time buckets can be designed fine-granularity at the short end (e.g., daily and then
weekly) and coarse-granularity at the far end (e.g. monthly and then yearly). The rationale is that
the calculation becomes less accurate due to the accumulated error from simulation discretization,
and inherited errors from calibration of the underlying models, such as those due to the change of
macro-economic climate. The collateral margin period of risk is assumed to be 14 days (2 weeks).
For risk-neutral simulation, we use a Hull-White model for interest rate and a CIR (CoxIngersoll-Ross) model for hazard rate scenario generations a modified GBM (Geometric
Brownian Motion) model for equity and collateral evolution. The results are presented in the
following tables. Table 2 illustrates that if party A has an infinite collateral threshold H A = 
i.e., no collateral requirement on A, the CVA value increases while the threshold H B increases.
Table 3 shows that if party B has an infinite collateral threshold H B =  , the CVA value actually
decreases while the threshold H A increases. This reflects the bilateral impact of the collaterals
on the CVA. The impact is mixed in Table 4 when both parties have finite collateral thresholds.

Table 2. The impact of collateral threshold H B on the CVA
This table shows that given an infinite H A , the CVA increases while H B increases, where H B
denotes the collateral threshold of party B and H A denotes the collateral threshold of party A.
Collateral Threshold H B

10.1 Mil

15.1 Mil

20.1 Mil

Infinite (  )

CVA

19,550.91

20,528.65

21,368.44

22,059.30

Table 3. The impact of collateral threshold H A on the CVA

15

This table shows that given an infinite H B , the CVA decreases while H A increases, where H B
denotes the collateral threshold of party B and H A denotes the collateral threshold of party A.
Collateral Threshold H A

10.1 Mil

15.1 Mil

20.1 Mil

Infinite (  )

CVA

28,283.64

25,608.92

23,979.11

22,059.30

Table 4. The impact of the both collateral thresholds on the CVA
The CVA may increase or decrease while both collateral thresholds change, where H B denotes
the collateral threshold of party B and H A denotes the collateral threshold of party A. This
reflects the fact that the collaterals have bilateral impacts on the CVA.
Collateral Threshold H B

10.1 Mil

15.1 Mil

20.1 Mil

Infinite (  )

Collateral Threshold H A

10.1 Mil

15.1 Mil

20.1 Mil

Infinite (  )

CVA

25,752.98

22,448.45

23,288.24

22,059.30

Next, we examine the impact of wrong way risk. Wrong way risk occurs when exposure
to a counterparty is adversely correlated with the credit quality of that counterparty, while right
way risk occurs when exposure to a counterparty is positively correlated with the credit quality of
that counterparty. Wrong/right way risk, as an additional source of risk, is rightly of concern to
banks and regulators.
Some financial markets are closely interlinked, while others are not. For example, CDS
price movements have a feedback effect on the equity market, as a trading strategy commonly
employed by banks and other market participants consists of selling a CDS on a reference entity
and hedging the resulting credit exposure by shorting the stock. On the other hand, Moody’s
Investor’s Service (2000) presents statistics that suggest that the correlations between interest
rates and CDS spreads are very small.

16

To capture wrong/right way risk, we need to determine the dependency between
counterparties and to correlate the credit spreads or hazard rates with the other market risk factors,
e.g. equities, commodities, etc., in the scenario generation.
We use an equity swap as an example. Assume the correlation between the underlying
equity price and the credit quality (hazard rate) of party B is  . The impact of the correlation on
the CVA is show in Table 5. The results say that the CVA increases when the absolute value of
the negative correlation increases.

Table 5. The impact of wrong way risk on the CVA
This table shows that the CVA increases while the negative correlation  increases in the
absolute value. We use an equity swap as an example and assume that there is a negative
correlation between the equity price and the credit quality of party B.
Correlation 

0

-50%

-100%

CVA

165.15

205.95

236.99

4. Conclusion
This article presents a framework for pricing risky contracts and their CVAs. The model
relies on the probability distribution of the default jump rather than the default jump itself,
because the default jump is normally inaccessible. We find that the valuation of risky assets and
their CVAs, in most situations, has a backward recursive nature and requires a backward
induction valuation. An intuitive explanation is that two counterparties implicitly sell each other
an option to default when entering into an OTC derivative transaction. If we assume that a default
may occur at any time, the default options are American style options. If we assume that a default
may only happen on the payment dates, the default options are Bermudan style options. Both
Bermudan and American options require backward induction valuations.

17

Based on our theory, we propose a novel cash-flow-based framework (see appendix) for
calculating bilateral CVA at the counterparty portfolio level. This framework can easily
incorporate various credit mitigation techniques, such as netting agreements and margin
agreements, and can capture wrong/right way risk. Numerical results show that these credit
mitigation techniques and wrong/right way risk have significant impacts on CVA.

Appendix
A. Proofs
Proof of Proposition 1: Under the unilateral credit risk assumption, we only consider the
default risk when the asset is in the money. Assume that a default may only occur on the payment
date. Therefore, the risky value of the asset at t is the discounted expectation of all possible
payoffs and is given by



(1 −  (T ))q(t , T )X
= ED(t , T )1 − 1



V (t ) = E D(t , T ) 1X T  0 ( p(t , T ) +  (T )q(t , T ) ) + 1X T  0 X T Ft
X T 0

T





Ft = E F (t , T ) X T Ft 

(A1a)

where





F (t , T ) = D(t , T ) 1 −1X T 0 q(t , T )(1 −  (T ))

(A1b)

Proof of Proposition 2: Let t = T0 . On the first payment day, let V (T1 ) denote the risky
value of the asset excluding the current cash flow X 1 . According to Proposition 1, the risky value
of the asset at t is given by
V (t ) = EF (T0 , T1 )( X1 + V (T1 ) ) Ft 

(A2a)

where





F (T0 , T1 ) = D(T0 , T1 ) 1 − 1(V (T1 ) + X1 )0 q(t , T )(1 −  (T ))

(A2b)

Similarly, we have



V (T1 ) = E F (T1 , T2 )( X 2 + V (T2 ) ) FT1



(A3)

18

Note that F (T0 , T1 ) is F T 1 -measurable. According to the taking out what is known and
tower properties of conditional expectation, we have
V (t ) = E F (T0 , T1 )( X 1 + V (T1 ) ) Ft  = E F (T0 , T1 ) X 1 Ft 



(

) (
) )X F + E (

+ E F (T0 , T1 ) E F (T1 , T2 ) X 2 FT 1 + E F (T1 , T2 )V (T2 ) FT 1
= i =1 E
2

(

i −1
j =0

F (T j , T j +1

1

i

t

j =0

)

) F 

(A4)

t

F (T j , T j +1 ) V (T2 ) Ft



By recursively deriving from T2 forward over Tm , where V (Tm ) = X m , we have
V (t ) =  i =1 E
m

(

i −1
j =0

) 

F (T j , T j +1 ) X i Ft

(A5)

Proof of Proposition 3: We assume that a default may only occur on the payment date.
At time T, there are four possible states: 1) both A and B survive, 2) A defaults but B survives, 3)
A survives but B defaults, and 4) both A and B default. The joint distributions of A and B are
given by (15). Depending on whether the payoff is in the money or out of the money at T, we
have





V (t ) = E D(t , T ) 1 X T 0 p 00 (t , T ) +  B (T ) p 01 (t , T )+  B (T ) p10 (t , T ) +  AB (T ) p11 (t , T ) X T F t
+ 1 X T 0 p 00 (t , T ) +  A (T ) p 01 (t , T )+  A (T ) p10 (t , T ) +  AB (T ) p11 (t , T ) X T F t



(

)

= E (K (t , T ) X T F t ) = E D(t , T ) 1 X T 0 k B (t , T ) + 1 X T 0 k A (t , T ) X T F t





(A6a)

where
k B (t , T ) = p B (t , T ) p A (t , T ) +  B (T )q B (t , T ) p A (t , T ) +  B (T ) p B (t , T )q A (t , T )

+  AB (T )q B (t , T )q A (t , T ) +  AB (t , T )(1 −  B (T ) −  B (T ) +  AB (T ) )

k A (t , T ) = p B (t , T ) p A (t , T ) +  A (T )q A (t , T ) p B (t , T ) +  A (T ) p A (t , T )q B (t , T )

+  AB (T )q B (t , T )q A (t , T ) +  AB (t , T )(1 −  A (T ) −  A (T ) +  AB (T ) )

(A6b)

(A6c)

B. A practical framework for calculating bilateral CVA
We develop a practical framework for calculating bilateral CVA at counterparty portfolio
level based on the theory described above. The framework incorporates netting and margin
agreements, and captures right/wrong way risk.

19

Two parties are denoted as A and B. All calculations are from the perspective of party A.
Let the valuation date be t. The CVA computation procedure consists of the following steps.
B.1.

Risk-neutral Monte Carlo scenario generation

One core element of the trading credit risk modeling is the Monte Carlo scenario
generation (market evolution). This must be able to run a large number of scenarios for each risk
factor with flexibility over parameterization of processes and treatment of correlation between
underlying factors. Credit exposure may be calculated under real probability measure, while CVA
or pricing counterparty credit risk should be conducted under risk-neutral probability measure.
Due to the extensive computational intensity of pricing counterparty risk, there will
inevitably be some compromise of limiting the number of market scenarios (paths) and the
number of simulation dates (also called “time buckets” or “time nodes”). The time buckets are
normally designed fine-granularity at the short end and coarse-granularity at the far end. The
details of scenario generation are beyond the scope of this paper.
B.2.

Cash flow generation

For ease of illustration, we choose a vanilla interest rate swap, as interest rate swaps
collectively account for around two-thirds of both the notional and market value of all
outstanding derivatives (FinPricing (2015))
Assume that party A pays a fixed rate, while party B pays a floating-rate. Assume that
there are M time buckets ( T0 , T1 ,..., TM ) in each scenario and N cash flows in the sample swap.
Let consider scenario j first.
For swaplet i, there are four important dates: the fixing date ti , f , the starting date t i , s ,
the ending date t i ,e and the payment date t i , p . In general, these dates are not coincidently at the
simulation time buckets. The time relationship between swaplet i and the simulation time buckets
is illustrated in Figure B1.

20

Interest rate curve simulated at ti , f
Rates
Tj

ti , f

T j +1

Tk

ti,s

ti,e

ti , p

Tk +1

Terms

Figure B1: An interest rate swaplet
This figure illustrates the time relationship between an interest rate swaplet and the simulation
time buckets. The floating leg of the swaplet is reset at the fixing date ti , f with the starting date

ti ,s , the ending date ti ,e , and the payment date ti , p . The simulation time buckets are
Ti , Ti +1 ,...,Tk +1 . The simulated interest rate curve is starting at ti , f . Both fixed rate payments and

floating-rate payments occur on the same payment dates.

The cash flow of swaplet i is determined at the fixing date ti , f that is assumed to be
between the simulation time buckets T j and T j +1 . First, we need to create an interest rate curve
observed at ti , f by interpolating the interest rate curves simulated at T j and T j +1 via either
Brownian Bridge or linear interpolation. The linear interpolation is the expectation of the
Brownian Bridge. Then we can calculate the payoff of swaplet i at scenario j as

(

)

 j , i = N F (ti , f ; ti , s , ti , e ) − R  (ti , s , ti , e )

(B1)

where N denotes the notional; F (ti , f ; ti ,s , ti ,e ) denotes the simply compounded forward rate reset
at ti , f for the forward period ( ti,s , ti,e );  (t i , s , t i ,e ) denotes the accrual factor or day count
fraction for the period ( ti,s , ti,e ) and R denotes the fixed rate.
21

The cash flow amount calculated by (B1) is paid on the payment date t i , p . This value
should be allocated into the nearest previous time bucket Tk as:

~ j ,k ,i =  j ,i D(Tk , ti , p )

(B2)

D(Tk , ti , p ) denotes the risk-free discount factor based on the interest rate curve simulated

where
at T k .

Cash flow generation for products without early-exercise provision is quite
straightforward. For early-exercise products, one can use the approach proposed by Longstaff and
Schwartz (2001) to obtain the optimal exercise boundaries and then the payoffs.
B3.

Aggregation and netting agreements
After generating cash flows for each deal, we need to aggregate them at counterparty

portfolio level at each scenario and each time bucket. The cash flows are aggregated by either
netting or nonnetting based on the netting agreements. A netting agreement is a provision that
allows the offset of settlement payments and receipts on all contracts between two counterparties.
Another important use of netting is the close-out netting that allows the offset of close-out values.
For netting, we add all cash flows together at the same scenario and the same time bucket
to recognize offsetting. The aggregated cash flow under netting at scenario j and time bucket k is
given by

~ j ,k =  ~ j ,k ,i
i

(B3)

For nonnetting, we divided cash flows into positive and negative groups and add them
separately. In other words, the offsetting is not recognized. The aggregated cash flows under
nonnetting at scenario j and time bucket k are given by

~ j ,k

  ~ j ,k ,l
 l

=
 ~
 m j ,k ,m

if  j ,k ,l  0
if  j ,k ,m  0

(B4)

22

B4.

Margin (or collateral) agreements
For a more detailed discussion on pricing collateralized contract/portfolio, see Xiao

(2013b).
B5.

CVA Calculation
After aggregating all cash flows via netting, one can price a portfolio in the same manner

as pricing a single deal. We assume that the reader is familiar with the least square Monte Carlo
valuation model proposed by Longstaff and Schwartz (2001) and thus do not repeat some wellknown procedures for brevity.
If the counterparty portfolio is collateralized, we can calculate the risky value based on
equation (21) of Xiao (2013b). If there is no collateral agreement, we can price the portfolio
according to Proposition 4 in this paper.
CVA is by definition the difference between the risk-free portfolio value and the true (or
risky or defaultable) portfolio value.

Reference
Brigo, D., and Capponi, A., 2008, Bilateral counterparty risk valuation with stochastic dynamical
models and application to Credit Default Swaps, Working paper.

Duffie, Darrell, and Ming Huang, 1996, Swap rates and credit quality, Journal of Finance, 51,
921-949.

Duffie, Darrell, and Kenneth J. Singleton, 1999, Modeling term structure of defaultable bonds,
Review of Financial Studies, 12, 687-720.

FinPricing, 2015, Financial Market Solution, https://finpricing.com/product.html

23

Gregory, Jon, 2009, Being two-faced over counterparty credit risk, RISK, 22, 86-90.

Hull, J. and White, A., 2013, CVA and wrong way risk, forthcoming, Financial Analysts Journal.

Jarrow, R. A., and Protter, P., 2004, Structural versus reduced form models: a new information
based perspective, Journal of Investment Management, 2, 34-43.

Jarrow, Robert A., and Stuart M. Turnbull, 1995, Pricing derivatives on financial
securities subject to credit risk, Journal of Finance, 50, 53-85.

Lipton, A., and Sepp, A., 2009, Credit value adjustment for credit default swaps via the structural
default model, Journal of Credit Risk, 5(2), 123-146.

Longstaff, Francis A., and Eduardo S. Schwartz, 2001, Valuing American options by simulation:
a simple least-squares approach, The Review of Financial Studies, 14 (1), 113-147.

Moody’s Investor’s Service, 2000, Historical default rates of corporate bond issuers, 1920-99.

J. P. Morgan, 1999, The J. P. Morgan guide to credit derivatives, Risk Publications.

O’Kane, D. and S. Turnbull, 2003, Valuation of credit default swaps, Fixed Income Quantitative
Credit Research, Lehman Brothers, QCR Quarterly, 2003 Q1/Q2, 1-19.

Pykhtin, Michael, and Steven Zhu, 2007, A guide to modeling counterparty credit risk, GARP
Risk Review, July/August, 16-22.

24

Sorensen, E. and T. Bollier, 1994, Pricing swap default risk, Financial Analysts Journal, 50, 2333.

Xiao, T., 2013a, The impact of default dependency and collateralization on asset pricing and
credit risk modeling, Working paper.

Xiao, T., 2013b, An economic examination of collateralization in different financial market,
Working paper.

25

