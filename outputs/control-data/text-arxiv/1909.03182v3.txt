TO APPEAR IN THE 58TH CONFERENCE ON DECISION AND CONTROL, NICE, FRANCE, DECEMBER 11‚Äì13, 2019

1

State Estimation in Water Distribution Networks through a New
Successive Linear Approximation

arXiv:1909.03182v3 [eess.SY] 26 Apr 2020

Shen WangÀö , Ahmad F. TahaÀö , Lina Sela; , Nikolaos GatsisÀö , and Marcio H. Giacomoni:

Abstract‚ÄîState estimation (SE) of water distribution networks
(WDNs) is difficult to solve due to nonlinearity/nonconvexity of
water flow models, uncertainties from parameters and demands,
lack of redundancy of measurements, and inaccurate flow and
pressure measurements. This paper proposes a new, scalable
successive linear approximation to solve the SE problem in
WDNs. The approach amounts to solving either a sequence
of linear or quadratic programs‚Äîdepending on the operators‚Äô
objectives. The proposed successive linear approximation offers a
seamless way of dealing with valve/pump model nonconvexities, is
different than a first order Taylor series linearization, and can be
incorporated into with robust uncertainty modeling. Two simple
test-cases are adopted to illustrate the effectiveness of proposed
approach using head measurements at select nodes.

I. I NTRODUCTION AND PAPER C ONTRIBUTIONS
Water distribution networks (WDNs) are designed to deliver water to various residential and business consumers with
sufficient pressure and flow [1]. The calculation of flows and
heads/pressures in WDNs can be obtained by the principles
of conservation of mass and energy. The former implies the
continuity of flow at nodes, and the latter states that energy
difference stored in a component equals the energy increases
minus energy losses, such as, frictional and minor losses [2].
The challenging part of monitoring WDNs is that pipes are
usually buried underground and are inaccessible [3]. Hence,
it is impossible to monitor the flow in all pipes and the head
at all nodes even with modern supervisory control and data
acquisition (SCADA) systems, let alone enable continuous
monitoring of WDNs, which is limited in practice due to high
investment, operations and maintenance costs [4].
A practical approach to gain a network-wide observability,
while addressing the aforementioned limitations, is to use state
estimation (SE), which can determine the unknown variables
of a system based on a set of local measurements and a
hydraulic network model [5]. Usually, the set of measurements
consists of heads at key nodes and the flows through key
links. However, the SE problem is difficult due to uncertainty
from pipe roughness coefficients, demands, and measurement
errors [6]. One way to reduce uncertainty is by introducing
redundancy of observations, which significantly improves the
Àö Department of Electrical and Computer Engineering, The University of
Texas at San Antonio. : Department of Civil and Environmental Engineering,
The University of Texas at San Antonio, ; Department of Civil, Architectural and Environmental Engineering, Cockrell School of Engineering, The
University of Texas at Austin. Emails: mvy292@my.utsa.edu, {ahmad.taha,
nikolaos.gatsis, marcio.giacomoni}@utsa.edu, linasela@utexas.edu. This material is based upon work supported by the National Science Foundation under
Grant CMMI-DCSD-1728629.

performance of the SE procedure. The degree of redundancy
is achieved by combining actual measurements (e.g., heads and
flows) with the pseudo-measurements (e.g., demands); however,
due to limited measurement availability, the application of SE
algorithms to WDNs is an ongoing research [3].
In WDNs, the SE problem is predominantly cast as an
inverse problem to determine unknown system conditions with
an objective, e.g., weighted least-squares (WLS), to minimize
the mismatch between measurements and hydraulic model
estimations [7]. The authors in [8] discuss a way to obtain the
solution from over-determined measurements. The study [9]
produces solutions that are consistent with available SCADA
data by adjusting estimated demands based on WLS method.
The authors in [10] use Monte Carlo simulation (MCS) to
evaluate the effect of variable demands on pressure and water
quality, and their work is extended by [11]. In order to overcome
the computational time of MCS, a new approximate method for
uncertainty analysis is proposed in [12].
The authors in [13] propose a SE in the presence of control
devices with switching behavior, such as pressure reducing
valves after a minor modification of existing WLS solvers. An
approach combining regression-trees with genetic algorithms to
fit demands to the observations was proposed in [14]. In [6], the
authors solve the real-time SE problem using interval linearization of the nonlinear flow equations and successively tightening
the interval bounds. In summary, the SE problem results in
nonlinear and nonconvex system of equations, which exhibit
serious scalability issues when applied to realistic WDNs.
This paper proposes a new, scalable successive linear approximation to solve the SE problem in WDNs. The approach
amounts to solving either a sequence of linear or quadratic
programs (LP/QP), depending on the operator‚Äôs objectives. The
proposed successive linear approximation offers a seamless
way of dealing with valve/pump model nonconvexities, is
different than a first order Taylor series linearization, and can
be easily incorporated into uncertainty modeling. The paper‚Äôs
contributions can be summarized as follows:
‚Äö The classical, highly nonlinear and nonconvex state estimation
problem is converted into successive convex LP/QP problems
via geometric programming (GP) approximation [15].
‚Äö A new optimization technique is introduced to solve the
nonconvex SE problem through a tractable computational algorithm for a general WDN topology. The proposed research
builds on our recent work on pump control of WDNs using
GP [16], but offers a different approach through LP formulation,
in comparison with our prior work.
The paper organization is given next. Section II describes SE

TO APPEAR IN THE 58TH CONFERENCE ON DECISION AND CONTROL, NICE, FRANCE, DECEMBER 11‚Äì13, 2019

2

Tab. I: Hydraulic models of pipes and pumps and their converted models (time index k is ignored for each variable for simplicity).
Pipes
¬µ¬¥1
‚àÜhP
ij ‚Äú hi ¬¥ hj ‚Äú Rij qij |qij |

Original Hydraulic Model

p P ¬¥1 qÃÇ ¬¥1
hÃÇi hÃÇ¬¥1
j rCij s
ij

GP Form

‚àÜhP
ij

Linear Form

‚Äú hi ¬¥ hj ‚Äú

‚Äú1

P
Cij

II. M ODELING AND S TATE E STIMATION OF WDN S
WDN is modeled by a directed ≈§
graph≈§pV, Eq. Set V defines
nodes and is partitioned as V ‚Äú J T R where J , T , and
R stand for the collection of junctions, tanks, and reservoirs.
Let E ƒé
≈§VÀÜ
≈§V be the set of links, and define the partition
E ‚Äú P M W, where P, M, and W stand for the collection
of pipes, pumps, and valves. For the ith node, set Ni≈§collects
its neighboring nodes and is partitioned as Ni ‚Äú Niin Niout ,
where Niin and Niout stand for the collection of inflow and
outflow nodes. According to the principles of conservation of
mass and energy, we present the modeling in WDNs next.
A. Modeling WDNs
In this section, we introduce the modeling of WDNs.
1) Tanks and Reservoirs: The water hydraulic dynamics
in the ith tank can be expressed by a discrete-time difference
equation [16]
¬®
Àõ
TK
hTK
i pk ` 1q‚Äúhi pkq`

√ø
‚àÜt Àù √ø
q
pkq¬¥
qij pkq‚Äö.
ji
ATK
out
i
in
jPNi

(7)

jPNi

TK
where hTK
respectively stand for the head, cross-sectional
i , Ai
th
area of the i tank, and ‚àÜt is sampling time; qji pkq, j P Niin is
inflow, while qij pkq, j P Niout is outflow of the j th neighbor.
We assume that reservoirs have infinite water supply and the
set
head of the ith reservoir is fixed as hR
[17], [18] which is
i
perfectly accurate. This also can be viewed as an operational
constraint (9a).
2) Junctions and Pipes: Junctions are the points where water
flow merges or splits. The expression of mass conservation of
the ith junction√øcan be written√ø
as
qji pkq ¬¥
qij pkq ‚Äú di pkq,
(8)
jPNiin

jPNiout

where di pkq stands for end-user demand that is extracted from
node i at time k.
The major head loss of a pipe from node i to j is due to
friction and is determined by (1) from Tab. I, where R is the
pipe resistance coefficient and ¬µ is the constant flow exponent,
both are determined by the corresponding formula, HazenWilliams, Darcy-Weisbach, or Chezy-Manning. The approach
we proposed considers any of the three formulae [18]. Minor
head losses are not considered in this paper, but can be easily
modeled through equivalent pipe length.

Pumps
¬¥1 ŒΩ
2
‚àÜhM
ij ‚Äú hi ¬¥ hj ‚Äú ¬¥sij ph0 ¬¥ rpqij sij q q
p M ¬¥1 rqÃÇij s¬¥Cp2M
hÃÇi hÃÇ¬¥1
j rC1 s

(3)

` qij

formulation. In Section III, the proposed optimization-based
SE technique is introduced, conversion of nonconvex SE into
LP/QP is given, and two test-cases are used to illustrate the
effectiveness of our approach in Section IV. Finally, Section V
presents the paper‚Äôs limitations and future research directions.

(1)

‚àÜhM
ij

(5)

‚Äú hi ¬¥ hj ‚Äú

C1M

`

(2)

‚Äú1

(4)

C2M qij

(6)

3) Head Gain in Pumps: A head increase/gain can be
generated by a pump between suction node i and delivery node
j. Generally, the head gain can be expressed as (2), where
h0 , r, and ŒΩ are the pump curve coefficients; qij is the flow
through a pump; sij P r0, smax
ij s is the relative speed of the
pump, we assume that the speed is fixed and can be expressed
as sij ‚Äú smax
‚Äú 1. Notice that head gain hM
ij
ij is always negative,
and can be viewed as an operational constraint (9b).
For all the operational limitations of head at each junction
and flow though each pipe, we list them as (9c). Hence, the
compact constraints are
Rset
Constraints :
hR
(9a)
i pkq ‚Äú hi
hM
ij pkq ƒè 0
hmin
i

ƒè hi pkq ƒè

hmax
,
j

min
qij

(9b)
ƒè qij pkq ƒè

max
qij
.

(9c)

B. State Estimation Formulation
Classical state estimation problems are typically presented as
y ‚Äú gpŒæq ` ,
(10)
where Œæ is the unknown variable, vector y includes all measured
quantities, the gpŒæq is the model of system including nonlinear
functions, and the  represents error between true model and
measured values via sensors. As we mentioned in Section I, it
is impossible to measure flows and pressures in the entire WDN,
except for key locations. Hence, Œæ can be a vector collecting all
unknown variables
and defined as
!
)
Œæpkq fi hJ pkq, hR pkq, hTK pkq, q P pkq, q M pkq .
(11)
where hJ , hR , and hTK collects the heads at junctions, reservoirs, and tanks; q P and q M collects the flow through pipes and
pumps. The y can be treated as the vector collecting several
measured key heads in the scenario of WDNs (sensors are
assumed available to measure head). The overall WDN-SE
problem can now be written as
≈ôT
WDN-SE : min f pq ‚Äú k‚Äú1 J pkqW pkqpkq
Œæpkq

s.t. hTK pk ` 1q ‚Äú hTK pkq ` E TK q P pkq
‚Äû P Ôöæ
q pkq
dpkq ‚Äú Eq M
q pkq

(12a)
(12b)

Constraints (9)
(12c)
where k is time-index; T is time-horizon; Œæpkq for all k ‚Äú
1, . . . , T is the optimization variable that includes unmeasured
heads h and flows q; ne represents the number of measurements; pkq P Rne ÀÜ1 is the error to be minimized; f pq is a
WLS objective function
and
‚Äû
Ôöæ
‚àÜhP pkq ‚Äú Œ¶P pq P pkqq
r ,
pkq ‚Äú Eh
¬¥‚àÜ
hpkq
loomoon
‚àÜhM pkq ‚Äú Œ¶M pq M pkqq
loooooooooooooooooomoooooooooooooooooon
y
gpŒæq

TO APPEAR IN THE 58TH CONFERENCE ON DECISION AND CONTROL, NICE, FRANCE, DECEMBER 11‚Äì13, 2019

where Œ¶P p¬®¬®q and Œ¶M p¬®¬®q collect the nonlinear head loss (1) of
all pipes and the nonlinear head gain (2) of all pumps. The
residual  is reminiscent of the model in (10) and captures the
r
error between the true model and differences ‚àÜhpkq
between
head measurements, while matrix Eh is related to the position
of sensors.
The weight matrix at time k is given by a diagonal matrix
W pkq: smaller diagonal elements in W pkq imply more accurate
measurements. In practice, sensors are usually fixed in key
nodes, and accuracy of sensors can also be assumed as fixed.
Hence, W pkq is assumed to be a constant matrix. The objective
function is thus designed to minimize the weighted error, and
we refer to W as accuracy matrix. The constraints in WDN-SE
are discussed next.
Equation (12a) collects the dynamics (7) of all tanks in the
network, and E TK is formed by the coefficients of flows in (7).
In fact, this constraint can be added and removed according
to the situation; e.g., this constraint can be removed when
performing single period analysis. Equation (12b) collects (8)
at all nodes, where matrix Eq is defined by WDNs topology,
and vector dpkq collects water demands at all junctions. We
do not consider demand uncertainty, and thus dpkq is assumed
known and perfectly accurate. Constraint (12c) includes the
linear constraints presented in Section II-A; i.e., the heads of
reservoirs are usually fixed and equal to their elevation. Hence,
we assume that the measurement of hR is very accurate.
Notice that any head difference can be expressed as the linear
combination of nonlinear models of pipes and pumps using Eh .
This key observation is thoroughly illustrated in Fig. 3(a) in
Section IV. We note the following about the WDN-SE problem.
‚Äö Two scenarios exist in SE problem in WDNs [8]: Scenario 1
is described by having sufficient measurements, e.g., all states
can be determined if heads at tanks and reservoirs are known,
see the blue line in Fig. 3(a). In fact, the SE in this scenario
has equal number of variables and equations. Scenario 2 refers
to the case with over-determined equations, e.g., additional sets
of head are measured at several key nodes besides the head at
tanks and reservoirs, see the red line in Fig. 3(a). Numerical
tests are given in Section IV for both scenarios.
‚Äö WDN-SE Problem (12) is nonconvex due to the nonlinearity
and nonconvexity of head loss/gain models Œ¶P p¬®¬®q and Œ¶M p¬®¬®q of
pipes and pumps‚Äîthe nonconvexity shows up in the objective
function, rather than the constraints. The only optimization variable in WDN-SE is Œæpkq, and other variables such as ‚àÜhP pkq
are expressions of vectors included in Œæ (11). Finally, certain
variables in Œæpkq, notably the measured heads at reservoirs and
tanks, are considered to be known.
‚Äö While WDN-SE pertains to SE given a batch of measurements
for k ‚Äú 1, . . . , T and then reconstructs the estimates Œæpkq for
that time-period, a simple windowing algorithm can yield near
real-time state estimates.
III. N EW L INEAR A PPROXIMATION OF WDN-SE
In this section, we propose a new method inspired by
geometric programming to convert the nonlinear head loss
model (1) and head gain model (2) into GP constraints which
can also be rewritten as linear constraints. A basic introduction

3

to GP is given at first, and then a new optimization technique
related with GP is proposed for ensuing sections.
A. Geometric Program and A New Optimization Technique
A geometric program [19] is a type of optimization problem
can be expressed as
GP: min f0 pxq
xƒÖ0

s.t.

fi pxq ƒè 1, i ‚Äú 1, ¬® ¬® ¬® , m

(13)

gi pxq ‚Äú 1, i ‚Äú 1, ¬® ¬® ¬® , p,
where x is an entry-wise positive optimization variable, fi pxq
are posynomial functions and gi pxq are monomials.
One main requirement of the GP formulation is the positiveness of the decision variables, which limits some decision variables and physical constraints in our setting, e.g., flows in pipes
and headloss equation. To overcome this modeling limitation
we are inspired by linear programming (LP) techniques. In the
simplex method [20], for example, the free variables are split
into a positive and negative part, both being nonnegative. In our
case, we introduce an exponential function f pxq ‚Äú bx to convert
a nonpositive variable to a positive one, since f pxq is always
positive. Using this technique, we can convert some problems
with negative feasible regions into a new problem with a positive
feasible region, and then solve it by using modern optimization
solvers. This technique has been successfully applied to solve
the control of WDNs in our recent work [16]. The SE problem
here is similar to the control problem of WDNs; however, in
the current paper, we convert the SE problem (12) into an LP or
QP problem instead of a GP, which provides more elegant‚Äîand
computationally more efficient‚Äîsolutions.
B. Conversion of Energy Balance Equations
Based on the newly introduced optimization technique in
Section III-A, we first convert the nonlinear hydraulic model
of WDNs into its GP form and then into its LP form. Here,
we convert the head at the ith node hi and the flow qij into
positive values hÃÇi and qÃÇij through exponential functions, hÃÇi fi
bhi , qÃÇij fi bqij , where b ‚Äú 1 ` Œ¥ is a constant base and Œ¥ is a
small positive number. Notice that we only need to convert the
Œ¶P p¬®¬®q and Œ¶M p¬®¬®q into linear form because others are already
linear. Tab. I show detailed conversions of all physical models
that are all discussed in the following sections.
Next, we convert the pipe model, and let hÃÇP
ij be the GP form
of head loss of a pipe, which is obtained by exponentiating both
sides of (1) as follows
qij pRij |qij |¬µ¬¥1 ¬¥1q
p P pqij q qÃÇij ,
hÃÇi hÃÇ¬¥1
qÃÇij ‚Äú C
ij
j ‚Äúb
¬µ¬¥1
qij pRij |qij |
¬¥1q
P
p
where C pq q ‚Äú b
is a function of q . Hence,
ij

ij

ij

the head loss constraint for each pipe can be written as a
monomial equality constraint, which is expressed as (3), if a
p P pqij q is known. In order to make it linear, we
an estimate of C
ij
can execute the log function on both sides of (3) and obtain (5)
p P pqij q turns into C P pqij q ‚Äú qij pRij |qij |¬µ¬¥1 ¬¥ 1q.
where C
ij
ij
We note that the expression above is linear with respect to
P
Cij
pqij q if qij is known, hence we develop a method to find
P
qij by sequentially updating qij and Cij
pqij q. The technique is
introduced here. At first, we can make an initial guess denoted

TO APPEAR IN THE 58TH CONFERENCE ON DECISION AND CONTROL, NICE, FRANCE, DECEMBER 11‚Äì13, 2019

P
y0 can be obtained if xqij y0 is
by xqij y0 for the 0th iteration (xCij
th
known), thus, for the n iteration, the corresponding values are
P
denoted by xqij yn and xCij
yn . If the flow rates are close to each
other between two successive iterations, we can approximate
P
P
P
P
yn¬¥1 . Then, for
yn ¬´ xCij
yn¬¥1 , that is xCij
yn using xCij
xCij
each iteration n, we have
¬¥
¬Ø
¬µ¬¥1
P
xCij
yn ‚Äú xqij yn¬¥1 R|xqij yn¬¥1 |
¬¥1 ,

and it can be approximated by a constant given the flow value
xqij yn¬¥1 from the previous iteration.
Similarly, the new variables qÃÇij ‚Äú bqij and sÃÇij ‚Äú bsij for
pi, jq P M are introduced for pumps. Let hÃÇM
ij be the GP form
of head increase of a pump
ŒΩ¬¥1 2¬¥ŒΩ
2
p M pqÃÇij qCp2M ,
hÃÇi hÃÇ¬¥1 ‚Äú b¬¥sij h0 pbqij qrqij sij ‚Äú C
j
M
p
C1

1
ŒΩ¬¥1 2¬¥ŒΩ
rqij sij .

¬¥s2ij h0

pM ‚Äú
where
‚Äú b
and C
Hence, the
2
approximating equation for the pump head increase becomes the
monomial equality constraint (4) in Tab. I. After executing log
function on both sides of (4), the equation (6) can be obtained,
which is a linear constraint. And at the same time, the parameters
p M and C
p M become C M and C M , that is
C
1
2
1
2
ŒΩ¬¥1 2¬¥ŒΩ
C1M ‚Äú ¬¥s2ij h0 , C2M ‚Äú rqij
sij .
M
M
Parameters C1 are fixed, while C2 follow a similar iterative
P
process as Cij
. That is, starting with an initial guess for the
flow rates and relative speeds, the constraints are approximated
at every iteration via constraints abiding by the linear form,
as listed in Tab. I. This process continues until a termination
criterion is met. The details are further discussed in Algorithm 1.

4

Algorithm 1: Successive approximation of WDN-SE.

1
2
3
4
5
6
7
8
9
10
11
12
13

Input: WDN topology, xŒæy0 , demand tdpkquTk‚Äú1 ,
r the accuracy matrix W
measurements of head h,
Output: The estimated state value tŒæSE pkquTk‚Äú1
Set Œæsave :‚Äú xŒæy0 , n ‚Äú 1, step ‚Äú 4, a ‚Äú 3
while error ƒõ threshold OR n ƒè maxIter do
P
Obtain xCij
yn , xC1M yn , and xC2M yn from xŒæyn¬¥1
Generate constraints and form it as LP/QP-SE (14)
Solve (14) and obtain xŒæyn
if modpn, stepq ‚Äú 0 then
‚àÜŒæ ‚Äú xŒæyn ¬¥ xŒæyn¬¥2
xŒæyn ‚Äú xŒæyn ` a‚àÜŒæ
end if
Calculate error :‚Äú normpxŒæyn ¬¥ Œæsave q
Update Œæsave ‚Äú xŒæyn and n ‚Äú n ` 1
end while
Set ŒæSE ‚Äú xŒæyn

h3

h2
<latexit sha1_base64="OPJuPu1BsyzlmykO0PaoiXom5s8=">AAAB6nicbVDLSgNBEOyNrxhfUY9eBoPgKewGIR4DXjzGRx6QLGF20psMmZ1dZmaFsOQTvHhQxKtf5M2/cZLsQRMLGoqqbrq7gkRwbVz32ylsbG5t7xR3S3v7B4dH5eOTto5TxbDFYhGrbkA1Ci6xZbgR2E0U0igQ2AkmN3O/84RK81g+mmmCfkRHkoecUWOlh/GgNihX3Kq7AFknXk4qkKM5KH/1hzFLI5SGCap1z3MT42dUGc4Ezkr9VGNC2YSOsGeppBFqP1ucOiMXVhmSMFa2pCEL9fdERiOtp1FgOyNqxnrVm4v/eb3UhNd+xmWSGpRsuShMBTExmf9NhlwhM2JqCWWK21sJG1NFmbHplGwI3urL66Rdq3pu1bu7qjTu8ziKcAbncAke1KEBt9CEFjAYwTO8wpsjnBfn3flYthacfOYU/sD5/AH5lY2h</latexit>

h4
<latexit sha1_base64="EuJAFJpFfV2PApzroxDxRIYWE04=">AAAB6nicbVDLSgNBEOyNrxhfUY9eBoPgKexKIB4DXjzGRx6QLGF20psMmZ1dZmaFsOQTvHhQxKtf5M2/cZLsQRMLGoqqbrq7gkRwbVz32ylsbG5t7xR3S3v7B4dH5eOTto5TxbDFYhGrbkA1Ci6xZbgR2E0U0igQ2AkmN3O/84RK81g+mmmCfkRHkoecUWOlh/GgNihX3Kq7AFknXk4qkKM5KH/1hzFLI5SGCap1z3MT42dUGc4Ezkr9VGNC2YSOsGeppBFqP1ucOiMXVhmSMFa2pCEL9fdERiOtp1FgOyNqxnrVm4v/eb3UhNd+xmWSGpRsuShMBTExmf9NhlwhM2JqCWWK21sJG1NFmbHplGwI3urL66R9VfXcqndXqzTu8ziKcAbncAke1KEBt9CEFjAYwTO8wpsjnBfn3flYthacfOYU/sD5/AH8nY2j</latexit>

<latexit sha1_base64="5QVrO1rw2iwU11hjrAFl0Obj9OQ=">AAAB6nicbVDLSgNBEOyNrxhfUY9eBoPgKexqQI8BLx7jIw9IljA76U2GzM4uM7NCWPIJXjwo4tUv8ubfOEn2oIkFDUVVN91dQSK4Nq777RTW1jc2t4rbpZ3dvf2D8uFRS8epYthksYhVJ6AaBZfYNNwI7CQKaRQIbAfjm5nffkKleSwfzSRBP6JDyUPOqLHSw6h/2S9X3Ko7B1klXk4qkKPRL3/1BjFLI5SGCap113MT42dUGc4ETku9VGNC2ZgOsWuppBFqP5ufOiVnVhmQMFa2pCFz9fdERiOtJ1FgOyNqRnrZm4n/ed3UhNd+xmWSGpRssShMBTExmf1NBlwhM2JiCWWK21sJG1FFmbHplGwI3vLLq6R1UfXcqndXq9Tv8ziKcAKncA4eXEEdbqEBTWAwhGd4hTdHOC/Ou/OxaC04+cwx/IHz+QP7GY2i</latexit>

q23
<latexit sha1_base64="GGNt3eCI80nqw6NR27rrxBSk3IY=">AAAB7XicbVBNSwMxEJ34WetX1aOXYBE8ld0q6LHgxWMV+wHtUrJpto3NJmuSFcrS/+DFgyJe/T/e/Dem7R609cHA470ZZuaFieDGet43WlldW9/YLGwVt3d29/ZLB4dNo1JNWYMqoXQ7JIYJLlnDcitYO9GMxKFgrXB0PfVbT0wbruS9HScsiMlA8ohTYp3UfOxl1fNJr1T2Kt4MeJn4OSlDjnqv9NXtK5rGTFoqiDEd30tskBFtORVsUuymhiWEjsiAdRyVJGYmyGbXTvCpU/o4UtqVtHim/p7ISGzMOA5dZ0zs0Cx6U/E/r5Pa6CrIuExSyySdL4pSga3C09dxn2tGrRg7Qqjm7lZMh0QTal1ARReCv/jyMmlWK75X8W8vyrW7PI4CHMMJnIEPl1CDG6hDAyg8wDO8whtS6AW9o4956wrKZ47gD9DnDz/ajvM=</latexit>

q34
<latexit sha1_base64="uTthD5snRq3uX5FZa2ijAx3BjGA=">AAAB7XicbVDLSgNBEOz1GeMr6tHLYBA8hV0N6DHgxWMU84BkCbOT2WTMPNaZWSEs+QcvHhTx6v9482+cJHvQxIKGoqqb7q4o4cxY3//2VlbX1jc2C1vF7Z3dvf3SwWHTqFQT2iCKK92OsKGcSdqwzHLaTjTFIuK0FY2up37riWrDlLy344SGAg8kixnB1knNx152UZ30SmW/4s+AlkmQkzLkqPdKX92+Iqmg0hKOjekEfmLDDGvLCKeTYjc1NMFkhAe046jEgpowm107QadO6aNYaVfSopn6eyLDwpixiFynwHZoFr2p+J/XSW18FWZMJqmlkswXxSlHVqHp66jPNCWWjx3BRDN3KyJDrDGxLqCiCyFYfHmZNM8rgV8Jbqvl2l0eRwGO4QTOIIBLqMEN1KEBBB7gGV7hzVPei/fufcxbV7x85gj+wPv8AULljvU=</latexit>

(a) 3-node network.

(b) Visualization of equation (15) of 3-node network.

Fig. 1: 3-node network and visualization of its equations.

D. Iterative Algorithm

C. LP/QP Formulation of SE
After the conversion of pipe and pump model constraints, we
can express the converted problem as
LP/QP-SE : minŒæpkq
f pq
(14a)
s.t.

(12a) ¬¥ (12c)
P

P

(14b)
P

‚àÜh pkq ‚Äú q pkq ` C pkq
M

C1M pkq

C2M pkqq M pkq

(14c)

‚àÜh pkq ‚Äú
`
(14d)
where constraints and variables remain the same as in (12)
except that constraints (14c) and (14d) are now linear and
viewed as constraints. The parameters C P is a Rnp ÀÜ1 vector
P
collecting the Cij
for each pipe. Similarly, the C1M and C2M are
a Rnm ÀÜnm diagonal matrices collecting C1M and C2M for each
pump.
We note the following: (i) LP/QP-SE (14) is only an approximation of WDN-SE (12) at a specific point (the flow
through pipes and pumps qij ), in other words, the nonconvex
WDN-SE can be approximated by successive convex LP/QPSE. (ii) The converted model is linear but it is not the equivalent
to the first order Taylor series linearization. We present the
geometric meaning of the conversion we applied via a concrete
example in Section IV-A1. (iii) LP/QP-SE can be expressed
as either an LP or QP depending on the objective function.
When
modeled through the absolute weighted error,
≈ôTf pq≈ôis
ne
i.e., k‚Äú1 i‚Äú1
wi pkq|i pkq|, the problem can be written as an
LP. When it is based on WLS, then it becomes a standard QP.

In order to solve all the unknown variables, our algorithm
needs to know the basic information at first, e.g., the topology
of tested network to form the matrices Eq , demand d, measurer and the accuracy matrix W .
ments of head h,
Notice that all variables are collected in Œæ by (11) and the
notation xŒæyn in Algorithm 1 stands for the nth iteration value
Œæ. For the 0th iteration, we initialize all flow xq P y0 and xq M y0
in xŒæy0 with historical average flows. In fact, this algorithm
still works by initializing all the flow in xŒæy0 with random
number. However, the convergence is relatively slow. All initial
statuses of pumps, tanks, and reservoirs are initialized with the
value set in ‚Äú.inp‚Äù source file which is a standard input file
used by EPANET, e.g., the initial status (open or close) and
speed (if open) of pumps, and the initial head value xhR y0 and
P
xhTK y0 of tanks and reservoirs. The parameters xCij
y1 , xC1M y1 ,
M
and xC2 y1 are then calculated by initialized values according
to Section III-B, and all constraints are automatically generated
for different WDNs topologies.
After solving (14) and obtaining the current solution xŒæyn ,
and defining the iteration error as the Euclidean distance between two consecutive iterations, we set xŒæyn as the saved value
for error calculation in next iteration by assigning Œæsave ‚Äú xŒæyn .
The iteration continues until the error is less than a predefined
threshold (threshold) or a maximum number of iterations
(maxIter) is reached, and the final solution is ŒæSE . The bottleneck of this algorithm is solving a scalable LP/QP successively

TO APPEAR IN THE 58TH CONFERENCE ON DECISION AND CONTROL, NICE, FRANCE, DECEMBER 11‚Äì13, 2019

Tab. II: Formulations of 3-node network (time index k is ignored).

Tab. III: Results of 3-node and 8-node network.

Original formulation
P
r
min kŒ¶P
23 pq23 q ` Œ¶34 pq34 q ¬¥ ‚àÜh24 k
s.t. q23 ¬¥ q34 ‚Äú d3

SE formulation
min J 
(16)
¬´ ff
‚Äù
ƒ± q
23
` d3
s.t. 0 ‚Äú 1 ¬¥1
q34
ff
¬´
Œ¶P
23 pq23 q
‚àÜhP ‚Äú
Œ¶P
34 pq34 q

(a) Results for the 3-node network.
Sufficient
Over-determined
measurements scenario
measurements scenario

(15)

QP-SE formulation
J 
(17)
¬´ ff
‚Äù
ƒ± q
23
` d3
s.t. 0 ‚Äú 1 ¬¥1
q34
ff
¬´ ff ¬´
P
q23
C23
`
‚àÜhP ‚Äú
P
q34
C34

min

which should not cause a large computational burden, even if
tens of iterations are required to converge. We note that Steps 7
and 8 are used to accelerate the computational times, since the
direction of the search is known, and the acceleration parameter
a in Step 8 is needed to be adjusted according to the specific
WDN. This will be investigated in future work. We finally
note that Algorithm 1 does not show the windowing process
of performing real-time SE, as the algorithm only shows batch
state estimation. However, a moving horizon window can be
implemented within Algorithm 1 thereby allowing real-time
state estimation.

IV. C ASE S TUDIES

We present two simulation examples to illustrate the applicability of our approach. The first 3-node network is used to
illustrate the geometric meaning of proposed method, and then
we test the 8-node network to illustrate that our approach can
handle looped topology. All numerical tests are simulated using
EPANET Matlab Toolkit [21] on Ubuntu 16.04.4 LTS with an
Intel(R) Xeon(R) CPU E5-1620 v3 @ 3.50 GHz. CVX [22]
is used to solve the optimization problem. We set the base
b ‚Äú 1.001 when converting the variables. All case studies are
performed for T ‚Äú 1 time-horizon; the head unit is ft; and the
flow unit is GPM. All codes, parameters, and tested networks
are available in [23].

5

Variables
Fmincon with
GlobalSearch
Algorithm 1

q23

q34

q23

q34

238.607

38.607

234.690

34.690

238.538

38.528

235.007

35.007

(b) Results for the 8-node network.
hTK
8

h3

h5

q46

True value: ŒæEPANET

834.00

875.89

863.49

82.50

Measurement: ŒæÃÉ

834.60

875.64

‚Äî

‚Äî

834.56
833.89

876.40
875.81

864.01
863.36

82.44
83.81

Estimation from
Algorithm 1 pŒæSE q

Case 1
Case 2

1) Sufficient measurements scenario: Suppose that we measure head difference ‚àÜr
h24 between Junction 2 and 4, and
estimates of the flows q23 and q34 are sought. According to (10),
the classical SE is presented as (15) in Tab. II. In fact, it can
be visualized as Fig. 1(b) where the red surface is nonlinear
P
Œ¶P
23 pq23 q ` Œ¶34 pq34 q, the blue surface is linear conservation
of mass constraint,and the gray surface is measured head
difference ‚àÜr
h24 . The solution is in the intersection of these
three surfaces. In order to see the feasible set, we can view 3D
plot from top (ignore ‚àÜr
h24 dimension). Notice that the feasible
set can be viewed as the intersection of red and gray surfaces,
and it is highly nonconvex in 2D.
After conversion, the corresponding QP
‚Äú form
‚Ä∞ of SE (16) is
presented as (17) in Tab. II, where  ‚Äú 1 1 ‚àÜhP ¬¥‚àÜr
h24 .
Iteration process is presented in Fig. 2, and intersection of blue
and red surface in the left plot are approximated by the intersection of blue surface and multi-green surfaces in the right plot.
As we mentioned, this is a new type of linear approximation
but not the first order Taylor series of the nonlinear function,
we can notice this from the green surfaces.
2) Over-determined measurements scenario: Suppose that
we measure two head differences ‚àÜr
h23 and ‚àÜr
h24 and that the
r
‚àÜh23 is ten times more accurate than ‚àÜr
h24 . Therefore, the
weight in the objective function must be updated. Hence, the
SE problem can simply be presented as
P
P
r
r
min kŒ¶P
23 pq23 q¬¥‚àÜh23 k`0.1kŒ¶23 pq23 q`Œ¶34 pq34 q ¬¥ ‚àÜh24 k
s.t. q23 ¬¥ q34 ‚Äú d3
(18)
With such changes, the objective function in (17) becomes
J diagp1, 0.1q and the corresponding
is
¬´ expression
ff
‚Äû
Ôöæ
1 0
‚àÜr
h23
‚Äú
‚àÜhP ¬¥
,
r
1 1
‚àÜh24

Fig. 2: (Left) 3D visualization of (15); (Right) Iteration process of
solving scenario 1 (sufficient measurements) for 3-node network.

A. Three-node Network
The 3-node network comprised of 3 junctions and 2 pipes is
shown in Fig. 1(a), and no demand at Junctions 2 and 4.

and notice that it is still a QP. In order to prove the effectiveness
of our approach, our results is compared with solutions from
other solvers. On one hand, the nonlinear optimization problems (15) and (18) can be solved optimally via fmincon with
GlobalSearch option in Matlab, on the other hand, it can
be solved via Algorithm 1. The final results and comparisons
are listed in Tab. III(a). We can see that the proposed algorithm
yields similar solutions to fmincon and if measurement ‚àÜr
h23
is more reliable than ‚àÜr
h24 , then final results change accordingly.

TO APPEAR IN THE 58TH CONFERENCE ON DECISION AND CONTROL, NICE, FRANCE, DECEMBER 11‚Äì13, 2019

2

1

3

<latexit sha1_base64="FrxRrc9vgf74Bezk8oi4FLuoKl8=">AAAB6HicbVBNS8NAEJ3Ur1q/qh69LBbBU0mKoCcpePHYgv2ANpTNdtKu3WzC7kYoob/AiwdFvPqTvPlv3LY5aOuDgcd7M8zMCxLBtXHdb6ewsbm1vVPcLe3tHxwelY9P2jpOFcMWi0WsugHVKLjEluFGYDdRSKNAYCeY3M39zhMqzWP5YKYJ+hEdSR5yRo2VmrVBueJW3QXIOvFyUoEcjUH5qz+MWRqhNExQrXuemxg/o8pwJnBW6qcaE8omdIQ9SyWNUPvZ4tAZubDKkISxsiUNWai/JzIaaT2NAtsZUTPWq95c/M/rpSa88TMuk9SgZMtFYSqIicn8azLkCpkRU0soU9zeStiYKsqMzaZkQ/BWX14n7VrVc6te86pSv83jKMIZnMMleHANdbiHBrSAAcIzvMKb8+i8OO/Ox7K14OQzp/AHzucPeu2Msg==</latexit>
<latexit

<latexit sha1_base64="7dcGK+x0vrfsCGPpUcIqpC4qwqU=">AAAB6HicdVDLSgNBEOyNrxhfUY9eBoPgKcwEMclFAl48JmAekCxhdjKbjJl9MDMrhCVf4MWDIl79JG/+jbNJBBUtaCiquunu8mIptMH4w8mtrW9sbuW3Czu7e/sHxcOjjo4SxXibRTJSPY9qLkXI20YYyXux4jTwJO960+vM795zpUUU3ppZzN2AjkPhC0aNlVpkWCzhMsaYEIIyQqqX2JJ6vVYhNUQyy6IEKzSHxffBKGJJwEPDJNW6T3Bs3JQqI5jk88Ig0TymbErHvG9pSAOu3XRx6BydWWWE/EjZCg1aqN8nUhpoPQs82xlQM9G/vUz8y+snxq+5qQjjxPCQLRf5iUQmQtnXaCQUZ0bOLKFMCXsrYhOqKDM2m4IN4etT9D/pVMoEl0nrotS4WsWRhxM4hXMgUIUG3EAT2sCAwwM8wbNz5zw6L87rsjXnrGaO4Qect0/GX4zn</latexit>
<latexit

<latexit sha1_base64="Lh4wE+41PDp6aDYPu/8T4ZNPBrA=">AAACAHicbVDLSsNAFJ3UV62vqAsXbgaL4KokRdCFi4IbN0IF+4Amhsl00g6dmYSZiVBCNv6KGxeKuPUz3Pk3TtostPXAhcM593LvPWHCqNKO821VVlbX1jeqm7Wt7Z3dPXv/oKviVGLSwTGLZT9EijAqSEdTzUg/kQTxkJFeOLku/N4jkYrG4l5PE+JzNBI0ohhpIwX2kdce0yBzm/lD5nGkx5Jnt3leC+y603BmgMvELUkdlGgH9pc3jHHKidCYIaUGrpNoP0NSU8xIXvNSRRKEJ2hEBoYKxInys9kDOTw1yhBGsTQlNJypvycyxJWa8tB0FjeqRa8Q//MGqY4u/YyKJNVE4PmiKGVQx7BIAw6pJFizqSEIS2puhXiMJMLaZFaE4C6+vEy6zYbrNNy783rrqoyjCo7BCTgDLrgALXAD2qADMMjBM3gFb9aT9WK9Wx/z1opVzhyCP7A+fwB56ZZM</latexit>

M
12

<latexit sha1_base64="4AH0dtPAl3t8nzi5e9wuS6c/fX8=">AAACAHicbVDLSsNAFJ3UV62vqAsXbgaL4KokVdCFi4IblxHsA5oYJtNpO3RmEmYmQgnZ+CtuXCji1s9w5984abPQ1gMXDufcy733RAmjSjvOt1VZWV1b36hu1ra2d3b37P2DjopTiUkbxyyWvQgpwqggbU01I71EEsQjRrrR5Kbwu49EKhqLez1NSMDRSNAhxUgbKbSPfG9Mw6x5nj9kPkd6LHnm5XkttOtOw5kBLhO3JHVQwgvtL38Q45QToTFDSvVdJ9FBhqSmmJG85qeKJAhP0Ij0DRWIExVkswdyeGqUARzG0pTQcKb+nsgQV2rKI9NZ3KgWvUL8z+unengVZFQkqSYCzxcNUwZ1DIs04IBKgjWbGoKwpOZWiMdIIqxNZkUI7uLLy6TTbLhOw727qLeuyziq4BicgDPggkvQArfAA22AQQ6ewSt4s56sF+vd+pi3Vqxy5hD8gfX5A4GlllE=</latexit>

P
23

8

7

<latexit sha1_base64="Q/q8rkVMhFE64pY1cijmGv9tk+k=">AAAB6HicdVDLSsNAFJ3UV62vqks3g0VwFSYxtHUjBTcuW7APaEOZTCft2MkkzEyEEvoFblwo4tZPcuffOGkrqOiBC4dz7uXee4KEM6UR+rAKa+sbm1vF7dLO7t7+QfnwqKPiVBLaJjGPZS/AinImaFszzWkvkRRHAafdYHqd+917KhWLxa2eJdSP8FiwkBGsjdS6GJYryL6sV12vCpGNUM1xnZy4Ne/Cg45RclTACs1h+X0wikkaUaEJx0r1HZRoP8NSM8LpvDRIFU0wmeIx7RsqcESVny0OncMzo4xgGEtTQsOF+n0iw5FSsygwnRHWE/Xby8W/vH6qw7qfMZGkmgqyXBSmHOoY5l/DEZOUaD4zBBPJzK2QTLDERJtsSiaEr0/h/6Tj2g6ynZZXaVyt4iiCE3AKzoEDaqABbkATtAEBFDyAJ/Bs3VmP1ov1umwtWKuZY/AD1tsn3ICM9Q==</latexit>
<latexit

<latexit sha1_base64="xi1iUqbZtpTIi3JZlf12hAUGLec=">AAAB6HicdVDLSgNBEJyNrxhfUY9eBoPgKcwEMZuLBLx4TMA8IFnC7KQ3GTP7YGZWCCFf4MWDIl79JG/+jbNJBBUtaCiquunu8hMptCHkw8mtrW9sbuW3Czu7e/sHxcOjto5TxaHFYxmrrs80SBFBywgjoZsoYKEvoeNPrjO/cw9Kizi6NdMEvJCNIhEIzoyVmu6gWCJlQgilFGeEVi+JJbWaW6EuppllUUIrNAbF9/4w5mkIkeGSad2jJDHejCkjuIR5oZ9qSBifsBH0LI1YCNqbLQ6d4zOrDHEQK1uRwQv1+8SMhVpPQ992hsyM9W8vE//yeqkJXG8moiQ1EPHloiCV2MQ4+xoPhQJu5NQSxpWwt2I+ZopxY7Mp2BC+PsX/k3alTEmZNi9K9atVHHl0gk7ROaKoiuroBjVQC3EE6AE9oWfnznl0XpzXZWvOWc0cox9w3j4B0PuM7g==</latexit>
<latexit

<latexit sha1_base64="Z0GFjLdFvC+snavu4GHgZTY7vXo=">AAAB6HicbVBNS8NAEJ3Ur1q/qh69LBbBU0lEqCcpePHYgv2ANpTNdtKu3WzC7kYoob/AiwdFvPqTvPlv3LY5aOuDgcd7M8zMCxLBtXHdb6ewsbm1vVPcLe3tHxwelY9P2jpOFcMWi0WsugHVKLjEluFGYDdRSKNAYCeY3M39zhMqzWP5YKYJ+hEdSR5yRo2VmrVBueJW3QXIOvFyUoEcjUH5qz+MWRqhNExQrXuemxg/o8pwJnBW6qcaE8omdIQ9SyWNUPvZ4tAZubDKkISxsiUNWai/JzIaaT2NAtsZUTPWq95c/M/rpSa88TMuk9SgZMtFYSqIicn8azLkCpkRU0soU9zeStiYKsqMzaZkQ/BWX14n7auq51a95nWlfpvHUYQzOIdL8KAGdbiHBrSAAcIzvMKb8+i8OO/Ox7K14OQzp/AHzucPgoGMtw==</latexit>
<latexit

<latexit sha1_base64="Z+4kEmTYX05dIWGLBxq+9nrucQE=">AAACAHicbVDLSsNAFJ3UV62vqAsXbgaL4KokKtSFi4IblxHsA5oYJtNpO3RmEmYmQgnZ+CtuXCji1s9w5984abPQ1gMXDufcy733RAmjSjvOt1VZWV1b36hu1ra2d3b37P2DjopTiUkbxyyWvQgpwqggbU01I71EEsQjRrrR5Kbwu49EKhqLez1NSMDRSNAhxUgbKbSPfG9Mw+yimT9kPkd6LHnm5XkttOtOw5kBLhO3JHVQwgvtL38Q45QToTFDSvVdJ9FBhqSmmJG85qeKJAhP0Ij0DRWIExVkswdyeGqUARzG0pTQcKb+nsgQV2rKI9NZ3KgWvUL8z+unengVZFQkqSYCzxcNUwZ1DIs04IBKgjWbGoKwpOZWiMdIIqxNZkUI7uLLy6Rz3nCdhnt3WW9dl3FUwTE4AWfABU3QArfAA22AQQ6ewSt4s56sF+vd+pi3Vqxy5hD8gfX5A4mFllY=</latexit>

4
<latexit sha1_base64="QnYO0nSxSUOtjZvg18QMXhnt20c=">AAAB6HicbVBNS8NAEJ3Ur1q/qh69LBbBU0mkoCcpePHYgv2ANpTNdtKu3WzC7kYoob/AiwdFvPqTvPlv3LY5aOuDgcd7M8zMCxLBtXHdb6ewsbm1vVPcLe3tHxwelY9P2jpOFcMWi0WsugHVKLjEluFGYDdRSKNAYCeY3M39zhMqzWP5YKYJ+hEdSR5yRo2VmrVBueJW3QXIOvFyUoEcjUH5qz+MWRqhNExQrXuemxg/o8pwJnBW6qcaE8omdIQ9SyWNUPvZ4tAZubDKkISxsiUNWai/JzIaaT2NAtsZUTPWq95c/M/rpSa88TMuk9SgZMtFYSqIicn8azLkCpkRU0soU9zeStiYKsqMzaZkQ/BWX14n7auq51a9Zq1Sv83jKMIZnMMleHANdbiHBrSAAcIzvMKb8+i8OO/Ox7K14OQzp/AHzucPffWMtA==</latexit>
<latexit

P
37

<latexit sha1_base64="yFm+pdX1sB7bT7MOCqgwwmrFuiE=">AAACAHicbVDLSsNAFJ3UV62vqAsXbgaL4KokIrQLFwU3LiPYBzQxTKbTdujMJMxMhBKy8VfcuFDErZ/hzr9x0mahrQcuHM65l3vviRJGlXacb6uytr6xuVXdru3s7u0f2IdHXRWnEpMOjlks+xFShFFBOppqRvqJJIhHjPSi6U3h9x6JVDQW93qWkICjsaAjipE2Umif+N6EhlmzlT9kPkd6Innm5XkttOtOw5kDrhK3JHVQwgvtL38Y45QToTFDSg1cJ9FBhqSmmJG85qeKJAhP0ZgMDBWIExVk8wdyeG6UIRzF0pTQcK7+nsgQV2rGI9NZ3KiWvUL8zxuketQKMiqSVBOBF4tGKYM6hkUacEglwZrNDEFYUnMrxBMkEdYmsyIEd/nlVdK9bLhOw727qrevyziq4BScgQvggiZog1vggQ7AIAfP4BW8WU/Wi/VufSxaK1Y5cwz+wPr8AZFolls=</latexit>

P
78

6
<latexit sha1_base64="qlGy2R7GfNthCO5W71bPrpK6Va8=">AAAB6HicbVBNS8NAEJ3Ur1q/qh69LBbBU0lE1JMUvHhswX5AG8pmO2nXbjZhdyOU0F/gxYMiXv1J3vw3btsctPXBwOO9GWbmBYng2rjut1NYW9/Y3Cpul3Z29/YPyodHLR2nimGTxSJWnYBqFFxi03AjsJMopFEgsB2M72Z++wmV5rF8MJME/YgOJQ85o8ZKjat+ueJW3TnIKvFyUoEc9X75qzeIWRqhNExQrbuemxg/o8pwJnBa6qUaE8rGdIhdSyWNUPvZ/NApObPKgISxsiUNmau/JzIaaT2JAtsZUTPSy95M/M/rpia88TMuk9SgZItFYSqIicnsazLgCpkRE0soU9zeStiIKsqMzaZkQ/CWX14lrYuq51a9xmWldpvHUYQTOIVz8OAaanAPdWgCA4RneIU359F5cd6dj0VrwclnjuEPnM8fgP2Mtg==</latexit>
<latexit

5
<latexit sha1_base64="i1x65Y0o+0srIUtb2H1g+191FEY=">AAAB6HicbVBNS8NAEJ3Ur1q/qh69LBbBU0lE0ZMUvHhswX5AG8pmO2nXbjZhdyOU0F/gxYMiXv1J3vw3btsctPXBwOO9GWbmBYng2rjut1NYW9/Y3Cpul3Z29/YPyodHLR2nimGTxSJWnYBqFFxi03AjsJMopFEgsB2M72Z++wmV5rF8MJME/YgOJQ85o8ZKjat+ueJW3TnIKvFyUoEc9X75qzeIWRqhNExQrbuemxg/o8pwJnBa6qUaE8rGdIhdSyWNUPvZ/NApObPKgISxsiUNmau/JzIaaT2JAtsZUTPSy95M/M/rpia88TMuk9SgZItFYSqIicnsazLgCpkRE0soU9zeStiIKsqMzaZkQ/CWX14lrYuq51a9xmWldpvHUYQTOIVz8OAaanAPdWgCA4RneIU359F5cd6dj0VrwclnjuEPnM8ff3mMtQ==</latexit>
<latexit

(a) 8-node network topology and over-determined measurements scenario (additional measurement h3 ), blue
line is head difference ‚àÜr
h18 , and red line is ‚àÜr
h13 .

(b) Error between solution from EPANET and our approach in
sufficient measurements scenario.

Fig. 3: 8-node network and its results under multi-scenarios.

B. 8-node Network
The 8-node network from EPANET Users Manual [18] is
a looped network, and labels for various components are all
TK
shown in Fig. 3(a). If the head at reservoir and tank, hR
1 and h8 ,
are known, then it satisfies the sufficient scenario which means
the solution can be determined with just these two measurements. The solution ŒæSE solved by Algorithm 1 and ŒæEPANET
from EPANET are given in Tab. III(b) when hTK
‚Äú 834 ft
8
and hR
‚Äú
700
ft,
and
final
error
kŒæ
¬¥
Œæ
k
SE
EPANET presented
1
in Fig. 3(b) reaches 0.1 which illustrates the effectiveness of
proposed method.
As we mentioned in Section II-B, we assume that the measurements of heads at tanks and reservoirs are very accurate. We
measure one more head at Junction 3 (h3 ) thereby defining the
over-determined scenario. There are two cases based on which
measurement is more trustful. For Case 1, if we postulate that
hTK
‚Äú 834.60 ft is more accurate and setting the accuracy
8
matrix as W ‚Äú diagp1, 0.1q, we see the resulting hTK
is very
8
close to the measured value in Tab. III(b), while h3 is far from
its measurement since it is considered less accurate. For Case
2, if h3 is considered more accurate, h3 is close to its measured
value 875.64 ft. Besides that, the two estimated variables h5 and
q46 are shown, and we can see that both are close to the values
provided by the EPANET software, but vary slightly between
Cases 1 and 2.

V. PAPER ‚Äô S L IMITATIONS AND F UTURE W ORK
The paper‚Äôs limitations include the lack of uncertainty
quantification from nodal water demands, leaks in pipes, and
pipe roughness parameters. The proposed approach can handle
ellipsoidal and cardinal-polyhedral uncertainty by updating the
constraints through the successive linear approximation, given
historical sets of demands and network parameters.
To this end, future work will focus on deriving a robust, yet
still scalable state estimation routine that addresses uncertainty
stemming from the aforementioned sources, in addition to
modeling various types of valves in the SE problem, and
thoroughly comparing our approach to the state-of-the-art in
the literature.

6

VI. ACKNOWLEDGMENTS
We gratefully acknowledge the constructive comments from
the conference editor and the reviewers. We also acknowledge
the financial support from National Science Foundation through
Grants 1728629 and 1917164.
R EFERENCES
[1] W. Zhao, T. H. Beach, and Y. Rezgui, ‚ÄúOptimization of potable water
distribution and wastewater collection networks: A systematic review
and future research directions.‚Äù IEEE Trans. Systems, Man, and Cybernetics: Systems, vol. 46, no. 5, pp. 659‚Äì681, 2016.
[2] V. Puig, C. Ocampo-Martinez, R. PeÃÅrez, G. Cembrano, J. Quevedo, and
T. Escobet, Real-Time Monitoring and Operational Control of DrinkingWater Systems. Springer, 2017.
[3] K. S. Tshehla, Y. Hamam, and A. M. Abu-Mahfouz, ‚ÄúState estimation in
water distribution network: A review,‚Äù in Industrial Informatics (INDIN),
2017 IEEE 15th International Conference on. IEEE, 2017, pp. 1247‚Äì
1252.
[4] A. Aisopou, I. Stoianov, and N. J. Graham, ‚ÄúIn-pipe water quality
monitoring in water supply systems under steady and unsteady state
flow conditions: A quantitative assessment,‚Äù Water research, vol. 46,
no. 1, pp. 235‚Äì246, 2012.
[5] W. Cheng, T. Yu, and G. Xu, ‚ÄúReal-time model of a large-scale water
distribution system,‚Äù Procedia Engineering, vol. 89, pp. 457‚Äì466, 2014.
[6] S. Vrachimis, D. Eliades, and M. Polycarpou, ‚ÄúReal-time hydraulic
interval state estimation for water transport networks: A case study,‚Äù
Drinking Water Engineering and Science, vol. 11, pp. 19‚Äì24, 03 2018.
[7] A. Bargiela, ‚ÄúOn-line monitoring of water distribution networks,‚Äù Ph.D.
dissertation, Durham University, 1984.
[8] R. Powell, ‚ÄúState estimation in water networks: a tutorial,‚Äù Measurement
and control, vol. 32, no. 4, pp. 101‚Äì104, 1999.
[9] J. Davidson and F.-C. Bouchart, ‚ÄúAdjusting nodal demands in SCADA
constrained real-time water distribution network models,‚Äù Journal of
Hydraulic Engineering, vol. 132, no. 1, pp. 102‚Äì110, 2006.
[10] B. D. Barkdoll and H. Didigam, ‚ÄúEffect of user demand on water quality
and hydraulics of distribution systems,‚Äù in World Water & Environmental
Resources Congress 2003, 2003, pp. 1‚Äì10.
[11] M. Pasha and K. Lansey, ‚ÄúAnalysis of uncertainty on water distribution
hydraulics and water quality,‚Äù in Impacts of Global Climate Change,
2005, pp. 1‚Äì12.
[12] D. Kang, M. Pasha, and K. Lansey, ‚ÄúApproximate methods for uncertainty analysis of water distribution systems,‚Äù Urban Water Journal,
vol. 6, no. 3, pp. 233‚Äì249, 2009.
[13] F. Fusco and E. Arandia, ‚ÄúState estimation for water distribution
networks in the presence of control devices with switching behavior,‚Äù
Procedia Engineering, vol. 186, pp. 592‚Äì600, 2017.
[14] A. Preis, A. J. Whittle, A. Ostfeld, and L. Perelman, ‚ÄúEfficient hydraulic state estimation technique using reduced models of urban water
networks,‚Äù Journal of Water Resources Planning and Management, vol.
137, no. 4, pp. 343‚Äì351, 2011.
[15] R. Duffin, E. Peterson, and C. Zener, Geometric programming - theory
and application. New York: Wiley, 1967.
[16] S. Wang, A. F. Taha, N. Gatsis, and M. Giacomoni,
‚ÄúGeometric programming-based control for nonlinear, daeconstrained water distribution networks,‚Äù in 2019 American
Control Conference, Philadelphia, US, July 2019, pp. 1470‚Äì1475.
https://arxiv.org/pdf/1902.06026.pdf
[17] A. S. Zamzam, E. Dall‚ÄôAnese, C. Zhao, J. A. Taylor, and N. Sidiropoulos, ‚ÄúOptimal water-power flow problem: Formulation and distributed
optimal solution,‚Äù IEEE Transactions on Control of Network Systems,
2018.
[18] L. A. Rossman et al., ‚ÄúEpanet 2: users manual,‚Äù 2000.
[19] S. Boyd, S.-J. Kim, L. Vandenberghe, and A. Hassibi, ‚ÄúA tutorial on
geometric programming,‚Äù Optimization and engineering, vol. 8, no. 1,
p. 67, 2007.
[20] I. J. Lustig, R. E. Marsten, and D. F. Shanno, ‚ÄúInterior point methods
for linear programming: Computational state of the art,‚Äù ORSA Journal
on Computing, vol. 6, no. 1, pp. 1‚Äì14, 1994.
[21] D. Elƒ±ÃÅades and M. Kyriakou, ‚ÄúEpanet matlab toolkit,‚Äù University of
Cyprus, Republic of Cyprus, 2009.
[22] I. CVX Research, ‚ÄúCVX: Matlab software for disciplined convex
programming, version 2.0,‚Äù http://cvxr.com/cvx, Aug. 2012.
[23] ‚ÄúShenwang9202/state estimation,‚Äù accessed 15 March 2019. https:
//github.com/ShenWang9202/StateEstimation

