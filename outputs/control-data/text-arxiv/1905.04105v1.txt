Which Contrast Does Matter? Towards a Deep Understanding of MR Contrast using Collaborative GAN

arXiv:1905.04105v1 [eess.IV] 10 May 2019

Dongwook Lee1 , Won-Jin Moon2 & Jong Chul Ye∗,1

1

Department of Bio and Brain Engineering, KAIST, Daejeon, Korea

2

Konkuk University Medical Center, Seoul, Korea

Correspondence should be addressed to J.C.Y. (jong.ye@kaist.ac.kr)
Thanks to the recent success of generative adversarial network (GAN) for image synthesis,
there are many exciting GAN approaches that successfully synthesize MR image contrast
from other images with different contrasts. These approaches are potentially important for
image imputation problems, where complete set of data is often difficult to obtain and image
synthesis is one of the key solutions for handling the missing data problem. Unfortunately,
the lack of the scalability of the existing GAN-based image translation approaches poses a
fundamental challenge to understand the nature of the MR contrast imputation problem:
which contrast does matter? Here, we present a systematic approach using Collaborative
Generative Adversarial Networks (CollaGAN), which enable the learning of the joint image
manifold of multiple MR contrasts to investigate which contrasts are essential. Our experimental results showed that the exogenous contrast from contrast agents is not replaceable,
but other endogenous contrast such as T1, T2, etc can be synthesized from other contrast.
These findings may give important guidance to the acquisition protocol design for MR in real
clinical environment.

1

In many image processing and computer vision problems in medical imaging, a set of multiple images are usually required to find a desired output. For example, for accurate diagnosis
and segmentation of the cancer margin and radiomic evaluations, multiple MR constrast such as
T1-weighted (T1), post-contrast T1-weighted (T1Gd), T2 weighted (T2), and T2-FLAIR (T2F)
are necessary

1–3

. Unfortunately, the complete set of input data are often difficult to obtain due

to the different acquisition protocol at each institute, prolonged acquisition time, operator errors,
or patient movement during the data acquisitions. Moreover, it it often impossible to use contrast
agents for some patients with kidney failure or allergic responses. Without the complete contrast,
the subsequent analysis can be prone to substantial biases and errors that can reduce the statistical
efficiency of subsequent analysis 4 , and the accurate segmentation of the whole tumor, tumor core
and effective tumor core may not be feasible.

Moreover, in some situations, although multiple contrast images are available, some of the
images suffers from systematic errors. For example, a synthetic MRI technique called Magnetic
Resonance Image Compilation (MAGiC, GE Healthcare)

5

enables the generation of the vari-

ous contrasts MR images using a Multi-Dynamic Multi-Echo (MDME) scan. While MAGiC can
provide clinically useful synthetic MR images with various contrasts such as T1-weighted, T2weighted, T2-FLAIR, etc, it is often reported that some of the synthetic contrasts have readily
recognizable artifacts

5–7

. Especially, the characteristic granulated hyperintense artifacts apparent

in the margins along the cerebrospinal fluid (CSF)-tissue boundaries on MAGiC FLAIR can be
mistaken for true pathologic conditions such as meningeal disease or subarachnoid hemorrhage in

2

clinical practice. Furthermore, flow and/or noise artifacts are more frequent on MAGiC FLAIR
than conventional FLAIR. This often leads to the additional MR acquisition to confirm the diagnosis, which requires significant amount of cost and patient inconvenience.

Therefore, rather than re-acquiring all data as a complete set in this unexpected situation, it is
often necessary to fill the missing data with substituted data. In statistical literatures, this process is
often referred to as missing data imputation. Once all missing data have been imputed, the dataset
can be used as an input for standard techniques designed for the complete dataset.

Recently, the field of image imputation has been significantly advanced thanks to the enormous success of deep neural networks

8–12

. Typically, the missing image imputation problem

can be formulated as an image translation problem from one domain to the other domain

13, 14

,

whose performance has been great improved with the advance of Generative Adversarial Network
(GAN)

15

. The main purpose of GAN architecture is to generate the realistic samples/images.

Typical GAN consists of two neural networks: a generator and a discriminator. The discriminator
attempts to find the features to distinguish fake image from real images, while the generator learns
to synthesize images so that the discriminator is difficult to judge as real or fake. After training
both neural networks, the generator produces the realistic outputs which cannot be distinguished
as fake samples by the discriminator. Since the introduction of the original GAN

15

, many in-

genious extensions have appeared. For example, for the translation between two domains A and
B, CycleGAN

13

constructs two generators, GA→B and GB→A , and two discriminators, DA and

3

DB , so that the images between two domains can be successfully translated by cycle consistency
loss 16 . In another variation, to handle the multiple domains more than two, Choi et al. proposed
StarGAN

14

which utilized the shared feature learning using a single generator and a single dis-

criminator. Using the concatenated input image with target domain vector, the generator produces
the fake image, which is classified as the target domain by the discriminator.

Inspired by the success of GAN-based image-translation techniques, there have been many
attempt to generate MR contrast. For example, Dar et al. proposed MR contrast synthesis with
conditional GAN and additional perceptual loss 17 . Specifically, they utilized Pix2pix 18 and CycleGAN to translate the MR contrast images between T1 and T2 weighted images. Welander et
al. compare the performance of CycleGAN and UNIT 19 in the task of translation between T1 and
T2 weighted images

20

. Furthermore, there are severaly studies to translate the images between

MR and CT (Computed Tomography) by using similar cycle consistency loss 16, 21, 22 . Meanwhile,
Hagiwara et al. proposed the conditional GAN-based frameworks to generate desired FLAIR images by two step approach

23

. First, FLAIR images are generated by MAGiC. Since the MAGiC

FLAIR have synthetic artifacts, they tried to remove the synthetic artifact and improve the quality
of synthetic MR imaging by utilizing Pix2pix after the MAGiC.

Despite of this success, handling the multiple inputs is one of the challenges for existing
image-to-image translation approaches. For example, for translating among N number of domains
using CycleGAN, it is necessary to train N (N -1) generators for each pair of domains, and N

4

discriminators for each domain. Therefore, CycleGAN requires a large number of neural networks in multi-domain setting since it is trained without feature sharing among the multi-domains.
Although StarGAN

14

address the multiple domain mapping, it cannot exploit the redundancies

across MR contrast images to reconstruct the output contrast, since StarGAN is designed to utilize
only one input.

In fact, this lack of the scalability of the existing GAN-based image translation approaches
poses a fundamental challenge to understand the nature of the MR contrast imputation problem:
i.e. which contrast does matter? In the age of artificial intelligence (AI) with amazing success
of generative models, clinicians are interested in understanding which MR contrast is really indispensable and cannot be synthesized using a generative model. This is especially important for
clinical decision making, since there are many claims that they can successfully synthesize any
MR contrast. It is generally believed that the success of MR contrast is due to the redundancies
in the different MR contrast. Therefore, to understand the nature of MR contrast imputation, we
should understand the redundancies across many different MR contrasts to figure out what kinds
of information can be, or cannot be generated. However, such an analysis is not trivial, since the
understanding of the redundancies across multiple MR contrasts requires complete knowledge of
joint image manifolds, which is considered as complicated machine learning task.

To address general image imputation problems in computer vision and image processing, we
recently developed a novel image imputation method called Collaborative Generative Adversarial

5

Network (CollaGAN) 24 , which reconstruct the missing image by learning the redundancies across
many image pairs. In CollaGAN, a set of images from the whole domains is treated as a complete
set, and the network is trained to estimate the missing image by synergistically combining the
information from the multiple inputs. The power of the method has been successfully demonstrated
to generate facial expressions, lightning conditions, etc 24 .

Inspired by this success, Fig 1 illustrates how CollaGAN can be used for the case of MR
contrast imputation problems. In particular, the collaborative processing of the multiple domain
input images is very important in MR contrast imputation problems, since it is impossible to find
the accurate pixel-intensity without understanding image manifold across different contrast. This
may appear similar to MAGiC that calculates the voxel intensity from multi-contrast MR images
from a MDME scan. However, in contrast to MAGiC, the collaborative learning with CollaGAN
also utilizes the semantic information beyond the pixel wise relationship, so the more systematic
studies about the MR contrast can be performed. Moreover, unlike CycleGAN, CollaGAN utilizes
a single discriminator and a single generator to reconstruct the image of whole domains so that the
generator can effectively exploit the multiple domain redundancy by learning high dimensional
manifold structure across images. Specifically, by estimating specific contrast from the rest, we
can understand the joint manifold structure across multiple contrast to decide which contrast is
most essential and cannot be generated effectively. This is very important in clinical environment,
since one can reduce the unnecessary exams while retaining the most essential one.

6

To validate the use of CollaGAN in understanding the essential MR contrast, we first perform quantitative study by comparing the segmentation performance by replacing one real contrast
with a synthesized contrast. Here, we utilized the multi-modal brain tumor image segmentation
benchmark (BraTS, 2015) 2, 3 . All the scans from BraTS consist of T1-weighted (T1), post-contrast
T1-weighted (T1Gd), T2 weighted (T2), T2-FLAIR (T2F) and the ground truth segmentation labels for brain tumors. The segmentation performances were evaluated from the five different BraTS
datasets: Original, T 1Colla , T 1GdColla , T 2Colla , and T 2FColla . The datasets with subscript Colla
represent the datasets with the substitution of a specific contrast by the reconstructed contrast from
CollaGAN. Here, for brain tumor segmentation, we used the state-of-the-art segmentation network
known as convolutional neural network with variational auto-encoder regularization 25 with some
minor modifications.

Fig. 2 shows the segmentation results for the five different BraTS datasets. As shown in
Fig. 2, the segmentation network performs well to find the whole tumor (WT), the tumor core
(TC), and the enhancing tumor core (EC) maps on the original BraTS dataset. The segmentation
maps from the synthetic BraTS datasets (T 1Colla , T 2Colla , T 2FColla and T 1GdColla ) produced
similar results to the ground truth and the result maps from the original BraTS. For quantitative
evaluation, we measured the segmentation performance by the dice similarity score 26 between the
prediction map, Ypred , and the ground truth, Ygt :
Dice(Ygt , Ypred ) =

2|Ygt ∩ Ypred |
,
|Ygt | + |Ypred |

where | · | represents the cardinalities of the set (number of elements in each set). The segmen7

tation network achieves 0.8531±0.0869 / 0.7368±0.1850 / 0.7066±0.2717 (mean±std, N =28)
DICE scores for WT / TC / EC, respectively, when using the original BraTS datasets. When the
original T1-weighted images are replaced with the reconstructed image by CollaGAN (T 1Colla ),
the DICE scores are reaches to 0.8567±0.0882 / 0.7342±0.1857 / 0.6979±0.2718 for WT / TC
/ EC, respectively, without any additional training or fine-tuning process. The segmentation performance between the original and (T 1Colla , T 2Colla , and T 2FColla ) are very similar as shown
in Fig. 5. The results validated the reconstructed contrast images by CollaGAN for the data set
T 1Colla , T 2Colla , and T 2FColla are very similar to the original contrast images from the original
BraTS dataset.

However, the injection of the gadolinium contrast agent provides additional tissue information so that the post-contrast T1-weighted (T1Gd) images show important role in the segmentation
of TC and EC as shown in the performance drop of the segmentation results using T 1GdColla .
While the performance drop from CollaGAN reconstructed T1Gd images using the other contrasts
is relatively small for WT and TC in Fig. 3, the performance drop in EC is statistically significant.
This experimental provides systematic understanding that the information of contrast injection is
still indispensable unless additional diagnostic evaluation is performed. This is as expected given
the wide use of MR contrast agent.

Although the previous experiment shows that the gadolinium contrast cannot be synthesized
accurately, it also shows promising results that intrinsic MR contrast may be estimated from the

8

remaining intrinsic contrasts. Thus, we investigate whether collaborative learning can essentially
overcome the limitation of MAGiC images. As shown in Fig. 4 (a-b), accurate contrast was generated using CollaGAN by synergistically utilizing the redundancies across the remaining contrast.
In contrast to CycleGAN and StarGAN that utilize a single input MR image, the accurate reconstructions of the voxel intensity are only possible by synergistically combining multiple contrast
information via CollaGAN. To verify the clinical efficacy of the method, the reconstructed MR contrast images were undergone radiological evalution. The CollaGAN performs very well not only
for the brain MR images from the normal subjects, but also for the brain scans from the subjects
with lesions (Fig. 5 (a-b)). The hyperintensity signal of the CSF space (yellow circled in Fig. 5(a))
compared to the other side hemisphere is well reconstructed on both MAGiC T2-FLAIR and T2FLAIR. Here, MAGiC T2-FLAIR and T2-FLAIR refer to the synthetic T2-FLAIR by MAGiC and
the true T2-FLAIR contrast by additional acquisition, respectively. The cortical and sulcal abnormality (yellow circled in Fig. 5 (b)) are also visible on the reconstructed MAGiC T2-FLAIR and
T2-FLAIR. The lesions of the subjects are well reconstructed compared to the original scans. On
the other hand, even if there exists systemic artifact on synthetic MAGiC T2-FLAIR, CollaGAN
still reconstructs the artifact-free T2-FLAIR results with a help from the collaborative input as
shown in Fig. 5 (c-d). The focal sulcal hyperintensity (yellow arrow in Fig. 5 (c)) is only visible on
T2-FLAIR (both original and reconstructed) while it is not visible on MAGiC T2-FLAIR images.
Since the synthetic images (T1-FLAIR, T2-weighted, MAGiC T2-FLAIR) from MAGiC cannot
capture the aforementioned hyper-intensity, it is usual to acquire additional scan of T2-FLAIR to
detect the lesion. However, the hyper-intensity lesion could be detected on the reconstructed T29

FLAIR by CollaGAN. Also, in the reconstructed MAGiC T2-FLAIR, there exists a pseudo-lesion
(yellow arrow in Fig. 5(d)) which is not visible on both original and reconstructed T2-FLAIR. The
radiologist concludes that the reconstructed conventional T2-FLAIR contrast from CollaGAN not
only reflects the original contrast well, but also removes the systemic artifacts from MAGiC well.
By reconstructing the specific desired contrast MR images without any artifacts, we could save the
scan time by avoiding the additional scan for accurate clinical diagnosis.

In conclusion, we employ a novel architecture, CollaGAN, to investigate the essential MR
contrast for imaging study, since CollaGAN can impute missing image by synergistically learning
the joint image manifold of multiple MR contrasts. Using the segmentation study, we found that
images from the contrast agent are indispensible and cannot be completely replaced by generative
models. For the case of intrinsic contrasts such as T2-FLAIR, we demonstrated that CollaGAN
reconstructs the specific contrast MR images without any artifacts, so that it can the scan time by
avoiding the additional scan for accurate clinical diagnosis. Our proposed CollaGAN model can
be utilized for all other types of imaging studies to investigate which contrast is the most essential
and which contrast is redundant.

METHODS

Background Theory for CollaGAN Here, we explain our Collaborative GAN framework to handle multiple inputs for generating more realistic output for image imputation. For ease of explanation, we assume that there are four types (N = 4) of domains: a, b, c, and d. To handle the
10

multiple-inputs using a single generator, we train the generator to synthesize the output image in
the target domain, x̂a , using a collaborative mapping from the set of the other types of multiple images, {xa }C = {xb , xc , xd }, where the superscript C denotes the complementary set. This mapping
is formally described by

x̂κ = G {xκ }C ; κ

(1)

where κ ∈ {a, b, c, d} denotes the target domain index that guides to generate the output of the
proper target domain, κ. As there are N number of combinations for single-output and its corresponding complementary set as multiple-inputs, we randomly choose these combination during
the training so that the generator learns the various mappings to the multiple target domains.

One of the key concepts for the proposed method is the multiple cycle consistency. Since
the original cycle-consistency loss cannot be defined for the multiple inputs, the cyclic loss should
be redefined. Suppose that the fake output from the forward cycle for the generator, G, is x̂a .
Then, we could generate N − 1 number of new inputs by the combinations with the fake output,
x̂a , and the inputs, xb , xc , xd . Using the new combination inputs, the generator synthesizs the
reconstructed outputs, x̃·|a , for the backward flow of the cycle. For example, when N = 4, there
are three combinations of multi-input and single-output so that we can reconstruct the three images

11

of original domains using backward flow of the generator as:
x̃b|a = G({x̂a , xc , xd }; b)
x̃c|a = G({x̂a , xb , xd }; c)
x̃d|a = G({x̂a , xb , xc }; d)
Then, the associated multiple cycle consistency loss can be defined as following:
Lmcc,a = ||xb − x̃b|a ||1 + ||xc − x̃c|a ||1 + ||xd − x̃d|a ||1
where || · ||1 is the l1 -norm. In general, the multiple cycle consistency loss for the multiple domains
κ can be written by
Lmcc,κ =

X

||xκ0 − x̃κ0 |κ ||1

(2)

κ0 6=κ

where

x̃κ0 |κ = G {x̂κ }C ; κ0 .

(3)

To use a single generator, we need to use the mask vector to guide the generator to the target
domain. The mask vector is an one-hot encoding vector which represents the target domain. When
it is fed into the encoder part of G (Fig. 6 left), it is enlarged as same dimension with the input
images to be easily concatenated. The mask vector has N class number of channel dimension to
represent the target domain as one-hot encoding along the channel dimension. This is a simplified
version of mask vector which was originally introduced in StarGAN 14 .
12

Discriminator Loss As mentioned before, the discriminator has two roles: one is to classify the
source which is real or fake, and the other is to classify the type of domain which is class a, b, c or d.
Therefore, the discriminator loss consists of two parts: adversarial loss and domain classification
loss. This can be realized using the two sub-paths Dgan and Dclsf in a single discriminator that
shares the same neural network weights for feature extraction except the last layers for sub-paths.

Specifically, the adversarial loss is necessary to make the generated images as realistic as
possible. The regular GAN loss may lead to the vanishing gradients problem during the learning
process 27, 28 . To overcome such problem and improve the robustness of the training, the adversarial
loss of Least Square GAN

27

was utilized instead of the original GAN loss. In particular for the

optimization of the discriminator, Dgan , the following loss is minimized:
2
2
Ldsc
gan (Dgan ) = Exκ [(Dgan (xκ ) − 1) ] + Ex̃κ|κ [(Dgan (x̃κ|κ )) ],

whereas the generator is optimized by minimizing the following loss:
2
Lgen
gan (G) = Ex̃κ|κ [(Dgan (x̃κ|κ ) − 1) ]

where x̃κ|κ is defined in (3).

f ake
Next, the domain classification loss consists of two parts: Lreal
clsf and Lclsf . They are the

cross entropy loss for domain classification from the real images and the fake image, respectively.
Recall that the goal of training G is to generate the image properly classified to the target domain.
Thus, we first need a best classifier Dclsf that should be trained only with the real data to guide the
13

generator properly. Accordingly, we first minimize the loss Lreal
clsf to train the classifier Dclsf , then
ake
Lfclsf
is minimized by training G with fixing Dclsf so that the generator can be trained to generate

samples that can be classified correctly.

Specifically, to optimize the Dclsf , the following Lreal
clsf should be minimizied with respect to
Dclsf :
Lreal
clsf (Dclsf ) = Exκ [− log(Dclsf (κ; xκ ))]

(4)

where Dclsf (κ; xκ ) can be interpreted as the probability to correctly classify the real input xκ as
the class κ. On the other hand, the generator G should be trained to generate fake samples which
are properly classified by the Dclsf . Thus, the following loss should be minimized with respect to
G:
ake
Lfclsf
(G) = Ex̂κ|κ [− log(Dclsf (κ; x̂κ|κ ))]

(5)

Structural Similarity Index Loss Structural Similarity (SSIM) index is one of the state-of-the-art
metrics to measure the image quality 29 . The l2 loss, which is widely used for the image restoration
tasks, has been reported to cause the blurring artifacts on the results

30–32

. SSIM is one of the

perceptual metrics and it is also differentiable, so it can be backpropagated 32 . The SSIM for pixel
p is defined as
SSIM(p) =

2µX µY + C1
2σXY + C2
· 2
2
2
µX + µY + C1 σX + σY2 + C2

(6)

2
where µX is an average of X, σX
is a variance of X and σXX ∗ is a covariance of X and X ∗ . There

14

are two variables to stabilize the division such as C1 = (k1 L)2 and C2 = (k2 L)2 . L is a dynamic
range of the pixel intensities. k1 and k2 are constants by default k1 = 0.01 and k2 = 0.03. Since
the SSIM is defined between 0 and 1, the loss function for SSIM can be written by:


X
1
LSSIM (X, Y ) = − log 
(1 + SSIM(p))
2|P |

(7)

p∈P (X,Y )

where P denotes the pixel location set and |P | is its cardinality. The SSIM loss was applied as an
additional multiple cycle consistency loss as follows:
Lmcc−SSIM,κ =

X


LSSIM xκ0 , x̃κ0 |κ .

(8)

κ0 6=κ

Generator CollaGAN consists of single pair of a generator, G, and a discriminator, D. For the
generator, we redesigned U-net 33 structure with the following three modification: CCNL (series of
convolutions, cancatenation, normalization, and Leaky-ReLU layer) unit, multi-branched encoder,
and channel attention as shown in Fig. 6.

First, the modified U-net basically consists of CCNL unit instead of CBR unit (series of
convolution, batch normalization and ReLU layer) in original U-net architecture. Similar to the
multi-resolution approach of GoogLeNet 34 , CCNL unit has two branched inputs: 1×1 convolution
and 3×3 convolution layer. The two convolution layers are concatenated and pass through the
Leaky-ReLU layer as shown in Fig. 6. It is important to utilize the 1×1 convolution since the voxelwise synthesis of the reconstruction is necessary as well as the 3×3 convolution feature extraction
for large receptive field. Thus, two branches of feature information are parallelly processed in
CCNL units.
15

Second, we designed a multi-branched encoder for inidiviudal feature extraction for each
input images (Fig. 6 left). The generator consists of two parts: encoder and decoder. In the
encoding step, each image are encoded separately by four branches. Here, the mask vector is
concatenated to every input images to extract the proper features for the target domain. Then, the
encoded features are concatenated at the end of the encoder and the concatenated features are fed
into the decoder with the contracting paths between encoder and decoder. Since the inputs are not
simply mixed in the first layer, the seperated features for each contrast image are extracted with a
help of the multi-branched encoder.

Third, the channel attention module called CCAM (Conditional Channel Attention Module)

35

is applied to the decoder part of the generator with the following modifications. CCAM

was originally designed for image translation to mixed-domain using Sym-parameterized Generative Network (SGN)

35

. CCAM selectively excludes channels and reduces influences of un-

necessary channels to generate images in a mixed-domain conditioned by sym-parameters. Here,
we applied channel attention in the decoder part of the generator by CCAM modules using the
one-dimensional mask vector as a sym-parameter. The input mask and the average pooled input
features are concatenated and pass through the attention-MLP (multi-layered perceptron). The
channel attentions are calculated as a form of scaling weights for each channel of input feature:
CCAM (X, m) = X · σ(M LP ([Pavg (X), m]))
where X and m represent the input features and 1-D input mask vector for target domain, respectively. And Pavg , σ and · are the average pooling, the sigmoid operation and the elementwise
16

multiplication, respectively. The refined features are calculated by the element-wise multiplication
between input features, X, and the scaling weights. The CCAM module chooses the channels with
the calculated attention according to the target domain and the input features.

Discriminator To classify the contrast of the MR images, the feature extraction by the multiresolution processing is important. This kind of multi-scale approach is reported to work well in
the classification of MR contrasts 36 . The discriminator has three branches that have different scales
of resolution. Specifically, the first branch extracts the feature at the original scale of resolution
and then reduces the size of feature domain. Another branch processes the feature extraction
on the quater resolution scales (height/4, width/4). The other branch sequentially reduces the
scales by two for extracting features. These three branches are concatenated to gather the features
in multi-scale manner. After that, the discriminator consists of three series of convolution with
stride two and Leaky-ReLU. At the end of the discriminator, there are two output headers: one is
the source classification header for real or fake and the other is the domain classification header.
PatchGAN

13, 18

was utilized on the source classification header to classify whether local image

patches are real or fake. We also found that the dropout

37, 38

was very effective to prevent the

overfitting of the discriminator.

Brain Tumor segmentation datasets For quantitative analysis for the reconstruction performance,
the multimodal brain tumor image segmentation benchmark (BraTS, 2015)

2, 3

was used. BraTS

supplies the routine clinically-acquired 3T multimodal MRI scans and the ground truth labels for

17

brain tumor segmentation. The ground truth labels have been manually-revised by the expert
board-certified neuroradiologists. The routine MRI scans consist of four different contrasts including native (T1), post-contrast T1-weighted (T1Gd), T2-weighted (T2), and T2-FLAIR (T2F)
volumes, and were acquired with different clinical protocols and various scanners from multiple
institutions. The datasets were divided into 218 / 28 / 28 subjects for train / validation / test sets,
respectively.

Tumor segmentation algorithm A semantic segmentation network for brain tumor segmentation
from 3D MRIs using autoencoder regularization 25 achieved the top performance score in BraTS
2018 challenge. We implemented the segmentation network with some modifications to handle
memory efficiently.

The segmentation network consists of shared encoder part and two branches of decoder part.
The encoder has an asymmetrically larger CNN architecture compared to the decoder part, to extract the features from the inputs. To fit into GPU memory size, we modified the 3D convolution
layer to 2D convolution layer to perform 2.5D segmentation instead of 3D, which utilize the multiple neighborhood slices of MR images to map the single segmentation label. Here, we choose
five slices (two adjacent slices from each dorsal and ventral slice) as input to find the tumor segmentation maps of the center slice. The encoder part uses the blocks where each block consists of
two convolutions with Group normalization (GN) 39 and ReLU, followed by additive identity skip
connection. After the two unit blocks in each spatial level, the image dimensions were progres-

18

sively downsized by two using the strided convolutions, and simultaneously increased feature size
by two.

One branch of the decoder is for the segmentation map. The decoder reconstructs each of the
segmentation maps for following three tumor subregions: whole tumor, tumor core, and enhancing
tumor core. The decoder utilised the same blocks in the encoder, but with a single block per each
spatial level. The other branch of the decoder is for the regularization. The additional variational
auto-encoder (VAE) branch reconstructs the input image itself to regularize the shared encoder
during the training phase. The VAE branch was added to the encoder endpoint which is similar to
auto-encoder architecture to additional guidance and regularization to the encoder part.

Synthetic MR datasets We prepared the four types of contrasts for 280 axial brain images from
10 subjects. The subjects were scanned by the multi-dynamic multi-echo (MDME) sequence and
the additional T2-FLAIR (FLuid-Attenuated Inversion Recovery) sequences. Synthetic T1-FLAIR
(T1F), T2-weighted (T2w) and MAGiC T2-FLAIR (T2F) images were acquired from MAGnetic
resonance image Compilation (MAGiC, GE Healthcare) 5 using the MDME scans. The MR scan
parameters for T1-FLAIR / T2-weighted / MAGiC T2-FLAIR are as followings: TR 2500ms, TE
10ms, TI 1050ms, FA 90◦ / TR 3500ms, TE 128ms, FA 90◦ / TR 9000ms, TE 95ms, TI 2408ms,
FA 90◦ , respectively. The additional T2-FLAIR scans was acquired with different scan parameter
of T2F: TR 9000ms, TE 93ms, TI 2471ms, FA 160◦ . The followings are common parameters
for four scans: FOV 220×220mm, 320×224 acquisition matrix, 4.0mm slice thickness. The MR

19

images were divided into the train (224 images), validation (28 images) and test sets (28 images)
by the subjects.

Data preprocessing and Augmentation The MR images were normalized to have unit standard
deviations based on the non-zero-voxels only. For the data augmentation, we apply a random scale
(0.9-1.1) and a random flip on lateral-to-lateral direction with a probability 0.5.

20

1. Drevelegas, A. & Papanikolaou, N. Imaging modalities in brain tumors. In Imaging of Brain
Tumors with Histological Correlations, 13–33 (Springer, 2011).
2. Menze, B. H. et al. The multimodal brain tumor image segmentation benchmark (brats). IEEE
transactions on medical imaging 34, 1993–2024 (2015).
3. Bakas, S. et al. Advancing the cancer genome atlas glioma mri collections with expert segmentation labels and radiomic features. Scientific data 4, 170117 (2017).
4. Baraldi, A. N. & Enders, C. K. An introduction to modern missing data analyses. Journal of
school psychology 48, 5–37 (2010).
5. Tanenbaum, L. N. et al. Synthetic MRI for clinical neuroimaging: Results of the Magnetic
Resonance Image Compilation (MAGiC) prospective, multicenter, multireader trial. American
Journal of Neuroradiology (2017).
6. Hagiwara, A. et al. Synthetic mri in the detection of multiple sclerosis plaques. American
Journal of Neuroradiology 38, 257–263 (2017).
7. Hagiwara, A. et al. Symri of the brain: rapid quantification of relaxation rates and proton density, with synthetic mri, automatic brain segmentation, and myelin measurement. Investigative
radiology 52, 647 (2017).

21

8. Krizhevsky, A., Sutskever, I. & Hinton, G. E. Imagenet classification with deep convolutional
neural networks. In Advances in neural information processing systems, 1097–1105 (2012).
9. Zhang, K., Zuo, W., Chen, Y., Meng, D. & Zhang, L. Beyond a gaussian denoiser: Residual
learning of deep cnn for image denoising. IEEE Transactions on Image Processing 26, 3142–
3155 (2017).
10. Dong, C., Loy, C. C., He, K. & Tang, X. Image super-resolution using deep convolutional networks. IEEE transactions on pattern analysis and machine intelligence 38, 295–307 (2016).
11. Xie, J., Xu, L. & Chen, E. Image denoising and inpainting with deep neural networks. In
Advances in neural information processing systems, 341–349 (2012).
12. Deng, J. et al. Imagenet: A large-scale hierarchical image database. In Computer Vision and
Pattern Recognition, 2009. CVPR 2009. IEEE Conference on, 248–255 (Ieee, 2009).
13. Zhu, J.-Y., Park, T., Isola, P. & Efros, A. A. Unpaired image-to-image translation using cycleconsistent adversarial networks. arXiv preprint (2017).
14. Choi, Y. et al. StarGAN: Unified generative adversarial networks for multi-domain image-toimage translation. arXiv preprint 1711 (2017).
15. Goodfellow, I. et al. Generative adversarial nets. In Advances in neural information processing
systems, 2672–2680 (2014).

22

16. Wolterink, J. M. et al. Deep mr to ct synthesis using unpaired data. In International Workshop
on Simulation and Synthesis in Medical Imaging, 14–23 (Springer, 2017).
17. Dar, S. U. et al. Image synthesis in multi-contrast mri with conditional generative adversarial
networks. IEEE transactions on medical imaging (2019).
18. Isola, P., Zhu, J.-Y., Zhou, T. & Efros, A. A. Image-to-image translation with conditional
adversarial networks. arXiv preprint (2017).
19. Liu, M.-Y., Breuel, T. & Kautz, J. Unsupervised image-to-image translation networks. In
Advances in Neural Information Processing Systems, 700–708 (2017).
20. Welander, P., Karlsson, S. & Eklund, A. Generative adversarial networks for image-to-image
translation on multi-contrast mr images-a comparison of cyclegan and unit. arXiv preprint
arXiv:1806.07777 (2018).
21. Yang, H. et al. Unpaired brain mr-to-ct synthesis using a structure-constrained cyclegan. In
Deep Learning in Medical Image Analysis and Multimodal Learning for Clinical Decision
Support, 174–182 (Springer, 2018).
22. Hiasa, Y. et al. Cross-modality image synthesis from unpaired data using cyclegan. In International Workshop on Simulation and Synthesis in Medical Imaging, 31–41 (Springer, 2018).
23. Hagiwara, A. et al. Improving the quality of synthetic flair images with deep learning using
a conditional generative adversarial network for pixel-by-pixel image translation. American
Journal of Neuroradiology 40, 224–230 (2019).
23

24. Lee, D., Kim, J., Moon, W.-J. & Ye, J. C. CollaGAN: Collaborative GAN for missing image
data imputation. to appear in Proc. of IEEE Conf. on Computer Vision and Pattern Recognition
(CVPR), also available as arXiv preprint arXiv:1901.09764 (2019).
25. Myronenko, A. 3D MRI brain tumor segmentation using autoencoder regularization. arXiv
preprint arXiv:1810.11654 (2018).
26. Dice, L. R. Measures of the amount of ecologic association between species. Ecology 26,
297–302 (1945).
27. Mao, X. et al. Least squares generative adversarial networks. In Computer Vision (ICCV),
2017 IEEE International Conference on, 2813–2821 (IEEE, 2017).
28. Arjovsky, M., Chintala, S. & Bottou, L. Wasserstein GAN. arXiv preprint arXiv:1701.07875
(2017).
29. Wang, Z., Bovik, A. C., Sheikh, H. R. & Simoncelli, E. P. Image quality assessment: from
error visibility to structural similarity. IEEE transactions on image processing 13, 600–612
(2004).
30. Ledig, C. et al. Photo-realistic single image super-resolution using a generative adversarial
network. In CVPR, vol. 2(3), 4 (2017).
31. Mathieu, M., Couprie, C. & LeCun, Y. Deep multi-scale video prediction beyond mean square
error. arXiv preprint arXiv:1511.05440 (2015).

24

32. Zhao, H., Gallo, O., Frosio, I. & Kautz, J. Loss functions for image restoration with neural
networks. IEEE Transactions on Computational Imaging 3, 47–57 (2017).
33. Ronneberger, O., Fischer, P. & Brox, T. U-net: Convolutional networks for biomedical image segmentation. In International Conference on Medical image computing and computerassisted intervention, 234–241 (Springer, 2015).
34. Szegedy, C. et al. Going deeper with convolutions. In Proceedings of the IEEE conference on
computer vision and pattern recognition, 1–9 (2015).
35. Chang, S., Park, S., Yang, J. & Kwak, N. Image translation to mixed-domain using symparameterized generative network. arXiv preprint arXiv:1811.12362 (2018).
36. Remedios, S., Pham, D. L., Butman, J. A. & Roy, S. Classifying magnetic resonance image
modalities with convolutional neural networks. In Proc. of SPIE Vol, vol. 10575, 105752I–1
(2018).
37. Hinton, G. E., Srivastava, N., Krizhevsky, A., Sutskever, I. & Salakhutdinov, R. R. Improving neural networks by preventing co-adaptation of feature detectors. arXiv preprint
arXiv:1207.0580 (2012).
38. Srivastava, N., Hinton, G., Krizhevsky, A., Sutskever, I. & Salakhutdinov, R. Dropout: a
simple way to prevent neural networks from overfitting. The Journal of Machine Learning
Research 15, 1929–1958 (2014).
39. Wu, Y. & He, K. Group normalization. arXiv preprint arXiv:1803.08494 (2018).
25

Acknowledgements This research was supported by the National Research Foundation (NRF) of Korea
grant NRF-2016R1A2B3008104.

Competing Interests The authors declare that they have no competing financial interests.

26

Figure 1: Concept diagram of multi-domain imputation task on MR contrast images using the proposed
Collaborative GAN (CollaGAN). The single generator (black circle) of CollaGAN utilizes multiple input images
from various contrasts to synthesize the target contrast image. Here, T1-FLAIR (orange circle), T2-weighted
(yellow circle), MAGiC T2-FLAIR (green circle) from synthetic MR imaging (MAGiC) and the additional scan
by conventional T2-FLAIR (red circle) were used for multi-domain imputation.

27

Figure 2: BRaTS segmentation results for quantitative evaluation of CollaGAN. The labels of the whole tumor
(union of green, red and yellow), the tumor core (union of red and yellow), and the enhancing tumor core (yellow) are overlaid on T1-weighted sagittal images. The segmentation results from the original BRaTS datasets
(2nd row) show similar to the ground truth (1st row). T 1Colla , T 2Colla , T 2FColla , and T 1GdColla represent
the datasets which the T1 weighted images, T2 weighted images, T2-FLAIR, and T1 weighted images with
Gd-injection are respectively substituted by the reconstructed images from CollaGAN. For whole tumor, tumor
core and enhancing tumor core, it shows the similar segmentation performance on both the original BRaTS
and the reconstructed BRaTS datasets from CollaGAN. In T 1GdColla (last row), the prediction of enhancing
tumor core shows inferior performance (blue arrows) since T 1GdColla has the lack of the information from the
Gd-injection which is necessary to predict accurate enhancing tumor core region.

28

Figure 3: Quantitative results for segmentation performance using the following datasets: original BRaTS
and T 1Colla , T 2Colla , T 2FColla , and T 1GdColla data set. Here, T 1Colla , T 2Colla , T 2FColla , and T 1GdColla
represent the datasets which the T1 weighted images, T2 weighted images, T2-FLAIR and T1 weighted images
with Gd-injection are respectively substituded by the reconstructed images from CollaGAN. The segmentation
network shows similar performance for the whole tumor, the tumor core, and enhancing tumor core on both
the original BRaTS and the reconstructed datasets by CollaGAN for T 1Colla , T 2Colla , and T 2FColla data set.
However, the prediction of enhancing tumor core shows inferior performance in T 1GdColla , since T 1GdColla
is lack of the information from the Gd-injection which is necessary for accurate prediction of the enhancing
tumor core region.

29

Figure 4: (a) MR contrast imputation results using the proposed method, CollaGAN. The target domain
contrast images (right) were reconstructed from the other contrast inputs (left). The contrast image to impute
is marked as the question mark. The normalized mean squared error (NMSE) and the structural similarity
index (SSIM) of the results are as following (NMSE/SSIM): 0.0326/0.918 for T1-FLAIR, 0.109/0.904 for T2weighted, 0.0238/0.942 for MAGiC T2-FLAIR, and 0.110/0.740 for T2-FLAIR. (b) Comparison of T2-FLAIR
imputation results using CycleGAN, StarGAN and CollaGAN with ×3 magnified images.

30

Figure 5: Reconstruction results with lesions by CollaGAN. MAGiC T2-FLAIR, the ground truth (T2-FLAIR,
separated conventional scan), and the reconstructed T2-FLAIR using CollaGAN are illustrated. When there
is no synthetic artifact on MAGiC T2-FLAIR (a-b), the reconstructed contrasts from CollaGAN also show
the accurate performance. (a) The hyperintensity signal of the CSF space (circled) compared to the other
side hemisphere is visible on all three images. (b) The cortical and sulcal abnormality (circled) is also visible
on all three images. On the other hand, although there exists synthetic artifact on MAGiC T2-FLAIR (c-d),
CollaGAN reconstructs the artifact-free T2-FLAIR results similar to the ground-truth T2-FLAIR images. (c)
The focal sulcal hyperintensity (arrow) is only visible on original T2-FLAIR and reconstruction T2-FLAIR by
CollaGAN, while it is not visible on the MAGiC T2-FLAIR images. The MAGiC T2-FLAIR cannot capture the
hyperintensity lesion, but CollaGAN can accurately capture it. (d) In MAGiC T2-FLAIR, there is a pseudolesion (arrow) which is not visible on both original T2-FLAIR and reconstructed T2-FLAIR by CollaGAN.

31

Figure 6: Architecture of the generator used for MR contrast imputation. The input images were concatenated
with the target mask which represents the target domain. The network consists of CCNL unit (Concatenation of
two Convolutions followed by instance Normalization and Leaky-relu, yellow), pooling layer (grey), convolution
transpose layer (dark grey), concatenate layer (half balck/white squre), and CCAM (Conditioned Cahnnel
Attention Module, purple). The network is divided by encoder part and decoder part. The encoder is multibranched for individual feature extraction of each input MR contrast. The decoder part consists of series of
CCNL units and CCAM. The CCAM gives the attention for accurate reconstruction of the contrast image in
the target domain.

32

