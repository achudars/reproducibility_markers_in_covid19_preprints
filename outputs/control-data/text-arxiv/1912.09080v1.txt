DRAFT: Real-Time Estimation of a Multi-Stage Centrifugal Compressor
Performance Map Considering Real-Gas Processes and Flexible Operation
Maik Gentsch1,∗, Rudibert King2
Technische Universität Berlin, Department of Measurement and Control, Hardenbergstr. 36a, 10623 Berlin, Germany

arXiv:1912.09080v1 [eess.SY] 19 Dec 2019

Abstract
This paper contributes to modeling and supervision of multi-stage centrifugal compressors coping with real-gas processes and steady to highly transient operating conditions. A novel dynamic model is derived, and the incorporation
of the generic Lee-Kesler-Plöcker real-gas equation of state and its derivatives is presented. The model allows for
embedding arbitrarily shaped performance maps, based on state-of-the-art polytropic change-of-state compressor characteristics. As the validity of these maps is a key issue for simulation and model-based monitoring, performance maps
are treated as time-variant, and their shape is to be identified and monitored during operation. The proposed real-time
map estimation scheme comprises an Unscented Kalman Filter and a newly proposed algorithm, referred to as Recursive
Map Estimation. The combination yields a novel parameter and state estimator, which is expected to be superior if
some parameters are characterized by a distinct operating point dependency. Two additional time-variant parameters
are provided for monitoring: The first indicates the level of confidence in the local estimate, and the second points to
drastic performance map alterations, which may be further exploited in fault detection. A modified reference simulation
of a two-stage supercritical carbon dioxide compressor with known state trajectories, performance maps, and alterations
demonstrates the successful application of the entire monitoring scheme, and serves for a discussion of the results.
Keywords: Compressor modeling, Model-based supervision, Flexible operation, Real-gas processes, Map identification,
Unscented Kalman Filter
1. Introduction

e.g., the integration of the ideal-gas equation for real-gas
processes in supervision algorithms.

Off-design, and in particular, flexible operation of industrial plants arises as a consequence of economic interests,
and the integration of volatile, highly dynamic fossil-free
resources in power generation that has to be complemented
for by quickly responding conventional gas turbines. Likewise, industries start to dynamically adapt their production to the current prizes of the energy market, e.g., in air
separation. This again results in the dynamic operation of
the air compressors used. Consequently, the design philosophy, as well as the supervision and maintenance of these
machines, has to be adapted properly. Concerning supervision for flexible operation, the common “steady-state”
assumption is likely to provide erroneous results, e.g., frequent false alarms, if the plant’s transient behavior comprises any dynamic within a relevant time scale. The same
issue applies if inappropriate model assumptions are used,

In this context, this paper deals with modeling (see Section 2) and supervision (see Section 3) of multi-stage (centrifugal) compressors coping with real-gas processes and
flexible operation. For geared compressors, these machines
comprise large pipes as the connection between (compressor stage)–(compressor stage), (compressor stage)–
(intercooler), (compressor stage)–(valve), etc. The strategy pursued here is picking out (multi-stage) compression
units that are not interrupted by other plant components
(intercooler, valves, etc.). For such compression units (Fig.
1), a model structure is introduced in Section 2.1. The
other plant components could be included readily in the
concept proposed, but this is not done here. Likewise,
to keep the presented equations compact, additional dependence on potentially installed inlet guide vanes is discarded.

∗ Corresponding

author
Email addresses: maik.gentsch@tu-berlin.de (Maik Gentsch),
rudibert.king@tu-berlin.de (Rudibert King)
1 Graduate Research Assistant; Declarations of interest: none
2 Head of Department; Declarations of interest: none
c 2019. This manuscript version is made available under the CC
BY-NC-SA 4.0 license https://creativecommons.org/licenses/
by-nc-sa/4.0/ .
Preprint submitted to Journal of Process Control

The proposed model will be applied within the modelbased monitoring scheme. But it might be used for dynamic process simulations as well, as it is designed to cope
with highly flexible operating conditions. However, for the
simulation task, a quasi-steady-state behavior of a compressor stage is assumed, i.e., the validity of a compressor
stage specific performance map remains unaffected, even
for transients. The investigation in [1] supports this genDecember 20, 2019

eral practice, with the exception for power calculated from
such a static map. A multitude of publications deals with
the concrete shape of such maps, i.e., the concrete correlations between head, compression work, volume flow,
and speed, or respective representatives of this compressor
characteristics. In [2], a set of equations is presented that
aims to describe the performance map far away from the
design point. As in the present contribution, the methodology in [2] is based on a static dependence of the same
dimensionless compressor characteristics as they are used
here. Similarly, a map prediction and modification scheme
is proposed in [3]. The prediction is based on several models that are originally introduced by Moore and Greitzer [4], Dixon [5], and Gravdahl [6]. An exhaustive
description of traditional models for axial and centrifugal
compressors can be found in [7]. However, starting point
for a simulation with the dynamic model proposed herein,
is a given set of discrete operating points, which may be
derived from the mentioned approaches. The current operating point within the performance map is then calculated
via an interpolation scheme. This enables the integration
of arbitrarily shaped maps, facilitating a high degree of
freedom for the task of learning a map in the framework
of the model-based monitoring proposed.
As mentioned in [8], almost all process fluids that
are used in centrifugal compressors have distinct real-gas
behavior. This applies in particular to carbon dioxide
(CO2 ), and to an even greater extent, to supercritical
CO2 , which has to be handled in a Carbon Capture and
Storage application, for example. With the purpose of
providing a versatile compressor model, the generic and
easy-to-parametrize Lee-Kesler-Plöcker (LKP) realgas model (see [9]) is embedded in this contribution. The
LKP model is capable of describing the thermal relations
for a multitude of relevant process fluids and conceivable
mixtures properly. The specific integration of the respective equation of state and its derivatives is introduced in
Section 2.2.
Subject to the existence of the instrumentation, depicted in Fig. 1, the monitoring scheme developed in this
contribution is capable of tracking common compressor
characteristics (polytropic head, efficiency, etc.) separately for each compressor stage. Moreover, several fluid
temperature estimates are provided, which is desired for
considerably delayed temperature measurements, as is the
case for many high-pressure applications. Since the calculation of compressor characteristics is based on stagespecific performance maps (see Section 2.3), which can
change, e.g., due to fouling, or which are not known exactly
initially, the validity of these maps is a key issue for simulation and model-based monitoring. Therefore, performance maps are treated as time-variant, and the proposed
approach aims to identify and monitor their shapes during
operation. Online adaption of performance maps for centrifugal compressors has been presented in [10]. There, an
automated decision unit, based on the deviation between
measurements and the current map, triggers a (sequen-

tial) quadratic program from time to time to calculate the
new map. Therefore, a proper set of past measurements
is stored in a buffer. In contrast to this batch approach,
which is not stated to be designed for real-gas processes
and transient operation, the proposed algorithm in this
contribution is characterized by a constant computational
load and storage requirement for every time interval between two measurement samples. Likewise, this applies to
the work of Höckerdal et al. [11]. The core concept of
their contribution, as is the case for the monitoring scheme
here, is the preservation of the operating point dependence
of parameters via estimated grid points of a parameter
map. Their approach is a joint estimation of the model
states and the grid points, which are treated as extended
model states, within a proper observer or filter scheme,
e.g., the Extended Kalman Filter scheme. Although this
is a very elegant approach, it is rather inappropriate for
the application considered here, due to the following reasons: i) As a consequence of the real-gas model integration, every execution of the overall multi-stage compressor
model is relative costly compared to more simple models;
and ii) much more grid points are necessary to shape the
multidimensional performance maps properly compared to
the application in [11]. Considering that every grid point,
treated as extended model state within the joint estimation
scheme, increases the number of model executions in every
estimation step, an unacceptable increase of the computational load arises for the present application.

Therefore, we will present an alternative approach to
map adaption that comprises a filter for state and parameter estimation and a coupled map estimation, which will
not trigger additional model executions. For the first issue, a constrained Unscented Kalman Filter (UKF, e.g.,
see [12, 13]) is applied (see Section 3.1). The UKF is a
real-time state estimator for nonlinear systems, applicable
even if no Jacobian matrix could be achieved. In this paper, the term “real-time” refers to a situation where the
measurement sampling rate is assumed to be low enough
to complete all calculation steps between two measurement
samples in real time. For this, all presented algorithms are
formulated in an effective, recursive manner. For real-time
performance map estimation, an algorithm referred to as
Recursive Map Estimation (RME) is presented in Section
3.2, and combined with the UKF in Section 3.3. The overall monitoring performance is assessed in Section 4 for a
simulative experiment with known state trajectories, performance maps, and alterations. A two-stage supercritical
CO2 compressor acts as the reference process.
2

P0

S1

S2

P1

T

T

T

T

1st stage
F

P2

···

PN

T

T

2nd stage

p

SN

Nth stage

p

p

p

Figure 1: Compression unit with mass flow (F), temperature (T), and pressure (p) instrumentation

T

Here, [ ] denotes the transpose of a vector. Model parameters θ result from first-principle modeling, and are specified below when they appear. The superscripts Pj and Si
denote whether the respective physical quantity belongs
to the suction pipe (P0), the ith compressor stage, the jth
intermediate pipe, or the discharge pipe (PN). The physical quantities are the temperatures T , pressures p, and
specific volumes v, or their dimensionless counterparts:

2. Model Building
2.1. Model Structure and Nomenclature
The starting point for the model-based monitoring approach is a nonlinear, dynamic system description


 d x(t) = f ( x, u, θ, t ) ,
x(t0 ) = x0 ,
(1)
dt

 y(t) = g ( x, u, θ, t ) ,
(2)

T̄ =

where y ∈ Rny , x ∈ Rnx , u ∈ Rnu , and θ ∈ Rnθ are
the measurable outputs, the states, the inputs, and the
parameters of the model, respectively. In general, all of
these values are time-variant, but the model parameters
are assumed to vary much slower than the other variables.
To increase readability of the equations, the time argument
t is suppressed in what follows.
Consider the N -stage compression unit depicted in Fig.
1, with a suction pipe P0 and a discharge pipe PN. The
model states and outputs might be structured as follows:


xP0



 S1 
x 


 xP1 


 S2 

,
x
x=

 xP2 


 . 
 . 
 . 
xSN

 P0 
ṁ
 P0 
y 
 S1 
 Ts 


 P1 
y 

y=
 TsS2  ,


 P2 
y 
 . 
 . 
 . 

h̄ =

(3)

TsSN

···

nSN

pPN

T

.

p
,
pc

v̄ = v

pc
,
R Tc

(6)

h
,
R Tc

ū =

u
,
R Tc

c¯v =

cv
.
R

(7)

h is the specific enthalpy, u is the specific internal energy,
and cv is the specific isochoric heat capacity.
Additional variables are mass flows ṁ and deviations
(∆) from nominal compressor specific quantities µ and ϕ,
which are introduced in Section 2.3. For the temperature
values modeled, a distinction is drawn between fluid temperatures and temperatures at the sensor location (for the
same pipe cross-section), denoted by subscripts f and s,
respectively. This distinction is necessary, because temperature sensors are quite often shielded by thick-walled
casings, especially for high-pressure applications, leading
to considerably delayed measurements. Temperature values assigned to a compressor stage are discharge temperatures always; for example, TfS1 and TsS1 denote the discharge temperatures (the fluid and sensor position) of the
first stage. Elsewhere, if a local assignment in the context
of a single plant component (compressor stage or pipe) is
needed, entry values are indicated with a subscript 1, and
exit values with a subscript 2.
2.2. Calculation of Real-Gas Values
For the sake of adaptability of the approach to fluids
other than that considered in the example below, a generic
real-gas state equation with a low parametrization effort is
chosen. For a multitude of relevant process fluids (air, hydrocarbons, carbon dioxid, hydrogen, and ammonia), the

are detailed below. The known or measured model inputs
are the speeds of the compressor shafts and the discharge
pressure:
nS2

p̄ =

respectively. For scaling, R is the specific gas constant,
and Tc and pc are the critical temperature and pressure of
the process fluid, respectively. Thus, for (T̄ > 1, p̄ > 1),
the process fluid is at a supercritical state. The following sections contain further dimensionless thermodynamic
quantities:

where the individual state vectors of a single component


Si
 Pj 
T̄
f
"
#
T̄f
 Si 
 T̄s 
TsPj
 Pj 
Pj
Pj
Si

x = T̄s  , y = Pj , x = 
(4)
∆µSi 
p


Pj
v̄
∆ϕSi


u = nS1

T
,
Tc

(5)
3

LKP state equation shows good agreement with published
gas property tables [8]. The equation is based on the threeparameter corresponding states principle [9] featuring reduced temperature T̄ , reduced pressure p̄, and acentric factor ω. For a given real gas (mixture), its (pseudo-)critical
temperature Tc and pressure pc , as well as its acentric factor ω and its specific gas constant R, determine all thermal relations for the LKP model. The thermal relations
are formulated as follows:


p̄ = p̄S T̄ , v̄S , p̄ = p̄R T̄ , v̄R ,
(8)


ω
,
(9)
and v̄ = δ v̄S , v̄R ,
ωR

has to be fulfilled. Treating formula (9) as equality constraint, the problem boils down to a scalar root determination of  with merely one independent variable, e.g., v̄S .
Applying a second-order root determination scheme, we
found that a single step (iteration) results in a sufficiently
small || if the fluid is in a gaseous or supercritical phase
and if the starting point of the root determination algorithm is set to v̄S,0 = v̄. Finally, this approach yields the
(one-step solvable) solution:


ωR 
,
(v̄S , v̄R ) = v̄S,1 , δ v̄S,1 , v̄,
ω

(11)

where

where p̄S and p̄R are separated Benedict-Webb-RubinStarling (BWRS)-type equations for a simple fluid and
a reference fluid, respectively, ωR is the acentric factor of
the reference fluid, and v̄S and v̄R are the reduced specific
volumes of these fluids, which are used to interpolate the
reduced real gas (mixture) specific volume v̄ according to


ω
ω
:= v̄S +
· [v̄R − v̄S ] .
(10)
δ v̄S , v̄R ,
ωR
ωR

q
2
 + ( 0 ) − 2  00
0

v̄S,1 = v̄ −

00

,

(12)



 = p̄S T̄ , v̄ − p̄R T̄ , v̄ ,
h
ωR i ∂ p̄R (T̄ , v̄R )
∂ p̄S (T̄ , v̄S )
− 1−
0 =
∂ v̄S
ω
∂ v̄R
v̄S =v̄

(13)
v̄R =v̄

(14)

h

∂ p̄S (T̄ , v̄S )
ωR i2 ∂ 2 p̄R (T̄ , v̄R )
00 =
−
1
−
2
∂ v̄S2
ω
∂ v̄R
v̄S =v̄
2

The common, originally stated way to resolve the thermal
relations (8)–(9) is as follows (see [9]): Given a thermodynamic state (T̄ , p̄), a typically multiple-step numerical
procedure is applied to determine the pair (v̄S , v̄R ) that
fulfills the equality constraint (8). We refer to this as the
pressure explicit approach. At this point, we recommend
the method described in [14], which is excellent in terms of
numerical convergence and reliability in the whole range
of valid thermodynamic states3 . Once (v̄S , v̄R ) is determined, all thermodynamic properties (e.g., reduced specific enthalpy h̄) and their derivatives (e.g., isochoric pressure variation (∂ p̄/∂ T̄ )v̄ ) can be calculated directly. Calculations in this pressure explicit approach are abbreviated in
a respective manner, e.g., h̄(T̄ , p̄) or (∂ p̄/∂ T̄ )v̄ (T̄ , p̄). For
the sake of completeness, a thermal state equation, such
as the LKP state equation, is able to determine the deviation of the ideal-gas caloric properties only. Thus, caloric
ideal-gas data, e.g., the thermal dependence of the isoid
choric heat capacity cid
v = cv (T ), is necessary to calculate
absolute caloric values.
If the range of possible thermodynamic states is
restricted to the gaseous and supercritical regions,
and if the thermodynamic state can be determined
by (T̄ , v̄), we found an alternative approach, which
is less computationally intensive and sufficiently accurate. Within this approach, given (T̄ , v̄), but without knowing p̄ a priori, it is clear from (8) that
p̄ = p̄S (T̄ , v̄S ) = p̄R (T̄ , v̄R ), or in an alternative mathematical description, (v̄S , v̄R ) = p̄S (T̄ , v̄S ) − p̄R (T̄ , v̄R ) = 0

,

v̄R =v̄

.

(15)

Calculations based on the latter approach are abbreviated
as h̄(T̄ , v̄) or (∂ p̄/∂ T̄ )v̄ (T̄ , v̄), for example. We refer to this
as the volume explicit approach.
2.3. Compressor Stage Model
Following the basic design philosophy for (real-gas)
centrifugal compressors in [8], a static dependency between dimensionless characteristic compressor numbers
Ψp –ϕ–µ–Md2 of a specific compressor stage is postulated.
The dimensionless numbers are
the polytropic head coefficient
the flow coefficient

Ψp = 2

yp
[π n d2 ]

2

, (16)

4
V̇s
,
π d22 [π n d2 ]
(17)
∆h
(18)
µ=
2 ,
[π n d2 ]
[π n d2 ]
M d2 =
.
(19)
a1
ϕ=

the work input factor
and the machine Mach number

The variables used are listed in Table 1. With these terms,
the polytropic efficiency can be introduced that serves as
a meaningful assessment measure, concerning not only the
efficiency of the current operating point but also the health
status of the respective compressor stage:

3 The LKP state equation is valid for (T̄ , p̄) ∈ [0.3; 4] × ]0; 10].
Due to its continuous pressure explicit formulation, it is improper to
describe the multiphase region correctly. The recommended method
guarantees an (always existing) solution outside this region.

ηp =
4

yp
Ψp
=
.
∆h
2µ

(20)

Polytropic work

yp

J kg−1

Actual compression work

∆h

J kg−1

Impeller diameter

d2

m

[π n d2 ]

m s−1

Suction volume flow

V̇s

m3 s−1

Sonic inlet velocity

a1

m s−1

Blade speed at impeller exit

in Fig. 2 for the first stage, T̄fSj is the temperature, corresponding to the reduced enthalpy h̄Sj
2 , of the small, fixedsize fluid volume V2Sj , which can be interpreted as a short
pipe section, connected to the discharge side of the compressor stage. For the sake of consistency, this artificial
fluid volume is under the same pressure as the actual volume within the downstream pipe. V2Sj /V Pj must be small
enough to guarantee the desired “rapid” solution, but large
enough to avoid dynamic stiffness. This trade-off is addressed within Section 3.3, where we present an approach,
which is proven to handle V2Sj /V Pj ≈ 0.01.
Here, for the jth compressor stage, the concrete, proposed solution strategy to determine an operating point
within the performance map and the right side of Eq. (21),
P[j-1] P[j-1]
given the thermodynamic states (T̄f
, v̄
) at the suction side and (T̄fPj , v̄ Pj ) at the discharge side, which is an
intermediate pipe in the global scheme for j 6= N (cf. Fig.
1), as well as the current discharge temperature T̄fSj , is as
follows:

Table 1: Compressor characteristics and their physical units

For real compressors, a generically structured mapping
function, e.g., a fixed-order polynomial, is improper for describing the multitude of possible shapes of specific compressor performance maps Ψp –ϕ–µ–Md2 accurately. That
is why we present an interpolation-based technique in Section 3.2 to approximate arbitrary shapes. In this section,
the actual shape is irrelevant, and we focus on the solution strategy to determine the current operating point of a
compressor stage within its performance map. To this end,
one has to ask, “Which of the properties of Ψp , ϕ, µ, and
Md2 are a priori accessible and determine the remaining
properties uniquely?” Given the predefined model structure (see Section 2.1), the dynamic simulation will supply
the suction and discharge states, as well as the rotational
speeds for every time instant. Thus, Md2 and Ψp can be
calculated readily; see below. As a result, we propose
an interpolation-based mapping M : (Md2 , Ψp ) → (ϕ, µ),
to uniquely determine ϕ and µ. With this information,
the compressor map can be displayed in the conventional
way as Ψp as a function of ϕ; see Section 4.4 as well. The
shape of M is addressed in Section 3.2.
To determine an operating point within such a polytropic performance map, an iterative multiple-step procedure is unavoidable, because it is infeasible to determine
the discharge temperature without prior knowledge of the
operating point, and vice versa. Within the framework of
the entire monitoring scheme, it turned out to be advantageous to resolve this dependence with the formulation
of a dynamic problem. To this end, an energy balance
for an appropriately defined hypothetical volume element
featuring the artificial dynamic state variables T̄fSj is formulated as a physically motivated approach; see Eq. (4)
as well. The model should ensure that such temperatures
tend rapidly toward values that are consistent with the
converged operating point. As an example for the jth
stage, the approach results in
i
h
Sj
Sj
Sj
Sj
Sj
Sj
ṁ
h̄
+
∆
h̄
−
h̄
d T̄f
2 v̄2
1
R Tc
=
·
.
(21)
Sj Sj
dt
pc
V2 c¯v 2

1. Determine the reduced specific enthalpy, pressure, and
speed of sound at the inlet, utilizing the volume explicit
approach (see Section 2.2)


P[j-1] P[j-1]
z1Sj = z T̄f
, v̄
, for z = {h̄, p̄, a} ,
which, inter alia, leads to the machine Mach number
Sj
MSj
d2 if the given compressor shaft speed n and impeller
Sj
diameter d2 are taken into account.

2. Determine the reduced discharge pressure, utilizing the
volume explicit approach


Pj Pj
p̄Sj
=
p̄
T̄
,
v̄
.
2
f
3. Determine the reduced specific enthalpy, volume, and
isochoric heat capacity at the discharge pipe-section,
utilizing the pressure explicit approach (see Section 2.2)
as p̄Sj
2 is given from the last step


z2Sj = z T̄fSj , p̄Sj
, for z = {h̄, v̄, c¯v } .
2
4. Calculate the polytropic volume exponent
nSj
v =−

Sj
ln(p̄Sj
2 /p̄1 )

ln(v̄2Sj /v̄ P[j-1] )

.

5. Calculate the polytropic work

A steady discharge temperature T̄fSj is obtained if and only
if the actual reduced compression work ∆h̄Sj , computed
from the performance map, equals the direct reduced enSj
thalpy increase over the compressor stage h̄Sj
2 − h̄1 , i.e.,
the calculation is converged. Within this concept, shown

ypSj =

Sj
P[j-1] nv
p̄Sj
v̄
1
nSj
v −

1





p̄Sj
2
p̄Sj
1

v −1
! nSj
Sj
nv




− 1 R Tc ,

which leads to the polytropic head coefficient ΨSj
p .
5

nS1
suction pipe


T̄ fP0 , v̄P0

1st stage
T̄ fP0 , p̄S1
1
S1
ΨS1
p , Md2

ṁS1 , ∆h̄S1
T̄ fS1 , p̄S1
2

discharge
pipe-section


T̄ fS1 , p̄S1
2

ṁS1 , T̄ fS1

1st intermediate pipe


T̄ fP1 , v̄P1

p̄S1
2

Figure 2: The dynamic compressor stage model concept exemplified for the first stage;
in-block values denote current states, values displayed on the paths represent drivers for changing linked in-block states

Sj
Sj
Sj
6. Apply the mapping MSj : (MSj
d2 , Ψp ) → (ϕ , µ ) to
determine the remaining properties ϕSj and µSj .

real-gas behavior, and expressed in a differential manner,
results in




v
∂u
dU − u · dm +
· v · dm ,
(24)
cv d T =
V
∂v T

Note that steps 4 and 5 are consistent with the definition of
a polytropic change {pv nv = const. , nv = const.} according to Zeuner (cf. [15]), which is occasionally considered
an approximation for real gases only, although an approximation of a polytropic change {ηp = v dp/dh , ηp = const.}
according to Stodola (cf. [16]) is actually meant. However, according to the authors, both definitions are approximations of the real change-of-state path, and choosing Zeuner’s approach is inevitable in the given context,
to enable real-time capability. References [17, pp. 385–386]
and [18] are given as indications for further discussion on
this topic.
To determine the right side of Eq. (21), the remaining
terms, namely, the mass flow and the reduced compression
work, follow from:
ṁ

Sj

∆h̄Sj

dv = −

v2
· dm.
V

(25)

V is the fixed-size reservoir volume, U is the extensive
internal energy, m is the volume’s total mass, and further,




∂p
∂u
=T
−p
(26)
∂v T
∂T v
is a universal caloric relation (cf. [17, p. 140]). The energy
and mass balance, given a single upstream input crosssection (subscript 1) and a single downstream outlet crosssection (subscript 2), yield
d U = h1 · d m1 − h · d m2 + d Q ,

ϕSj + ∆ϕSj π Sj 2 h Sj Sj i pc
V̇sSj
d
=
π n d2 ·
,
= P[j-1]
4 2
R Tc
v
v̄ P[j-1]
(22)
h
i2
 Sj

1
.
(23)
= µ + ∆µSj π nSj dSj
·
2
R Tc

d m = d m1 − d m2 ,

(27)
(28)

where dQ might be used to model additional energy transfer, e.g., heat transfer in the case of a diabatic pipe casing. The combination of Eqs. (24)–(28), expressed with
dimensionless quantities, leads to the dynamic evolution
equations of the thermodynamic state of an intermediate
pipe volume:
"
d T̄fPj
v̄ Pj
d QPj
1
=
·
+ ṁSj
Pj
Pj
Pj
dt
R Tc
V c¯v (T̄f , v̄ ) d t


i
h
∂ p̄
S[j+1]
Sj
Pj
+ T̄f
(T̄ Pj , v̄ Pj )
· h̄2 − h̄1
∂ T̄ v̄ f
#
h
i
R Tc
· ṁSj − ṁS[j+1] v̄ Pj ·
,
pc

Note the incorporation of the model states ∆ϕSj and
∆µSj , which represent deviations from the (nominal) performance map, and which will be estimated below.
For the N th compressor stage, the procedure is analogous, with the exception of step 2, which is obsolete due
to the given model input pPN (cf. Eq. (5)). Note that the
multi-stage model can be programmed efficiently, because
many interim results, e.g., the pressure within the interS[j-1]
mediate pipe p̄2
= p̄Sj
1 , and terms from the thermal
relations that are not shown here appear multiple times.

(29)

2.4. Dynamic State Equations
In addition to the artificial state equations dT̄fSj /dt (see
Eq. (21)), dynamic equations for the remaining states have
to be derived. For quantities, representing the thermodynamic state within intermediate pipes, T̄ Pj and v̄ Pj for
j = {1, . . . , N − 1}, appropriate balance equations are utilized. To ensure real-time capability, each fluid volume
within such pipes is modeled as an open, well-mixed reservoir. The change of state for such a reservoir, considering

i RT
d v̄ Pj
(v̄ Pj )2 h Sj
c
S[j+1]
=−
ṁ
−
ṁ
·
,
dt
V Pj
pc

(30)

In Eqs. (29) and (30), leakage mass flows might be considered, which is not done here. Note that many terms,
including hidden ones such as (v̄S , v̄R )Pj (cf. Section 2.2),
have already been calculated within the compressor stage
model (see Section 2.3).
6

For considering delayed temperature measurements, arbitrary sensor models can be applied. However, as sensor
modeling is not the focus of this article, we choose a simple
linear, first-order approach:

Entry in χ represents

Valid domain, such that

temperature T̄

max(0.3, T̄l ) ≤ T̄ ≤ min(4, T̄u )

i
d T̄sPj
1 h
= Pj T̄fPj − T̄sPj ,
dt
τ

work input deviation ∆µ 0 ≤ µ and ηp =

i
d T̄sSj
1 h
= Sj T̄fSj − T̄sSj .
dt
τ
(31)

A variable with an index k denotes a discrete-time quantity; e.g., z k would be an abbreviation for a time-sampled
value z(t = tk ) (usually, tk = k × “fixed sample time”,
k ∈ N), rx is an additive system noise, and ry represents
measurement noise. rxk and ryk are stochastic, zero-mean,
uncorrelated, discrete signals with time-variant covariance
matrices Rxk and Ryk , respectively. Applying the expectation operator E{},

(32)

E{ rxi (rxj )T } = Rxk δij ,

Considering the terms already calculated within the
compressor stage model (Section 2.3), the entire set of
output equations g of the multi-stage model (cf. Eq. (2))
simply comprises:

TsSj

=

T̄sSj

S[j+1]

pPj = p̄1

Tc .

pc ,

≤1

nonlinear, discrete-time system description is derived from
Eqs. (1) and (2):


 xk = F xk−1 , uk−1 , θ, k + rxk−1 , x0 – given, (34)

 y =G x ,u
,
θ,
k
+ ryk .
(35)
k
k−1
k

2.5. Output Equations

TsPj = T̄sPj Tc ,

Ψp
2µ

Table 2: Sigma point constraints; T̄l and T̄u represent any known
lower and upper temperature bounds for the underlying process

The entire dynamic equation set f of the multi-stage model
(cf. Eq. (1)) consists of Eqs. (21) and (29)–(32).

ṁP0 = ṁS1 ,

≤ v̄

0≤ϕ

flow deviation ∆ϕ

τ denotes time constants, which are the parameters to be
adjusted later.
To fully describe the system (1)–(2), more variables have
to be known for which balance equations cannot be formulated. Most prominently, this applies to the deviation
variables ∆ϕSj and ∆µSj of the performance map. Within
the modeling scheme, they are treated as constants. The
monitoring scheme described in Section 3.1 will be able to
estimate such quantities. For this purpose, and for applying an Unscented Kalman Filter, dynamic equations must
be formulated for these “constants”, namely
d T̄fP0
d v̄ P0
d ∆ϕSj
d ∆µSj
=
=
=
= 0.
dt
dt
dt
dt

1
11.7

specific volume v̄

E{ rxi (ryj )T } = 0 ,

E{ ryi (ryj )T } = Ryk δij ,

∀ i, j ,

(36)

follows, where δii = 1 and δij = 0 for i 6= j.
The core of the UKF is the Unscented Transformation
(UT). The UT gives an estimate of statistical moments,
inter alia, the mean and the covariance, of a density function that is the outcome of a nonlinear transformation (via
F or G) of a prior density function. The estimate is based
on specific representatives of the density function, called
sigma points. The sigma points of a distribution of x or y
are typically denoted with χ or γ, respectively.
For the multi-stage compressor introduced, physical
constraints must be respected. The valid domains are
given in Table 2. Different types of constraint handling
within the Kalman Filter approach are discussed in [24].
In this contribution, a simple approach is chosen: Check
that every sigma point calculated within the UT and the
reformulated correction step is in a valid physical domain,
and if not, place the entries involved on the nearest element inside the valid domain. This ad-hoc approach,
called clipping, is an essential element of the entire monitoring algorithm, because it has a superior stabilizing effect, compared to any internal constraint handling within
the general model F and G.

(33)

3. Monitoring
3.1. Constrained Unscented Kalman Filter
Because the aim is to focus on the novelty of our contribution, i.e., the modeling approach and the performance
map estimation below, the reader is referred to [19, 12]
for an introduction to the well-known UKF. However, as
the UKF is a fundamental part of the overall monitoring
scheme, some remarks are in order. The objective of the
UKF approach is to provide an estimate x̂ of the true,
partly unmeasurable states x of a nonlinear system that
is given by Eqs. (1) and (2). Readers who are more interested in the basics of implementing this method might
prefer the brief presentation in [20].
There are several concepts of the UKF that differ in detail; cf. [21, 13, 22, 23]. For the multi-stage monitoring
scheme of a compressor considered here, the Constrained
Unscented Kalman Filter (CUKF) with the reformulated
correction step proposed in [13] is combined with an additive noise assumption. Therefore, the following stochastic,

3.2. Recursive Map Estimation
In Section 2.3, a generic mapping function
M : (Md2 , Ψp ) → (ϕ, µ) was introduced to determine
an operating point within the dimensionless performance
7

map Ψp –ϕ–µ–Md2 of a single compressor stage. The aim
of this work is an estimation of this performance map,
even when it changes over time, e.g., due to fouling,
or when it is completely unknown from the beginning.
Before going into details, the general idea of the RME is
sketched in Fig. 3:
Assume that at time t an estimate of the map exists, as
is displayed in Fig. 3a, for an arbitrary map with two independent variables and one dependent variable. For t = 0,
the initial guess might be a nominal map or just a horizontal plane z(x, y) = constant. Data of the actual map is
stored for individual pairs of the independent variables x
and y on a rectangular grid, as shown as well. By interpolation, z can be calculated for every pair (x, y). Now, at
time t, with the help of the CUKF, an estimate of the process state is obtained that can be exploited to calculate
an estimate of the local dependent variable z(t) marked
by in Fig. 3. This estimate will be used in the RME to
adapt the dependent variable z of the map in an optimal
manner, in which neighboring z-grid values will be more
affected than distant ones, and x-y-grid values will remain
in their initial position, as depicted in Fig. 3b. By this,
the shape of a time-invariant map can be learned, or a
time-variant map can be estimated.
In this sense, for allowing almost arbitrary shapes, we
define a performance map via a set of NM discrete operating points that are initialized for t = 0, and updated for
all future time instants. The corresponding coordinates
M
M
M
MM
d2 ,i , Ψp,i , ϕi , and µi for these operating points i are
M
M
captured in respective column vectors MM
d2 , Ψp , ϕ , and
M
NM
µ ∈ R . Using an interpolation scheme to merge the
set of grid points into a coherent map, the mapping function boils down to:



M
M
T
M

(37)
 ϕ = m Md2 , Ψp , Md2 , Ψp · ϕ ,



 µ = mT MM , ΨM , M , Ψ · µM ,
d2
p
d2
p

ranged as follows:
xM
1
xM
2

xM
Nx







y1M

y2M

z11
z21
..
.

z12
z22

zNx 1
 x
= z1

M
yN
y

···
···
..
.

zNx 2

···

z x2

···

z1Ny
z2Ny
..
.





T

z y1
T
z y2
..
.




 

 


=

 

y T
z Nx

(39)

zNx Ny

z xNy .

With the introduced notation, it is easy to see that

  T M M M M   x 
m x , y , x1 , yj 
z1
z1j
M   zx 
 z2j   mT xM , y M , xM
2 , yj

 
  2 
(40)
 ..  = 
 ·  ..  ,
..
 .  
  . 
.

M
z xNy
zNx j
mT xM , y M , xM
Nx , yj
| {z } |
{z
} | {z }
z xj
MyjM
zM





 x
M
mT xM , y M , xM
i , y1 
z1
zi1
T
M
M
M
M
m x , y , xi , y2 
 zi2  
 z x2 





·
..
(41)
 ..  = 
.. 
 
.
 .  


.



M
z xNy
ziNy
mT xM , y M , xM
i , yNy
| {z } |
{z
} | {z }
z yi
zM
MxM
i

is true. After k time instants, a respective amount
of information {z1 , z2 , . . . , zk } (usually, from measurements; below, from CUKF estimates) has been collected, corresponding to k independent operating points
{(x1 , y1 ), (x2 , y2 ), . . . , (xk , yk )}.
The information collected, stored in vector z k , will now be used to adapt the
z-grid values, which are stored in the time-variant vector
zM
k . It follows:
  x   
   T M M
z 1,k
m x , y , x1 , y1 
z1
ez1
x
T
M
M
z2   m x , y , x2 , y2   z 2,k  ez2 
  
 
  
 ..  = 
 ·  ..  +  ..  . (42)
..
. 


.  .
.

x
T
M
M
z N ,k
ezk
zk
m x , y , xk , yk
| {z } |
{z
} | {zy } | {z }
zk
ezk
Mk
zM
k

(38)

where mT ∈ RNM is a row vector containing interpolation coefficients that depend on the point to be interpolated (Md2 , Ψp ) and (usually a subset of) grid points MM
d2
and ΨM
p . Further dependencies, e.g., describing the effect
of potential inlet guide vanes, might be included as well.
Note that the structure of mT depends on the selected
interpolation method. The proposed RME is restricted
to interpolation methods, where mTk is not a function of
the dependent variables, ϕM or µM . We utilize a bilinear
interpolation method based on a rectangular, normalized
interpolation grid to enable efficient programming.
To exemplify the RME, we return to the x-y-z notation
from the beginning of this section.
Consider a mapping

function z = mT xM , y M , x, y · z M , which represents one
of the expressions (37) or (38), with a rectangular grid, as
shown in Fig. 4. The objective is to estimate the performance map by an optimal adjustment of z M considering
any (new) information collected. The grid vectors are ar-

The objective is to minimize the weighted sum of squared
z
errors ezk T W1,k
ezk , where
 M

M
ezk = z k − Mk · z M
.
k = z k − Mk · z ∗ + ∆z k

(43)

If prior knowledge concerning the map is available, this
M
M
is stored in z M
∗ . Consequently, z ∗ is fixed, and ∆z k is
the actual design variable of the optimization problem, the
cost function of which is:

T
z
z
= ∆z M
MTk W1,k
Mk ∆z M
J1,k
∆z M
k
k
k
h T
i
(44)
M
T
T
+ 2 z ∗ Mk − z k W1,k Mk ∆z M
k .

z
A unique minimum of J1,k
exists under very strict conditions only. To stress this issue, consider a situation,

8

a)

z

z

b)

y

y
x

x

Figure 3: Scheme of local map adaption;
a) the new information deviates considerably from the current map; b) the map is adapted by incorporating the new information

Costs (ii) and (iii) provide the smooth shape of a characteristic performance map. Matrices Lzg and Lzc are computed
as follows:

yM
Ny
yM
3
yM
2
yM
1
x1M

T

Lzg
x2M x3M x4M

xNMx

Ny −1 ∆M
∆MyjM
X
yjM
1
=
Wgzy
M
Ny − 1 j=1 ∆yj
∆yjM

(45)

NX
x −1 ∆MT
∆MxM
1
xM
i
i
+
Wgzx
,
M
Nx − 1 i=1 ∆xi
∆xM
i
 ∆M

∆MyM T
yM
j+1
j
Ny −2
−
M
X
∆yj+1
∆yjM
1
Lzc =
·
Wczy
M
M
yj+2 −yj
Ny − 2 j=1

Figure 4: Rectangular grid; the significance of the colors is given in
the text

where all information collected relates to the green area
within the grid space, shown in Fig. 4. A variation of
z-values corresponding to grid points within the red area
does not affect the interpolated z-surface within the green
z
area, and, thus, it has no impact on ezk and J1,k
, conse4
quently. Within the joint estimation scheme proposed by
Höckerdal et al., see [11], the explained issue transforms
into the loss of observability of the respective grid point
“states”. To overcome this issue, they suggest a specific
restriction to the estimated covariance matrix of their approach, with the intention to prevent the divergence of
the filter. The countermeasure here is, to extend the cost
function by several regularization terms that add

2

∆MyM

j+1

·

·

where
∆yjM

M
∆yj+1

∆MyM

−

j

∆yjM

+

M −y M
yj+2
j
2

NX
x −2

 ∆M

xM
i+1

∆xM
i+1

i=1

−

1
Nx − 2
T

∆MxM
i

∆MxM

∆xM
i

∆xM
i+1

M
xM
i+2 −xi
2

Wczx

−

∆MxM
i

∆xM
i

M
xM
i+2 −xi
2

,

(46)

∆MyjM = Myj+1
M − My M
j

M
yj+1

i+1

yjM ,

(cf.

Eq.

41)

∆xM
i

and

=
−
and ∆MxM
and
are dei
fined analogously. All introduced weighting matrices W
are symmetric and positive definite. Note that Lg and
Lc are time-invariant, and thus, they can be computed
offline.
For the purpose of real-time estimation, a recursive algorithm can be derived to solve the final optimization problem
h


z
M
M
zM
+ J2z z M
min J1,k
k − z∗
k − z∗
M
zk
(47)

i
M
z M
M
−
z
+
J
z
−
z
+ J3z z M
4
k
∗
k
∗

i) the cost of deviations to the a priori map (z M
∗ )

T
J2z ∆z M
= ∆z M
W2z ∆z M
k
k
k ,

ii) the cost of a mean gradient of the entire performance
M
map (z M
∗ + ∆z k )

T z
MT z
J3z ∆z M
= ∆z M
Lg ∆z M
Lg ∆z M
k
k
k + 2 z∗
k ,

iii) and the cost of a mean curvature of the entire perforM
mance map (z M
∗ + ∆z k )

T z
MT z
J4z ∆z M
= ∆z M
Lc ∆z M
Lc ∆z M
k
k
k + 2 z∗
k .

based on the recent optimal solution z M
k−1 :

4 To be precise, the illustration applies only to a C0 continuous
interpolation method, e.g., a bilinear interpolation, but the issue still
exists—to a lesser extent—for Cn continuous interpolation functions.

1. Initialize with:
z
z M
zM
0 = P0 W2 z ∗ ,

9


−1
.
Pz0 = W2z + Lzg + Lzc

2. For k ∈ N \ {0}:

RME (ϕ) :



M
z
z
T M
zM
k = z k−1 + Pk mk w1,k zk − mk z k−1 ,

Pzk

=

Pzk−1

RME (µ) :

where zk is the new information (the last element
of z k , cf. Eq. (42)), mk is an abbreviation for
m xM , y M , xk , yk , and w1,k is the last element of
z
W1,k
:


z
W1,k
=


z
W1,k−1

0

···

0

0
z
w1,k



.


3.3. Coupled State and Map Estimation
Thus far, the model (f , g), a state estimator (CUKF),
and the RME have been presented. In this section, a combination is presented leading to a novel real-time parameter and state estimation scheme, referred to as Coupled
State and Map Estimator (CSME), which is expected to
be superior if the map parameters have a distinct operating point dependency. As the overall performance will
be sensitive to some implementation details, we propose a
specific algorithm, and provide design suggestions.
To avoid an extensive use of indexes, we denote the entry of vector x that corresponds to the physical quantity
z with x{z}. Analogously, P{z} denotes the diagonal element of matrix P that corresponds to z. Furthermore,
D{P} represents a column vector containing all diagonal
elements—in corresponding order—of matrix P. The proposed scheme of the CSME is as follows:

RME (ϕ & µ) :

MM
d2 ,

Rx0 ,

Wgµx = wgµ · INy ,

Wgµy = wgµ · INx ,

µM
,
∗

W2µ = w2µ · INM ,

Wcµy = wcµ · INx .

2. Initialize the CUKF and the RME:
CUKF:
RME (ϕ) :

1. Declare the required variables, e.g.,
x̂0 ,

Wcϕy = wcϕ · INx ,

The initial state x̂0 of the dynamic system refers to all
state variables, i.e., normalized temperatures and specific
volumes, and variables describing deviations in the work
input factor and flow coefficient. IN denotes an N × N
M
identity matrix. Remember that MM
d2 and Ψp are fixed
time-invariant grid vectors. They have to be preset properly; i.e., they should span the entire range of possible operating points. Naturally, the number and distribution of
the declared grid points determine the flexibility of the performance map and the storage requirement of the routine.
Concerning this trade-off, the aim is to put the maximum
compatible number of grid points within the actual domain
of possible operating points. Therefore, we use a rectangular grid with normalized grid points between Ψp = 0 and
the expected surge line Ψp = Ψp (Md2 ), near which the
density of the points increases. However, if an actual operating point is found to lie outside the preset domain, one
could think of applying an extrapolation scheme (the same
structure as Eqs (37) or Eq. (38)) instead of redesigning
the interpolation grid.
Note that every individual compressor stage has its own
performance map, and if map variations should be monitored, its own RME calculation steps. To avoid repetitions, the stage-number superscript Sj is suppressed in
this section.
With the scalar weights w2ϕ and w2µ , the user declares whether to trust the a priori performance map
M
M
M
ΨM
p –ϕ∗ –µ∗ –Md2 (high weights) or not (low weights).
Even in cases where there is no a priori knowledge,
they have to be declared positive. For these cases,
we set w2ϕ = w2µ = 10−4 and ϕM
= µM
=
∗
∗
0NM ×1 . Otherwise, with w2 = 0, the matrix inverse
within the initialization step of the RME may not exist. Concerning the adjustment of the remaining weights
for the presented test case below (see Section 4), we
found a proper balance for wgϕ = wcϕ = 10−4 /Rx0 {∆ϕ} and
wgµ = wcµ = 10−4 /Rx0 {∆µ}.

Clearly, step 2 does not differ from the well-known Recursive Least Squares (RLS) algorithm; cf. [25, pp. 363 ff.].
Consequently, any known issue and modification of the
RLS algorithm that can be found in the literature may
apply. The distinguishing feature is the initialization, step
1, where the time-invariant regularization terms are incorporated. Within the RLS approach, Pzk is the covariance
z
matrix of the estimation error if w1,k
= 1 ∀k and the information zk is a normally distributed, uncorrelated signal.
Although this does not apply here, Pzk provides information about the uncertainty of the current estimate z M
k . A
low diagonal element indicates a reliable estimate of the
corresponding element in z M
k ; i.e., considerable information has already been collected within the vicinity of the
corresponding grid point. We refer to these diagonal elements as uncertainty levels.

CUKF:

Wgϕy = wgϕ · INx ,

Wcϕx = wcϕ · INy ,

Wcµx = wcµ · INy ,



0
..
.

W2ϕ = w2ϕ · INM ,

Wgϕx = wgϕ · INy ,

T
Pzk−1 mk mTk Pzk−1
,
− z −1
w1,k + mTk Pzk−1 mk



ϕM
,
∗

RME (µ) :

Ry0 ,

ΨM
p ,
10

x̂0 {∆ϕ} = 0 ,

x̂0 {∆µ} = 0 ,
x
Px0 = wP · R0 ,
ϕ M
ϕM
= Pϕ
0 W2 ϕ∗ ,
0
 ϕ

ϕ
ϕ −1
Pϕ
,
0 = W2 + Lg + Lc
µ
µ M
M
µ0 = P0 W2 µ∗ ,

−1
.
Pµ0 = W2µ + Lµg + Lµc

Most UT algorithms (cf. Section 3.1) require wP > 0.
Without prior knowledge of Px0 , wP  1 is a common
choice that allows the state estimator to apply large adjustment steps during the initial phase. Since large adjustments may have a destabilizing effect on the CSME,
especially if the prior performance map knowledge is very
uncertain (w2 small), we recommend waiting for an initial period before enabling map estimation. Following this
advice, the initial transient behavior of the CUKF, configured via wP , is rather irrelevant in the CSME scheme.

calculation according to the state estimate x̂; i.e., respective entries from x̂ are used to calculate the hat marked
values according to the presented formulae. Considering
that D{Pµk−1 } is consistently ordered to the interpolation
grid, mTk−1 · D{Pµk−1 } gives the interpolated uncertainty
level of the recent operating point. If the applied interpolation scheme for calculating the interpolation coefficients in
mTk−1 is comonotone (monotone between neighbored grid
points), wR,k ≥ 1 is fulfilled within the entire grid domain
(no extrapolation). In this case, one could define a Local
Information Level

3. Initialize the revised map vectors (the explanation follows, see step (4f)):
= ϕM
,
ϕ
eM
0
0

LILk := √

µ
eM
= µM
.
0
0

(a) Adjust time-variant system noise for the CUKF:

Rxk {∆µ} = wR,k · Rx0 {∆µ} ,

2
Rxk {T̄fS } = wT̄ · f k−1 {T̄fS } ,


f k−1 = f x̂k−1 , uk−1 , θ, tk−1 ,

The incorporation of the model (f , g) into the CUKF
scheme is quite clear (cf. Section 3.1):

F xk−1 , uk−1 , θ, k = xk−1

θ{µM
eM
i }=µ
i,k−1 .

The latter line should clarify that the revised map vectors
are applied within the compressor stage model. As a reminder, f k−1 {T̄fS } was introduced in Section 2.3, Eq. (21),
as an artificial model equation with the purpose of determining the converged compressor stage’s discharge temperature T̄fS within a small time interval. If f k−1 {T̄fS } = 0,
then T̄fS is in a converged state. In contrast, if (f k−1 {T̄fS })2
is large, then T̄fS is far from the converged state. Enlarging the corresponding model equation uncertainty Rxk {T̄fS }
in the latter situation, enables the state estimator to apply large adjustment steps of x̂k {T̄fS }, thus, increasing the
speed of convergence. We apply wT̄ = 10−2 .
Further, it is advisable to inform the state estimator
whether the current operating point lies within a certain known region (low uncertainty level ) of the performance map. If not, the estimator should be allowed to apply larger deviations from the nominal performance map
(x̂k {∆ϕ}, x̂k {∆µ}). For instance,
wR,k = mTk−1 ·

+



Ztk

f ( x, u∗ , θ, t ) d t ,

tk−1

G xk , uk−1 , θ, k = g ( x, u, θ, tk ) .
From the user’s point of view, note that we end up using
a simple forward Euler method for numerical integration
that provides acceptable performance in terms of stability,
accuracy, and computational speed, at least with step sizes
≈ 5 × 10−2 s for volumes ≥ 10−2 m3 , as chosen here. Further, since entries in the input vector u that comprises the
individual shaft speeds and the last stage’s discharge pressure may arise from time-sampled measurements (cf. Eq.
(5)), it is not advisable to ignore their changes throughout the prediction horizon, especially in cases of highly
transient operation or large tk − tk−1 . Therefore,


t − tk−1
t − tk−1
∗
u (t) = 1 −
· uk−1 +
·u
tk − tk−1
tk − tk−1 k

D{Pµk−1 }
min D{Pµk−1 }

serves
this purpose, where m

 k−1 is an abbreviation for
M
M b
b
m Md2 , Ψp , Md2 ,k−1 , Ψp,k−1 , which contains the interpolation coefficients depending on the location of the recent operating point within the performance map, which
is assumed to lie within the vicinity of the current operating point. The hat symbol b denotes the consistent

(48)

(b) Update the state estimate and the covariance matrix considering the current measurements y k by
applying the proposed CUKF scheme:


(x̂k , Pxk ) = CUKF x̂k−1 , Pxk−1 , y k , Rxk , Ryk .

Rxk {∆ϕ} = wR,k · Rx0 {∆ϕ} ,

eM
and θ{ϕM
i }=ϕ
i,k−1 ,

0 % < LILk ≤ 100 %

serving as a meaningful monitoring indicator that correlates with the amount of information collected within the
vicinity of the current operating point (“amount of confidence” in the local estimation).

4. For k ∈ N \ {0}:

where

1
,
wR,k

is embedded in the numerical integration scheme.
(c) If the initial transient phase of the state estimator
is concluded, continue with step (4d); otherwise,
skip steps (4d)–(4f).

11

For a proper indication, condition


D{Pxk } − D{Pxk−1 }
D{Pxk−1 }

∞

ϕ

< “threshold”
may be checked, where the operator
denotes the
Hadamard division (element-wise division).

bk
ϕ

(d) Concerning the weighted map estimation error (cf.
Eq. (43)), adjust the time-variant weights for the
RME:
ϕ
w1,k
=

1
,
Pxk {∆ϕ}

µ
w1,k
=

1
.
Pxk {∆µ}

RME (µ) :

µM
k

−1

=

Pµk−1

−

Pµk−1 mk mTk Pµk−1
−1

µ
w1,k
+ mTk Pµk−1 mk

eM
mTk · ϕ
k−1
b p,k−1
Ψ

Ψp

x̂k {∆µ} = 0 .

Before the newly introduced variables are declared, the
conceptual idea behind the revised map vectors and step
(4f) needs clarification. A sketch of this concept is shown
b d ,k−1 = M
b d ,k =
in Fig. 5 for the simplified situation M
2
2
M
Md2 ,i ; i.e., the dimension along machine Mach number
variation becomes neglectable, yielding a scalar interpolation approach along Ψp only. For the current time stamp
k, the CUKF estimates a deviation x̂k {∆ϕ} to the former revised map, the ϕ-coordinates of which are stored
in ϕ
eM
. In step (4e) this deviation is incorporated into
k−1
the actual map, the ϕ-coordinates of which are stored in
, by recursively solving the optimization problem, as
ϕM
k
described in Section 3.2. As is the situation in Fig. 5, the
estimated flow coefficient ϕ
bk is unlikely to have no bias to
the actual map (normally, an interpolated surface; here,
an interpolated line); i.e., mTk · ϕM
6= ϕ
bk . In other words,
k
the actual map is not consistent with the estimated state.
This is expected, since the CUKF presumes the map to
be time-invariant. Instead of advancing the model states
by ϕk , etc., and applying a joint estimation within the
CUKF scheme, which would be in accordance with the
approach in [11] and raise a massive increase in the computational burden in the present context, we derived the
Coupled State and Map Estimator and provide the revised
map vectors for this purpose. These vectors, ϕ
eM
and µ
eM
,
k
k
are consistent to the CUKF estimate, i.e.,

,

,

RME (ϕ) : ϕ
bk = mTk · ϕ
eM
+ x̂k {∆ϕ} ,
k−1

µ
bk = mTk · µ
eM
+ x̂k {∆µ} ,
k−1



M b
b p,k .
and mk is an abbreviation for m MM
,
Ψ
,
M
,
Ψ
d
,k
d2
p
2

Note that, for instance, mTk · ϕ
eM
is embedded in the
k−1
Sj
model in place of ϕ from Eq. (22), and x̂k {∆ϕ} represents ∆ϕSj in this context; i.e., the CUKF calculates the
displacement in relation to the former revised map.
(f) Update the revised map vectors with the approach
described below:
h
i−1
h
i
ϕ
e
ϕ
e
ϕ
ϕ
T
T
M
ϕ
eM
=
A
A
W
A
A
W
ϕ
−
b
k
k
k
k
k
k
k + bk ,
k
k
h
i−1
h
i
µ
e
µ
e
µ
µ
T
T
M
=
A
A
W
µ
eM
A
A
W
µ
−
b
k
k
k
k
k
k
k + bk ;
k
k

ϕM
k−1

x̂k {∆ϕ} = 0 ,

where the “new information” to be considered arises from

RME (µ) :

eM
ϕ
k−1

and reset the a priori performance map deviations
of the next iteration afterward:

T

Pµk

eM
ϕ
k

Figure 5: Update of revised map vector ϕ
e M applying a scalar C0
continuous linear interpolation approach (dependence on Md2 nedenote uncertainty levels at grid points
glected); symbols

T

ϕ
w1,k
+ mTk Pϕ
k−1 mk
h
µ
= µM
+ Pµk mk w1,k
µ
bk
k−1
i
,
− mTk µM
k−1

x̂k {∆ϕ}

b p,k
Ψ

(e) Incorporate the updated state estimates x̂k {∆ϕ}
and x̂k {∆µ} into the performance map applying
the recursive step of the RME scheme:
h
ϕ
ϕ
M
=
ϕ
+
P
w
ϕ
bk
RME (ϕ) : ϕM
m
k
k
1,k
k
k−1
i
− mTk ϕM
,
k−1
T ϕ
Pϕ
k−1 mk mk Pk−1

ϕM
k

bk−1
ϕ

In a standard Least Squares approach without regularizaz
tion terms, W1,k
= (Czk )−1 gives the optimal (minimum
z
covariance) estimate of z M
k if Ck is the true covariance
matrix of the collected information z k that arises from a
stochastic, uncorrelated process. We already stated that
such a premise does not apply here. The current information to be considered will arise from the CUKF estimate
x̂k {z}, which is treated as the expected mean of an unspecified distribution with an expected variance Pxk {z}.
ϕ
µ
However, the proposed weighting w1,k
and w1,k
clearly indicates the underlying intention.

ϕ
Pϕ
k = Pk−1 −

b d ,k−1 = M
b d ,k = MM
M
d2 ,i
2
2

mTk · ϕ
eM
=ϕ
bk ,
k

mTk · µ
eM
=µ
bk ,
k

(49)

which is assured via step (4f). Metaphorically speaking,
the estimated deviation is preserved within the revised
map. Therefore, the respective CUKF states must be
12

(Tc = 31.13 ◦C, pc = 73.77 bar) compressor acts as reference and “measurement” generator. The “measurements”
are sampled at a rate of 1 Hz. At a reasonable effort, several modifications have been implemented compared to the
model that is applied within the monitoring scheme (cf.
Section 2), to draw a somewhat more realistic situation
for the CSME:

reinitialized for the next iteration, to be consistent with
the revised situation itself. Consequently, the revised map
and the CUKF estimates are capable of tracking spontaneous and wide map deviations quickly, even if the actual
map, calculated within the RME scheme, is in a nearly
converged state, where adjustments to changed circumstances are typically sluggish.5 The diverging response
times of actual and revised map vectors may be exploited
for fault detection. As an example for µ, if condition
q
M
>
w
Pxj {∆µ}
(50)
µM
−
µ
e
f
j
j

• In contrast to the approximative but versatile real-gas
model that is applied within the CSME (cf. Section 2.2),
the CO2 -specific model presented in [26], which matches
the real-gas behavior of CO2 closely, is embedded within
the SE.

∞

is fulfilled for (Nf + 1) consecutive time stamps
(j = {k − Nf , . . . , k − 1, k}), a drastic change in behavior, i.e., a fault at time stamp k −Nf , of the corresponding
compressor stage is plausible.
or µ
eM
minimizes the
The proposed calculation of ϕ
eM
k
k

• The assumption of well-mixed volumes within the connecting pipes is discarded, and the delay of the temperature information due to (1D) transportation of the mass
inside the pipes is considered in the SE.

weighted sum of squared errors between ϕM
or
and ϕ
eM
k
k

• For the mapping function M, a C1 continuous (piecewise
cubic) interpolation method is applied based on 350 grid
points vs. C0 continuous (bilinear) interpolation with
NM = 140 grid points in the CSME.

between µM
and µ
eM
, respectively, subjected to (49). We
k
k
found it reasonable to keep revised points with a low uncertainty level close to the actual map (cf. Fig. 5). Therefore, weighting matrices Wkze are constructed as diagonal
−1
matrices that fulfill D{Wkze } = D{Pzk }.
ϕ
µ
Ak , bk , and bk are as follows:


Ijk −1
0(jk −1)×(NM −jk )




T
−m−1
·
m
Ak = 
,
jk ,k
k,jk


0(NM −jk )×(jk −1)
INM −jk




0(jk −1)×1
0(jk −1)×1








µ
−1
−1
ϕ
b
·
m
µ
b
·
m
,
b
=
=
bϕ

.


k
k
k,j
k,j
k
k
k
k




0(NM −jk )×1
0(NM −jk )×1

• For every time stamp, the converged discharge temperature is calculated vs. the artificial state approach according to Eq. (21) of Section 2.3, in the CSME.
The preset simulation inputs, the compressor-shaft
speed and the discharge pressure, can be found in Fig.
6. We do not claim to have designed a realistic operating scenario. The intention was to run the machine across
varying operating points, as in a highly flexible operation,
connected via transients with a supposedly realistic, nonstepwise shape. The suction conditions of the SE are fixed
at pP0 = 100 bar, T P0 = 80 ◦C. All calculated values that
are treated as “measurements” for the CSME are affected
by artificial, normally distributed noise with a standard
deviation of 0.1 bar, 0.1 K, or 0.1 kg s−1 , respectively. The
time stamp index k is suppressed in this section, since
the physical time, e.g., measured in minutes, seems more
natural. Such a dependence is obvious from the following
figures anyway.

mk,jk is the jk th element of mk , and mjk ,k ∈ RNM −1 is
a subvector of mk , constructed by removing mk,jk , and
jk is an arbitrary index that fulfills mk,jk 6= 0. Be aware
that—applying a C0 continuous interpolation method—
the matrix inversion in step (4f) can be reformulated; thus,
the actual matrix to be inverted is of dimension 3 × 3.

4.2. Process Tracking

4. Results

Concerning the tracking performance, i.e., the capability of the CSME to track reference process states, we focus on the unmeasured, in reality unknown states. The
CSME is able to track the measurement values as well,
while significantly reducing the (artificial) measurement
noise. Some exemplary results are shown in Fig. 7. The
delay between the fluid’s temperature in the intermediate
pipe TfP1 and the corresponding “measured” value TsP1 ,
both calculated in the SE, can be seen in Fig. 7a for the
intermediate temperature. In the SE and the CSME, a
time constant of τ P1 = 10 s is assumed for a first-order
system; see Section 2.4, Eq. (31). The CSME is capable of
tracking the actual temperature of interest TfP1 (slightly

4.1. Test Case
For validation purposes, a reference process with known
performance maps and state trajectories is mandatory,
and distinct real-gas behavior is desired to emphasize the
scope of this research. Therefore, a numerical, i.e., simulative experiment (SE) of a two-stage supercritical CO2
5 Forgetting factors may be incorporated in the RME to keep the
actual map flexible. Within the presented context, global forgetting
does not make sense, and—as far as our experience goes—local forgetting is hard to adjust properly. Alternatively, the CSME might
be restarted frequently, e.g., with ϕM
= ϕM
, etc.
∗
k−1

13

n [s−1 ]

a) 400
300
200
nS1 = nS2 (SE & CSME)

100

p [bar]

b) 180
160
140
120
100
80

pP2 (SE & CSME)
0

5

10

15

20

25

30
time [min]

35

40

45

50

55

60

Figure 6: Simulation inputs; a) identical compressor-shaft speed for both stages S1 and S2; b) discharge pressure pP2 of discharge pipe P2.

noisy), revealing any temperature peak, which is hidden
from the measurements. For the remaining temperature
positions, the tracking performance is very similar; thus,
they are omitted here.
Fig. 7b–d shows the estimation of several compressor
characteristics. Obviously, the generic real-gas model, presented in Section 2.2, is sufficiently accurate; otherwise,
the estimates would have to be biased from the reference.
None of the values shown in Fig. 7b–d are declared model
states for the CUKF scheme; thus, the values arise from
the presented formulae (see Section 2.3), embedding the
“direct estimates” preserved in x̂. Since x̂{∆µ} enters the
denominator of
η̂p =

flexible operation. Altogether, the tracking performance
seems unaffected by the fault, which indicates a correct
fault isolation. Generally, fault isolation is the capability
to assign a fault to the correct cause. Here, due to the lack
of defining particular failure sets, the term fault isolation
is used for the local assignment to a specific plant component, i.e., the correct compressor stage. Because the
proposed fault detection is based on component-specific
parameters, fault isolation is a straightforward task.
Situations where the fault condition (50) is fulfilled for
the current time stamp (Nf = 0) setting wf = 2 are referred to as fault indication. A fault indication is marked
by a colored background in Fig. 8b. The proposed scheme
clearly indicates the fault assigned to the first compressor
stage. For Nf = 5 (six consecutive fault indications), an
automated fault detection would have raised the failure
flag for “compressor stage 1” for the first time 7 s after the
actual fault event, while failure flag “compressor stage 2”
would remain deactivated for the entire experiment. Naturally, the frequency of the fault indications diminishes over
time, since the actual map estimate µM is never in a converged state if a failure has occurred. Consequently, the
faulty behavior is gradually incorporated into the actual
map estimate.

bp
b p,k
Ψ
Ψ

= 
2µ
b
{∆µ}
2 mTk · µ
+
x̂
eM
k
k−1

(cf. Eq. (20) and step (4e) of Section 3.3), this value is
particularly prone to noise transmission, as can be seen in
Fig. 7d. Note that the tuning parameters, e.g., Rx0 , Ryk ,
weights, etc., are manually tuned, and thus, the existence
of an alternative parameter set that provides a “better”
performance is very likely.
4.3. Fault Indication and Isolation
Although the term alteration would be much better
suited in the context of this work, the common term fault
is used consistently. To investigate the simple fault detection scheme stated in Section 3.3 (cf. Eq. (50)), the
reference performance map of the first compressor stage
is modified within the SE from t = 40 min on, referred to
as a fault event in the present section. More specifically,
the first stage’s work input factor, calculated via a reference mapping function, is increased by 0.1 for t ≥ 40 min
in the SE. A respective, spontaneous efficiency decline can
already be found in Fig. 7d, while it is hard to detect an increase in the temperature measurement in Fig. 7a during
14

In Fig. 8,pthe advantage of defining a time-variant
threshold (2 Pxk {∆µ}) for fault indication is quite obvious. Every time the compressor stage runs into an uncertain operating range, i.e., the Local Information Level LIL
is low (Fig. 8a), the amplitude of adaption, recognizable
via µM
eM
j∞ − µ
j∞ (Fig. 8b), increases, which is enhanced by
step (4a) of the CSME algorithm (cf. Section 3.3). Large
adaption steps are facilitated by large entries in Pxk ; thus,
the proposed threshold is logical. For a nominal situation, the mismatch between actual map µM and revised
map µ
eM vanishes as additional information is collected,
yielding a noisy, nearly zero-mean signal µM
eM
j∞ − µ
j∞ . For
the faulty situation, the signal characteristic completely

T [◦C]

a) 110

100
90
TsP1 (SE)

b)

15

y p [kJ kg−1 ]

80
10

T fP1 (SE)

T̂ fP1 (CSME)

yS2
p (SE)

ŷS2
p (CSME)

5
0

V̇s

[m3 min−1 ]

c)

yS1
p (SE)

ŷS1
p (CSME)

6
4
2

V̇sS1 (SE)

V̇ˆsS1 (CSME)

V̇sS2 (SE)

V̇ˆsS2 (CSME)

ηS1
p (SE)

η̂S1
p (CSME)

ηS2
p (SE)

η̂S2
p (CSME)

η p [%]

d) 100

50
0
0

2

4

6

8

10
time [min]

12

14

40

42

44

Figure 7: Tracking performance of the CSME for t ∈ [0 min; 15 min] ∪ [39 min; 44 min]; true trajectories are depicted with solid lines whereas
estimated trajectories are depicted with line shape
;
a) intermediate temperatures; b) polytropic heads; c) suction volume flows; d) polytropic efficiencies

15

map estimation enabled

a) 100
75
50
25
0

fault active (1st stage)

b) 0.4
0.2
0
−0.2
−0.4

0

10

5
LIL [%]

15
µM
µM
j∞ − e
j∞

20

25
±2

p

30
time [min]

Px {∆µ}

35

40

µM − e
µM

45

∞

>2

p
Px {∆µ}

M−µ
eM
eM
Figure 8: Fault indication and isolation; index j∞ is defined via µM
j∞ − µ
j∞ = µ

changes, which might serve as an indication whether for
manual monitoring or some augmented and automated
fault detection schemes, the investigation of which is beyond the scope of this paper.

50

55

60

1st stage
2nd stage

∞

use an artificial, time-invariant suction condition (index r)
for conversion (Ψp –ϕ–Md2 → yp –V̇s –n)8 according to relations (16)–(19) if the true performance map yp –V̇s –n (solid
speed curves) is to be fixed for the supervision monitor. As
a result, the projected OP (related to Tr and pr ) of the
first and second stages do not lie on the same (projected)
speed curve, even if the stages are mechanically coupled
(nS1 = nS2 , cf. Fig. 6a). Note that both shapes, true and
estimated, are depicted for the same Ψp and Md2 domain.
As the operating point varies, the shape adapts quickly,
as can be seen in Fig. 9b. Here, 55 s after map initialization, 55 respective measurements have been incorporated. Every 30 s, the corresponding OP estimated is
drawn into the present diagram. As a result of the flexible
interpolation-based mapping scheme, it seems unreasonable to expect a correct shape adjustment for map regions
in which no information has been collected thus far. Consequently, the speed curve shape of the first stage does
not converge correctly in the region where the surge line
would be anticipated, as this region was not accessed thus
far. However, near the operating points, good estimation
results can be seen. Whenever a “new” region is entered,
the supervisor may recognize this by the rapid decline of
the LIL.
As time passes, and the amount of information collected
increases (Fig. 9c, Fig. 10a), not only the estimated shape
of speed curves but also the estimated shape of the effi-

4.4. Performance Map Monitoring
As denoted in Fig. 8, we utilize the delayed activation of
the RME, which was suggested in step (4c) of Section 3.3.
The preset “threshold” of 2 % enables the map estimation
after 125 s. For this time stamp, the initialized map estimate (dashed speed curves), free of any reasonable a priori
shape, can be found in Fig. 9a. In this figure, polytropic
work yp and suction volume flow V̇s are displayed instead
of their dimensionless counterparts. Thus far, the information of merely one operating point (OP) marked by
has been considered. The introduced regularization terms
provide the “straight” shape, since gradients (Lg ) and curvatures (Lc ) have a relative high cost to this moment.
The presented shape is mapped into the typical yp –V̇s –n
diagram. In contrast, the true map and the (actual and
revised) map estimate6 are preserved in the dimensionless counterpart Ψp –ϕ–Md2 , which is not really suitable
for the intended presentation here.7 Due to the basic
model assumption that presupposes a static dependency
between Ψp –ϕ–µ–Md2 (cf. Section 2.3), it is necessary to
6 For the presentation of estimates in Fig. 9 and Fig. 10, the
revised map is used (cf. Section 3.3).
7 The µ-dimension becomes visible via η or, to be precise, via
p
∆ηp (filled contours, an explanation follows).

8 The real-gas models differ, whether the conversion refers to the
true or the estimated map; see Section 4.1.

16

1st stage

2nd stage

a)
20

> 10%

12
10

10%

8

5%

t = 125 s

15

6

10

2%

4
1%

5

2
0.5%

3

4

5

6

7

8

3

4

5

6

7

b)
20

> 10%

12
10

10%

8

5%

t = 3 min

15

6

10

2%

4
1%

5

2
0.5%

3

4

5

6

7

8

3

4

5

6

7

c)
20

> 10%

12
10

10%

8

5%

t = 10 min

15

6

10

2%

4
1%

5

2
0.5%

3

4

5

6

7

8

3

4

5

6

7

Figure 9: True and estimated (revised) performance map of the first (left column) and second (right column) compressor stages in relation
to the reference suction conditions (Tr , pr ) at three time stamps (rows); every 30 s (after enabling map estimation at t = 125 s), a new
(estimated) operating point (OP) is drawn, shown by the increasing number of symbols; the filled contours, projected into the estimated
performance map shape, represent levels of the efficiency estimation error ∆ηp = |ηp − η̂p |

17

1st stage

2nd stage

a)

t = 40 min − 1 s

20

> 10%

12
10

10%

8

5%

15

6

10

2%

4
1%

5

2
0.5%

3

4

5

6

7

8

3

4

5

6

7

b)

t = 40 min + 2 s

20

> 10%

12
10

10%

8

5%

15

6

10

2%

4
1%

5

2
0.5%

3

4

5

6

7

8

3

4

5

6

7

c)
20

> 10%

12
10

10%

8

5%

t = 60 min

15

6

10

2%

4
1%

5

2
0.5%

3

4

5

6

7

8

3

4

5

6

7

Figure 10: Nomenclature, see above; additionally, operating points (OP) that occur after the fault event at t = 40 min are highlighted in red

18

• an optimal preservation of past estimates concerning the
operating point dependency within fixed-size grid vectors, yielding a constant memory requirement.

ciency map improves, which becomes obvious by the drawn
levels of the efficiency estimation error ∆ηp = |ηp − η̂p |, depicted as filled contours within the estimated speed curve
shape. Concerning these levels, a systematic estimation
error remains, due to the different mapping functions used
in the SE and the CSME, as mentioned in Section 4.1.
The fault event at t = 40 min, a spontaneous decline in
the first stage’s µ map vectors of the reference (SE), affects neither the speed curve shapes nor the second stage’s
performance map at all (Fig. 10b,c). This complies with
the correct behavior, facilitating the further improvement
of the second stage’s performance map beyond the fault
event (cf. Fig. 10c). The low level of ∆ηp within the vicinity of the current (red) operating point, 2 s after the fault
event (Fig. 10b), proves the fast adaptability of the revised
map, which is presented for all time stamps in Fig. 9 and
Fig. 10. A further issue, already stated, can be seen in
Fig. 10c for the first stage. Within regions where much informations had already been collected (high concentration
of past, black OP), the estimated map is highly inflexible.
However, if the fault had been detected, a reinitialization
(after potential interventions) would be advisable anyway.

As a by-product, three time-variant supplementary observations can be provided for the monitoring task in the
context of monitoring of a multi-stage compressor:
1. a performance map for every compressor stage, i.e., the
estimated shape of speed and efficiency curves;
2. a Local Information Level, indicating the reliability of
estimates at the local operating point;
3. a fault indicator for every compressor stage, which
might be extended for fault detection and isolation if
conceivable faults have been defined.
The estimator is able to handle a priori knowledge
optionally, whether the task is to monitor deviations from
the a priori presumed performance map or to identify the
performance map during operation.
The model-based monitoring scheme was validated
via numerical simulations of a two-stage carbon dioxide
compressor operating in the supercritical phase of the
fluid. The reference simulation, which replaces the real
“measurements”, was modified considerably; e.g., the
real-gas model was interchanged, and the mass transportation delay was considered. In spite of this adverse
situation, the proposed estimator performed well. The
estimator was capable of tracking every state or variable,
whether it was measured or not, without noticeable bias.
For operating ranges that have already been reached,
the estimated performance maps converged correctly.
Within the remaining regions, the map shape maintains
its flexibility. A preset fault event was isolated (to the
respective compressor stage) correctly, and the overall
behavior of the estimates and fault indicators was as
desired.
Subjects of future research may arise from the following:

5. Conclusions
From the methodological aspect, two main issues have
been presented.
Model building. A novel, low-order dynamic model for centrifugal multi-stage compressors has been derived. Realgas behavior is taken into account explicitly. To this end,
the generic LKP real-gas equation of state [9] is applied.
Several refinements are provided to embed this equation
and its derivatives properly into the overall model scheme,
in terms of accuracy and computational speed. A compressor stage’s behavior arises from its possibly time-variant
performance map. The proposed approach utilizes an interpolation scheme based on four grid vectors, i.e., polytropic head coefficient, flow coefficient, work input factor,
and machine Mach number, which allows for the description of nearly arbitrary performance map shapes. The
proposed scheme may easily be extended by further dependencies, e.g., for variable inlet guide vanes.

• The request to continuously incorporate an alteration,
which might be detectable with the proposed scheme
already, into a nearly converged map estimate. Since
the integration of common (global) forgetting factors is
considered unreasonable within the given context, the
approach of local forgetting might be further investigated.

Monitoring. The Unscented Kalman Filter approach and
a new Recursive Map Estimation are combined, yielding a
novel real-time estimation scheme, which is expected to be
superior if the parameters to be estimated have a distinct
operating point dependency, as is the case for the grid
vectors of a compressor stage’s performance map. Realtime capability is addressed via
• a first-principle, but—in detail—approximate and consequently less computationally intensive model;

• The demand to recover from an erroneous map status,
which may be triggered from faulty measurements or
extreme deviations between plant and model behavior,
e.g., due to a short period of compressor surge. Strategies for recovering as well as surge modeling, may contribute to this issue.

• a recursive formulation of all estimation steps, yielding
a constant calculation workload;

• Augmented fault detection and isolation schemes, i.e.,
the real-time classification of conceivable failure sets.
19

Acknowledgment

[17] H. D. Baehr, K. Stephan, Wärme- und Stoffübertragung, Vol. 2,
Springer, 1996 (1996). doi:10.1007/978-3-540-87689-2.
[18] H. E. Wettstein, Polytropic change of state calculations, in:
2014 International Mechanical Engineering Congress and Exposition, ASME, 2014, p. V06AT07A077 (2014). doi:10.1115/
IMECE2014-36202.
[19] S. J. Julier, J. K. Uhlmann, New extension of the Kalman Filter
to nonlinear systems, in: Proceedings of AeroSense, Signal Processing, Sensor Fusion, and Target Recognition VI, Vol. 3068,
1997 (1997). doi:10.1117/12.280797.
[20] R. Van der Merwe, E. A. Wan, The Square-Root Unscented
Kalman Filter for state and parameter-estimation, in: 2001
IEEE International Conference on Acoustics, Speech, and Signal Processing, Vol. 6, 2001, pp. 3461–3464 (2001). doi:
10.1109/ICASSP.2001.940586.
[21] M. W. Yuanxin Wu, Dewen Hu, X. Hu, Unscented Kalman
Filtering for additive noise case: augmented vs. non-augmented,
in: Proceedings of the American Control Conference, Vol. 6,
2005, pp. 4051–4055 (2005). doi:10.1109/ACC.2005.1470611.
[22] S. J. Julier, The Scaled Unscented Transformation, in: Proceedings of the American Control Conference, Vol. 6, 2002, pp.
4555–4559 (2002). doi:10.1109/ACC.2002.1025369.
[23] S. Sarkka, On Unscented Kalman Filtering for state estimation
of continuous-time nonlinear systems, IEEE Transactions on
Automatic Control 52 (9) (2007) 1631–1641 (2007). doi:10.
1109/TAC.2007.904453.
[24] D. Simon, Kalman filtering with state constraints: a survey of
linear and nonlinear algorithms, IET Control Theory & Applications 4 (2010) 1303–1318(15) (2010). doi:10.1049/iet-cta.
2009.0032.
[25] L. Ljung, System Identification: Theory for the User, Vol. 2,
Prentice Hall PTR, 1999 (1999).
[26] R. Span, W. Wagner, A new equation of state for carbon dioxide
covering the fluid region from the triplepoint temperature to
1100 K at pressures up to 800 MPa, Journal of Physical and
Chemical Reference Data 25 (6) (1996) 1509–1596 (1996). doi:
10.1063/1.555991.

This work was supported by MAN Energy Solutions SE
and the Federal Ministry for Economic Affairs and Energy
based on a decision by the German Bundestag as part of
the ECOFLEX-Turbo project [grant number 03ET7091T].
References
[1] M. Blieske, R. Kurz, A. Garcia-Hernandez, K. Brun, Centrifugal compressors during fast transients, Journal of Engineering
for Gas Turbines and Power 133 (7) (2011) 072401–072401–8
(2011). doi:10.1115/1.4002681.
[2] M. Casey, C. Robinson, A method to estimate the performance map of a centrifugal compressor stage, Journal of Turbomachinery 135 (2) (2012) 021034–021034–10 (2012). doi:
10.1115/1.4006590.
[3] N. Bayomi, R. Abdel-Maksoud, M. Rezk, Centrifugal compressor map prediction and modification, Journal of King Abdulaziz University-Engineering Sciences 24 (2013) 73–88 (2013).
doi:10.4197/Eng.24-1.4.
[4] F. K. Moore, E. M. Greitzer, A theory of post-stall transients
in axial compression systems: Part idevelopment of equations,
Journal of Engineering for gas turbines and power 108 (1) (1986)
68–76 (1986). doi:10.1115/1.3239887.
[5] S. Dixon, C. Hall, Fluid Mechanics and Thermodynamics of
Turbomachinery, Elsevier Science, 2013 (2013).
[6] J. T. Gravdahl, Modeling and control of surge and rotating stall
in compressors, Ph.D. thesis, Norwegian University of Science
and Technology (1998).
[7] J. T. Gravdahl, O. Egeland, Compressor Surge and Rotating Stall: Modeling and Control, Advances in Industrial Control, Springer London, 2012 (2012). doi:10.1007/
978-1-4471-0827-6.
[8] K. H. Lüdtke, Process Centrifugal Compressors: Basics, Function, Operation, Design, Application, Springer Science & Business Media, 2004 (2004). doi:10.1007/978-3-662-09449-5.
[9] B. I. Lee, M. G. Kesler, A generalized thermodynamic correlation based on three-parameter corresponding states, AIChE
Journal 21 (3) (1975) 510–527 (1975). doi:10.1002/aic.
690210313.
[10] A. Cortinovis, M. Zovadelli, M. Mercangz, D. Pareschi, A. De
Marco, S. Bittanti, Online adaptation of performance maps for
centrifugal gas compressors, in: 2014 European Control Conference (ECC), 2014, pp. 1036–1041 (2014). doi:10.1109/ECC.
2014.6862211.
[11] E. Hckerdal, E. Frisk, L. Eriksson, EKF-based adaptation of
look-up tables with an air mass-flow sensor application, Control
Engineering Practice 19 (5) (2011) 442 – 453 (2011). doi:10.
1016/j.conengprac.2011.01.006.
[12] S. J. Julier, J. K. Uhlmann, H. F. Durrant-Whyte, A new
method for the nonlinear transformation of means and covariances in filters and estimators, IEEE Transactions on Automatic
Control 45 (3) (2000) 477–482 (2000). doi:10.1109/9.847726.
[13] S. Kolås, B. Foss, T. Schei, Constrained nonlinear state estimation based on the UKF approach, Computers & Chemical
Engineering 33 (8) (2009) 1386 – 1401 (2009). doi:10.1016/j.
compchemeng.2009.01.012.
[14] M. B. Mills, M. J. Wills, V. L. Bhirud, The calculation of density
by the BWRS equation of state in process simulation contexts,
AIChE Journal 26 (6) (1980) 902–910 (1980). doi:10.1002/
aic.690260604.
[15] G. Zeuner, Grundzüge der mechanischen Wärmetheorie. Mit
Anwendungen auf die der Wärmelehre angehörigen Theile der
Maschinenlehre insbesondere auf die Theorie der calorischen
Maschinen und Dampfmaschinen, Vol. 2, A. Felix, 1866 (1866).
[16] A. Stodola, Dampf- und Gasturbinen. Mit einem Anhang über
die Aussichten der Wärmekraftmaschinen: Nachtrag zur 5. Auflage, Springer Berlin Heidelberg, 2013 (2013).

20

