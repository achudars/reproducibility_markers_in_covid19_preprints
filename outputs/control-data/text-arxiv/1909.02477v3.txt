AFP-Net: Realtime Anchor-Free Polyp Detection in
Colonoscopy
Dechun Wang*, Ning Zhang*, Xinzi Sun, Pengfei Zhang, Chenxi Zhang, Yu Cao, Benyuan Liu

arXiv:1909.02477v3 [eess.IV] 26 Sep 2019

Department Of Computer Science
University of Massachusetts Lowell
Lowell, MA
{dechun wang, ning zhang, xinzi sun, pengfei zhang, chenxi zhang}@student.uml.edu
{ycao, bliu}@cs.uml.edu

Abstract—Colorectal cancer (CRC) is a common and lethal
disease. Globally, CRC is the third most commonly diagnosed
cancer in males and the second in females. For colorectal cancer,
the best screening test available is the colonoscopy. During a
colonoscopic procedure, a tiny camera at the tip of the endoscope
generates a video of the internal mucosa of the colon. The video
data are displayed on a monitor for the physician to examine
the lining of the entire colon and check for colorectal polyps.
Detection and removal of colorectal polyps are associated with a
reduction in mortality from colorectal cancer. However, the miss
rate of polyp detection during colonoscopy procedure is often
high even for very experienced physicians. The reason lies in the
high variation of polyp in terms of shape, size, textural, color
and illumination. Though challenging, with the great advances
in object detection techniques, automated polyp detection still
demonstrates a great potential in reducing the false negative rate
while maintaining a high precision. In this paper, we propose a
novel anchor free polyp detector that can localize polyps without
using predefined anchor boxes. To further strengthen the model,
we leverage a Context Enhancement Module and Cosine Ground
truth Projection. Our approach can respond in real time while
achieving state-of-the-art performance with 99.36% precision and
96.44% recall.

I. I NTRODUCTION
Colorectal Cancer (CRC) is the third most common cancer
worldwide and the second most lethal cancer in USA [33],
with an estimate of 1.8 million new diagnosed colorectal
cancer cases and 881,000 deaths in 2018 [7]. Colorectal
cancer often begins with the growth of tissues known as
polyps. Most of these polyps are initially benign but some
of them will become malignant over time. Early diagnosis
via colonoscopy is widely believed to be the best way for
the prevention of colorectal cancer. During a colonoscopy,
specialized physicians will carefully inspect the intestinal wall.
However, the operations can have a false negative rate of 25%
[19]. Multiple independent factors contribute to the miss rate.
Some of the factors are related to the polyp appearance, eg.
a small and flat polyp is less likely to be perceived, while
some other causes can be operational: the camera is moving
too fast, leading physicians to fail to catch the suspicious
regions which require more efforts. For these reasons, real
time automated polyp detection can act as a complementary
“*” indicates equal contribution.
© 2019 IEEE

tool to assist physicians in improving the sensitivity of the
diagnosis.
In the past, automated polyp detection mainly utilized handcrafted color, shape and texture features to distinguish polyps
from normal mucosae [3], [16]. Bernal et. al [4] used the
appearance of the polyps as a key factor. They assumed all
polyps have protruding surface and used valley detection as
the feature extractor. However, polyp and normal mucosae can
share similar features in edge and texture when polyps have
flat surfaces as normal mucosae. In addition, some mucosae
with vally-reach structures can appear similar to polyps. All
these facts result in poor performance for these approaches in
real applications.
Recently, Convolutional Neural Network (CNN) based object detectors such as SSD [25] and Faster R-CNN [30]
dominate the object detection task across different image
modalities. Compared with traditional approaches where features are fully designed based on human knowledge, these
CNN based detectors can learn rich features automatically in
the deep backbone networks. This is the key contributing factor
for deep learning to thrive [1], [8], [11], [21], [36], [41].
To make it more clear, we divide CNN based detectors into
the backbone part (eg. ResNet [14], VGG [34]) and the head
part which is more specific to individual detectors. For the
detection head part, the “anchor” concept is shared by both
single-stage [23], [25], [29] and two-stage [13], [30] detectors.
Anchors represent different box templates (at different scales).
This strategy works by enumerating box templates of different
scales and aspect ratios with respect to the dataset in process.
In other words, anchors should adapt to the characteristics
of the dataset. However, designing anchor sets and assigning
objects to specific anchors require extensive experience. It is
also indicated in [10] that the choice of anchors is especially
important for small objects. Moreover, when we assign objects
to certain anchors, IoU is usually the major criterion. Different
IoU thresholds can result in significant performance variations.
Motivated by these observations, the “Anchor-Free” approaches [9], [18], [40], [42], [44] have received much attention recently, where the anchor mechanism is removed and
objects are represented as keypoints. For instance, CornerNet
[18] represents an object as a pair of keypoints (top-left and
bottom-right corners). To better detect these corners, a special

Input Image

Conv4_3

Conv5_3

Sum

Conv6_2

Conv7_2

Conv8_2

Conv9_2

Context Enhancement Module

Convolution
Upsample

Anchor-free Detections

Fig. 1: The network architecture of our proposed framework. The network includes a top-down up-sampling path to enrich
semantic features at different scales, followed by a Context Enhancement Module (CEM) to increase the receptive field. The
enhanced feature maps are then fed into Anchor-free detection heads to predict bounding boxes.

corner pooling is devised to enrich the context information.
Different from CornerNet, Zhou et. al [44] represent an object
as a single keypoint located in the center. In this way, the
time-consuming pairing is removed and the model achieves
the best trade-off between performance and inference speed.
In the polyp detection, we observe that the objects (polyps)
under concern actually do not overlap much with each other
and the shapes do not vary much either. Therefore, we believe
the idea of “objects as keypoints” fits well with our application scenario. Moreover, removing the anchor mechanism
can reduce the parameters in detection heads thus result in
fewer highly overlapped proposals during inference, which can
potentially accelerate the inference speed.
In this paper, we propose a novel anchor-free detector for
fast polyp detection. Similar to [44], we formulate objects as
center points, yet removing the time-consuming center pooling
in CenterNet [9] to achieve real time response. The role of the
center pooling is replaced by a context enhancement module
as well as a feature pyramid design. In addition, we devise a
special cosine ground-truth projection strategy to compensate
for the potential drop in recall caused by the removal of the
anchor mechanism. Our proposed polyp detector outperforms
previous studies and achieves the state of the art performance
in terms of both accuracy and inference speed.

assumed to be stable without a sudden move from one location
to another between two consecutive frames. Therefore, in the
second step, a Discriminative Correlation Filter based tracking
approach was proposed to leverage the temporal information.
This tracking based method refines the detection results given
by ResYOLO and is capable of locating polyps missed by the
detector in consecutive frames.
Mohammed et. al [27] proposed Y-Net for this task. It
consists of two fully convolutional encoders followed by a
fully convolutional decoder. The motivation is that a model
pre-trained on natural images may not generalize well on
medical images. To mitigate performance degradation due to
the domain-shift (natural images to medical images), they
slowly fine-tune the first encoder from the pre-trained network
while aggressively train from scratch for the second encoder.
Two encoders are of the same network architecture and the
outputs are combined with a sum-skip-concatenation connection before coming to the decoder network.

II. R ELATED W ORK

However, seemly contradicting with [27], Mo et. al [26]
proved that fine-tuning a pre-trained Faster R-CNN can work
considerably well. In addition, Shin et. al [32] proposed a
post learning scheme to enhance the Faster R-CNN detector.
This post learning scheme automatically collects hard negative
samples and retrains the network with selected polyp-like false
positives, which functions similarly to boosting.

With the success of deep learning in natural image processing, CNN based polyp detectors were proposed in the last
few years. Compared to hand-crafted features, CNN based
detectors automate the process of extracting abstract and
discriminative features. They are more robust and require less
domain knowledge, making them particularly suitable for this
task. As our approach is also CNN based, we only discuss
with details CNN based detectors in this paper.
Zhang et. al [43] proposed a two-step pipeline for polyp
detection in endoscopic videos. In the first step, they use a pretrained ResYOLO to detect suspicious polyps. The polyps are

Our proposed method is the first one to apply the anchorfree approach to automated polyp detection. We believe that
anchor-free design is a very practical solution in our case in
terms of speed and accuracy. Unlike natural images where
pre-defined anchors are introduced to attack the occlusion
issue, in medical images such as Computed Tomography and
Colonoscopy Images, occlusion is rare. Another concern for
this polyp detection task is the real time requirement. With
anchors, a large number of overlapped proposals would be
proposed, putting significant pressure on the post-processing
step (Non-Maximum Suppression). Therefore, the anchor free
mechanism would fit better in this polyp detection task.

A. Polyp Detection

B. Anchor Free Detectors
While almost all the state of the art object detectors employ
pre-defined anchors, anchor-free object detectors [9], [17],
[18], [39], [40] have received much attention in recent years
because of their better adaptability towards different datasets.
Representative approaches include CornerNet [18] and CenterNet [9].
In CornerNet [18], objects are represented as pairs of keypoints: top-left corners and bottom-right corners. The network
is trained to predict a heatmap for all top-left corners and for
all bottom-right corners respectively in parallel. To associate
them in pairs, for each corner an embedding vector is also
learned: pushing away corners belonging to different objects
while pulling together corners in the same group. To further
strengthen the “corner learning” process, the authors also
devise a special Corner Pooling. This pooling consists of
two separate one-directional pooling (horizontal and vertical)
before combining them together at the end. In this way, more
context information is gathered to identify corners. However,
because of the pairing process, the inference speed drops
significantly.
Zhou et. al [44] use the center keypoint to represent an
object. In this way, the burden of learning to group corners
is removed and the model achieves the best performancespeed trade-off. Our work follows this idea. But we add more
constraints when assigning the label to keypoints in the context
of the feature pyramid. These constraints are later proved
to be critical in our experiments. Moreover, as indicated in
CornerNet, enriching context information plays a key role in
the success of anchor-free detectors. We also explore in this
direction by adding a Context Enhancement Module.
III. M ETHODOLOGY
In this section, we will describe our proposed anchorfree approach in detail including the network design and the
associated technical components.
A. Network Architecture
Figure 1 illustrates our framework design. It is a fully convolutional network that classifies and localizes objects on each
enhanced feature map. Our network uses VGG16 [34] as the
backbone Our framework selects k = 6 feature maps from the
backbone: conv4 3, conv5 3, conv6 2, conv7 2, conv8 2 and
conv9 2, responsible for detecting objects at different scales.
In order to increase semantics information for each feature
map, we build a feature pyramid similarly to FPN [22]. Note
that we use Deconvolution (Transposed Convolution) for upsampling instead of interpolation. Upstream and downstream
features of the same scale are combined by element-wised
addition. For each feature map Si where i ∈ [0, k − 1), we
first use 1x1 convolution to smooth the upper feature map
Si+1 , which is then up-sampled to the size of Si . Finally, we
add up-sampled Si+1 to Si . The enhanced feature map Ei can
be mathematically represented as follows:
Ei = Si + upsample(smooth(Si+1 ))

(1)

N/3
N/3

Concat

N/3

Fig. 2: Illustration of the context enhancement module. The input feature channels were first divided into three chunks, each
fed into dilated convolution layers of different depths before
they are concatenated. In this way, the effective receptive field
is enlarged while detailed information is still retained.

(a) Standard anchor based
ground truth matching.

(b) Our anchor free ground
truth matching.

Fig. 3: Comparison between anchor-based detectors (a) and
our anchor free detector (b) in ground truth target assigning.

To further increase context information for small objects,
we feed each feature map Ei to a context module before
forwarding them to the anchor-free detection heads. These
detection heads are single-staged and have similar structures
to the heads in SSD where two parallel subnets are dedicated
for classification and localization respectively.
B. Context Enhancement Module (CEM)
In order to increase context information for small objects,
we apply a similar context enhancement module (illustrated in
Fig. 2) in [20], [28]. Since our anchor-free detection heads are
of a fully convolutional manner, increasing context information
is equivalent to enlarge the receptive field of our detection
heads. However, instead of using 5x5 or 7x7 filters to enlarge
the receptive field, we adopt the dilated convolution following
[20], [37]. One good property about dilated convolutions is
that it brings in fewer parameters to achieve the same size of
the receptive field. Note that the input channels are equally
split into three branches with each branch being of different
depths. Outputs of all branches are concatenated at the end.
By employing this context enhancement module, we find in
experiments that it can considerably increase the precision
performance.
C. Anchor-free Label Assignment
We adopt a very different label assigning procedure in our
anchor-free design compared with the anchor-based framework
(Fig. 3). In anchor-based detectors (Fig. 3a), the green dashed

(a) conv4 3

(b) conv5 3

(c) conv6 2

(d) conv7 2

(e) conv8 2

(f) conv9 2

Fig. 4: Ground truth projection on different feature maps (a - f represent different scales). The blue dots are the projected points
from the feature map. The green rectangles and red rectangles represent the positive and non-negative region respectively. In
this figure, the ground-truth’s was originally assigned to (c) conv6 2. We project its non-negative region to different levels of
feature map with reduced sizes. The amount of reduction is based on the distance to (c) conv6 2.

rectangle is a positive anchor with IoU > 0.5 and red
dashed rectangle represents a negative anchor with IoU < 0.3.
The white dashed anchor would be ignored as its IoU is in
between. Unlike anchor-based approaches relying on manually
set up overlap thresholds, in our anchor-free design, center
points are labeled solely based on the location and the size of
ground truth boxes. The whole process is demonstrated in Fig.
3b. The blue dotted grid represents center points. Any center
points falling outside of the red rectangle, inside of the green
rectangle and in the gap between the two will be assigned as
negative, positive and ignored respectively.
More formally, consider an object b = (cx , cy , w, h), where
(cx , cy ) is the center position of the bounding box; w, h
are the width and height respectively. Suppose this object
was assigned to an arbitrary feature map Kl with size m
and stride sl during training, we have m2 (we assume the
image is a square for simplicity) center points pij from set
Pb = {xi , yj }m
i,j=1 where xi = sl × i and yj = sl × j.
We define an positive region blp = (cx , cy , wpl , hlp ) and nonnegative region bln = (cx , cy , wnl , hln ). We mark center points
as positive if pij ∈ blp , negative if pij ∈
/ bln and ignored if
l
l
pij ∈
/ bp ∧ pij ∈ bn . The size of the positive region and nonnegative region is controlled by scale factors εp and εn in
proportion to the ground truth, i.e. wpl = εp w, hlp = εp h, wnl =
εn w, hln = εn h. We use εp = 0.75 and εn = 1.25 in this
paper.
D. Cosine Ground-truth Projection
It has been shown that distributing objects of different
sizes to different scales can greatly improve the detector
performance. In this way, objects will be detected at the best
granularity with respect to their size. On the other hand,
numerically, bounding box regression would also benefit from
this technique as the loss could be better constrained. Almost
all current state-of-the-art object detectors [18], [22], [25],
[29], [30] employ this strategy. We also adopt this multi-scale
strategy in our design.
However, simply assigning positive and non-negative region
to a single scale will resulting “unnecessary” negative keypoints. By unnecessarily negative we mean that in other scales,
some key-points near to the center of an object may also
contain some context information to cover the whole object.

This can be well explained by the enlarged receptive field
empowered by the downstream pathway and the CEM. One
direct result of the unnecessarily negative key-points is the
drop in recall because all these key-points are labeled as
negative during training.
To solve this issue, we define a cosine Ground-truth Projection to maximize recall and speed up the training process.
Figure 4 illustrates the projection of the non-negative region
across different feature maps when conv6 2 is the best feature
scale for the ground truth. The projection sizes of the nonnegative region in neighboring feature maps are penalized
with a cosine function, based on how far away they are from
the best feature map i, i ∈ [0, k − 1]. Suppose we have k
feature maps, let d = |i − l| be the distance between current
feature map l and the best feature map i. We can calculate the
penalizing factor ϕl on feature map l as follows:
ϕl = max(cos(

λdπ
), 0),
2k

(2)

where λ decides to what extent the projection is penalized.
We use λ = 2.5 in this paper. Our new non-negative region
bln can now be defined as:
bln = (cx , cy , ϕl wnl , ϕl hln ).

(3)

By using this cosine function we penalize the non-negative
region less on neighboring feature maps than on distanced
feature map as shown in Figure 4. As a result, we are able to
receive more responses from neighboring feature maps which
further improves the recall performance of our model.
E. Box Regression
Unlike anchor-based methods which predict the offset by
using reference anchor boxes, the output of our bounding box
regression is the offset of the center point and size encoded
by the stride of the feature map. In particular, given an object
b = (x1 , y1 , x2 , y2 ) with category Cb , the center position of the
x2 − x1 y2 − y1
ground truth (cbx , cby ) can be calculated as (
,
),
2
2
b
b
with w = x2 −x1 ; h = y2 −y1 being the width and height of
l
the box. The offset vector vb,p
= [∆clx , ∆cly , ∆wl , ∆hl ] for
ij

center point pij = (cpx , cpy ) at pixel location (i, j) with stride
sl can be defined as:
(cb − cpx )
wb
∆clx = x
, ∆wl = log( )
sl
sl
(4)
b
p
(cy − cy )
hb
l
l
∆cy =
, ∆h = log( ).
sl
sl
To remove overlapped bounding boxes, we apply IoU-based
Non Maximum Suppression (NMS) with a threshold of 0.1.
Similar to Faster R-CNN [30], our localization loss for
bounding box regression is Smooth L1 loss [12]:
Lloc =

N
β X
SmoothL1(vk , vbk ),
N

(5)

k

where vk , vbk and N denote the predicted bounding boxes,
ground truth bounding boxes and the number of positive labels
respectively. In this paper, we have β = 0.45.
F. Classification Loss
Different from the situation we have in natural image
modalities where objects are often dense (in terms of averaged
number of objects in one image) and of regular sizes, in
colonoscopy, polyps are often very sparse and small. This
fact determines that we are facing an extremely small positive/negative sample ratio. Thus, we feel that Focal Loss fits
better in our case compared with the Online Hard Negative
Mining (OHEM) mechanism. However, we only apply Focal
Loss [24] to negative samples while adopting cross entropy
with a penalty term for positive samples. We assume center
points closer to the ground truth centroid have a more precise
view of an object and thus contribute more to the loss.
In particular, the penalty weight of a certain positive center
point is determined by its Euclidean distance to the ground
truth centroid and the size of the object. We use an unnormalized 2-D Gaussian to generate the penalty weight. Formally,
given an object b = (cbx , cby , wb , hb ) and a point pij = (cpx , cpy )
at pixel location (i, j) within positive region, we can generate
its weight ψpij by:
(cbx − cpx )2 + (cby − cpy )2 
.
(6)
2α(max(wb , hb ))2
We use α = 1 in this paper. In sum, we will have the following
loss defined for the classification end:
ψpij = exp −

LF (pt ) = −αt (1 − pt )γ log(pt )
Lcls = 1/Npos

Nneg

Npos

X

X

j

LF (ptj ) + 1/Npos

(7)

ψi LCE (pi ), (8)

i

where pt = (p)y (1 − p)(1−y) , y ∈ {0, 1} is the ground truth.
Finally we combined regression loss and classification loss to
formulate our multitask loss L = Lloc + Lcls .
IV. E XPERIMENTS
We conduct our experiments mainly on GIANA [5], CVCCLINIC [4] and ETIS-LARIB [31] dataset. We use GIANA as
the training set, CVC-CLINIC and ETIS-LARIB as the testing
set.

A. Data Preparation and Augmentation
GIANA [5], a database from MICCAI2017 endoscopic subchallenge. The dataset contains four tasks, including Polyp
detection, Polyp segmentation, Small Bowel Lesion Detection
and Small Bowel Lesion Localization. For the polyp detection
task, it contains 18 short videos for training and 20 short
videos for testing. For the polyp segmentation task contains,
it provides 300 images for training and 612 for testing and
additionally more than 150 high definition images. However,
the 612 testing image for the polyp segmentation task is
identical to CVC-CLINIC.
To build our training set, we combined the datasets designed
for Polyp detection and Polyp segmentation tasks from GIANA. Image frames are extracted from the 18 short videos.
Segmentation annotations are converted to bounding boxes. As
for the data augmentation purpose, we apply random rotation,
zoom crop/expand, horizontal/vertical flip and distortions by
using Augmentor [6]. In the end, we obtain a training set of
25K images.
CVC-CLINIC [4] contains 612 still frames from 29 endoscopic videos. Each image comes with manually labeled
pixel-level ground truth by Computer Vision Center (CVC),
Barcelona, Span. All these 612 images are used as our testing
set.
ETIS-LARIB [31] contains 192 high resolution images
with the resolution of 1225 × 996. Annotations are also
provided at the pixel level. We convert these pixel-level
annotations to bounding boxes for our detection task. We also
evaluate our model on this dataset.
B. Training
Our backbone network is initialized by the pre-trained
VGG16 on ImageNet. All additional convolution layers added
on top of the backbone network are initialized by the Xavier
method. We train our model on NVIDIA V100 with a batch
size of 64. We use SGD with 0.9 momentum, 0.0005 weight
decay and initial learning rate of 0.001. During the training
process, we apply cosine annealing [15] for learning rate
decay with an interval of 20 epochs. Following SSD, we also
apply the online data augmentation photometric distortions and
random sampling during training.
C. Evaluation metrics
We follow the protocol of MICCAI2015 [5] challenge
by using the precision, recall, F1, F2 score as the major
evaluation metrics. We define the following terms to calculate
the performance:
True Positive (TP): When the centroid of the predicted
bounding box falls in the polyp ground truth, it will count
as a True Positive detection.
False Positive (FP): When the centroid of the predicted
bounding box falls outside of polyp ground truth, it will be
viewed as False Positive.
False Negative (FN): When a polyp ground truth is not
detected by our detector, it will count as a False Negative.

Experiment
1
2
3
4
5
6

FPN

CEM

OHEM

X
X
X
X
X

X
X
X
X

X

Focal Loss
X
X

Cosine Projection
X
X
X

X
X
X

X
X

Gaussian Penalty
X
X
X
X
X

Precision
97.27
97.31
95.20
98.56
98.42
99.36

Recall
93.65
95.51
92.11
95.36
96.28
96.44

F1-score
95.43
96.33
93.63
96.93
97.34
97.88

F2-score
94.35
95.84
92.71
95.98
96.70
97.01

TABLE I: Ablation study of each technical components. All the models use VGG16 as the backbone.
Backbone
ResNet-50
ResNet-101
VGG16

Precision
99.04
98.40
99.36

Recall
95.51
95.36
96.44

F1-score
97.24
96.86
97.88

F2-score
96.20
95.95
97.01

TABLE II: Effectiveness of different backbones. For all these
experiments, all technical components are added: FPN, CEM,
Cosine projection and Gaussian penalty.
1.00

precision

0.98
0.96
0.94
0.92
0.90
0.90

resnet-50
resnet-101
SSD_baseline
Ours:VGG16
Ours:VGG16+FPN
Ours:VGG16+FPN+CEM
0.92

0.94
0.96
recall

0.98

1.00

Fig. 5: Precision Recall Curve for different networks.

Note that, if multiple predicted bounding boxes fall within
one polyp ground truth, only one TP will be counted. In sum,
precision (pre), recall (rec), F1 and F2 scores are formulated
as:
TP
TP
pre =
,
rec =
TP + FP
TP + FN
(9)
2 × pre × rec
5 × pre × rec
F1 =
, F2 =
pre + rec
4 × pre + rec
D. Ablation Study
We also conduct a full ablation study to isolate the effects
of each technical component. All these models use VGG16 as
the backbone and are evaluated with the CVC-Clinic dataset
and results are summarized in Table I.
FPN improve Recall significantly. In Experiment 1 (Table I), the downstream pathway is removed as well as the
CEM. Therefore the network is similar to SSD. By comparing
Experiment 1&2, we find the recall rate is improved significantly. We attribute this to the enlarged effective receptive field
from downstream features that carry more context information.
This observation is further supported by the experiment on the
Context Enhancement Module.

Context Enhancement Module plays a critical role in
improve the model. By comparing Experiment 2&6 in Table
I, the overall performance drops significantly, 2.1% for recall
and 0.9% for precision, when CEM is removed. This is
consistent with the effects of the Corner Pooling in CornerNet
[18] and in turn, confirms the importance of enriching context
in anchor-free detectors.
Focal Loss works better than OHEM. As we can observe
from Table I that (Experiment 3&6), Focal Loss brings in
4.1%, 4.3% increase in precision and recall over OHEM.
Moreover, in practice, training would be much faster and more
stable with Focal Loss than with OHEM.
Cosine projection results in performance boost. In Experiment 4, we remove the cosine projection, then a ground truth
would only be assigned with one feature scale. Comparing
Experiment 4&6 in Table I, we can observe that the recall
rate is increased by a considerable margin.
Gaussian penalty improves precision. In order to investigate the effectiveness of the Gaussian penalty, we train
one network without it (Experiment 5). As we can see by
comparing Experiment 5&6, the Gaussian penalty results in
0.94%, 0.18% increase in precision and recall respectively.
We also explored the effect of different backbones in our
model (Table II), finding that VGG seems to work better
than ResNets. In the meantime, to give a better view of the
performance, we show the ROC curve with respect to precision
and recall in Fig. 5.
E. Overall Performance
We compared our proposed method with other models
reported in the MICCAI2015 challenge on polyp detection
[5] and recent work [26], [27], [32]. We run our test on CVCClinic training dataset and ETIS-LARIB dataset, with an input
size of 320. We set the IoU threshold to 0.1 for the nonmaximum suppression. All results are summarized in Table
III.
We refer to our model as AFP-Net (Experiment 6 in Table
I). Our proposed method outperforms all previous approaches
in terms of F1 and F2 scores on both testing datasets. In
the meantime, we also compared our approach with another
anchor-free design (CenterNet), showing the superior performance of our design. Note that our anchor-free detector even
outperforms its anchor-based baseline model SSD-baseline
(FPN + CEM + SSD anchors) where only the anchor part
is different.
We test all models on a NVIDIA RTX-2080TI with an input
size of 320 to investigate the inference speed (FPS, frame

Method
Y-Net [27]
RYCO [43]
ASU [38]
CVC-CLINIC [4]
OUS [5]
RCNN-Mask [35]
FRCNNPL [32]
AFP-Net (ours)
Mask-RCNN [2]
Faster-RCNN [26]
CenterNet-104
SSD-baseline**
AFP-Net (ours)

Testing Dataset
ASU-MAYO*
ASU-MAYO*
CVC-Clinic-test
CVC-Clinic-test
ETIS-LARIB
ETIS-LARIB
ETIS-LARIB
ETIS-LARIB
CVC-Clinic-train
CVC-Clinic-train
CVC-Clinic-train
CVC-Clinic-train
CVC-Clinic-train

TP
3582
3087
N/A
N/A
131
167
167
168
N/A
523
603
618
623

FP
513
398
N/A
N/A
57
62
26
21
N/A
81
30
8
4

FN
662
1226
N/A
N/A
77
41
41
40
N/A
8
43
28
23

Precision
87.4
88.6
97
83.5
69.7
72.93
86.5
88.89
83.49
86.6
95.27
98.72
99.36

Recall
84.4
71.6
85.2
83.1
63.0
80.29
80.3
80.77
92.95
98.5
93.35
95.67
96.44

F1-score
85.9
79.2
90.8
83.3
66.1
76.43
83.3
84.63
87.96
92.2
94.30
97.17
97.88

F2-score
85.0
74.4
87.4
83.2
64.2
78.70
81.5
82.27
90.89
95.9
93.73
96.26
97.01

Inference time
N/A
N/A
N/A
N/A
N/A
N/A
5.0 FPS†
52.6 FPS
N/A
N/A
7.8 FPS
37.0 FPS
52.6 FPS

TABLE III: Results of proposed method compare to others. * dataset no longer available. ** baseline SSD (FPN + CEM +
SSD Anchors) with input size of 320. † runs with a NVIDIA GTX TITAN X.

(a)

(b)

(c)

(d)

Fig. 6: Examples of False Negative (a & b) and False Positive (c & d). The first row shows the raw input images while
the second row presents the corresponding detection results. The green rectangles are our predicted bounding boxes. The red
rectangles are the ground truth boxes.

per second) of our models. Among all anchor-based models,
the “SSD-baseline” (differ with AFP-Net only in the anchor
design) represents the fairest and direct reference. As shown
in Table III, our model gives a speed boost around 30%. This
speed boost is consistent when comparing with other anchorbased designs such as FRCNNPL [32]. However, we must
note that in FRCNNPL, the inference time is evaluated with
a NVIDIA GTX TITAN X which is slightly slower than our
GPU. Nevertheless, we are still confident to claim that our
model runs faster, given the large gap in inference time (52.6
FPS vs. 5 FPS). On the other hand, to compare with other
anchor-free designs, we retrained a CenterNet. As shown in
Table III, the speed advantage of our model still holds.
F. Visualization
We visualize some of the hard cases in Fig. 6 where our
model can make a mistake. Our predicted boxes are marked
as green rectangles while the ground truth for each image is
marked as red rectangles. As we can see the missed polyps
in Figure 6a and 6b are very challenging cases because they

share similar texture and shapes with normal mucosae. This is
partially due to the view angle during image capturing. When
the light hits on top of a polyp directly, the polyp may blend
into the background and becomes difficult to detect. Figure
6c and 6d show some samples of false positive detection.
Normal mucosae with some fold structures are very hard to be
distinguished from polyps, especially the early stage of polyps,
as they can share the same texture as shown in Figure 6d.
V. C ONCLUSION AND F UTURE WORK
In this paper, we proposed a novel anchor-free polyp detector. It is faster than the anchor-based design while achieving
state-of-the-art performance. In addition to the improved performance, we also remove the hassle of manually fine-tuning
anchor related hyper-parameters.
Enriching context information is critical for anchor-free
detectors. Feature Pyramid, Context Enhancement Module all
contribute in this way. At the Loss end, Focal Loss, distance
based Gaussian Penalty and our proposed cosine ground truth
all play important roles in improving the performance. With all

these technical components, the potential recall drop caused
by removing anchors are well compensated and we achieved
the state-of-the-art performance.
We believe our cosine ground truth projection and Gaussian
penalty will provide a vital building block for future anchorfree design. In our future work, we intend to further improve
the classification strategies for small flat polyps that are very
hard to be distinguished from normal mucosae.
R EFERENCES
[1] M. F. Alcantara, Y. Cao, C. Liu, B. Liu, M. Brunette, N. Zhang, T. Sun,
P. Zhang, Q. Chen, Y. Li, C. M. Albarracin, J. Peinado, E. S. Garavito,
L. L. Garcia, and W. H. Curioso. Improving tuberculosis diagnostics
using deep learning and mobile health technologies among resource-poor
communities in per. Smart Health, 1-2(Supplement C):66 – 76, 2017.
Connected Health: Applications, Systems and Engineering Technologies
(CHASE 2016).
[2] H. Ali Qadir, Y. Shin, J. Solhusvik, J. Bergsland, L. Aabakken, and
I. Balasingham. Polyp detection and segmentation using mask r-cnn:
Does a deeper feature extractor cnn always perform better? pages 1–6,
05 2019.
[3] S. Ameling, S. Wirth, D. Paulus, G. Lacey, and F. Vilario. Texture-based
polyp detection in colonoscopy. pages 346–350, 01 2009.
[4] J. Bernal, F. J. Snchez, G. Fernndez-Esparrach, D. Gil, C. Rodrguez,
and F. Vilario. Wm-dova maps for accurate polyp highlighting in
colonoscopy: Validation vs. saliency maps from physicians. Computerized Medical Imaging and Graphics, 43:99 – 111, 2015.
[5] J. Bernal, N. Tajbakhsh, F. Javier Sanchez, B. J. Matuszewski,
H. Chen, L. Yu, Q. Angermann, O. Romain, B. Rustad, I. Balasingham, K. Pogorelov, S. Choi, Q. Debard, L. Maier-Hein, S. Speidel,
D. Stoyanov, P. Brandao, H. Crdova, C. Snchez-Montes, and A. Histace. Comparative validation of polyp detection methods in video
colonoscopy: Results from the miccai 2015 endoscopic vision challenge.
IEEE Transactions on Medical Imaging, PP:1–1, 02 2017.
[6] M. D. Bloice, P. M. Roth, and A. Holzinger. Biomedical image
augmentation using Augmentor. Bioinformatics, 04 2019.
[7] F. Bray, J. Ferlay, I. Soerjomataram, R. L. Siegel, L. A. Torre, and
A. Jemal. Global cancer statistics 2018: Globocan estimates of incidence
and mortality worldwide for 36 cancers in 185 countries. CA: A Cancer
Journal for Clinicians, 68(6):394–424, 2018.
[8] Y. Cao, C. Liu, B. Liu, M. J. Brunette, N. Zhang, T. Sun, P. Zhang,
J. Peinado, E. S. Garavito, L. L. Garcia, and W. H. Curioso. Improving
tuberculosis diagnostics using deep learning and mobile health technologies among resource-poor and marginalized communities. In 2016
IEEE First International Conference on Connected Health: Applications,
Systems and Engineering Technologies (CHASE), pages 274–281, June
2016.
[9] K. Duan, S. Bai, L. Xie, H. Qi, Q. Huang, and Q. Tian. Centernet:
Keypoint triplets for object detection. CoRR, abs/1904.08189, 2019.
[10] C. Eggert, S. Brehm, A. Winschel, D. Zecha, and R. Lienhart. A closer
look: Small object detection in faster r-cnn. In Multimedia and Expo
(ICME), 2017 IEEE International Conference on, pages 421–426. IEEE,
2017.
[11] Y. Gao, N. Zhang, H. Wang, X. Ding, X. Ye, G. Chen, and Y. Cao. ihear
food: Eating detection using commodity bluetooth headsets. In 2016
IEEE First International Conference on Connected Health: Applications,
Systems and Engineering Technologies (CHASE), pages 163–172, June
2016.
[12] R. B. Girshick. Fast R-CNN. CoRR, abs/1504.08083, 2015.
[13] K. He, G. Gkioxari, P. Dollár, and R. Girshick. Mask r-cnn. In Computer
Vision (ICCV), 2017 IEEE International Conference on, pages 2980–
2988. IEEE, 2017.
[14] K. He, X. Zhang, S. Ren, and J. Sun. Deep residual learning for image
recognition. In Proceedings of the IEEE conference on computer vision
and pattern recognition, pages 770–778, 2016.
[15] B. Y. Hsueh, W. Li, and I. Wu. Stochastic gradient descent with
hyperbolic-tangent decay. CoRR, abs/1806.01593, 2018.
[16] S. Hwang, J. Oh, W. Tavanapong, J. Wong, and P. C. de Groen. Polyp
detection in colonoscopy video using elliptical shape feature. In 2007
IEEE International Conference on Image Processing, volume 2, pages
II – 465–II – 468, Sep. 2007.
[17] T. Kong, F. Sun, H. Liu, Y. Jiang, and J. Shi. Foveabox: Beyond anchorbased object detector. arXiv preprint arXiv:1904.03797, 2019.

[18] H. Law and J. Deng. Cornernet: Detecting objects as paired keypoints.
CoRR, abs/1808.01244, 2018.
[19] A. Leufkens, M. V. Oijen, F. Vleggaar, and P. Siersema. Factors
influencing the miss rate of polyps in a back-to-back colonoscopy study.
Endoscopy, 44(05):470?475, 2012.
[20] J. Li, Y. Wang, C. Wang, Y. Tai, J. Qian, J. Yang, C. Wang, J. Li, and
F. Huang. DSFD: dual shot face detector. CoRR, abs/1810.10220, 2018.
[21] P. Li, Y. Luo, N. Zhang, and Y. Cao. Heterospark: A heterogeneous
cpu/gpu spark platform for machine learning algorithms. In 2015
IEEE International Conference on Networking, Architecture and Storage
(NAS), pages 347–348, Aug 2015.
[22] T. Lin, P. Dollár, R. B. Girshick, K. He, B. Hariharan, and S. J. Belongie.
Feature pyramid networks for object detection. CoRR, abs/1612.03144,
2016.
[23] T.-Y. Lin, P. Dollár, R. Girshick, K. He, B. Hariharan, and S. Belongie.
Feature pyramid networks for object detection. In CVPR, volume 1,
page 4, 2017.
[24] T.-Y. Lin, P. Goyal, R. Girshick, K. He, and P. Dollár. Focal loss for
dense object detection. arXiv preprint arXiv:1708.02002, 2017.
[25] W. Liu, D. Anguelov, D. Erhan, C. Szegedy, S. E. Reed, C. Fu, and A. C.
Berg. SSD: single shot multibox detector. CoRR, abs/1512.02325, 2015.
[26] X. Mo, K. Tao, Q. Wang, and G. Wang. An Efficient Approach for
Polyps Detection in Endoscopic Videos Based on Faster R-CNN. arXiv
e-prints, page arXiv:1809.01263, Sep 2018.
[27] A. K. Mohammed, S. Yildirim, I. Farup, M. Pedersen, and Ø. Hovde.
Y-net: A deep convolutional neural network for polyp detection. CoRR,
abs/1806.01907, 2018.
[28] M. Najibi, P. Samangouei, R. Chellappa, and L. S. Davis. SSH: single
stage headless face detector. CoRR, abs/1708.03979, 2017.
[29] J. Redmon, S. K. Divvala, R. B. Girshick, and A. Farhadi. You only
look once: Unified, real-time object detection. CoRR, abs/1506.02640,
2015.
[30] S. Ren, K. He, R. B. Girshick, and J. Sun. Faster R-CNN: towards
real-time object detection with region proposal networks. CoRR,
abs/1506.01497, 2015.
[31] J. S. Silva, A. Histace, O. Romain, X. Dray, and B. Granado. Toward
embedded detection of polyps in wce images for early diagnosis of
colorectal cancer. International journal of computer assisted radiology
and surgery, 9, 09 2013.
[32] Y. Shin, H. Ali Qadir, L. Aabakken, J. Bergsland, and I. Balasingham.
Automatic colon polyp detection using region based deep cnn and post
learning approaches. IEEE Access, PP:1–1, 07 2018.
[33] R. L. Siegel, K. D. Miller, S. A. Fedewa, D. J. Ahnen, R. G. S. Meester,
A. Barzi, and A. Jemal. Colorectal cancer statistics, 2017. CA: A Cancer
Journal for Clinicians, 67(3):177–193, 2017.
[34] K. Simonyan and A. Zisserman. Very deep convolutional networks for
large-scale image recognition. arXiv 1409.1556, 09 2014.
[35] S. Sornapudi, F. Meng, and S. Yi. Region-based automated localization of colonoscopy and wireless capsule endoscopy polyps. Applied
Sciences, 9, 06 2019.
[36] X. Sun, N. Zhang, Q. Chen, Y. Cao, and B. Liu. People re-identification
by multi-branch cnn with multi-scale features. In 2019 26th IEEE
International Conference on Image Processing (ICIP). IEEE, 2019.
[37] C. Szegedy, Wei Liu, Yangqing Jia, P. Sermanet, S. Reed, D. Anguelov,
D. Erhan, V. Vanhoucke, and A. Rabinovich. Going deeper with
convolutions. In 2015 IEEE Conference on Computer Vision and Pattern
Recognition (CVPR), pages 1–9, June 2015.
[38] N. Tajbakhsh, S. Gurudu, and J. Liang. Automated polyp detection
in colonoscopy videos using shape and context information. IEEE
transactions on medical imaging, 35, 10 2015.
[39] Z. Tian, C. Shen, H. Chen, and T. He. Fcos: Fully convolutional onestage object detection. arXiv preprint arXiv:1904.01355, 2019.
[40] J. Wang, K. Chen, S. Yang, C. C. Loy, and D. Lin. Region proposal by
guided anchoring. arXiv preprint arXiv:1901.03278, 2019.
[41] N. Zhang, Y. Cao, B. Liu, and Y. Luo. Improved multimodal representation learning with skip connections. In Proceedings of the 2017 ACM
on Multimedia Conference, MM ’17, pages 654–662, New York, NY,
USA, 2017. ACM.
[42] N. Zhang, D. Wang, X. Sun, P. Zhang, C. Zhang, Y. Cao, and B. Liu.
3d anchor-free lesion detector on computed tomography scans, 2019.
[43] R. Zhang, Y. Zheng, C. C. Poon, D. Shen, and J. Y. Lau. Polyp
detection during colonoscopy using a regression-based convolutional
neural network with a tracker. Pattern Recognition, 83:209 – 219, 2018.
[44] X. Zhou, D. Wang, and P. Krähenbühl. Objects as points. CoRR,
abs/1904.07850, 2019.

