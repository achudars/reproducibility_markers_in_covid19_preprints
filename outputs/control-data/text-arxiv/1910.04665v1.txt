arXiv:1910.04665v1 [stat.ML] 10 Oct 2019

Learning from Multiple Corrupted Sources,
with Application to
Learning from Label Proportions
Clayton Scott and Jianxin Zhang
University of Michigan
Electrical Engineering and Computer Science
October 11, 2019
Abstract
We study binary classification in the setting where the learner is presented with multiple corrupted
training samples, with possibly different sample sizes and degrees of corruption, and introduce an approach based on minimizing a weighted combination of corruption-corrected empirical risks. We establish
a generalization error bound, and further show that the bound is optimized when the weights are certain
interpretable and intuitive functions of the sample sizes and degrees of corruptions. We then apply this
setting to the problem of learning with label proportions (LLP), and propose an algorithm that enjoys
the most general statistical performance guarantees known for LLP. Experiments demonstrate the utility
of our theory.

1

INTRODUCTION

We study the problem of binary classification in the setting where the learner does not have access to a
conventional training data set with correctly labeled instances. Instead, the learner has access to several
data sets for which the true labels have been randomly corrupted, with each data set having possibly different
sample size and degree of corruption. Previous work has considered learning from a single corrupted data
set, but the problem considered here raises the natural question of how best to aggregate and weight the
information from these multiple corrupted data sets according to the sample size and degree of corruption.
We extend the method of corruption corrected losses (Natarajan et al., 2018) to this setting and establish a
generalization error bound for kernel-based predictors. By optimizing this bound, we obtain a precise and
interpretable scheme for aggregating the various corrupted sources according to the degree of corruption.
We then apply our framework to the problem of learning from label proportions (LLP), which is another
weak supervision setting for binary classification. In this problem, training data come in the form of bags.
Each bag contains unlabeled feature vectors (patterns) and is annotated with the proportion of patterns
arising from class 1. We argue that this problem can be reduced to the first problem studied, and apply our
results to obtain the most general theoretical analysis of this problem to date.

1.1

Related Work and Contributions

Our work is in the setting of classification with label-dependent label noise. Prior work has focused on a
single noisy dataset. Blanchard et al. (2016) introduce a way to estimate the label noise proportions, while
Natarajan et al. (2018) introduce a loss-correction framework when the noise proportions are known (or can
be estimated). There have also been recent efforts to develop noise-robust losses for training neural networks
(Patrini et al., 2017; Zhang and Sabuncu, 2018).

1

van Rooyen and Williamson (2018), who extend the method of Natarajan et al. (2018) to other weakly
supervised settings, considered the question of learning from multiple independent sources. Like us, they also
prove a generalization error bound for the weighted empirical risk based on multiple corruption-corrected
losses. However, their weights are fixed and depend only on the sample sizes, and they assume the corrected
losses are bounded, which precludes many common losses. Relative to this work, our contribution is to prove
a bound that holds for Lipschitz losses and arbitrary weights, with the optimized weights depending on both
the sample sizes and degrees of corruption in an intuitive way.
The problem of learning a classifier from multiple corrupted datasets arises in some applications such as
crowdsourcing and learning from multiple weak labeling functions (Ratner et al., 2016). In these applications,
the corrupted datasets often arise from different annotators assigning labels to the same unlabeled datasets.
This leads the datasets to be dependent, whereas our analysis assumes independence. However, if unlabeled
data are very abundant as envisioned by Ratner et al. (2016), independent unlabeled datasets could be
provided to the different annotators, thus fitting our assumption.
LLP is motivated by a number of real-world applications including particle physics (Komiske et al., 2018),
vote prediction (Sun et al., 2017), and image classification (Ding et al., 2017). Several algorithms have been
proposed in recent years, and we refer the reader to the recent summary in Dulac-Arnold et al. (2019).
Statistical analysis of LLP has been studied by a handful of papers. Quadrianto et al. (2009) reduce LLP
to estimation of a certain mean operator, and use Rademacher complexity to establish uniform convergence
guarantees for this estimate. Patrini et al. (2014) extend the work of Quadrianto et al. (2009) in several
ways, including a generalization error bound for LLP based on a notion of bag-Rademacher complexity,
and present two algorithms for approximately optimizing the associated bag-empirical risk. Neither of these
works establish consistency guarantees for a classification performance measure, and both focus on linear
methods. Yu et al. (2015) study the algorithm of minimizing the “empirical proportion risk,” which seeks a
classifier that best reproduces the bag label proportions. Bounds on the accuracy of the resulting classifier
are established, but only under two restrictive assumptions, namely, that the bags are all very pure (label
proportions close to 0 or 1) or that the feature space is finite. Relative to these works, our contributions
are to establish distribution-free generalization error analysis and universal consistency with respect to a
classification performance measure.
Our work may also be viewed as a novel setting for multi-source domain adaptation, where the target is
the clean distribution. Typically, domain adaptation methods are classified as supervised, semi-supervised,
or unsupervised, depending on whether the feature vectors from the target distribution are fully labeled,
partially labeled, or unlabeled (Pan and Yang, 2010). In our case, however, we do not even assume access
to unlabeled data from the target (clean) distribution.
Finally, we note that our framework yields a generalization error bound and consistency for the problem
of classification with feature dependent label noise (Menon et al., 2018; Cannings et al., 2018; Scott, 2019),
which has not previously been addressed. This follows by taking each corrupted data set to consist of a
single point. We elaborate below.

1.2

Notation and Terminology

A binary classification loss function, referred to simply as a loss in this work, is a function ℓ : R × {−1, 1} →
[0, ∞). We say a loss ℓ is L-Lipschitz if for every y ∈ {−1, 1}, and every t, t′ ∈ R, |ℓ(t, y) − ℓ(t′, y)| ≤ L|t − t′ |.
We say a loss is Lipschitz if it is L-Lipschitz for some L. We say a loss is a margin loss if it has the form
ℓ(t, y) = ϕ(yt) for some ϕ : R → [0, ∞).
A decision function is a measurable function f : X → R. The classifier induced by a decision function f
is the function x 7→ sign(f (x)). We will only consider classifiers induced by a decision function. In addition,
we will often refer to a decision function as a classifier, in which case we mean
P the induced classifier.
Finally, define the probability simplex ∆N := {w ∈ RN | wi ≥ 0 ∀i, and
i wi = 1}.

2

1.3

Outline

Sec. 2 presents our generalization error analysis for learning from multiple corrupted sources, and Sec. 3
applies it to LLP. Discrimination rules are discussed in Sec. 4, while Sec. 5 present experiments illustrating
our theory. Sec. 6 offers some concluding comments.

2

LEARNING FROM MULTIPLE CORRUPTED SOURCES

We first review the work of Natarajan et al. (2018) before presenting two settings for learning from multiple
corrupted sources.

2.1

Learning from A Single Corrupted Source

Let X be the feature space and P a probability distribution on X ×{−1, 1}, which shall denote a clean/uncorrupted
distribution. Let ρ = (ρ+ , ρ− ) ∈ [0, 1]2 be such that ρ− +ρ+ < 1, referred to as label noise proportions. Given
P and ρ, we define a new probability distribution P ρ on X × {−1, 1} as follows. To generate a realization
(X, Ỹ ) from P ρ , first draw a realization (X, Y ) from P , and then let the conditional distribution of Ỹ given
Y be
Ỹ | Y = 1 ∼ Ber(1 − ρ+ )

Ỹ | Y = −1 ∼ Ber(ρ− ).

In words, the noisy label Ỹ is obtained by randomly corrupting the true label Y in a manner depending on
the value of Y , but not on X, such that ρ+ is the probability that a +1 is flipped to a −1, and ρ− is the
probability that a −1 is flipped to a +1. Below we use p(ỹ|y; ρ) to denote this conditional distribution of Ỹ
given Y = y, with noise proportions ρ.
Let ℓ : R × {−1, 1} → [0, ∞) be a loss. Following Natarajan et al. (2018), given label noise proportions
ρ = (ρ+ , ρ− ), define the corrected loss ℓρ by
(1 − ρ− )ℓ(t, 1) − ρ+ ℓ(t, −1)
1 − ρ− − ρ+
+
(1 − ρ )ℓ(t, −1) − ρ− ℓ(t, 1)
.
ℓρ (t, −1) :=
1 − ρ− − ρ+
ℓρ (t, 1) :=

The corrected loss (also referred to as an unbiased loss) debiases the affects of noisy labels as captured by
the following result.
Lemma 1. With ℓ, ρ and ℓρ as in the preceding paragraph, for any y ∈ {−1, 1} and t ∈ R,
EỸ ∼p(ỹ|y;ρ) [ℓρ (t, Ỹ )] = ℓ(t, y).
Additionally, consider any distribution P on X × {−1, 1} with associated corrupted distribution P ρ . If f is
a decision function such that ℓ(f (·), y) is bounded for all y, then
E(X,Ỹ )∼P ρ [ℓρ (f (X), Ỹ )] = E(X,Y )∼P [ℓ(f (X), Y )].
The first part of the lemma was establish by Natarajan et al. (2018), and the second part follows as an
immediate corollary, where the boundedness assumption ensures the existence of the expectation. Given
noisy data (X1 , Ỹ1 ), . . . , (Xn , Ỹn ) ∼ P ρ , this result immediately suggests learning a classifier by empirical
risk minimization over the noisy data,
n

1X ρ
fb = arg min
ℓ (f (Xj ), Ỹj ),
n j=1
f ∈F
3

where F is some class of decision functions. Natarajan et al. (2018) show that the generalization error, i.e.,
the difference between the corrupted empirical risk and the uncorrupted true risk, is bounded uniformly over
F , in terms of the Rademacher complexity of F .
Below, we extend the above framework to the setting where there are multiple contaminated sources with
different degrees of corruption.

2.2

Learning from Multiple Corruptions of a Common Source

We now consider the problem of learning from multiple corrupted sources. In this section, we assume
observations are drawn from one of several distributions, all of which are corruptions of a common clean
distribution P . Our goal is to learn a decision function f to minimize the risk
EP (f ) := E(X,Y )∼P [ℓ(f (X), Y )].

(1)

−
The clean distribution is only observed through several corrupted samples. Thus, let ρi = (ρ+
i , ρi ), i =
ρN
ρ1
1, . . . , N be N pairs of label noise proportions, and let P , . . . , P be the associated corrupted distributions.
For each i, let Si = ((Xij , Ỹij ))1≤j≤ni be ni iid draws from P ρi , and assume the samples S1 , . . . , SN are
themselves independent.
To learn from this data, we propose to minimize a weighted sum of empirical risks


ni
N
X
X
1
wi 
ℓρi (f (Xij ), Ỹij )
n
i
i=1
j=1

where w ∈ ∆N is a tuning parameter.
Intuitively, samples Si with less corruption should receive larger weights. We confirm this intuition by
establishing a generalization error bound, and then showing that the bound is indeed optimized by assigning
larger weights to less corrupted samples.
To obtain an explicit bound, we specialize to kernel algorithms. Thus, let k be a symmetric, positive
definite (SPD) kernel, and let Bk (R) denote the ball of radius R > 0, centered at the origin, in the reproducing
kernel Hilbert space (RKHS) associated to the kernel. Assume the kernel is bounded by the constant K.
For example, in the case of the Gaussian kernel k(x, x′ ) = exp(−γkx − x′ k2 ), K = 1.
For all generalization error bounds in this paper, we assume that ℓ is a margin loss, that is, ℓ(t, y) = ϕ(yt)
for some ϕ : R → [0, ∞). This assumption could be dropped at the expense messier expressions.
Theorem 2. Let ℓ be an L-Lipschitz margin loss and k an SPD kernel bounded by K. Let P be a distribution
−
−
+
2
on X × {−1, 1}, and for each i, let ρi = (ρ+
i , ρi ) ∈ [0, 1] such that ρi + ρi < 1. For all R > ϕ(0)/KL,
1
N
w ∈ ∆ , and 0 < δ ≤ 4 , we have with probability at least 1 − δ with respect to the draws of the corrupted
samples S1 , . . . , SN ,
v


uN
n
N
uX w2  1 + |ρ+ − ρ− | 2  log(2/δ) 
X
X
1
ρ
i
i
i
i
ℓ (f (Xij ), Ỹij ) − EP (f ) ≤ 4KRLt
wi 
. (2)
sup
−
+
ni j=1
n
2
1
−
ρ
−
ρ
i
f ∈Bk (R) i=1
i
i
i=1
To interpret the bound, first consider the case where ni = n for all i, and wi = 1/N . The bound becomes
v
u
N 
− 2
log(2/δ)
4KRL u
1 X 1 + |ρ+
i − ρi |
t
√
−
+
N
2
1 − ρi − ρi
Nn
i=1

+
which tends to zero provided either of N or n tends to ∞ (but not necessarily both), and 1 − ρ−
i − ρi remains
bounded away from zero.

4

However, uniform weights do not optimize the bound. Returning to the setting where the ni are arbitrary,
introduce the notation
−
1
1 + |ρ+
i − ρi |
ci = √ ·
.
(3)
n i 1 − ρ−
i − ρ+

Define 1/c2i to be the “signal-to-noise” ratio (SNR) for the ith sample, where ni reflects the “signal” while
− 2
−
2
(1 + |ρ+
i − ρi |) /(1 − ρi − ρ+ ) captures the overall amount of noise. This notion of overall noise is smaller
+
−
whenever ρi and ρi are small and when the label noise is symmetric (Kamalaruban and Williamson, 2018).
It can easily be shown using Lagrange multiplier theory that the w minimizing
N
X

wi2 c2i

(4)

i=1

P −2
1
2
2
subject to w ∈ ∆N is wi = c−2
i /
j cj , and that the optimal value of (4) is N H(c1 , . . . , cN ), where H
denotes the harmonic mean. The harmonic mean is dominated by the smallest ci , with large ones having
considerably less impact. In contrast, if we selected P
uniform weights wi = 1/N , the harmonic mean is
replaced by the arithmetic mean, A(c21 , . . . , c2N ) = N1 i c2i , which is much more sensitive to large values
of ci (samples with very low SNR). As an illustration, suppose N = 10, ni = n = 100, and for i < N ,
−
+
−
ρ+
i = ρi = 0.01, while ρN = ρN = 0.49. Then the ratio of arithmetic mean to harmonic mean exceeds 100.
In summary, the optimal weight wi is proportional to the signal-to-noise ratio of the ith sample. Thus,
samples with larger sample size, less total label noise, and more balanced label noise, are preferred.
Additional remarks: (1) Theorem 2 and the other generalization error bounds below are all special
cases of a master theorem provided in the supplemental material. The proof of the master theorem is based
on an extension of Rademacher complexity analysis to a novel weighted Rademacher complexity. The factor
−
1+|ρ+
i −ρi |
L 1−ρ−
in Thm. 2 is the Lipschitz constant of ℓρi . In the event of a single sample with no noise, we
−ρ
i

+

recover known bounds (Mohri et al., 2012) up to minor differences.
(2) In the problem of binary classification with feature dependent label noise, there is a single dataset
where each label is corrupted with probability ρ+ (x) (if Y = 1) or ρ− (x) (if Y = −1), where x is the feature
±
vector. This problem can be viewed as the special case where ni = 1 and ρ±
i = ρ (xi ). Thus, Theorem 2
applies to this setting provided the corruption probability functions ρ± (x) are known which, unfortunately,
is rarely the case.
(3) For the generalization error bound to imply a consistent learning procedure, it must converge to zero.
We note one asymptotic setting where the bound does converge to zero for the optimized weights, but not
for uniform weights. This is the setting where N is fixed, and some but not all of the sample sizes n1 , . . . , nN
tend to ∞. To see that the optimized bound vanishes, just realize that the optimized weights lead to a
smaller bound than when the wi are uniform on the samples with diverging sizes.

2.3

Learning from Multiple Corrupted Sources with Varying Class Priors

We now assume each corrupted source is associated to its own clean distribution, where the different clean
distributions differ only in their class prior probabilities. In particular, let P1 , . . . , PN denote the N clean
distributions, and let πi = Pi (Y = 1). All Pi are assumed to have the same class-conditional distributions,
P+ and P− , which are two fixed distributions on X . This setting will be used to study LLP below.
In this setting it makes sense to look at a performance measure that depends only on the class-conditional
distributions P+ and P− . Thus, we will adopt as our performance measure the balanced error rate (BER),


1
E [ℓ(f (X), 1)] + E [ℓ(f (X), −1)]
E± (f ) :=
X∼P−
2 X∼P+
The BER may be related to a cost-sensitive risk as follows. Let α = (α+ , α− ) ∈ R2+ . Given a loss ℓ, define
the associated cost-sensitive loss
ℓα (t, y) := α+ 1{y=1} ℓ(t, 1) + α− 1{y=−1} ℓ(t, −1).
5

Given a distribution P on X × {−1, 1}, define the cost-sensitive risk with costs given by α,
EP,α (f ) := E(X,Y )∼P ℓα (f (X), Y ).
1
1
If π is the prior class probability of P , and α = ( 2π
, 2(1−π)
), then it can easily be shown that

EP,α (f ) = E± (f ).
We seek to learn a classifier minimizing E± (f ) given corrupted samples from each of P1 , . . . , PN . Thus,
ρ1
ρN
−
let ρi = (ρ+
i , ρi ), i = 1, . . . , N be N pairs of label noise proportions, and let P1 , . . . , PN be the associated
corrupted distributions. For each i, let Si = ((Xij , Ỹij ))1≤j≤ni be ni iid draws from Piρi , and assume
S1 , . . . , SN are themselves independent.
We again propose to minimize a weighted sum of empirical risks


ni
N
X
X
1
ℓραii (f (Xij ), Ỹij )
wi 
n
i
j=1
i=1
1
where αi = ( 2π1 i , 2(1−π
) and ℓραii denotes (ℓαi )ρi , which is not the same as (ℓρi )αi . Adopting the same kernel
i)
setting as above, we have the following.

Theorem 3. Let ℓ be an L-Lipschitz margin loss, and let k be an SPD kernel bounded by K. Let P+ and
P− be two probability distributions on X , and for i = 1, . . . , N , let Pi be the distribution on X × {−1, 1}
1
). For all
having P+ and P− as class-conditional distributions and πi as class prior. Set αi = ( 2π1 i , 2(1−π
i)
1
N
R > 2ϕ(0)/KL, w ∈ ∆ , and 0 < δ ≤ 4 , we have with probability at least 1 − δ with respect to the draw of
the corrupted samples S1 , . . . , SN ,
v


uN
n
N
uX w2  1 + |ρ+ − ρ− | 2
X
X
1
1
i
i
i
ℓραii (f (Xij ), Ỹij ) − E± (f ) ≤ C t
,
wi 
sup
−
+
2
n
n
min(π
,
1
−
ρ
−
ρ
i j=1
i
i 1 − πi )
f ∈Bk (R) i=1
i
i
i=1
where C = 2KRL

q

log(2/δ)
.
2

Similar remarks apply to this result as were made in the previous section. The optimized weights are
still proportional to an appropriately defined SNR, updated to include the class priors, where now there is
a preference for more balanced samples, i.e., πi ≈ 12 .

3

Learning from Label Proportions

In learning from label proportions, the learner is presented with several pairs (B1 , γ1 ), . . . , (BM , γM ). Each
Bi is a bag of mi unlabeled instances, and each γi ∈ [0, 1] is the proportion of instances from class 1 in the
bag. The goal is to learn an accurate classifier as measured by some performance measure. Our approach
is to frame LLP in the setting of Section 2.3, and so we adopt the BER as our performance measure. This
choice is already a departure from prior work on LLP, which adopts a risk as the performance measure. The
BER has the advantage of not being sensitive to changes in class prior at test time.
To reduce LLP to the setting of Section 2.3, we pair the bags, and view each pair of bags as a corrupted
sample. Thus, we re-index the bags and let (Bi− , γi− ) and (Bi+ , γi+ ) constitute the ith pair of bags, and
assume γi− < γi+ . Also assume the total number of bags is M = 2N , so that the number of pairs of bags
is N . We associate to every Xij in Bi− the noisy label Ỹij = −1, and to every Xij in Bi+ the noisy label
Ỹij = 1. Finally, let Si denote the set of all pairs (Xij , Ỹij ), j = 1, . . . , ni from the ith pair of bags.

6

3.1

Probabilistic model for paired bags

We propose a probabilistic model that connects LLP to the problem of learning from corrupted sources as
described in Section 2.3. Let P+ and P− be two probability distributions on X .
First, we define a joint distribution Qi on a realization (X, Ỹ ) from the ith pair of bags as follows: Assume
Ỹ ∼ Ber( 12 ), and that the conditional distribution of X given Ỹ is
X ∼ γi+ P+ + (1 − γi+ )P−

X∼

γi− P+

+ (1 −

given Ỹ = 1

γi− )P−

given Ỹ = −1.

The conditional distributions of X|Ỹ are consistent with γi+ and γi− being the label proportions for the two
bags, making this a reasonable model for LLP. The label proportions themselves are viewed as fixed and
nonrandom1 .
−
Next, we will construct a clean distribution Pi , and label noise proportions ρi = (ρ+
i , ρi ), such that
ρi
Qi = Pi . These label noise proportions are not to be confused with the label proportions γi+ , γi− that
annotate the bags, and in fact the former will be defined in terms of the latter. Let Pi be the joint distribution
of (X, Y ) whose class conditional distributions are P+ and P− , and whose prior class probability is
πi :=

γi+ + γi−
.
2

−
Also, define the label noise proportions ρi = (ρ+
i , ρi ) according to

ρ+
i :=

γi−
,
γi− + γi +

A simple calculation shows
+
1 − ρ−
i − ρi =

ρ−
i :=

1 − γi+
.
2 − γi− − γi+

γi+ − γi−
(γi+ + γi− )(2 − γi+ − γi− )

(5)

+
+
−
which ensures that ρ−
i + ρi < 1, because γi − γi > 0 by assumption.
ρi
We claim that Qi = Pi . First, consider the distribution of Ỹ under Piρi . We have
−
Pr(Ỹ = 1) = πi (1 − ρ+
i ) + (1 − πi )ρi =

γi− + γi+
2 − γi− − γi+
γ+
1 − γi+
· − i ++
·
,
2
2
γi + γi
2 − γi− − γi+

which equals 12 in agreement with Qi . Next, consider the conditional distribution of X given Ỹ under both Qi
and Piρi . To show that these agree, it suffices to show Pr(Y = 1 | Ỹ = 1) = γi+ and Pr(Y = 1 | Ỹ = −1) = γi− .
This follows from
(1 − ρ+
Pr(Ỹ = 1 | Y = 1) Pr(Y = 1)
i )
=
Pr(Y = 1 | Ỹ = 1) =
1
Pr(Ỹ = 1)
2

γi− +γi+
2

=

γi−

γi+
(γ − + γi+ ) = γi+ ,
+ γi+ i

and the other case is similar.

3.2

A generalization error bound for LLP

From the preceding discussion, we may view each pair of bags as a corrupted sample, and since each Pi has
the same class-conditional distributions, we are in the setting of Section 2.3 and may deduce the following
result. The result is actually obtained by applying the master theorem in the appendix, which allows us to
save a factor of 3 in the leading constant compared with applying Theorem 3 directly.
1 However, it is easy to extend our analysis to the setting where the bag proportions are also random, in which case the above
model is conditioned on the γi± . In this case, the joint distribution of bag proportions can be arbitrary as long as γi− < γi+
almost surely. The results are proved by first conditioning on, and the integrating out, the γi± .

7

Theorem 4. Let ℓ be an L-Lipschitz margin loss, and let k be a SPD kernel bounded by K. Let P+ and
P− be two probability distributions on X . Let S1 , . . . , SN be pairs of bags described by the construction and
probabilistic model above. For each i, let (a) γi− < γi+ be the label proportions for the ith pair of bags, (b)
πi =

γi+ +γi−
,
2

(c) Pi be the distribution on X × {−1, 1} with P+ and P− as class-conditional distributions and
1−γ +

γ−

1
1
i
i
), and (e) ρi = ( γ − +γ
). For all R > ϕ(0)/KL,
πi as the class prior (d) αi = ( γ + +γ
−,
+,
2−γ + −γ −
2−γ − −γ +
i

i

i

i

i

i

i

i

w ∈ ∆N , and 0 < δ ≤ 14 , we have with probability at least 1 − δ with respect to the draw of the corrupted
samples S1 , . . . , SN ,
v


uN


ni
N
uX
X
X
1
wi2
log(2/δ)
ρ
i
ℓαi (f (Xij ), Ỹij ) − E± (f ) ≤ 4KRLt
.
wi 
sup
ni j=1
2
n (γ + − γi− )2
f ∈Bk (R) i=1
i=1 i i

3.3

Optimal pairing of bags

The bound above is minimized by selecting weights
wi ∝ ni (γi+ − γi− )2 ,
which gives preference to pairs of bags where one bag is mostly +1’s (large γi+ ) and the other is mostly -1’s
(small γi− ). With these weights, the bound becomes
v
!−1
u N
u X
log(2/δ)
t
+
− 2
4KRL
ni (γi − γi )
.
2
i=1

We can also optimize the pairing of bags by further optimizing the bound. Consider the unpaired bags
(Bi , γi ), i = 1, . . . , 2N , and assume all unpaired bags have the same size2 . We would like to pair each bag
to a different bag, forming pairs (γi+ , γi− ), such that
N
X
i=1

(γi+ − γi− )2

is maximized. For each i < j, let uij be a binary variable, with uij = 1 indicating that the ith and jth bags
are paired. The optimal pairing of bags is given by the solution to the following integer program:
X
X
max
(γi − γj )2 uij
u

1≤i<2N i<j≤2N

s.t. uij ∈ {0, 1}, ∀i, j
X
X
uji = 1, ∀i
uij +
i<j

j<i

The equality constraint ensures that every bag is paired with precisely one other distinct bag. This problem
is known as the “maximum weighted (perfect) matching” problem, and in our experiments we solve it using
the algorithm of Edmonds (1965).

4

Discrimination Rules

The bounds above all show that a weighted empirical risk of the form
X wi X
b )=
E(f
(ℓαi )ρi (f (Xij ), Ỹij )
n
i
i
j
2 We

make this assumption because for our probabilistic model, bags in a pair have the same (expected) size.

8

is, with high probability, uniformly close to an error quantity E(f ) (= EP (f ) or E± (f ) depending on context)
over a ball in a RKHS. This suggests a discrimination rule based on regularized, weighted empirical risk
minimization (ERM):
b ) + λkf k2 ,
fb := arg min E(f
(6)
Hk
f ∈Hk

where λ ≥ 0 and Hk is the RKHS associated to k. In this section we discuss statistical and computational
aspects of this learning rule.

4.1

Consistency

An algorithm is consistent if the sequence of random variables E(fb) (where the randomness arises from the
training data) converges asymptotically to E ∗ := E(f ∗ ), where f ∗ is a global minimizer of E(f ). To prove
consistency using our generalization error bounds, two things must happen asymptotically: (1) Bk (R) can
approximate f ∗ to arbitrary accuracy as R → ∞, and (2) the generalization error bound tends to zero. (1)
is ensured by taking k to be a universal kernel on a compact domain (Steinwart and Christmann, 2008). (2)
Requires balancing the sample sizes with a shrinking value of λ, which implicitly determines R. These ideas
are captured in the following general result that covers all three settings discussed above. We say that the
−
+
−
problems in Secs. 2.2, 2.3, and 3 satisfy the bounded noise condition if 1−ρ+
i −ρi , (1−ρi −ρi ) min(πi , 1−πi ),
+
−
and γi − γi are bounded away from zero, respectively.
Theorem 5. Let X be compact and let k be a universal kernel on X . Let λ be such that λ → 0 and
λ(n1 + · · · + nN )/ log(n1 + · · · + nN ) → ∞ as n1 + · · · + nN → ∞. For each of the settings in Secs. 2.2, 2.3,
3, under the bounded noise condition, and with optimized weights,

in probability as n1 + · · · + nN → ∞.

E(fb) → E ∗

(7)

It is important to note that the condition n1 + · · · + nN → ∞ covers a wide range of asymptotic regimes.
It essentially requires that at least one of n1 , . . . , nN or N tend to infinity. In particular, consistency is
possible even though some sample sizes may remain bounded.
This consistency result is universal in the sense that it makes no assumptions on P− , P+ other than
compact support. In the case of LLP, the only prior work to consider consistency makes much stronger
distributional assumptions (Yu et al., 2015).

4.2

Calibrated Losses

The consistency discussion above applies to the loss function that is used in the algorithm. This loss is
typically chosen for computational properties such as convexity, whereas the true loss of interest may be the
0-1 loss. Fortunately, we can ensure consistency wrt the 0-1 loss simply by choosing ℓ to be classification
calibrated which, in the case of a margin loss ϕ, requires that it be differentiable at 0 and ϕ′ (0) < 0
(Bartlett et al., 2006). This decoupling of calibration and noise correction is one nice feature of the method
of Natarajan et al. (2018).

4.3

Convexity

We say that the loss ℓ is convex if, for each y, ℓ(t, y) is a convex function of t. Natarajan et al. (2018)
establish the following result, where ℓ′′ denotes the second derivative of ℓ with respect to its first variable.
Proposition 6. Let ℓ be a convex, twice differentiable loss satisfying
ℓ′′ (t, 1) = ℓ′′ (t, −1)
for all t ∈ R. Then for any ρ = (ρ+ , ρ− ) ∈ [0, 1]2 satisfying ρ+ + ρ− < 1, ℓρ is convex.
9

(8)

This result follows easily from the definition of the corrected loss. Examples of losses satisfying the second
order condition include the logistic, Huber, and squared error losses.
P i P ρi
This result immediately implies that the weighted average of losses in Section 2.2, i w
j ℓ (t, Ỹij ) is
ni
a convex function of t, provided ℓ satisfies (8). The result is less helpful in the case of Section 2.3, because
cost-sensitive losses ℓα do not generally satisfy (8). In the setting of LLP, however, the choices of ρi and αi
play together nicely and allow us to establish the following.
Proposition 7. Let ℓ be a convex, twice differentiable loss satisfying
ℓ′′ (t, 1) = ℓ′′ (t, −1)

(9)

− +
−
for all t ∈ R. For 1 ≤ i ≤ N , let γi+ , γi− , α+
i , αi , ρi and ρi be as in the statement of Theorem 4, and let
±
ni := |{j : Ỹij = ±1}|. Then
X wi X
J(t) :=
(ℓαi )ρi (t, Ỹij )
n
i
i
j

is a convex function of t provided
X
i

!#
!
"
1
wi
+
−
−
+ 1
≥ 0.
− γi + n i γi −
n
2
ni (γi+ − γi− ) i 2

(10)

If, in addition, ℓ′′ (t, y) > 0 for all t, y, then (10) is also necessary for convexity of J(t).
−
The condition in (10) is satisfied if either (a) for all i, γi− ≤ 12 and γi+ ≥ 21 , or (b) for all i, n+
i = ni . The
condition in (10) may still be satisfied even if neither (a) nor (b) are, and can be easily verified numerically
for any instance of the problem.

4.4

LLP Implementation

We employ the logistic loss and use a Gaussian kernel. To compute the minimizer of (6), we appeal
P to the representer theorem (Schölkopf et al., 2001) which implies that the solution has the form f (x) = i αi k(x, xi ).
In our LLP experiments, all (unpaired and therefore paired) bags have equal size. Prop. 7 thus implies
that the objective is convex in the αi , which are learned via gradient descent. We also perform the optimal
pairing of bags as described in Sec. 3.3, and use the weights wi ∝ (γi+ − γi− )2 as prescribed by our theory. It
is possible that parametrizing the weights in terms of (γi+ − γi− ), and tuning them by cross-validation, may
lead to improved performance. If a bag pair has a weight of zero, i.e., γi+ = γi− , we drop the pair from the
training data. Finally, we remark that the γi ’s are fixed population level parameters in our model, whereas
they are typically empirical quantities (computed from true but unobserved class labels) in practice. We
take the latter to be estimates of the former.

5

LLP EXPERIMENTS

To illustrate our theory, we compare our approach against InvCal (Rueping, 2010) and alternate-∝SVM
(Yu et al., 2013), which are the two most common reference methods in learning with label proportions.

5.1

Datasets

We employ datasets from the UCI repository (see table). For datasets with multiple classes, we convert them
to binary by choosing one class as positive and the others are merged to form the negative class.

10

5.2

Dataset

Size

Classes

Banknote
Cardiotocography
CNAE
Contraceptive
German bank
Sports article
Wireless Indoor

1372
2126
1080
1473
1000
1000
2000

2
3
9
3
2
2
4

Prior label distribution
(55.54%,
(22.15%,
(11.11%,
(42.70%,
(30.00%,
(63.50%,
(25.00%,

44.46%)
77.85%)
88.89%)
57.30%)
70.00%)
36.50%)
75.00%)

Experiment Setup

We first randomly split each dataset into training and test sets, using 80% for training. The training set is
then split into bags of fixed sizes. We consider the bag sizes of 2, 4, 8, 16, 32, 64, and select the parameters
of each model by 5-fold cross validation. As we assume instance-level labels are inaccessible during training,
the parameters of our method are selected by the corrected empirical risk, while the other two methods use
the empirical proportion risk. The above process is repeated for 5 times per dataset per bag size. The mean
accuracy and the mean balanced accuracy are reported with their standard deviations.
For InvCal, the parameters are tuned from Cp ∈ {0.1, 1, 10}, and ǫ ∈ {0, 0.01, 0.1}. For alter-∝SVM,
the parameters are tuned from C ∈ {0.1, 1, 10}, Cp ∈ {1, 10, 100}. Following (Yu et al., 2013), The alternate
∝SVM is randomly initialized 10 times and the result with the smallest objective values is picked. In our
approach, the parameters are tuned from learning rate ∈ {0.1, 0.01, 0.001}, decay ∈ {0.01, 0.001, 0.0001}, iterations ∈ {100, 800, 1600, 3200}, and regularization parameter ∈ {0.001, 0}. For all approaches, the Gaussian
kernel is used and the parameter γ is tuned from {0.001, 0.1, 1}

5.3

Results

Performance is measured by balanced accuracy (1 - BER) with 0/1 loss, which is shown in Table 1 in the
appendix. As a reference, the conventional accuracy is shown in Table 2. As shown by Table 1, corrected
loss outperforms the other two methods 16 times, while for InvCal the number is 13 and for ∝SVM 15. We
can conclude that our method is comparable to the other two methods for balanced accuracy.

6

DISCUSSION

We have presented one approach to learning from multiple corrupted sources, building on the method of
unbiased losses (Natarajan et al., 2018). At least two other approaches may be worth exploring. First,
Natarajan et al. (2018) present a second general approach, the method of calibrated surrogates. With this
method, it is no longer possible to decouple calibration and noise correction, and different techniques would
be needed. Second, one could use symmetric losses, which are immune to class-conditional label noise
(van Rooyen et al., 2015; Charoenphakdee et al., 2019).
We also point out that while our approach has focused on kernel methods for binary classification, it can
be generalized. For example, unbiased losses for multiclass have be developed in recent years (Patrini et al.,
2017; van Rooyen and Williamson, 2018). Furthermore, our analysis is based on Rademacher complexity
and should be extensible to other types of classifiers (Neyshabur et al., 2015).
References
P. Bartlett, M. Jordan, and J. McAuliffe. Convexity, classification, and risk bounds. J. American Statistical
Association, 101(473):138–156, 2006.
G. Blanchard, M. Flaska, G. Handy, S. Pozzi, and C. Scott. Classification with asymmetric label noise:
Consistency and maximal denoising. Electronic Journal of Statistics, 10:2780–2824, 2016.
Timothy I. Cannings, Yingying Fan, and Richard J. Samworth. Classification with imperfect training labels.
Technical Report arXiv:1805.11505, 2018.
11

Nontawat Charoenphakdee, Jongyeong Lee, and Masashi Sugiyama. On symmetric losses for learning from
corrupted labels. In Kamalika Chaudhuri and Ruslan Salakhutdinov, editors, Proceedings of the 36th
International Conference on Machine Learning, volume 97 of Proceedings of Machine Learning Research,
pages 961–970, 2019.
Yongke Ding, Yuanxiang Li, and Wenxian Yu. Learning from label proportions for sar image classification.
EURASIP Journal on Advances in Signal Processing, 2017.
Gabriel Dulac-Arnold, Neil Zeghidour, Marco Cuturi, Lucas Beyer, and Jean-Philippe Vert. Deep multi-class
learning from label proportions. Technical Report arXiv:1905.12909, 2019.
Jack Edmonds. Maximum matching and a polyhedron with 0, 1-vertices. Journal of Research of the National
Bureau of Standards B, 69:125–130, 1965.
Parameswaran Kamalaruban and Robert C. Williamson. Minimax lower bounds for cost sensitive classification. Technical Report arXiv:1805.07723, 2018.
Patrick Komiske, Eric Metodiev, Benjamin Nachman, and Matthew Schwartz. Learning to classify from
impure samples with high-dimensional data. Physical Review D, 98, 07 2018.
C. McDiarmid. On the method of bounded differences. Surveys in Combinatorics, 141:148–188, 1989.
R. Meir and T. Zhang. Generalization error bounds for bayesian mixture algorithms. Journal of Machine
Learning Research, 4:839–860, 2003.
Aditya Krishna Menon, Brendan van Rooyen, and Nagarajan Natarajan. Learning from binary labels with
instance-dependent noise. Machine Learning, 107:1561–1595, 2018.
M. Mohri, A. Rostamizadeh, and A. Talwalkar. Foundations of Machine Learning. MIT Press, 2012.
Nagarajan Natarajan, Inderjit S. Dhillon, Pradeep Ravikumar, and Ambuj Tewari. Cost-sensitive
learning with noisy labels.
Journal of Machine Learning Research, 18(155):1–33, 2018.
URL
http://jmlr.org/papers/v18/15-226.html.
Behnam Neyshabur, Ryota Tomioka, and Nathan Srebro. Norm-based capacity control in neural networks.
In Peter Grnwald, Elad Hazan, and Satyen Kale, editors, Proceedings of The 28th Conference on Learning
Theory, volume 40 of Proceedings of Machine Learning Research, pages 1376–1401, 2015.
S. J. Pan and Q. Yang. A survey on transfer learning. IEEE Transactions on Knowledge and Data Engineering, 22:1345–1359, 2010.
Giorgio Patrini, Richard Nock, Paul Rivera, and Tiberio Caetano. (Almost) No label no cry. In Z. Ghahramani, M. Welling, C. Cortes, N. D. Lawrence, and K. Q. Weinberger, editors, Advances in Neural Information Processing Systems 27, pages 190–198. 2014.
Giorgio Patrini, Alessandro Rozza, Aditya Krishna Menon, Richard Nock, and Lizhen Qu. Making deep
neural networks robust to label noise: A loss correction approach. In The IEEE Conference on Computer
Vision and Pattern Recognition (CVPR), July 2017.
Novi Quadrianto, Alex J. Smola, Tibério S. Caetano, and Quoc V. Le. Estimating labels from label proportions. Journal of Machine Learning Research, 10:2349–2374, 2009.
Alexander J Ratner, Christopher M De Sa, Sen Wu, Daniel Selsam, and Christopher Ré. Data programming:
Creating large training sets, quickly. In D. D. Lee, M. Sugiyama, U. V. Luxburg, I. Guyon, and R. Garnett,
editors, Advances in Neural Information Processing Systems 29, pages 3567–3575. 2016.
Stefan Rueping. SVM classifier estimation from group probabilities. In Proceedings of the 27th International
Conference on International Conference on Machine Learning, pages 911–918, 2010.
12

B. Schölkopf, R. Herbrich, and A. J. Smola. A generalized representer theorem. In Proc. Annu. Conf.
Comput. Learning Theory, pages 416–426, 2001.
Clayton Scott. A generalized Neyman-Pearson criterion for optimal domain adaptation. In Aurélien Garivier and Satyen Kale, editors, Proceedings of the 30th International Conference on Algorithmic Learning
Theory, volume 98 of Proceedings of Machine Learning Research, pages 738–761. PMLR, 2019.
I. Steinwart and A. Christmann. Support Vector Machines. Springer, 2008.
T. Sun, D. Sheldon, and B. OConnor. A probabilistic approach for learning with label proportions applied
to the us presidential election. In 2017 IEEE International Conference on Data Mining (ICDM), pages
445–454, 2017.
Brendan van Rooyen and Robert C. Williamson. A theory of learning with corrupted labels. Journal of
Machine Learning Research, 18(228):1–50, 2018.
Brendan van Rooyen, Aditya Krishna Menon, and Robert C. Williamson. An average classification algorithm.
Technical Report arXiv:1506.01520, 2015.
Felix X. Yu, Dong Liu, Sanjiv Kumar, Tony Jebara, and Shih-Fu Chang. ∝SVM for learning with label
proportions. In Proceedings of the 30th International Conference on International Conference on Machine
Learning - Volume 28, 2013.
Felix X. Yu, Krzysztof Choromanski, Sanjiv Kumar, Tony Jebara, and Shih-Fu Chang. On learning from
label proportions. Technical Report arXiv:1402.5902, 2015.
Zhilu Zhang and Mert R. Sabuncu. Generalized cross entropy loss for training deep neural networks with
noisy labels. In Proceedings of the 32Nd International Conference on Neural Information Processing
Systems, pages 8792–8802, 2018.

13

7

DETAILS OF EXPERIMENTAL RESULTS
Table 1: Balanced accuracy
Dataset
Banknote

Cardiotocography

CNAE

Contraceptive

German bank

Sports article

Wireless Indoor

Method
InvCal
alter-pSVM
corrected loss
InvCal
alter-pSVM
corrected loss
InvCal
alter-pSVM
corrected loss
InvCal
alter-pSVM
corrected loss
InvCal
alter-pSVM
corrected loss
InvCal
alter-pSVM
corrected loss
InvCal
alter-pSVM
corrected loss

2
0.9994 ± 0.0013
0.9994 ± 0.0013
0.9895 ± 0.0085
0.8286 ± 0.0079
0.8465 ± 0.0083
0.7985 ± 0.0779
0.7727 ± 0.0504
0.9207 ± 0.0112
0.9367 ± 0.0174
0.6593 ± 0.0103
0.6600 ± 0.0127
0.6616 ± 0.0267
0.6450 ± 0.0272
0.6600 ± 0.0127
0.6885 ± 0.0380
0.8193 ± 0.0182
0.8107 ± 0.0059
0.8216 ± 0.0201
0.9937 ± 0.0042
0.9962 ± 0.0045
0.9724 ± 0.0080

0.9994
0.9994
0.9668
0.8349
0.8241
0.7616
0.6974
0.7418
0.8049
0.6569
0.6041
0.6992
0.5420
0.6041
0.6572
0.7999
0.8266
0.8291
0.9898
0.9983
0.9693

4
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±

0.0015
0.0015
0.0260
0.0274
0.0555
0.1278
0.0694
0.1769
0.0537
0.0093
0.0237
0.0071
0.0426
0.0237
0.0463
0.0481
0.0445
0.0341
0.0035
0.0020
0.0234

0.9994
1.0000
0.9431
0.7078
0.6814
0.7137
0.5372
0.7101
0.7552
0.6096
0.5628
0.5698
0.5233
0.5628
0.6285
0.8030
0.8086
0.8050
0.9893
0.9947
0.9488

8
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±

0.0014
0.0000
0.0277
0.1027
0.1749
0.0747
0.0231
0.1576
0.0634
0.0428
0.0205
0.0834
0.0189
0.0205
0.0447
0.0199
0.0288
0.0179
0.0082
0.0058
0.0121

0.9927
0.9987
0.8995
0.5805
0.4424
0.5273
0.5000
0.5635
0.6047
0.5835
0.5321
0.5172
0.5371
0.5321
0.5123
0.7896
0.7993
0.6828
0.9882
0.9967
0.9087

16
± 0.0061
± 0.0018
± 0.0415
± 0.0912
± 0.0060
± 0.1234
± 0.0000
± 0.1694
± 0.0901
± 0.0409
± 0.0475
± 0.0501
± 0.0321
± 0.0475
± 0.0647
± 0.0254
± 0.0103
± 0.1895
± 0.0078
± 0.0024
± 0.0342

32
0.9636 ± 0.0089
0.8969 ± 0.0771
0.7976 ± 0.1065
0.5340 ± 0.1169
0.4374 ± 0.0047
0.5407 ± 0.1576
0.5000 ± 0.0000
0.4887 ± 0.0305
0.6055 ± 0.1270
0.5908 ± 0.0169
0.5491 ± 0.0325
0.5525 ± 0.0328
0.5094 ± 0.0209
0.5491 ± 0.0325
0.4869 ± 0.0730
0.7447 ± 0.0371
0.7683 ± 0.0332
0.7610 ± 0.0394
0.9679 ± 0.0142
0.8735 ± 0.2680
0.8646 ± 0.0732

0.9053
0.7244
0.7400
0.4978
0.4471
0.4925
0.5000
0.4726
0.5363
0.5162
0.4917
0.5035
0.5000
0.4917
0.5353
0.5993
0.7059
0.6360
0.6842
0.9928
0.7648

64
± 0.0369
± 0.1487
± 0.1614
± 0.0048
± 0.0081
± 0.1457
± 0.0000
± 0.0282
± 0.0473
± 0.0194
± 0.0650
± 0.0191
± 0.0000
± 0.0650
± 0.0593
± 0.1149
± 0.2231
± 0.1387
± 0.1041
± 0.0053
± 0.2458

32
± 0.0086
± 0.0738
± 0.1065
± 0.0629
± 0.0100
± 0.0559
± 0.0200
± 0.0294
± 0.1211
± 0.0208
± 0.0293
± 0.0322
± 0.0058
± 0.0293
± 0.0776
± 0.0158
± 0.0370
± 0.0346
± 0.0071
± 0.1929
± 0.0982

0.9115
0.7264
0.7385
0.7961
0.6900
0.6489
0.8859
0.8218
0.4724
0.5813
0.5629
0.5184
0.7026
0.5629
0.5560
0.6974
0.7259
0.6233
0.8431
0.9948
0.7336

64
± 0.0365
± 0.1477
± 0.1614
± 0.0106
± 0.0083
± 0.1464
± 0.0218
± 0.0312
± 0.2511
± 0.0199
± 0.0630
± 0.0277
± 0.0000
± 0.0630
± 0.0888
± 0.0777
± 0.2034
± 0.1058
± 0.0633
± 0.0039
± 0.3003

Table 2: Accuracy
Dataset
Banknote

Cardiotocography

CNAE

Contraceptive

German bank

Sports article

Wireless Indoor

8

Method
InvCal
alter-pSVM
corrected loss
InvCal
alter-pSVM
corrected loss
InvCal
alter-pSVM
corrected loss
InvCal
alter-pSVM
corrected loss
InvCal
alter-pSVM
corrected loss
InvCal
alter-pSVM
corrected loss
InvCal
alter-pSVM
corrected loss

0.9993
0.9993
0.9891
0.8540
0.8146
0.7977
0.9491
0.9815
0.9463
0.6774
0.7320
0.6646
0.7290
0.7320
0.6860
0.8330
0.8270
0.8220
0.9960
0.9970
0.9700

2
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±

0.0016
0.0016
0.0089
0.0051
0.0136
0.0341
0.0113
0.0033
0.0086
0.0080
0.0091
0.0434
0.0204
0.0091
0.0428
0.0130
0.0076
0.0172
0.0022
0.0027
0.0096

0.9993
0.9993
0.9674
0.8335
0.8037
0.7553
0.9250
0.9250
0.8815
0.6862
0.6850
0.7030
0.7150
0.6850
0.6590
0.8390
0.8420
0.8450
0.9935
0.9985
0.9710

4
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±

0.0016
0.0016
0.0258
0.0151
0.0311
0.0350
0.0286
0.0511
0.0249
0.0174
0.0292
0.0140
0.0252
0.0292
0.0482
0.0439
0.0396
0.0251
0.0022
0.0014
0.0208

0.9993
1.0000
0.9423
0.8130
0.7609
0.7526
0.8907
0.9204
0.8648
0.6308
0.6250
0.5660
0.6980
0.6250
0.6460
0.8230
0.8210
0.8170
0.9945
0.9970
0.9445

8
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±
±

0.0016
0.0000
0.0274
0.0444
0.0759
0.0608
0.0184
0.0524
0.0359
0.0354
0.0170
0.0855
0.0164
0.0170
0.0444
0.0175
0.0248
0.0117
0.0037
0.0033
0.0165

0.9923
0.9986
0.9007
0.7502
0.6730
0.6693
0.8889
0.8713
0.6491
0.6193
0.6130
0.5022
0.7120
0.6130
0.5280
0.8160
0.8160
0.6940
0.9930
0.9980
0.9060

16
± 0.0063
± 0.0019
± 0.0420
± 0.0372
± 0.0097
± 0.0721
± 0.0146
± 0.0584
± 0.1689
± 0.0471
± 0.0362
± 0.0430
± 0.0144
± 0.0362
± 0.1201
± 0.0164
± 0.0175
± 0.1756
± 0.0027
± 0.0011
± 0.0280

0.9648
0.9007
0.7951
0.7571
0.6719
0.7000
0.8839
0.8323
0.6847
0.6299
0.6190
0.5632
0.7052
0.6190
0.5233
0.7802
0.7828
0.7724
0.9850
0.9100
0.8375

PROOFS

We introduce the following notation. The Lipschitz constant of a loss ℓ is the smallest L for which ℓ is
L-Lipschitz, and is denoted |ℓ|. Additionally, for any loss ℓ define
|ℓ|0 :=

max ℓ(0, y).

y∈{−1,1}

Note that for a margin loss ℓ(t, y) = ϕ(yt), we have |ℓ|0 = ϕ(0).
Our proofs leverage techniques drawn from Rademacher complexity theory. This theory applies to classes
of bounded function, and the following lemma ensures we are in this setting.

14

Lemma 8. Suppose k is an SPD kernel on X , bounded by K. Then for any R > 0, f ∈ Bk (R), and x ∈ X ,
|f (x)| ≤ RK.
If in addition ℓ is a Lipschitz loss, then for any R > 0 and f ∈ Bk (R), and any x ∈ X and y ∈ {−1, 1},
ℓ(f (x), y) ≤ |ℓ|0 + |ℓ|RK.
Proof. Let Hk denote the RKHS associated to k. The first part follows from the reproducing property and
Cauchy-Schwarz:
|f (x)| = |hf, k(·, x)i| ≤ kf kHk kk(·, x)kHk = RK.
For the second part, by the Lipschitz continuity of ℓ,
ℓ(f (x), y) ≤ ℓ(0, y) + ℓ(f (x), y) − ℓ(0, y)
≤ |ℓ|0 + |ℓ||f (x) − 0|
≤ |ℓ|0 + |ℓ|RK,

where the last step uses the first part.
The following lemma is used to deduce Theorems 2, 3 and 4 from Theorem 10 below. Recall that (ℓα )ρ
denotes ℓρα .
Lemma 9. Let ℓ be a Lipschitz margin loss with ℓ(t, y) = ϕ(yt). Let ρ = (ρ+ , ρ− ) ∈ [0, 1)2 such that
ρ− + ρ+ < 1, and α = (α+ , α− ) ∈ R2+ . Then
1. |ℓρ |0 = ϕ(0)
+

−

−ρ |
2. |ℓρ | ≤ |ℓ| 1+|ρ
1−ρ− −ρ+

3. |ℓρα |0 ≤

2ϕ(0)
1−ρ− −ρ+
+

max(α+ , α− )
−

−ρ |
+
−
4. |ℓρα | ≤ |ℓ| 1+|ρ
1−ρ− −ρ+ max(α , α ).
1
1
Now suppose that for some γ + , γ − ∈ [0, 1] with γ + > γ − , we have α = ( γ + +γ
− , 2−γ + −γ − ), and ρ =
+

−

1−γ
( γ −γ+γ + , 2−γ
− −γ + ). Then

5. |ℓρα |0 ≤
6. |ℓρα | ≤

ϕ(0)
γ + −γ −

|ℓ|
γ + −γ − .

15

Proof. 1. follows from definitions and 2. is a special case of 4 with α = (1, 1). To establish 3.,
max ℓρα (0, y) = max {ℓρα (0, 1), ℓρα (0, −1)}
y

=
=
=
≤
≤
=
≤

max {(1 − ρ− )ℓα (0, 1) − ρ+ ℓα (0, −1), (1 − ρ+ )ℓα (0, −1) − ρ− ℓα (0, 1)}
1 − ρ− − ρ+
−
+
+ −
max {(1 − ρ )α ℓ(0, 1) − ρ α ℓ(0, −1), (1 − ρ+ )α− ℓ(0, −1) − ρ− α+ ℓ(0, 1)}
1 − ρ− − ρ+

ϕ(0)
max (1 − ρ− )α+ − ρ+ α− , (1 − ρ+ )α− − ρ− α+
1 − ρ− − ρ+

ϕ(0)
max (1 − ρ− )α+ + ρ+ α− , (1 − ρ+ )α− + ρ− α+
−
+
1−ρ −ρ

ϕ(0)
(1 − ρ− )α+ + ρ+ α− + (1 − ρ+ )α− + ρ− α+
−
+
1−ρ −ρ
ϕ(0)
(α+ + α− )
1 − ρ− − ρ+
2ϕ(0)
max(α+ , α− ).
1 − ρ− − ρ+

To establish 4., let t, t′ ∈ R. Then
|ℓρα (t, 1) − ℓρα (t′ , 1)|

1
(1 − ρ− )α+ ℓ(t, 1) − ρ+ α− ℓ(t, −1) − [(1 − ρ− )α+ ℓ(t′ , 1) − ρ+ α− ℓ(t′ , −1)]
1 − ρ− − ρ+
1
(1 − ρ− )α+ (ℓ(t, 1) − ℓ(t′ , 1)) − ρ+ α− (ℓ(t, −1) − ℓ(t′ , −1))
=
1 − ρ− − ρ+
h
i
|ℓ|
−
+
+ −
≤
(1
−
ρ
)α
+
ρ
α
|t − t′ |
1 − ρ− − ρ+
i
h
|ℓ|
+
−
−
+
≤
|t − t′ |
max(α
,
α
)
1
−
ρ
+
ρ
1 − ρ− − ρ+

=

where the first inequality results from the triangle inequality and the Lipschitz property of ℓ. Similarly,
i
h
|ℓ|
+
−
− +
|t − t′ |
(1
−
ρ
)α
+
ρ
α
1 − ρ− − ρ+
i
h
|ℓ|
+
−
+
−
≤
|t − t′ |.
max(α
,
α
)
1
−
ρ
+
ρ
1 − ρ− − ρ+

|ℓρα (t, −1) − ℓρα (t′ , −1)| ≤

The result now follows from

max 1 − ρ− + ρ+ , 1 − ρ+ + ρ− = 1 + |ρ+ − ρ− |.

16

To establish 5.,
max ℓρα (0, y) = max {ℓρα (0, 1), ℓρα (0, −1)}
y
(
ϕ(0)
1
γ−
1
1 − γ−
=
max
−
,
−
+
−
+
+
−
−
+
+
1−ρ −ρ
2−γ −γ γ +γ
γ + γ 2 − γ − γ−

ϕ(0)
≤
max
1 − ρ− − ρ+

(

1
1
1 − γ+
γ+
−
−
+
+
−
γ +γ 2−γ −γ
2 − γ− − γ+ γ+ + γ−
1
1
γ−
1 − γ−
+
,
−
+
+
−
−
+
+
2−γ −γ γ +γ
γ + γ 2 − γ − γ−
γ+
1
1
1 − γ+
+
−
+
+
−
γ +γ 2−γ −γ
2 − γ− − γ+ γ+ + γ−

)

)

ϕ(0)
1
−
+
−
+
1 − ρ − ρ (γ + γ )(2 − γ + − γ − )
ϕ(0)
,
= +
γ − γ−

=

where in the last step we used Eqn. (5).
To establish 6., let t, t′ ∈ R. Arguing as in case 4., we have
|ℓρα (t, 1) − ℓρα (t′ , 1)| ≤

i
h
|ℓ|
(1 − ρ− )α+ + ρ+ α− |t − t′ |.
−
+
1−ρ −ρ

Now observe
"
#
i
h
|ℓ|
|ℓ|
1 − γ−
1
1
γ−
−
+
+ −
(1 − ρ )α + ρ α =
+ −
1 − ρ− − ρ+
1 − ρ− − ρ+ 2 − γ − − γ + γ + + γ −
γ + γ+ 2 − γ+ − γ−
|ℓ|
1
−
+
−
+
1 − ρ − ρ (γ + γ )(2 − γ + − γ − )
|ℓ|
,
= +
γ − γ−

=

where the last step uses Eqn. (5). The case y = −1 follows similarly.
We may now state the master theorem, of which Theorems 2, 3 and 4 are special cases.
Theorem 10. Let ℓ be a Lipschitz margin loss. For i = 1, . . . , N , let (a) πi ∈ (0, 1), (b) Pi be a probability
+
−
+
2
2
distribution on X × {−1, 1}, (c) ρi = (ρ−
i , ρi ) ∈ [0, 1) such that ρi + ρi < 1, (d) αi ∈ R+ , and (e) Si
ρi
consist of ni iid samples of Pi . For all R > 0, w ∈ ∆N , and 0 < δ ≤ 1, we have that with probability at
least 1 − δ with respect to the draws of the corrupted samples S1 , . . . , SN ,
sup
f ∈Bk (R)





ni
X
1
wi 
ℓρi (f (Xij ), Ỹij ) − EPi ,αi (f )
ni j=1 αi
i=1
v
v
uN
uN
uX w2 ρ
uX w2 ρ
log(2/δ)
i
i
i 2
t
≤ 2KR
|ℓαi | + t
(|ℓαii |0 + |ℓραii |KR)2
.
ni
ni
2
i=1
i=1

N
X

Proof. We first review the following properties of the supremum which are easily verified.
17

P1 For any real-valued functions f1 , f2 : X → R,
sup f1 (x) − sup f2 (x) ≤ sup(f1 (x) − f2 (x)).
x

x

x

P2 For any real-valued functions f1 , f2 : X → R,
sup(f1 (x) + f2 (x)) ≤ sup f1 (x) + sup f2 (x).
x

x

x

P3 sup(·) is a convex function, i.e., if (xλ )λ∈Λ and (x′λ )λ∈Λ are two sequences (where Λ is possibly uncountable), then ∀α ∈ [0, 1],
sup(αxλ + (1 − α)x′λ ) ≤ α sup xλ + (1 − α) sup x′λ .

λ∈Λ

λ∈Λ

λ∈Λ

Introduce the variable S to denote all realizations (Xij , Ỹij ), 1 ≤ i ≤ N, 1 ≤ j ≤ ni . Since the realizations
Xij are independent, we can apply the Azuma-McDiarmid inequality (McDiarmid, 1989) to the function



ni
N
X
X
1
wi 
ℓρi (f (Xij ), Ỹij ) − EPi ,αi (f ) .
ξ(S) := sup
ni j=1 αi
f ∈Bk (R) i=1

In particular, by Lemmas 8 and 9, every loss ℓραii is bounded by Ki := |ℓραii |0 + |ℓραii |KR. If we modify S by
′
replacing some (Xij , Ỹij ) with another (Xij
, Ỹij′ ), while leaving all other values in S fixed, then (by P1) ξ
wi Ki
changes by at most ni , and we obtain that with probability 1 − δ over the draw of S1 , . . . , SN ,
v
uN
uX w2 (|ℓραi |0 + |ℓραi |KR)2 log(1/δ)
i
i
i
.
ξ − E [ξ] ≤ t
n
2
i
i=1

To bound E [ξ] we will use ideas from Rademacher complexity theory. Thus let S ′ denote a separate
iid

′
(ghost) sample of corrupted data (Xij
, Ỹij′ ) ∼ Piρi , i = 1, . . . , N , j = 1, . . . , ni , independent of the realizations
P
wi P ρi
b S [f ] be shorthand for
in S. Let E
j ℓαi (f (Xij ), Ỹij ). Denote by (ǫij ) 1 ≤ i ≤ N, 1 ≤ j ≤ ni , iid
i ni
Rademacher variables (independent from everything else), and let E(ǫij ) denote the expectation with respect

18

to these variables. We have






ni
X
1
E [ξ] = ES  sup
wi 
ℓρi (f (Xij ), Ỹij ) − EPi ,αi (f )
ni j=1 αi
f ∈Bk (R) i=1
!#
"
h
i
b
b
sup
ES [f ] − ES ′ ES ′ [f ]
= ES
N
X

f ∈Bk (R)

(by Lemmas 1 and 8)
!#
"
b S [f ] − E
b S ′ [f ]
sup
E
≤ ES,S ′
f ∈Bk (R)

(by P3 and Jensen’s inequality)

!
ni
N
X
X
w
i
′
), Ỹij′ ) 
ℓραii (f (Xij ), Ỹij ) − ℓραii (f (Xij
= ES,S ′  sup
n
i
f ∈Bk (R)
i=1
j=1

!
ni
N


X
X
w
i
′
= ES,S ′ ,(ǫij )  sup
), Ỹij′ ) 
ǫij ℓραii (f (Xij ), Ỹij ) − ℓραii (f (Xij
n
i
f ∈Bk (R)
i=1
j=1
′
(for all i, j, (Xij , Ỹij ) and (Xij
, Ỹij′ ) are iid, and ǫij are symmetric)


ni
N
X
X
w
i
ǫij ℓραii (f (Xij ), Ỹij )
≤ ES,S ′ ,(ǫij )  sup
f ∈Bk (R) i=1 ni j=1


ni
N
X
X
w
i
′
+ ES,S ′ ,(ǫij )  sup
), Ỹij′ )
(−ǫij )ℓραii (f (Xij
f ∈Bk (R) i=1 ni j=1

(by P2)



= 2ES E(ǫij )  sup

ni
N
X
wi X

f ∈Bk (R) i=1

ni

j=1



ǫij ℓραii (f (Xij ), Ỹij ) .

To bound the innermost expectation we use the following result from Meir and Zhang (2003).
Lemma 11. Suppose {φt } , {ψt } , t = 1, . . . , T , are two sets of functions on a set Θ such that for each t and
θ, θ′ ∈ Θ, |φt (θ) − φt (θ′ )| ≤ |ψt (θ) − ψt (θ′ )|. Then for all functions c : Θ → R,
"
(
)#
"
(
)#
T
T
X
X
E(ǫt ) sup c(θ) +
ǫt φt (θ)
≤ E(ǫt ) sup c(θ) +
ǫt ψt (θ)
.
θ

θ

t=1

t=1

Switching from the single index t to our two indices i and j, we apply the lemma with Θ = F , θ = f ,
wi ρi
i ρi
c(θ) = 0, φij (θ) = w
ni ℓαi (f (Xij ), Ỹij ), and ψij (θ) = ni |ℓαi |f (Xij ) to obtain


E [ξ] ≤ 2ES E(ǫij )  sup

ni
N
X
wi |ℓραi | X
i

f ∈Bk (R) i=1

ni

j=1



ǫij f (Xij ) .

This inner expectation may be bounded by a modification of the standard bound of Rademacher complexity

19

ρ

for kernel classes. For conciseness introduce ai :=
#
"
X
ai ǫij f (Xij )
E(ǫij )
sup
f ∈Bk (R) i,j

wi |ℓαii |
ni .





X

= E(ǫij )  sup

ai ǫij hf, k(·, Xij )i

f ∈Bk (R) i,j



= E(ǫij )  sup

f ∈Bk (R)

*

Then

f,

X
i,j

+

ai ǫij k(·, Xij ) 

+
X
a
ǫ
k(·,
X
)
ij
i,j i ij
ai ǫij k(·, Xij ) 
= E(ǫij )  R P
,
k i,j ai ǫij k(·, Xij )k i,j
v

u
2
u X
= RE(ǫij ) t
ai ǫij k(·, Xij ) 
*

P

(11)

(12)

i,j

v

u
u
X
u
ai ǫij k(·, Xij )
≤ RtE(ǫij ) 
i,j

=R

sX
i,j

a2i kk(·, Xij )k2

2




v
uN
uX w2 |ℓραii |2
i
,
= RK t
ni
i=1

(13)

(14)

(15)

where (11) uses the reproducing property, (12) is the condition for equality in Cauchy-Schwarz, (13) is
Jensen’s inequality, (14) follows from independence of the Rademacher random variables, and (15) follows
from the reproducing property and the bound on the kernel.
All of the above establishes a high probability bound on ξ. To get a bound with an absolute value (as
in the theorem statement), we may argue analogously to bound the reverse direction, also with probability
at least 1 − δ. Substituting δ → δ/2 combines the two directions, giving a bound on the supremum of the
absolute value of the generalization error, thus completing the proof.

8.1

Proof of Theorem 2

To prove Theorem 2 we apply Theorem 10 with Pi = P and αi = (1, 1). The result now follows from Lemma
9 parts 1 and 2, the fact that for R > ϕ(0)/(|ℓ|K) it holds ϕ(0) ≤ |ℓ|KR ≤ |ℓρi |KR, and the fact that
1 < log(2/δ)/2 when δ ≤ 41 .

8.2

Proof of Theorem 3

To prove Theorem 3 we apply Theorem 10 and note that for the given αi , EPi ,αi = E± . Applying Lemma 9
parts 3 and 4 we have that
−
|ℓραii |0 + |ℓραii |KR ≤ max(α+
i , αi )

−
1 + |ρ+
i − ρi |
− (2ϕ(0) + |ℓ|KR).
1 − ρ+
i − ρi

−
1
1
The result now follows from the observation that max(α+
i , αi ) = 2 min(πi ,1−πi ) , the fact that for R >
2ϕ(0)/(|ℓ|K) it holds 2ϕ(0) ≤ |ℓ|KR, and the fact that 1 < log(2/δ)/2 when δ ≤ 14 .

20

8.3

Proof of Theorem 4

To prove Theorem 4 we apply Theorem 10 and note that for the given αi , EPi ,αi = E± . The result now
follows from Lemma 9 parts 5 and 6, the fact that for R > ϕ(0)/(|ℓ|K) it holds ϕ(0) ≤ |ℓ|KR, and the fact
that 1 < log(2/δ)/2 when δ ≤ 41 .

8.4

Proof of Theorem 5

Under the bounded noise condition, it holds for all three settings that with probability at least 1 − δ,
v
!−1
u
u X
8KRL
log(2/δ)
t
b
sup E(f ) − E(f ) ≤
ni
,
c0
2
f ∈Bk (R)
i

where c0 is the noise level lower bound. This can be seen by plugging in the optimal weights and simplifying.
Denote
J(f ) =

ni
N
X
wi X
i=1

ni

j=1

ℓραii (f (Xij ), Ỹij ) + λkf k2

b ) + λkf k2 .
= E(f

b fb) ≤ ϕ(0) and so kfbk2 ≤ ϕ(0)/λ.
Observe thatpJ(fb) ≤ J(0) = ϕ(0). Therefore λkfbk2 ≤ ϕ(0) − E(
Set R = ϕ(0)/λ. Note that R grows asymptotically because λ shrinks. We just saw that fb ∈ Bk (R).
∗
Let ǫ > 0. Fix fǫ ∈ Hk s.t. E(f
P ǫ ) ≤ E + ǫ/2, possible since k is universal (Steinwart and Christmann,
2008). Note that fǫ ∈ Bk (R) for i ni sufficiently large. In this case the generalization error bound implies
that with probability ≥ 1 − δ,
v
!−1
u
u X
log(2/δ)
8KRL
t
b fb) +
ni
E(fb) ≤ E(
c0
2
i
v
!−1
u
u X
log(2/δ)
8KRL
t
2
2
b ǫ ) + λkfǫ k − λkfbk +
ni
≤ E(f
c0
2
i
v
!−1
u
u X
log(2/δ)
8KRL
t
b ǫ ) + λkfǫ k2 +
ni
≤ E(f
c0
2
i
v
!−1
u
u X
log(2/δ)
16KRL
t
ni
.
≤ E(fǫ ) + λkfǫ k2 +
c0
2
i
Taking δ = (n1 + · · · + nN )−1 , the result now follows.

8.5

Proof of Proposition 7

Through simple algebra it can be shown that for each i,
(ℓαi )ρi (t, 1) =
and
(ℓαi )ρi (t, −1) =

γi+

1
[(1 − γi− )ℓ(t, 1) − γi− ℓ(t, −1)]
− γi−

1
[γ + ℓ(t, −1) − (1 − γi+ )ℓ(t, 1)].
γi+ − γi− i
21

Applying (9) it now follows that
#
"
X
w
i
J ′′ (t) = ℓ′′ (t, 1)
(1 − 2γi− )1{Ỹij =1} + (2γi+ − 1)1{Ỹij =−1}
+
−
n
(γ
−
γ
)
i
i
i
i
j
#
"
X
w
i
+
−
= ℓ′′ (t, 1)
(1 − 2γi− )n+
i + (2γi − 1)ni .
+
−
n
(γ
−
γ
)
i
i
i
i
X

The result now follows.

22

