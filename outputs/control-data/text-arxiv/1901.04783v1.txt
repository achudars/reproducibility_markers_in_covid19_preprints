1

Balancing Cost and Dissatisfaction in Online EV
Charging under Real-time Pricing
(Technical Report)
t

Hanling YT ** , Qiulin Lin7*, Minghua Chen
Department of Information Engineering, The Chinese University of Hong Kong, Hong Kong
? Huawei Noah ’ s Ark Lab, Hong Kong

Abstract—We consider an increasingly popular demand
response scenario where a user schedules the flexible electric
vehicle (EV ) charging load in response to real time electricity
prices. The objective is to minimize the total charging cost with
user dissatisfaction taken into account. We focus on the online
setting where neither accurate prediction nor distribution of
future real -time prices is available to the user when making
irrevocable charging decision in each time slot. The emphasis on
considering user dissatisfaction and achieving optimal competi
tive ratio differentiates our work from existing ones and makes
our study uniquely challenging. Our key contribution is two
simple online algorithms with the best possible competitive ratio
among all deterministic algorithms. The optimal competitive ratio
is upper bounded by min yja / pmm , pmax / Pmm and the bound is
asymptotically tight with respect to a, where pmax and pnun are
the upper and lower bounds of real time prices and a
pmm
captures the consideration of user dissatisfaction. The bounds
under small and large values of a suggest the fundamental
difference of the problems with and without considering user
dissatisfaction. Simulation results based on real world traces
corroborate our theoretical findings and show that the empirical

-

-

-

-

)

{

-

-

performance of our algorithms can be substantially better than
its theoretical worst-case guarantee. Moreover, our algorithms
achieve large performance gains as compared to conceivable
alternatives. The results also suggest that increasing EV charging
rate limit decreases overall cost almost linearly.

I. INTRODUCTION
Integrating renewable energy sources at large scale is a
prioritized focus in the recent development of power systems.
In the US, renewable electricity accounts for 67 % of electricity
capacity addition in 2016, and it mounts to 15.6% of the
total electricity generation [ 1]. Globally, in 2016, the installed
renewable generation continues to increase and represents 26%
of the total electricity generation, exceeding 6,210 terawatthours (TWh) [1] . High penetration of renewable generation,
however, challenges the conventional operating principle of
the power grid. Specifically, renewable generation, such as
wind turbine and solar PV, is highly uncertain and intermittent .
As renewable generation fluctuates, the conventional approach
requires additional supply - side flexibility to balance the supply
and demand, to ensure power system reliability at all time [2] .
Demand response with dynamic pricing is a modern mechanism for providing the needed flexibility, from the demand
side, to better accommodate renewable generation. The idea
The two authors contribute equally to the work.

is to incentivize customers to adapt the consumption according
to the electricity supply conditions, e.g., to shift load from onpeak to off - peak periods, by leveraging real -time electricity
prices [3]. Results from real-world trials have been encouraging. In 2015, in the US, the (retail ) demand response programs
identify 32 GW flexible load, enough to accommodate at least
14 % variation in the renewable generation [4] [1 ]. Furthermore, the rapid and widespread adoption of electric vehicles
(EV ) introduces substantial flexible charging load that can be
leveraged in future demand response programs. l
Motivated by the above observations, we focus on an
increasingly popular scenario of EV demand response, where
individual customers schedule the flexible EV charging demand in response to real-time electricity prices. The objective
is to minimize the EV charging cost with user dissatisfaction
taken into account.2 The dissatisfaction captures the user’s
willingness for the EV not being fully charged , and it is usually
encapsulated using the concept of disutility function [6], [7].
With proper real-time pricing in place, minimizing the overall
cost of customers ( by charging at cheaper time spots) will
also benefit the power system because of the reduced peak
load and flattened load -curve. Meanwhile, when the prices are
relatively high during the entire EV charging period, customers
may prefer to charge the EV just enough to meet certain level
of satisfaction , so as to avoid excessive electricity cost and
casting full charging load to the grid when the supply is scarce
or expensive. Overall , it is win-win, for the customers and the
system operator, to jointly consider the charging cost and user
dissatisfaction .
A number of solutions have been proposed for the offline/stochastic setting where the complete or distributional
information of the future real-time prices are known in advance; see a brief summary in Sec. II. While the solutions
usually achieve strong performance guarantee, they may not
be practical since it is difficult to obtain accurate estimates or
distributions of future real-time prices. To illustrate, we plot
the real -time prices of two consecutive Tuesdays in the same
For example, the annual EV sales in the US have increased by 6 x since
2010 and will reach 28% of the US vehicle market by 2031 [5]. The power
required for charging a single EV is 2 6 KW and can be as high as 20 KW
for fast charging models. The charging load is highly flexible and controllable .
2 With the two way communication smart grid infrastructure and smart EV
charger, the price aware strategy can be implemented on the vehicle and
executed autonomously during the charging .

-

-

-

2

pm n captures the consideration of user
time prices and a
dissatisfaction . Larger (resp. smaller) a indicates more (resp.
less) user demand will be satisfied , which represents less (resp.
more) user dissatisfaction . The bounds of competitive-ratio
give an explicit characterization of the influence of the user
dissatisfaction consideration . Furthermore, the bounds under
small and large values of a suggest the fundamental difference
of the problems with considering user dissatisfaction ( a takes
small values) and without ( a takes large values).
> In Sec. VI, we carry out extensive simulation to evaluate
the performance of our algorithms based on real -world traces.
The results corroborate our theoretical findings and show
that the empirical online-to-offline performance ratio of our
algorithms is much smaller than competitive ratio. Moreover,
our algorithms achieve substantial performance gains as compared to conceivable alternatives. The results also suggest that
increasing the EV charging rate limit decreases the overall cost
almost linearly.
Due to the space limitation, all proofs are included in our
technical report [ 11].
]

0.5

I

S'

3

§-

25
8
L 00

s

50

100

150

200

250

300

Time (Feb. 27, 2018)

12

Price (cents/ kWh)
0.4

10

S'

§
3 5

Ui

.8

ol 00

50

100

150

200

250

s5.0.2
e

LL

300

Time (Mar. 06, 2018)

-

( a ) Real time price trajectories.

Price (cents/ kWh)

-

( b) Real time price distributions.

Figure 1 : Trajectories and daily distributions of the real-time
electricity prices from ComEd in Illinois, USA at 5-minute
intervals, for two consecutive Tuesdays Feb 27, 2018 and Mar
06, 2018 with similar weather [8].

region in Fig. 1. As seen , the real-time prices in two similar
days do not follow similar trajectory patterns or histograms.
Thus, it will be challenging to predict real-time prices or their
distributions by leveraging the commonly-used information
including weekdays and historical price data.
In this paper, we investigate the EV charging scheduling
problem under a more realistic online setting, where neither
accurate prediction nor distribution of future real -time prices
is available to users when making online charging decision .
Under the online setting , the EV owner has to make irrevocable
charging decisions at current time without knowing whether
the prices will become cheaper or more expensive in the
future. It is challenging as the quality of charging decisions
at present time depends on future electricity prices. There
have been several pioneering studies along this direction; see
a summary in Sec. II. In particular, the authors in [9] propose
an online algorithm for optimizing a cost-induced function for
EV demand response with performance guarantee that requires
little priori knowledge, which makes it amenable for practical
implementation .
To this end, we further explore the design of online scheduling algorithms for EV charging under real -time pricing. Our
study emphasizes on minimizing charging cost with customer
dissatisfaction taken into account and deriving strong/optimal
performance guarantees. We employ a new technique to tackle
the challenges and design two optimal online algorithms with
the best possible competitive ratio among all deterministic
ones. We summarize our key contributions as follows.
> We formulate the EV charging scheduling problem with
both cost and dissatisfaction in consideration in Sec. III.
We also consider charging rate limit in the formulation. We
then discuss an optimal offline algorithm and the impact of
dissatisfaction consideration on the charging behavior and the
overall cost in Sec. IV.
> In Sec. V, as the key contribution of our study, we design
two online algorithms that achieve the best possible competitive ratio among all deterministic algorithms. Along the way,
we develop a general technique for designing online optimal
algorithms, from an idea hinted in [10]. The optimal competitive ratio is upper-bounded by min { a / pmjn , pmiXx / Pmin
and the bound is asymptotically tight with respect to a ,
where pnvdx and pm[ n are the upper and lower bounds of real-

^

}

II. RELATED WORK
EVs have been widely recognized to have great potential
for demand response ( DR ) [7], [12], [13]. Conventionally, an
EV can participate in DR either directly through the timebased pricing scheme set by the system operator (a.k.a. singlelevel market ) [13], or indirectly through the charging station
(a.k.a. two-level market ) [7]. We focus on the former setting ,
where the real-time price is served as a signal for DR. A
number of solutions have been proposed for DR with EV in the
offline/stochastic settings, where the complete or distributional
information of the future real -time prices is known in advance
[6], [14], [15]. In this paper, we focus on the online setting
which assumes minimum knowledge on prices.
Prior to our work , online algorithms have been proposed for
EV charging in different scenarios. Majority of the previous
work in this area have been focusing on online scheduling
of EV charging for charge stations [16] [18]. For example,
Zhao et. al. [16] study competitive online algorithm for
aggregator to minimize peak electricity procurement from
the grid. Tang et. al. [18] propose an online coordinated
charging algorithm for EV charging station to minimize the
energy cost. Moreover, there are a few work focusing on the
charging strategy design for single EV. Deng et al. [9] study
the online cost minimization problem for a single EV charging
scenario and propose a near-optimal online algorithm based on
a Primal and Dual framework. Later Deng et al . consider both
charging and discharging strategies for single EV [19]. We
note that our problem is different from theirs in that we take
into consideration the trade-off between cost-minimization and
user dissatisfaction. In addition, our algorithms can achieve
the optimal competitive ratio among all deterministic online
algorithms.

—

III. EV CHARGING PROBLEM FORMULATION
We consider the EV charging problem within a charging
period T . The charging period is divided into slots with equal

3

lengths, denoted by [ T ] = {1, 2, T } 3 . Due to real-time
electricity pricing, the charging price of EV is time varying.
At slot t , when the charging price is p( t ) and the charging
quantity (in kWh ) is v( t ) , the EV incurs a charging cost of
p{ t )v( t ). For ease of presentation , we assume v{ t ) e [0, 1 ],
i.e., v(0 is the charging quantity normalized by the maximum
charging quantity in a single slot4 . Denote c > 0 as the battery
capacity normalized by the maximum charging quantity within
a single slot . If the battery is fully charged at the end of
the charging period , i .e., £ / = 1 v( t ) = c , the EV owner incurs
total charging cost of £ r = 1 p( t ) v { t ) . Otherwise, the EV owner
suffers an additional penalty, named user dissatisfaction , which
is modeled as a linear function5 on the uncharged capacity
c - X / = i v( t ). In summary, the EV charging problem , denoted
as EVC , can be formulated as the following:
rT 1

rT'

T

EVC :

min

^

T

p ( t ) v( t ) + a c -

t=1
T

s.t.

i>

)

t=1

i>>

< C,

(1)

0 < v(0 < 1 , W G [ T ]

( 2)

t= 1

The constraint in (1) indicates that the total charging quantity
can not exceed the battery capacity. The parameter a pmm
captures the consideration of user dissatisfaction6 . The objective function in EVC consists of two terms: the first is
the charging cost , and the second represents the user dissatisfaction. We call the objective value of EVC as cost- plusdissatisfaction value . Both c and a are specified by the EV
owner in advance.
The offline version of EVC is a linear problem ( LP) , which
can be solved efficiently. However, in practice, the problem
inputs such as the charging period and the real-time electricity
prices are not known in advance. Thus we are interested in the
are
online setting , i .e ., T and <xrrl = (/?( l ), /? ( 2), ..., p( T ) ) e
revealed sequentially, where X|r| is the set of all possible price
sequence in T slots. We assume the real-time electricity prices
are bounded , i.e., p( r ) e [ pmm , Pmaxl Vr e [ T ] . Here pmin , Pmax
are common knowledge and we denote 6 = Pmax / Pmin In this
paper, we aim to develop deterministic online algorithms that
have the optimal competitive ratio which is defined as the best
achievable online to offline performance ratio in the worst case .
can
Formally, the competitive ratio of an online algorithm
be defined as
(3)
CR f [ ~ max

-

rIGeZm TJOPJ

(

where r\0 PT and r/ are the cost-plus-dissatisfaction values for
^
offline and online algorithm under input cr|yl , respectively. The
best competitive ratio is then defined as CR = min CR
^
Remark: Note that in our formulation, we assume the real time price is not affected by the charging quantity of EV. This
paper, we use the notation [ n ] , n e Z+ to denote the set {1 , 2, ..., «}.
The maximum charging quantity in single slot is the battery charging rate
limit multiplies by the time duration in a single slot, i .e., 5 minutes.
5
A linear dissatisfaction model mimics the charging cost model. We leave
considering a more general model as our future work .
6
Note that when a < pm[ n , the optimal solution is to never charge the EV,
which is trivial. Therefore, we only consider a pmm .
3 In this

4

is a common assumption in demand response literature [3],
[6], [13]. On one hand , it is reasonable as we are considering
the single EV charging problem and the charging quantity of a
single EV has negligible impact on the power system supplyand - demand balance. The study to investigate the aggregate
impact of a large number of EVs on the real-time price would
be an interesting future work. On the other hand, a complex
model on the real-time price would require the EV owner to
constantly update the model parameters, as market condition
may change from time to time. This is not practical in the
resource-limited scenario, which is the case for most EV

owners.
IV. OPTIMAL OFFLINE ALGORITHM

In this section, we consider the problem under the offline
setting where the prices are given in advance. We discuss the
optimal offline algorithm, and the impact of dissatisfaction
consideration on the charging behavior and the cost-plusdissatisfaction value.
Let us first consider the offline algorithm for the EV
charging problem without charging rate limit constraint , i.e.,
we omit v( t )
1 in ( 2). Denote the input until time t as
|r|
<r
= ( /?( l ), /?(2), ..., p( t ) ) e X1'1 , and the minimum price
observed in the first t slots as plm[ n = minr [r] p{ r ). Given
the offline problem at time t is an LP. We know that when
a p'min , it is optimal to not charge the EV; otherwise, it is
best to fully charge the EV at price pmin Thus the optimal
offline cost-plus-dissatisfaction value until time t is given by

‘ -

{

OPT ( t ) = min /?jnin , «

}

•

c.

(4)

From the above analysis, we can see the impact of a on the
offline solution . When taking into account the user dissatisfaction in consideration , sometimes it is better not to fully charge
the EV.
Secondly, let us study the offline algorithm for problem
EVC (i.e., with charging rate limit v{ t ) < 1 , W e [ T ] ). For
ease of presentation , we consider the case when c is a positive
integer. Due to the charging rate limit, it may take multiple
slots to fully charge a EV and we prefer to charge the EV in the
slots with low prices. Formally, at time t , if / > c, we denote
the set Tt as the index set of the c-smallest prices in <xM (break
ties randomly ); otherwise we denote Tt = [ / j. Clearly, we have
\Tt\ < c. Further, define the set Tta = { r\ p( r ) < a , T e [ f ]}, i.e.,
77* is the set of slots in which the prices are smaller than a.
Then at slot t , the optimal offline solution under crM is given
as follow : Vr e [ /],
V* ( T)

=

1, reTtnTta ;
0, otherwise.

(5)

Therefore, the optimal cost-plus-dissatisfaction value at time
t, denoted as OPT ( t ), can be expressed as

OPT ( t ) =

YJ

PV ) + a

TeTtCT?

c-

.
E
r,rr; ;
1

T£

(6 )

r

Note that when \T t n 77* 1 = c , the expression of OPT ( t ) can
be simplified as OPT ( t ) = Ere r nr, P ( T ) • From (5 ), we know
^
the offline solution depends on a. If a is large, for example,

-

0

4

Pnrd\•> then Tfi = [ t ] and the EV will be charged in slots
that belong to Tt . Tf a is small, it is possible that the EV is not
fully charged at the end. The rationality behinds this is that
the EV owner prefers to charge the EV just enough to meet
certain level of satisfaction when the prices are relatively high
(as compare to a ) to save the charging cost. In fact, the EV
will be fully charged at time t only when there are no less than
c slots at which the prices are lower than a. In addition , the
system operator also benefits as the demand is reduced during
periods with high prices indicating scare or expensive supply.
This leads to a win-win situation.

a

V. OPTIMAL ONLINE ALGORITHMS
In this section, we study online algorithms for EVC . We
firstly study the problem when there is no charging rate limit
and propose two optimal online algorithms in Sec. V-A. We
then extend these two online algorithms to the case with charging rate limit by employing a neat divide-and -conquer idea
in Sec. V-B and showing that they achieve the best possible
competitive ratio among all deterministic online algorithms for
EVC .

A. Without Charging Rate Limit

For ease of presentation , we denote the EV charging problem without charging rate limit as EVC c • We develop a
^
general technique for online algorithm design and propose
two optimal deterministic online algorithms for EVC c The
^
two proposed online algorithms have the same online-to-offline
performance ratio in the worst-case. Meanwhile, the first one
is too conservative under general cases, thus we propose the
second online algorithm as an improved version of the first
one and show that it has better performance in general .
1 ) Optimal Online Algorithm for EVC c Given any n 1,
^
we define a class of online algorithm ALGin ) as follows: at
time t, the output of ALGin ) is given by

-

'

v( t )

[ if - - OPT ( t )n\
a - p( t )

'

(7 )

where [ x ] + = max{0, x ] , OPT ( t ) is the cost- plus-dissatisfaction
value of offline algorithm defined in (4), and q/- i is the costplus-dissatisfaction value of online algorithm up to time t 1.
Clearly we have q° = ac and

—

1

- ht-1 - ( a - p( t ) ) v( t ) .

(8 )

From (7 ) and (8), we know that ALGin ) can guarantee at
each time t, the online-to-offline performance ratio is bounded
by 7r, i.e., qT / OPTit ) < n. In particular, when qT ~ l / OPT it ) n,
ALGin ) does not charge the EV, i.e., v( r) = 0. In this case, we
have 77? = qr~ ] and thus qf / OPTit ) < TT . When ql ~ x / OPTit ) >
_ rf - l -OPT ( t )7i
7
and
TT , AEGin ) will charge the EV , i .e., v ( f )
a p( t )
n. Thus intuitively, the
in this case we have rf / OPTit )
online algorithm ALGin ) will charge the EV only when the
ratio qT V OPT it ) is larger than n. In that case, ALGin )
~

—

7
In this case we must have p{ t ) < a , otherwise according to (4) , the
optimal offline cost plus dissatisfaction value remains unchanged , then we
have OPT ( t ) = OPT ( t 1 ) > TJ' ~ ] / /T is a contradiction .

- -

—

charges just enough at each time to keep the ratio to be n.
The idea of keeping the online-to-offline performance ratio
in ALGin ) originates from the discussion in the two intuitive
rules of designing online algorithms for the one-way trading
problem [10] . In the following, we show that this simple online
algorithm ALGin) with a carefully chosen n* is optimal among
all the deterministic online algorithms for EVC c

^

-

Definition 1. For ALGin ) with n 1. If for any T and <xirj,
T
we have £ / = 1 v(t) < c, then we say ALGin ) is feasible.
We note that there always exists a n (large enough ) that
can guarantee the feasibility of ALGin ). For example, when
77° = ac < npmmc < nOPT ( t ) ,Vt and any input ,
n >
which means ALG( n ) can maintain a competitive ratio n. As
such , we easily conclude v( t ) = 0, St e [ T ] , cr|r| and thus
ALGin ) is feasible. For any n > 1, we can define the maximum
total charging quantity for ALGin ) as
'

Vin )

—

max

2— >.
T

(9)

1

where v( r ) , Vr e [ T ] are the outputs of ALGin ) defined in (7).
By definition , ALGin ) is feasible if V ( n ) < c. It is obvious
that if ALGin ) is feasible, then it is ^-competitive. Denote
the set T = { n\V ( n ) < c } , i .e., T is the set of n such that
ALGin ) is feasible. In the following, we are dedicated to find
the minimum n* such that ALGin* ) is feasible. Namely, we
want to find n* = min
n.

^^

Lemma 2. To compute Vin ), it is sufficient to consider
decreasing price sequences with the first price p\ satisfies
P\ < min { 2 , pmax }.
pit - 1 ),
Intuitively, following ALGin ) , when pit )
OPT ( t )
OPT { t - 1 ), i .e., the optimal offline cost-plusdissatisfaction remains unchanged and thus ALGin ) will not
charge at slot t to keep n. As a result , we can delete such pit )
from the price sequence and the total charging quantity won’ t
change. For ease of presentation , in the following, we consider
an arbitrary decreasing price sequence as the following:

|

min

“

’

|

Pmax > P ( I) >

Pi 2) >

• • •

> p( T )

Pmin

-

(10)

We denote the decreasing price sequence in ( 10) as
( p ( l ) , p( 2 ) 9 ...9 p( T ) ) .

Lemma 3. For any n > 0 , we have

fo
V ( n ) = cvrln
OC

O'

-l

P max ^ TT
a~ P max

+ c^ ln

a P min
a P max

Moreover, V ( TT ) is decreasing in TT .

—

Pmim

>

n

>

Pmin

>

^ ^ Pmax -

Pmin

a

—

x

—

Pmax

?

(11)

Following Lemma 3, we know that the minimum TT* should
min
satisfy V(/r * ) = c . Since V( l ) = c + cln aa //?7max
> c and
lim^ + oo Vin ) < c, from Lemma 3, we know that n* is unique.
We plot function V ( /r ) in Fig. 2, under the setting specified
in the caption . From this figure, we can observe that Vin ) is
decreasing in TT . By solving for the equation Vin* ) = c, we
can get the expression of TT* , as summarized in the following
theorem .

5

7

—

10

6

'

Consider the following motivating example, when a =
pmax and the initial price is pmjn , from ( 13) we know
7t* > 1. According to (7 ), the output of ALG { n* ) is

n’
Pmin

6»

..

** *

5

>4
3
2
1

v( l )

O' C

- PmmCK*
Pmin

&
/p

10

max

min

a*

50 P min

100 P min

Figure 3: n* and the upper bound under the setting
where pm[ n - 1 and 9 = 5 .

Figure 2: The plot of V ( n )
for the case where pmin = 1,
0 = 5, a = 4 pmax and c = 5 .

Pmin
Theorem 4. Denote a* as the root J for equation
In && Pmax
1
Pmax
*
1, which exists and is unique. Then when a > a , we have
Pmax
&

71

Pmax

-Pmax - In
Pmax

O'

O'

&

—

Pmin
P max

(12)

‘

Otheiwvise, n* is the unique root for the following equation

n In

O'

—— —

a

Pmin

4
7T*

= 1.

(13)

{

}

Further, n* is upper-hounded by min yja / pm\ n , # and the
hound is asymptotically tight with respect to a.
Recall that 6 = pmax / Pmin To further illustrate the relationship between a and n* , in Fig. 3 we plot n* and its upper bound
sjcz / Pmin • Clearly, we can observe that n* min yja / pm[ n , #}
and it approaches 6 { = 5) as a increases. The competitive-ratio
bound gives an explicit characterization of the influence of
the user dissatisfaction consideration . Specifically, when a is
small , i.e., a e [ pmm , pmax #L tt* is upper bounded by a / pnun •
When a is large, i .e., a e (pmaxft + °° X
is upper bounded
by 6 . In particular, when a approaches infinity, the optimal
competitive ratio approaches 6 . This contrasting expressions
of the competitive-ratio bound for small and large a suggest a
fundamental difference between the problems with and without
user dissatisfaction in consideration.

-

{

^

Theorem 5. ALG ( TR * ) achieves the optimal competitive ratio
among all the deterministic online algorithms.
We prove theorem 5 by presenting the worst-case input of
ALG (7r* ) to any deterministic online algorithm fA, and show
that under this input , the competitive ratio of A. is at least TT* .
2 ) Adaptive Online Algorithm for EVCNC : In this subsection, we propose an adaptive online algorithm ALG that has the
same competitive ratio as ALG (7T* ) . Meanwhile, it improves
the online-to-offline performance ratio under general-case inputs.
From (7), we know that ALG ( 7T* ) charges just enough energy
at each slot to keep the online-to-offline performance ratio to
be no larger than n* . Following ALG (7r* ), it is guaranteed that
the EV will be fully charged with the real-time price under
the worst case input ( the input such that V ( TT* ) = c ). However,
in practice, it is more likely that we will encounter the nonworst case input. Under a general -case input, the EV is not
fully charged .

< c.

The cost-plus-dissatisfaction of ALG ( n* ) is rjl = Pmmcn* .
However, ALG( n* ) would have achieved a lower costplus-dissatisfaction if it fully charges the EV at price pmin •
Intuitively, a “ good” online algorithm will try to charge the
EV more when the price is low, i.e., being more opportunistic.
However, by design ALG ( n* ) is pessimistic: it only tries
to maintain the competitive ratio to be no larger than n\
even if for some (general -case) inputs one can certainly do
better than /r *. Thus one way to improve the non-worst case
performance of ALG( n* ) is as follows: instead of trying to
keep the online-to-offline performance ratio as jf during the
whole charging period , at time t , the online algorithm ALG
chooses a nt to maintain . This n is chosen as the smallest
attainable competitive ratio at time t , given the previous inputs
crf /1 and outputs v(r ), Vr e [ t - 1] of the algorithm, and
taking into account the possible inputs in future slots. As
compared to ALG(/r * ), ALG can adaptively change if at each
e [ L ], i.e.,
slot. Obviously, under worst case input, nt =
ALG performs exactly the same as ALG ( ir * ). Thus ALG has
the same competitive ratio as ALG { n* ). However, under nonworst case input, we have nt < n* , i.e., ALG strictly improves
the online-to-offline performance ratio.
We now present the adaptive algorithm ALG and study its
performance. At time t, ALG computes the best attainable
competitive ratio JT* . Given n* , if p( t ) a, the output of ALG
is 0. Otherwise, the output of ALG is
[7/-1 - OPT ( t )7T*\
( 14)
v( t ) =
a - pit )
where T -1 is the online cost-plus-dissatisfaction value of ALG

,

/

—

up to time t 1. From ( 14), we can observe that the structure of
ALG and ALG (zr* ) are the same, except that in ALG , the target
ratio 7i* is changing with t . The question remained is how
to determine the best attainable competitive ratio TT* ! In the
following, we are dedicated to find 7r* and study its property.
Similarly from Lemma 2, we know it is sufficient to consider
decreasing price sequences. In the following, we consider the
decreasing price sequence
defined in (10). At time t , we
denote
V,(;rr )

^

j-[ / + 1

max
:7

] eS[ ?+ 1 :7 ]

j> r = 5>
( )

T

=1

T

T

( T) +

—1

-

max[
\ ]

0 lt+ :T £

^

t+ hT ]
T

=t + 1

Note that in Vr ( /rr ) we are optimizing over a t+ l :T since the
input <xM and the output V(T), VT e [ l , t 1 ] are given at time
t . By definition , we know Vo (^o ) = V(?r), thus it is easy to
conclude that 7rJ = 7t* .

—

^ ^

Lemma 6. Under input cr T\ at time t e \T\, for any given
7Tt , we have
i- 1
/- i
- P( t )C7Tt C7 In & P min (15)
+~
Vr ( nt ) =
- p{ t ) + Tt a - pit)
a
T= 1

^

Z

6

and

Vt ( nt ) is decreasing in nt .

From Lemma 6, we know that at time t, the optimal n
should satisfy Vt (.n* ) = c. Then we can obtain the expression
for 7i* by solving the equation Vt ( n* ) - c , as shown in the
following theorem.

ALGint

*

pit ) <

Pit )
t e [T ]

Input
Distributor

1

V

.

711

=

-i

\

—

c In Oa' -ppitmin)

(16)

cp( t )

o:- p( t )

ALGO* )

pit )

Pi/

—

}

Back to our motivating example, under the same input,
from (16), we know that n* = 1. Thus the output of ALG
is c , i.e. , ALG fully charges the EV at price pmjn and
achieves an online-to-offline performance ratio of 1.

We end the discussion in this subsection by summarizing
the general technique we used for designing online algorithms,
which can be of independent interest: at each slot, the online
algorithm will try to maintain the online-to-offline performance ratio to be no larger than a target value. The target value
is chosen as the minimum possible value that the online algorithm can maintain under all the possible uncertain inputs, and
it can either be fixed (as in ALGin* ) ) or adaptively changed (as
in ALG ). The competitive ratio of the online algorithm is by
definition the target value under worst case input (for example,
the competitive ratio of ALG is max rm vm nT ). In our recent
work [20], we develop a framework named CR - Pursuit for
solving online revenue maximization problems with inventory
constraint based on similar idea.
(

B. With Charging Rate Limit
In this subsection, adapting the results from Sec. V-A, we
propose two optimal online algorithms for EVC based on a
divide-and -conquer technique. We note that the extension from
non-charging-rate-limit case to with-charging-rate-limit case is
nontrivial , and many related works [15], [16] do not consider
charging rate limit when designing EV charging algorithms.
First, we observe that when c < 1, problem EVC is
when c < 1,
equivalent to EVC c To see this, note that
nr
^
the constraint ( 1) in EVC jc becomes £ f = 1 v(0
c
1,
^
which together with v( t ) 0, implies that v(0 < 1. With this
observation, from Sec. V-A, we have the following corollary:
Corollary 8. ALGin* ) and ALG achieve the optimal competitive ratio among all deterministic online algorithms for EVC
when c < 1.
We then utilize this observation to design optimal online
algorithms for EVC when c is a positive integer. Later we
will show that our analysis can be easily extended to the
case when c is a positive rational number. Further, when c

0

2(

> 0
.
.
.

ALGO* ) > 0

i

^-1
Pi

Note that n* is a function of v (r), Vr e [ L 1 ] and ;?(r ), Vr
[ /] . It is not hard to observe that /r* < n* and /r l
IT * only
, pmax . Thus from theorem
when the initial price is min
7 , we know that ALG performs better than ALG in* ) under
general-case inputs.

^

ALGO* ) >v

" EVCc

and ift is non -increasing in t.

j

EVC2

.
.
.

/

c - Z' - v

ALGO* ) > 0

- -> EVC3

Theorem 7. At time t, we have
..

EVC\

—

_> 0

max{/ij 1 , i E [c] }

Figure 4: Schema of algorithm ALGmt . At each slot, the real time price is assigned to one sub-problem . For a particular
moment, the price p( t ) is assigned to EVCi

-

is a positive real number, we can run our algorithm with the
rational number c' that is arbitrarily close to c, and it can
be shown that the competitive ratio is arbitrarily close to the
optimal competitive ratio.
1 ) c is a Positive Integer: We now introduce our online
algorithm, denoted as ALGinl , for the case when c is a
positive integer. The main idea behind ALGjnt is divide and
conquer. Specifically, we decompose problem EVC into c subproblems, denoted as EVCj , i e [c], where [ c ] = { 1 , 2, . . . , c ) .
Each sub-problem is a problem EVC with c
1 and its
design variable at time t is denoted as V j ( t ). The real-time
prices are distributed to the sub-problems according to an
input distributor. For each sub-problem, we runs the online
algorithm ALG (/r* )8, which outputs v, (7), if assigned with an
input at slot t from the input distributor; 0, otherwise. The
outputs to the sub-problems are then combined to attain a
solution to the original problem.
We now discuss how the input distributor works in ALGini
Let p\ be the latest price distributed to EVCl up to slot t
(inclusive ). Initially, we set p 9 = a , V / e [c] . At slot t , the input
distributor in ALGjnt works as follows: when the real -time
price pit ) is revealed , compare pit ) with pf ~ l = maxj//-1 , /
p!rl , then pit ) is discarded and the output at
[c] ) . If pit )
time t is 0. Otherwise, the input distributor assigns pit ) to
sub-problem EVC /* , where i* = arg max /6[Cj pl ~ l ( we select
the minimum one if there are multiple solutions) and we must
have pit ) < p( f l . Note that at slot t , //.* = pit ) and for other
sub-problems ( / ± /* ), p\ - p\~ x .
For EVCi , denote the output at time t e [ T ] as v, (0, the
corresponding online cost-plus-dissatisfaction value as r(i and
offline optimal cost-plus-dissatisfaction value as OPT jit ). If
EVCi is not assigned a price at slot t , it does nothing (i.e.,
ALGin* ) skips this slot). In this case, we specify v/ (f ) = 0;
and OPT jit ) = OPT jit - 1 ). Otherwise,
consequently, r(i - ?
pit ). In this case, pit ) < p' ~ l (latest
assigned
is
price
a
EVCi
price distributed to EVC , up to slot t 1 ), which holds for
all the slots that EVCj is assigned a price, and thus we easily
conclude the prices assigned to EVCj are decreasing in time.
'

—

8
Or alternatively, ALG. The analysis when ALGjnt use ALG( n* ) or ALG is
the same. In the following , we only focus on the analysis when ALGjnt uses
ALGin* ).

7

Algorithms 1 Online Algorithm ALGjnt for EVC .
1: $ = a , V ? [c] ;
2: At slot t , pit ) is revealed ;
3: Set ix\ =
4: if p ( t ) > MAXJG [c] } then
v( r) = 0
5:
6: else
Assign p { t ) to EVCi* (i* = argmax/ep.] //' );
7:
Set
8:
= /7(0;
9:
Attain output v** ( t ) from EVCi* by Alg. 2;
Set v( t ) = V * (t);
10:
11: end if
“

Algorithms 3 Online Algorithm ALGrat for EVC .
l:
= a , Vi G [m];
2: At slot t , /?( /) is revealed ;
3: Set p\ = /ij.-1 , Vi G [m]
4: if /?( ) > max{/ij 1 , i G [m] ) then
*
v(0 = 0
5:
6: else
7:
A = {i, /i( 1 > p( t ) ) ; B : index set of the sub-problem
with n largest fo~ l ( break ties randomly )
8
Assign pit ) to EVCi , set p\ - pit ) , Vi e An B ;
9
Attains output vft ) from EVCi , Vi G [m ] by Alg. 2;
10
v(0 2 / [m] y/ (0;
11 : end if

_

'

“

|

Algorithms 2 Online Algorithm

.

7’

1:
= « OPT A0)
2: At Slot t ,
3:
4

5:
6:
7:

8
9:

ALGin* ) for EVCi .

= a;

Theorem 12. ALGm , is n* - competitive .
Proof: By Lemma 9, 10, 11, we have for any input cfX : T\
at any t G [ T ]

if Assigned pit ) < a then
OPTM = pit ) = p\;

[ rj f OPTiiQ
V f t ) = ' -a- pit ) ^ r .
rf. = 7/ - - id - pit ) )Viit ) ;

else

V;(

^=Z :

;'

i= 1

< /r*

^

0FT,- (f )

= n* OPT ( t ) .

i= l

We can then easily conclude ALGmt is -competitive.
Using similar technique in the proof of the optimality of
ALGiiC ) in Sec. V-A, we can show that ALGmt is the optimal
deterministic online algorithm.

0 = 0; OPT A! ) = OPT At - 1 ) ; rf = tfr ' :
.

end if

\

As such, OPT ft )
p\. Then , vft ) and r\ can be
pit )
computed following ALGin* ). An example is illustrated in Fig.
4 : at a particular time t , pit ) is distributed to EVC 2 according
to the input distributor. The output of EVC 2 is V 2 it ) , while for
the other sub-problems, their outputs are 0. The outputs of all
the sub-problems are then combined to produce v ( r ).
We summarize ALGmt for EVC and ALGiiC ) for EVCi
in Alg . 1 and Alg. 2, respectively. In the following, we
characterize the competitive ratio of online algorithm ALGmt .

Lemma 9. Following AEGint , the online - to - offline performance ratio for each sub - problem EVC; at any time t for
any real - time price sequence is upper bounded by n\ That is
for any cr :T\ rf . < TCOPTFT ) , Vi G [ c ] , Vt e [T ].

^

We then characterize the relationship between the online and
offline cost- plus-dissatisfaction values for EVC and EVC , , Vi G
[ c ] in Lemma 10 and 11, respectively.

Lemma 10. At any time t , the online cost - plus - dissatisfaction
value of ALGint . for EVC , denoted as rf , equals the summation of those of A LG in* ) for each sub - problem, i . e . , rf =
Lemma 11. Following the input distributor in ALGint , at
any time t , the offline cost - plus - dissatisfaction value for EVC
equals the summation of those for each sub - problem, i . e . ,
OPTit ) = ZU OPT ft ), Vt G [7].
The key insights from Lemma 10 and 11 are that (i )
our divide-and-conquer approach incurs no optimality loss
under both online and offline settings, and (ii ) the competitive
ratio for the overall problem should also be the same as the
individual sub-problem . These insights lead to the following
result.

^

Theorem 13. ALGi,lt achieves the optimal competitive ratio
among all deterministic online algorithms .
2 ) Extension: c is a Positive Rational Number: In this
subsection, we extend ALGint to the case when c is a positive
rational number. Suppose c = m / n . If m < n , it is equivalent
to the case without charging rate limit. We thus focus on the
case when m > n . We again apply the divide-and-conquer
approach. First , we define m sub- problems, denoted as EVCi ,
i G \m\ . Each sub-problem is a problem EVC with c = l / n .
Each sub- problem also runs Alg. 2. The input distributor
works a little differently. Specifically, when a price pit ) is
revealed at slot t , we compare pit ) with [ p f l , i G [ m ] } . If
pit ) max{/i(-1 , / G [ m ] ) , then pit ) is discarded and v( / ) is set
to be 0. Otherwise, let A = { i, // J 1 > pit ) ) , which represents
the index set of sub-problems such that pl ~ ] > pit ) . And let B
be the index set of the sub-problems with n largest p!~ 1 ( break
ties randomly ). Then pit ) is distributed to EVCi , Vi e An B .
Namely, we distribute pit ) to at most n sub- problems with
higher pf 1 (compared with pit ) ) . We set v ( t ) = Z / [mj vi ( 0 This is to make sure the online (resp. optimal offline) costplus-dissatisfaction value at time / is always the same as the
sum of online ( resp. optimal offline) cost-plus-dissatisfaction
value of all the sub-problems. The algorithm for EVC when
c = m / n im > n ) , denoted as ALGrat , is summarized in Alg. 3.

_

Theorem 14. ALGrat is n* -competitive and it is optimal
among all deterministic online algorithms .
VI. PERFORMANCE EVALUATION
A. Evaluation Setup
We consider a residential user with an EV, who has enrolled
in the real-time pricing ( RTP) scheme. The real-time prices are

8

-

.2 3 5
a

o 1 *95
CO

“c =

1.9

ALG( TT )
= ALG

/3
C/3

CC

3

.2

2.5

.2

= 2.5

0

9C/3 1.85

Q

S

Sc 1.5

'

''

-

-

RHC 0

-

--

RHC 4 w Naive

do
'

1.8

/3

o

O

— ALGint _

O

1.75

100

50

min

max

10 P min

20 P min

min

max

10P

min

20P

min

t

Figure 5: Empirical Costplus-Diss. ratio of ALG ( TT * )
and ALG in different slots.

Figure 6: Empirical and theoretical Cost-plus-Diss. ratio of ALGint .

Figure 7: Percentage of
charged of ALGint and OPT
with varying a.

Figure 8: Averaged Costplus-Diss. ratio of different
algorithms with varying a.

2.5

updated every 5 minutes and thus the length of each time slot
is 5 minutes in our simulation. We obtain the 5-min real-time
prices (from June, 2017 to June, 2018) from ComEd in Illinois,
USA [21 ] . In practice, the real -time prices can be negative, as
we can observed from the data. However, we note that these
abnormal prices seldom occur, for example, the percentage of
negative prices within a year is less than 3%. In our simulation ,
we only focus on the normal-price setting and we preprocessed
the real-time price data by eliminating the largest 5% and
smallest 5 % prices within the year. After preprocessing, we
1.3 (cents/kWh ) and 9 4.54 for the one-year
have pmin
price data . We consider a scenario where the EV owner park
the EV from 5pm to 8am . The EV has a charging power of
8.8kW and it can be fully charged in 2 hour [22], if we assume
a daily commute of 100km. Namely, we have c = 24 and
T = 180.
B. Evaluation of Online Algorithms

.

ALG (;r* ) VS ALG . Analysis in Sec. V-A shows that
ALG( n* ) and ALG has the same competitive ratio. Meanwhile,
ALG performs better than ALG ( n* ) under general-case inputs.
To compare their performances, we relax the charging limit
constraint in EVC and run the simulation using the real-time
price data . We plot the empirical online-to-offline cost-plusdissatisfaction (denoted as Cost-plus-Diss.) ratio at different
slots in Fig. 5. From this figure, we have the following two
observations: i ) the empirical cost-plus-dissatisfaction ratio of
ALG( n* ) is fixed over time. This is reasonable because by
design , ALG ( JR* ) will try to keep the ratio to be TC at each slot ;
ii ) the empirical cost-plus-dissatisfaction ratio of ALG is nonincreasing in t and it is always smaller than that of ALG{ jC ).
This is because ALG can adaptively change the target ratio
7it and nt is non-increasing in t . These observations verify
our results in Sec. V-A and demonstrate the superiority of
algorithm ALG over A LG ( 7C ) .
Cost-minimization VS. User Dissatisfaction. The EV
owner can adjust a to strike a balance between cost minimization and dissatisfaction. On the one hand , if a is small,
the EV owner prefers to charge the battery at a low cost and
can bear the risk of not being fully charged for the EV. On the
other hand, if a is large, the EV owner prefers to charge the
EV more, despite of potentially high prices and consequently
large charging cost . We conduct simulations to understand the
impact of a.

HALGini[]RHC-o[]Naive
CC

2

0.45

C/3

0.4

do

0.35

C/3

o

1.5

Q.

o

O

ALG int
OPT

0.3

I

0.25
0.5

Spring Summer Autumn Winter

Figure 9: Cost-plus-Diss.
Ratio of ALG / nt , RHC -0 and
Naive online algorithm.

1

1.5

Charging Rate Upper Limit

Figure 10: Averaged daily
Cost-plus-Diss. of ALG int
and OPT .

Let us first see how a can affect the performance of ALGint ,
as suggested by our analysis in Sec. V-A. In particular, we vary
a in [ pm\n , 20 pmm ] and plot the averaged empirical cost-plusdissatisfaction ratio of ALGint ( where each sub- problem runs
ALG ) and its theoretical competitive ratio if in one year in Fig.
6. We can observe that the empirical cost-plus-dissatisfaction
ratio of ALGi,lt is much smaller than n\ as in practice the
worst case input seldom happens. Meanwhile, both curves
grow sublinearly as a increases, i .e., large a degrades the
empirical online-to-offline performance ratio for ALGml . These
observations are aligned with our theoretical results in Theorem 4 and 12. Note that the online-to-offline performance ratio
can be interpreted as the performance improvement if future
prices are given in advance. Thus this result also highlights
that knowing future prices can lead to bigger performance
improvement in the case of not considering user dissatisfaction
( a is large ) than otherwise .
We then investigate the impact of a on the charged percentage, i.e., Yut=\ v(0 / c, at the end of the charging period.
Intuitively, we would expect a large (resp. small ) charged
percentage if a is large (resp. small). Indeed this is the case, as
we can see from Fig . 7, which shows the charged percentage
( % charged ) of ALG\nt and optimal offline algorithm OPT .
The charged percentage of ALGint grows as a increases. In
particular, when a = \ 0 pmm , ALGmt charges around 95% of
the requested capacity c.
Comparison with Alternatives. We compare the performance of ALGint with other conceivable alternatives. One is
the Receding Horizon Control ( RHC) [23] with look-ahead
window size n e Z + (denoted as RHC -n), i .e., at time t ,
given the prices from slots t to t + n , RHC -n optimizes over
these slots and executes only the action at the current slot. In
particular, RHC -0 in our scenario corresponds to the online
'T'

9

strategy of charging the EV at the maximum rate in each slot,
regardless of the price. Thus RHC -0 can be regarded as our
online algorithm ALGint with a being infinitely large. Besides
RHC, we also compare our algorithm with a naive threshold based online algorithm, i .e., the EV owner sets P max 2U^ min as the
threshold and charges the EV whenever the price is lower than
the threshold . We plot the empirical cost- plus-dissatisfaction
ratios of different algorithms in Fig. 8. From this figure, we
can observe that when a is small , ALGmt outperforms other
algorithms. However, large a degrades the performance of
ALGim • Intuitively, this is because in our model, we assume T
is unknown . Thus ALGint will try to reserve some capacity for
the future good prices. When a is large, ALGinl will then suffer
a large user dissatisfaction as the EV is not fully charged .
In Fig. 9, we fix a
/?max , and plot the empirical costplus-dissatisfaction ratios in different seasons. We can observe
that our algorithm achieves substantial performance gain as
compared to the alternatives in all the seasons. Moreover, we
note that the online-to-offline performance ratio of ALGmt is
upper- bounded by /r* , which is better than that of RHC and
the naive algorithm.
Impact of Charging Rate Limit. In practice, an EV owner
may face the question of whether to have a fast charger (large
charging power) or a slow charger (small charging power).
To address this question , we vary the charging rate upper
limit in our simulation and study the average daily costplus-dissatisfaction value under different charging power. In
particular, we very the normalized charging rate limit from
0.5 to 1.5 ( i.e., the charging power of the charger varies
from 4.4 kW to 13.2kW) and the results are shown in Fig.
10. We can observe that with fast charger, both optimal
offline and ALG\nt have a lower daily cost- plus-dissatisfaction
value on average. Meanwhile, increasing EV charging rate
limit decreases overall cost almost linearly. Intuitively, this
is because a fast charger provides more flexibility, i.e., the
algorithm can charge the EV more (resp. less) when the price
is low (resp. high), incurring a lower cost- plus-dissatisfaction
value as compared to the slow charger case .
~

REFERENCES
[ 1] P. C. Beiter, M . A. Elchinger, and T. Tian , “ 2016 renewable energy data
book,” National Renewable Energy Lab.( NREL), Golden , CO ( United
States ), Tech. Rep., 2017.
[ 21 T. Mai, D. Sandor, R . Wiser, and T. Schneider, “ Renewable elec
tricity futures study executive summary,” National Renewable Energy
Lab.( NREL ) , Golden , CO ( United States), Tech. Rep., 2012.
L 3] S. Borenstein, M . Jaske, and A. Rosenfeld, “ Dynamic pricing, advanced
metering, and demand response in electricity markets,” 2002.
[ 4 ] F. E. R. Commission , “ Assessment of demand response & advanced
metering staff report . 2017,” 2017.
[5] Navigant Research , “ Electric vehicle market forecasts,” Internet:
https://www. navigantresearch.com/, 2018.
[6] K. M. Tsui and S . C . Chan, “ Demand response optimization for smart
home scheduling under real time pricing,” IEEE Trans. Smart Grid ,
vol. 3, no. 4, pp. 1812-1821, 2012.
[7] F. Kong and X. Liu , “ Distributed deadline and renewable aware electric
vehicle demand response in the smart grid ,” in Proc IEEE RTSS , 2015.
18 ] “ Historical Weather in Chicago, IL,” Internet: https://goo.gl/qahg3T,

-

,

-

-

.

2018.
[9] R. Deng and H. Liang, “ Whether to charge an electric vehicle or not ?

-

a near optimal online approach,” in Proc. IEEE PESGM , 2016.
[ 10] R. El Yaniv, A. Fiat , R . M . Karp, and G . Turpin , “ Optimal search and
one way trading online algorithms ,” Algorithmica , vol . 30, no. 1, pp.
101-139, 2001.
[11 ] H.
Q.
“ Balancing
Chen ,
and
cost
M.
Yi ,
Lin ,
and
in
dissatisfaction
online ev charging under real
[Online].
pricing,”
Rep.,
time
Available:
Tech.
2018.
https://www.dropbox .eom/s/cnl 4ruo7 kd 8aiO/OnlineEVCharging.pdf
[ 12 ] S. Shao, M. Pipattanasomporn , and S . Rahman , “ Grid integration of
electric vehicles and demand response with customer choice,” IEEE
Trans. Smart Grid, vol. 3, no. 1 , pp. 543-550, 2012.
[ 13] Z. Tan , P. Yang, and A. Nehorai, “ An optimal and distributed demand
response strategy with electric vehicles in the smart grid ,” IEEE Trans.
Smart Grid , vol . 5, no. 2, pp. 861-869, 2014.
[ 14] L. Gan , U . Topcu, and S. H. Low, “ Optimal decentralized protocol for
electric vehicle charging,” IEEE Trans. Power Systems , vol . 28, no. 2,
pp. 940-951 , 2013.
[ 15 ] E. Bitar and Y. Xu. “ Deadline differentiated pricing of deferrable electric
loads,” IEEE Trans, on Smart Grid , vol . 8, no . 1 , pp. 13-25, 2017.
[ 16 ] S. Zhao, X. Lin , and M. Chen , “ Peak minimizing online ev charging:
Price of uncertainty and algorithm robustification ,” in Proc. IEEE IN FOCOM , 2015.
[ 17 ] L. Guo, K. F. Erliksson , and S. H. Low, “ Optimal online adaptive electric
vehicle charging,” in Proc. IEEE PESGM , 2017.
[ 18] W. Tang , S. Bi, and Y. J. A. Zhang , “ Online coordinated charging
decision algorithm for electric vehicles without future information ,”
IEEE Trans. Smart Grid , vol. 5, no. 6, pp. 2810-2824, 2014.
[19] R . Deng and H. Liang, “ Whether to charge or discharge an electric
vehicle? an optimal approach in polynomial time,” in Proc. IEEE VTC-

-

-

-

- -

Fail , 2017 .

VII. CONCLUSION

In this paper, we investigate the online EV charging problem
under real-time pricing, where neither accurate prediction nor
distribution of future real-time prices is available to users
when making online charging decision. We take into consideration the user dissatisfaction and propose two optimal
deterministic online algorithms. The theoretical competitive
ratio of our proposed online algorithms is upper bounded by
min { yja / pmjn , Pmax / Pmm > and their empirical online-to-offline
performance ratio are shown to outperform other conceivable
alternatives, through extensive simulations based on real-world
traces.
In terms of future work, there are several directions to
explore. First, solving the problem with known T is an
interesting direction. Second, it would be interesting to develop
online algorithms with minimum commitment, i.e., the online
algorithm can guarantee a certain charged percentage at the
end of charging period .

}

[20] Q. Lin , H. Yi, J . Pang , M . Chen , A. Wierman , M. Honig, and Y. Xiao,
“ Competitive online optimization under inventory constraints,” ACM
Transactions on Modeling and Performance Evaluation of Computing
System , 2018.
[ 21 ] “ ComEd real time price,” Internet: https:// hourlypricing.comed .com/ hp
api/, 2018.
L 22] M . Yamauchi, “ Tesla Charging: the Complete Guide to Charging at
Home, in Public and Autonomously,” Internet: https://goo.gl /HV14tU,

-

-

2018.

[ 23] H. Michalska and D. Q. Mayne, “ Receding horizon control of nonlinear
systems,” in Proc. IEEE CDC , 1989.

10

VIII. APPENDIX

^

Secondly, note that p( 1 ) < min{ , pmax }. Then V ( n ) can be
expressed as

A. Proof of Lemma 2
Proof: Since ALG( n ) outputs 0 whenever p{ t ) > a , it
is sufficient to consider the input o~ [ 1 :Ti that satisfies p( r ) <
we have OPT ( t ) = pTminc. For ease
a ,Vr e [ T ] . Given
of presentation , given any n , define t\ - min{ t\OPT ( t ) < ).
From (7), we know that the output of ALG ( n ) , denoted as
v(r ), r e [ T ] , can be expressed as
v ( r) - i

0

rf ~ x OPT { T )JT
V a p( T )

_

-

, Vr < t\
, Vr t\ ’

V ( n)

^

It is easy to check that f ( x ) obtain the maximum at x
Then we have

^

f

=
=

?

'

(

O

V\n ) - c In

Pmin

O'

c(ln

O

-

-z

1

c
71

^

~

a
> 1 - z for any z

1

ac - p{ 1 )CTI

T

a - p( r - 1 )

+
T

a - P( T )

-2

)C7T

Firstly, note that for any r e [2, T ] , we have

=

—

-

-

-

Then we know that given /? (!) and p( T ), we have

z< >

a - p(r - 1)
)
a - p( r )

=2

=

In

O'

- PGO

a - pi} )

Thus we can re-express V ( n ) as the following

ac - p( l )C7T
a - p( T )
V( 7 T )
max
+ C7T In
p( l ),p( D or - p( l )
o - p( l )
ac - p( l )C7T
, a Pmin
= m(ai )x a p( \ ) h C7T In —
( )
P

-

—

1

))

-1

71

n-

1

71 -

( 18)

1

1

)+

71

—

—

Of
pmin
Pmax ^
+ In
“
a ~ Pmax
Pmax
Pmax ( l ~ 0 ) Pmin
O

—

< 0.

a-p l

71

when

^

>
®

C. Proof of Theorem 4
Proof: We know that /f is the unique solution to the
equation V ( JT* ) = c. Further, we have
a
a Pmin
c In
.
V( - )
O ~ Pmax
P max
Pmax
2- ) is decreasing in a . From the
It is easy to check that W -Pmax
2- ) < c, then a >
monotonicity of V (7r ) , we know that if V( P max
7iPmax , otherwise we have a < 7r /?max . Denote a* as the root
a* )
for equation -Z ln ® Pmin 1 , then we have V ( Pmax
- c. Now
Pmax
Pmax
*
when a > a , we know V( -P max
^- ) < V ( Pmax ) = c, then /r* should
satisfy

^

cr - /?(r - 1 )
a p( r )
< In
a p( r )
a p( r 1 )

r-i ) T

1

71

Pmax
Thus we know that V ( /r) is also decreasing in
Pmax •

= max
a - p i1)
a- l 1:71

T

)+

0, we have

71

<

] v( r )

-

1
71

1
ln ( l - - ) > !

V'(7T)

r= 1

1-

1

Pmin - ( (
ln l

^

VW = max

~

> 0.
1
It then follows that V' ( n ) < 0, thus V { n ) is decreasing in n
when 2 < pmax . When 2 > pmax , we have

T

/?(2),p(3),...,p(

Pmin

O'

71

Then we have

max

•

ln( l

1 ) - p( r )
C7T
a - p( r )
a - p(r - 1 )
)C7T.
(1 a - p(r )
P( T

=

Thus

and for all r e [2, T ] ,

v( r )

O'

C7i In

-

n — Pmax
-2
YC Pmdxc 7T
P min
,
cn
In
+
a- p max
P max
^ ^ Pmax
It then remains to prove that V ( n ) is decreasing in n. When
Pmax , we have

V (n)

Proof: From (7), under the input <x[1:r ] , we know that

ac - p( l )C7T
a p( 1 )

—

(17 )

Since In

=

ac - xc7t
O
P min
+ C7Tln
a X
a- x

*< min{

^

B. Proof of Lemma 3

v( l )

max

’

=

.

^

fM

J ,/>max }

Taking the derivative w.r.t. x , we get

and we have T/ i 1 = ac and if = OPT (J )TI ,VT > t\ Namely,
for any n , when r < t\ , the output of ALG ( n ) is zero until
t = t\ . Thus the summation of outputs of ALG ( n ) in cr , : rj is
equivalent to that in cr [ l :T\ Denote the first price in cr [ h :T as
pi , we have p\ = /7 ( 1 ) < rnin{ , /? max }. When T > 11 , from
( 17 ) and (4), we know that the output of ALG ( n ) is positive
only when the current price is the lowest price that appear so
far. Thus we can delete the slots when the output of ALG ( n )
is zero and the resulting price sequence is decreasing.

^

max

A < min{

—

—

—

O
max
V ( n ) = - P ^ c + c n* I7 n
O'
O
Pmax
Solving the linear equation we get

—

Pmax
O'

71

Pmax

a Pmax

Pmax

- In

W

P min
Pmax

Pmin
Pmax

= c.

11

When a

rJ

exist , otherwise we have at time T , Zr = i
is a contradiction. Then we have

a\ we have
V ( n* ) = of In

pmin

&

= c,

a - 7—T*

_

thus n* is the root for the equation n* lnaa f ?. " = 1 .
nt
It then remains to show that 7r * is upper bounded by
min{$, y Pmin }. Firstly, when o' > a* , we have 7T* < -"gmax
— . One
can easily check that if defined in ( 12) is increasing in a.
Further, we have

/

lim n*
CO

=

Z—

Pmax

O'

•

Pmax

^
^ ^
2—
^—

=

&

Pmax
P min

a P max

a
P max

]

= 6.

<0=

Pmax

&

&

P min

a

<

^

Pmin

a- 4
7T*

= e*

*

fgn

a_

-

n*

where the inequality follows from the fact that > x + 1 , Vx G
. This
R. Solving the above inequality, we get if <
\ Pmi
completes our proof .

\

T

- p( T))V(T) - (or - p(0)v (0,

^

—1

^

where 77 is the cost-plus-dissatisfaction of PA at time f .
However, from ( 19), we know v ( f ' ) < v( P ) and thus we have

p > ac —

^

t'

^

(a - P( T)) V( T)

= OPT { t’ )n .

r= l

Thus the competitive ratio of Ph should at least be if .
It follows that PI must coincide with ALG( n* ), achieving a
ratio of /r \ or otherwise
incurs a higher ratio on cr l :T\

^

/n

D. Proof of Theorem 5

Proof: Consider an arbitrary deterministic online algorithm different from ALG( n*), denoted as PH . Using an ad versary argument we show that PH cannot achieve a ratio
smaller than if . For PH and ALG ( n* ), denote the output at
time t as v&( t ) and v ( t ) , respectively. For ease of presentation,
denote <x|1:r ] = ( p( l ) , p( 2 ) , p( T ) ) as the worst case input
for ALG( n* ), i .e ., under this input, we have
=\ v( t) = c •
According to Lemma 2, we must have min { ,
> /5( 1) >
• • • >
(
)
)
2
.
T
pmin
>
Pi
P
We present /?(1 ) to TA at the first slot. If v ( l ) < v ( l ),
^
then we end the charging period, i .e ., T - 1. In this case, the
competitive ratio of LA is at least n* . Otherwise, if v ( l ) > v( l ),
^
we continue to present p{ 2 ) to TA. In general , if at time
charged is no larger than
t the total amount of energy
T/t=\ v( tX we immediately end the charging period. Otherwise,
we continue and present LA with the next price. Let t' be the
minimum t such that at the end of time t , the total amount of
energy 3\ charged is less than Y /T = ] Kr) We note that t' must

-

( 19 )

-

1
—/r* + 1,

^

v( r ) .

1

t' l

rfn > ac -

n* ‘ Taking the

ex

T

vft

Pmin ^*

—

Secondly, when a < a* , we know In
exponential on both sides, we have

^

Since p( r ) are decreasing in r, TA would have achieved a lower
cost -plus-dissatisfaction by charging exactly v(r ) for any r G
[r' - l ] and by charging
v(r )
’ ) - vAt' )+ lfr=
at time P . Namely, we have

7T*

0

v (r )

r= l

v - (r) <

1

T

- < 0, when cr G (ar* , pmax0). When
< yM
Pmin
a
> P, we know ;r* < $ is a tighter
Pmax #, Since
Pmin
bound . In conclusion , when a > a* , n* is upper bounded by
So we have

—

^

1

t'

Pmax

Namely, when a > a* , n* is upper bounded by 0. In particular,
when cr G (o'*, pmax #X we can have a tighter bound. Recall that
when a > a* , we know rf <
it then follows that
/

P-1

v (r) >

Pmax P min

Pmin

O'

*

-

v( r )

=1

and by the definition of \
t we have

1

lim
Pmax
Pmin

O'

T

/' 1

T

(1 -

2

*(T) >

V<

1

T

1

lim

v ( l ) > v( l )
*

2

~

T

^ (T) > Zr = i V(T) - c

V

E. Proof of Lemma 6
Proof: We first show the expression of Vt ( nt ). Given any
717, we know that the output at time t + 1 needed to maintain
the online to offline cost-plus-dissatisfaction ratio to be nt is
v( / + 1 )

=

if

—-

p( t + 1 )cnt
a pit + 1 )

and for any r > t + 2, we have

YJt
pmaxJ

a - p(r )
p( r - 1) - p( r)
< cjt In
cnt
cr - p(r )
a - p( r - 1 )

,

=

v( r)

Then given any p( t + 1), we have
T

max

Z

V{ T

rf

)

T -t + 1

—-

p{ t + 1) C7T,
&
Pmin
+ cnt In
)
a pit + 1
a - pit + 1)

It then follows that
T

(

m a x]

J -U+ UT

r
Zv
=

( )

T

t+ 1

max

p( t +\ )< p( t )

rf

- pit + 1 )cnt + C7Tt In & P min
a - pit + 1 )
a - pit + 1 )

12

——

,

a
( )
+ cn In -a Pmm
x • We have h' x Note that we have
Thus h( x ) obtain the maximum at x =
rf - p( t )cnt , thus we know that

Define h( x )

rf xcnt
a x

=

—

-1

T

l

——

Vt ( nt ) = t/ J v( r ) + v(f ) + amax
- t+ \ J
T

[

v
Z
=

]

1

T

Y= v r) + iit + r, In
(

)

r 1
t-1

(t )

t+ 1

C7

C7T

,

t-1

'

T

T

We then show that Vtint ) is decreasing in nt . Note that Vtint )
is a linear function on nt and the first order derivative is

Pit )

Pmin

O'

a - pit )

^

-

V ,( r ) + 2 a-- ppit( t ))C7T- + cnt In Oa - Ppitmin)
—1
c In

H. Proof of Lemma 10
Proof: Firstly, we claim vf ) = fi= ] vft ) , Vf e [ T ] . To see
this, consider the following two cases:
Case I, the condition at line 4 in Algorithm 1 fails and pf )
is assigned to a EVCi . In this case, vf ) = vft ) and for any
other EVCi , vft ) = 0. So vf ) = Jfi= l vft ).
Case II, the condition at line 4 in Algorithm 1 holds and
pit ) is not assigned to any EVCi . In this case, v( t ) = 0 and
for any EVCi , vft ) = 0. So vf ) = ZLi v / (0
Secondly, observe that at time t , by definition, we have

v' = Y PCPC ) + a \ c T

—

1

t

C

Y—

a - pit )

a
a - pit )

a

- 1 > In a - pit )

> In

&

P min .

a - pit )
It then follows that Vtint ) is decreasing in nt .

( 20 )

F. Proof of Theorem 7

we have
Proof: Since Vt ( nt ) is linearly decreasing in
* in (16). It
we
can
of
Then
the
c
n
.
get
expression
Vti =
then follows that , for any n* , and
we have
7r* )

_

V T.- i

-

t 1

«

EJ v Y + cn a - pit - 1) = c ,
c.
ytiK ) = YJ v( ) + cn ln —
V
‘ a - pit ) =
_i) =

( )

*
-

t

*

T

“

—a - Ppit ) cn , a - pitPmm- 1)
!) _ , - pit )n
< — ) + nt In —aa - Pmm
pit )
a - pit
min

0 = v(0 + cn* ln

Pit ~

-

*

*
t

— n, , ,ln a — pitPmm- 1)
Pit - 1 )<_ - p( t )
+
« - <_ , In a - Fmin
pit )
a - pit )
*

&

1

®

)

!

7T *

a - pit )

a- p ( t )

1)

int - nt _ i
,

*

*

{

VI
) \n

a

-& - Ppitmin)

a - Pit )

pit )
Pmi n
~ a pit ) ,
a pit ) <

From ( 20) we know that ln for any t e [ T ] , n* n* { .

_

-

_

c

El

1

1

) > 0.

then we must have

G. Proof of Lemma 9

Proof: As each EVCi follows ALGin* ) if it’ s assigned
with a price and remains unchanged otherwise, from Corollary
8, we easily conclude it .

1

c

\\

, ( r ) = Ejr>z

V

r= l

//

/

’

=1

This completes our proof .
I. Proof of Lemma 11
Proof: For ease of presentation, we present the proof for
the case that pir ) < a , Vr e [ T ] . The case that there exist
p( r ) a is trivial, since both OPTir ) and OPTi( f ) ,Wi e [ c ]
remains unchanged at time r.
Firstly, note that when pir ) < a , Vr e [ T ] , we have Tta = [ t ]
[ T ] , thus the set Tt Pi Tf - Tt . Namely, it is
for any t
sufficient to consider the set Tt .
Initially, OPTiO ) = ac = Zci= l a = £ -= 1 OPTf 0).
When t c , we know that Tt - [ t ] . The offline cost-plusdissatisfaction can be expressed as

Y— ,Pir x 1 + aic - Y= !
)

T

_

)•

1

T

I

Meanwhile, following ALGint , it’s easy to see that at slot t < c,
i* = arg max /e[c] p\r 1 = t as a > P ( T ) ,VT e [7], and thus pit )
is assigned to EVCt . As a result, if i < t , OPTft ) = pii ) as
EVCj is assigned with pii ) only up to time t ; if i > t , EVCj
is not assigned any pit ) yet and OPT ft ) = OPTfO ) = a as
EVCi haven ’ t been assigned with any price. Thus we have for
any t < c ,
(i ) + «

Y1

i=t + 1

ZpiT ) X 1 + aic - Y

pit )

O'

+a 1

=1

i i

pit 1 )
> 1 - aa-- pit-) , we have

( r)
Z— ZVi
=
T

Y OPT ,in = Y= p

iin a - pit - 1)
Since ln

T

O!

1

+ a c-

=

OPT it ) =

Subtracting the above two equations, we get

1

t

fj PtoViW
/= 1

—

/ 1

c

It is easy to check that
pit)
a - pit )

fjvi <T >

p( T >

1

T

T

= OPT { t ).
T= 1
=1
When t > c , we know that OPT it )
TJTGT, P ( T ) - We also
have OPTif ) = pi . It’s then sufficient to show that multiset
T

^

{ p f e [ c ] } = { pir ) , r e Tt ).

\

( 21 )

We prove it by mathematics induction. At slot t - c, p\ p f ) ,V i e [ c ] and Tt = [ c ] as there are exactly c input prices.
So we know ( 21) holds for t - c. Suppose at time t - 1, we
have { pr ~ lJ [c] j = jp(r ), r Tt ~\ ) . Then at time t , consider
the following two cases:

13

Case I: pit ) > max{ p!~ { , i G [c]}, or equivalently, pit )
max{ /?(r ), r Tt - \ }. Tn this case, we know that Tt = Tt ~ \ and
the price pit ) is discarded according to the input distributor in
ALGjnt . Thus we have p\ - plf ] for all i G [ c ] . Then we know
that (21 ) holds for t as well in this case.
Case II: pit ) < maxjyuj-1 , / G [c ] }, or equivalently, pit ) <
max{ /?(r ), r G T -\ } . According to the offline solution, we
know that

It is easy to check by contradiction that period t' must exist.
Then we have

^
X '^

v ( l ) > v'( l )

2

,

{ /7 ( r ), T

G

Tt } = { pirlre Tt- i ) - { /2 (f )} + { pit ) } .

^

J

Jr

,

{ p( T ) , T 6 T \

X v'(

t)

r= 1

t'

v' ( r )

*

X= v'

( 22)

(t ) -

r l

^

1C

X v^ ’
f)

=-

t ( i l )c+\
ic

Y- m

t=( i. l )c+ l

Namely, v' fi ) and v'(0 are the accumulate output from t =
ii - l )c + 1^ to ic for 3ft and ALGjnt , respectively. We say [( / 1 )c + 1, ic ] as period /, obviously, i G [ T ] . We first present the
If v'?1( l ) < v'( l ), then we end the charging
input cr[1:c] to
period, i.e., T = 1 xc. In this case, the competitive ratio of 3ft is
at least n* . Otherwise, if v ( l ) > v' ( l ), we continue to present
a- Lc+ i ’2cJ to 3ft . In general, if at time i x c the total amount of
energy 3ft charged is less than Xr = i y (TX we immediately end
the charging period. Otherwise, we continue and present 3ft
with the sequence of prices in next period , i.e., <r[ ic+ 1,(i +1)c]. Fet
f be the minimum period t such that at the end of time t' x c ,
,
the total amount of energy 3ft charged is less than Xr= i y (T)

^

-

Since (r ) are non-increasing in r,
would have achieved
a lower cost-plus-dissatisfaction by charging exactly v' (r) for
any r [f' - 1] and by charging vT f' ) = v',n ( i' ) +
v (r ) / '- i
)
'
(
we
v
have
,
r
period
.
for
Namely
'
r
T= 1

/

-

^

^

z

-

/' i

^
T

co =

t)

1

and by the definition of \
t we have

r l

^

v'

1

X=

Proof: The optimality is proved as following. It’ s similar
to the proof of the optimality of A LGin* ) in the non-charginglimit case. Consider the worst case input for ALGin* ) in the
non-charging-limit case, denoted as <x[1:7X Under this input,
we have Vin* ) = c . Base on a[ l :T\ we construct another input
by repeating each pir ) , r G [T ] in <rri : r] for c times. Denote
the new constructed input as cr[1:c7X It is obvious that under
cr l :cT\ the EV will be fully charged under the online algorithm
ALGjnt . Namely, a- L 1:c7J is the worst case input for ALGmt in
problem EVC .
Now consider an arbitrary deterministic online algorithm
for EVC , denoted as 3ft . Using an adversary argument we
show that 3ft cannot achieve a ratio smaller than n* . For 3ft
and ALGint , denote the output at time t as v ( t ) and v(f ),
^
respectively. For ease of presentation, we define

^

X= v'(

T

t' i

X= ^

> crc -

=

-1

T

J. Proof of Theorem 13

(0

f

i'

= {juJ-1, i 6 [c] ) - { />( /* ) } + { pit ) }
e [c] ) - { u’/T 1 } + { pit ) }
=
- iiu'i , i e Ml,

where the last equality follows from the input distributor in
ALGjnt as it distribute pit ) to EVCj* . We conclude that (21 )
holds for t as well in this case.

V

-\

v’ ( r ) >

-

_

where i* = arg max
, /?(r ). Since (21 ) holds for t 1 , we
have maxT 7-; 1 p( r ) = maxz 6[ Cj // 1, or equivalently, pi? ) =
1
. It then follows that
yL/

T

2

(r ) >

(a

^ ^ it' ,

- P( TC)) V'(T) - (or - pit' c v

=1

)

where
is the cost of 3ft at the end of period f . However,
from (22) , we have
v (0 < v (0

*

and thus we have
f

TJ

^

> ac -

^
T

—1

( cr - /7(rc)) v (r )

= OPTit' c )n* .

Thus the competitive ratio of 3ft should at least be n* .
It follows then that 3ft must coincide with ALGjnt , achieving
a ratio of n* , or otherwise 3ft incurs a higher ratio on input
m
Q-W CT\

-

