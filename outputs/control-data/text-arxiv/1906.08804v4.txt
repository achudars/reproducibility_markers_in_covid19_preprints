arXiv:1906.08804v4 [cs.NE] 30 Jul 2019

Derivation of the Variational Bayes Equations
Alianna J. Maren
Themasis Technical Report TR-2019-01v4 (ajm)
alianna.maren@northwestern.edu
alianna@aliannajmaren.com
July 31, 2019
Abstract
The derivation of key equations for the variational Bayes approach
is well-known in certain circles. However, translating the fundamental
derivations (e.g., as found in Beal (2003)) to the notation of Friston (2013, 2015) is somewhat delicate. Further, the notion of using
variational Bayes in the context of a system with a Markov blanket
requires special attention. This Technical Report presents the derivation in detail. It further illustrates how the variational Bayes method
provides a framework for a new computational engine, incorporating
the 2-D cluster variation method (CVM), which provides a necessary
free energy equation that can be minimized across both the external
and representational systems’ states, respectively.
“Do you understand this?” she demanded. ...
“It seems simple enough,” he said after a moment.
“I knew it,” she muttered, crossing her arms. “I knew it was written
in male.”
Heir to the Shadows: Book 2 of the Black Jewels Trilogy
Anne Bishop (1999), p. 214 (Trade edition).

1

Introduction

Friston (2010, 2013, 2015)[1, 2, 3] has proposed that free energy minimization serves as a unifying theory for describing neural dynamics.

1

He further suggests that statistical thermodynamics can model neuronal systems, drawing on the dynamic properties of activated neuronal ensembles [3]. This elegant and fascinating notion depends on
the use of the variational Bayes approach, together with the idea of
a Markov blanket which separates an internal computational (“representational”) set of units from external ones.
While this approach is certainly attractive, it is potentially difficult for many readers to follow the translation from one of the earlier
presentations of variational Bayes (by Beal (2003) [4]) to the equations
used by Friston (op. cit.).
One could attempt a singular explanation that cuts across all presentations of variational Bayes and the free energy principle in their
primary sources. However, this particular treatment offers a careful
deconstruction of the ideas and formalism as they were originally articulated. As such, it serves as a Rosetta stone, not just for the ideas,
but also for the meaning of variables and operators. This is not as
easy as it may seem; for example, H could be read as enthalpy in
thermodynamic treatments, while it stands in for entropy in purely
information theoretic treatments.
In what follows, we will address the meaning of each variable explicitly and note any instances of overloading (i.e., the use of the same
variable to mean two things). To help in this regard, Section 2 includes
a glossary of the thermodynamic variables in this paper, along with
a brief description. Section 3 includes a glossary of the additional
information-theoretic notions.
Thus, this Technical Report serves as a mini-tutorial, carefully
delineating how the free energy equations presented in Friston (op.
cit.) correspond to the detailed derivations presented in Beal (2003),
which were originally presented in Feynman [5] and in Hinton and van
Camp [6]. It identifies how - although the equations may seem formally
identical - there are certain key differences in the two presentations.
Further, it addresses the notion of terminology, carefully identifying
what certain terms actually mean, regardless of how they have been
described by various authors in different works.
A further intention of this work is to facilitate a new computational
engine. Such an engine would make use of not only Friston’s notion
of a set of computational (representational) units separated from an
external system by a Markov blanket, but also follow the variational
Bayes (free energy minimization) approach described by both Friston
(op. cit.) and Beal (2003).

2

In brief, Friston proposes a computational system in which a Markov
blanket separates the computational (representational) elements of the
engine from external events, as shown in Figure 1. The communications between the external system elements (denoted ψ̃) with those
of the representational system (denoted λ or r̃) are mediated by two
distinct layers or components of the Markov blanket; the sensing (s̃)
elements and the action (ã) ones. The distinction between active
and sensory states is dictated by the definition of a Markov blanket;
namely, active states influence but are not influenced by external system elements, while sensory states influence but are not influenced by
the representational system. This ensures that the external states and
the internal or representational states are conditionally independent.
In the notions offered by Friston, both the external system (ψ̃
units) and the representational system (r̃ units) each independently
come to a free energy minimum. The activation of r̃ units within the
representational system can be mediated by certain parameters (θ),
so that the representational system models the external one.
More appropriately, since we are specifying that both the external
and representational systems come to free energy minima, we would
state that the nature of the representational system, when it achieves
free energy minimization, approximates that of the external system,
which also comes to free energy minimization. The degree-of-closeness
of the model approximation to the external system is mediated by the
parameter(s) θ.
In order to create such a computational engine, we need a formalism that will actually allow this free energy minimization to take
place, in both the external and representational components of the system. Maren [7] has suggested that a free energy formulation, known
as the cluster variation method (CVM), can potentially serve in such
a computational engine, as is shown in Fig. 1.
As a first step, we will use Friston’s framework for the variational
Bayes approach, and this requires that we derive the basic variational
Bayes equations.
To do this, we use the same notation as used by Friston, presented
in the following Table 1. The tilde notation (with variables ψ̃, r̃, s̃,
and ã) all refer to these as being “generalized” variables [3].

3

Figure 1: Illustration of a cluster variation method (CVM)-based computational engine, for which the Markov blanket of sensing and active units
corresponds to input and output layers (see Friston [3]). Unique to the approach advanced here, the computational layer is composed as a 2-D CVM,
for which the free energy equation can be explicitly written, and the free
energy minimum can be found either analytically or computationally, depending on the parameters used. The CVM layer comprises the internal or
representational units (r̃), and cannot communicate with the external field
(shown in two parts for visualization purposes only). However, units within
the representational layer can receive inputs from the sensory units (s̃) and
send signals to the active (ã) units. The sensory units can receive inputs
from external stimulus, and send signals to the representational units. The
active units can receive inputs from the representational units, and send signals to the external system. (In the notional view advanced by Friston (op.
cit.), a broader set of interactions is allowed; for simplicity in this engine, the
interaction pathways have been streamlined.)

4

Table 1: Variable definitions for variational free energy equations

2

Variable
s̃, ã, r̃

Meaning
Generalized expressions for sensory (s̃), active (ã), and internal (or representational) (r̃)
states

ψ̃

States of the world (system being modeled)
that cause sensory states, and which can be
influenced by action

fx (ψ̃, s̃, ã, r̃)

Flow of system’s states, where x corresponds
to external, internal (representational), or active states; see, e.g., Friston et al. (2015) [3]

The variational free energy

The goal of this section is to follow the Friston approach and express variational free energy as an expected energy or enthalpy minus
the entropy of a variational (i.e., approximate posterior) probability density. This can be equivalently expressed as surprisal plus the
Kullback-Leibler (KL) divergence between the variational density (the
density of the model system) and the true posterior density over external states (given the internal or representational states and their
Markov blanket) (p. 4, [3]), as shown in Eqn. 2.
Friston expresses the variational free energy of an ensemble as the
following equations [2, 3] (where the exact notation is taken from
Friston (2015) [3], Eqn. 3.2)
fr (s̃, ã, r̃) = (Qr − Γr )∇r̃ F
fa (s̃, ã, r̃) = (Qa − Γa )∇ã F

(1)

and
F (s̃, ã, r̃) = Eq [L(x̃)] − H[q(ψ̃|r̃)]
= L(s̃, ã, r̃) + DKL [q(ψ̃|r̃)||p(ψ̃|s̃, ã, r̃)].

(2)

where the variables were previously identified in Table 1.
The flow of system states, represented by Eqn. 1, is particular to
each type of unit, so that fa (s̃, ã, r̃) is the (gradient descent) change
in the set of action units (ã), and fs (s̃, ã, r̃) is the change in the set
of action units (s̃). These system states are subject to random fluctuations denoted by ω. The amplitude of the random fluctuations is

5

controlled by [the diffusion tensor] Γ, while (the set of) Q are antisymmetric matrices that allow for solenoidal flow (which does not change
free energy). (See further discussion in Sect. 2 of Friston (2013) [2].)
This Technical Report focuses exclusively on the static Eqn. 2, and
defers the dynamic Eqn. 1 to a different occasion.
Eqn. 2 expresses the variational free energy F (s̃, ã, r̃), which is
isomorphic in structure to the free energy used in statistical thermodynamics. In Eqn. 2, this term is expressed in two ways. First, it given
as the difference of the expectation of L(x̃) (a log-likelihood term) and
the entropy of the model system, H[q]. (This is the formalism that is
isomorphic with statistical thermodynamics.) We will determine the
exact meaning of L(x̃) in Section 5.
The second expression for F (s̃, ã, r̃) is the sum of the negative log
evidence (surprisal ) L(s̃, ã, r̃) and the Kullback-Leibler (K-L) divergence between the model and the external system. We will determine
the meaning of L(s̃, ã, r̃) in Section 4, and identify how (and why) it is
different from the L(x̃) used in the first expression. (As a minor note:
as the Kullback-Leibler divergence in this expression approaches zero,
we see that the variational free energy can be identified as an evidence
bound for the system.)
We further note that a primary difference between these two expressions is that in the first expression, H[q(ψ̃|r̃)] is an exact entropy
term, whereas in the second expression, the DKL term is a relative
entropy.
The following Table 2 presents a glossary of the thermodynamic
terms used in this Report.

2.1

The final result in a nutshell

The essence of Eqn. 2 is that we are taking a single expression, and
parsing and re-organizing it to achieve two different ways of re-expressing
the same thing. The expression, sometimes called the “variational free
energy” (see, e.g., Friston (op. cit.)) is given as
!
Z
p(ψ̃, s̃, ã, r̃)
F (s̃, ã, r̃) = − q(ψ̃|r̃) ln
dψ.
(3)
q(ψ̃|r̃)
ψ
Diagrammatically, we can see this shown in Figure 2. The tilde
notation is dropped in this figure and in the immediately-following
subsection, which discusses this figure.

6

Figure 2: Diagrammatic illustration of Eqn. 2.

7

Table 2: Variable definitions for variational free energy equations
Variable
Activation
enthalpy

Configuration
variable(s)
Degeneracy

Meaning
Enthalpy ε0 associated with a single unit (node) in the “on” or
“active” state (A); influences configuration variables and is set
to 0 in order to achieve an analytic solution for the free energy
equilibrium
Nearest neighbor, next-nearest neighbor, and triplet patterns
Number of ways in which a configuration variable can appear

Enthalpy

Internal energy H results from both per unit and pairwise interactions; often denoted H in thermodynamic treatments

Entropy

The entropy S is the distribution over all possible states; often
denoted S in thermodynamic treatments and H in information
theory

Equilibrium point
Equilibrium
distribution
Ergodic
distribution

By definition, the free energy minimum for a closed system
Configuration variable values when free energy minimized for
given h
Achieved when a system is allowed to evolve over a long period of
time

Free Energy

The thermodynamic state function F ; where F = H-TS ; sometimes G is used instead of F ; referring to (thermodynamic) Gibbs
free energy

h-value

A more useful expression for the interaction enthalpy parameter
ε1 ; h = e2βε1 , where β = 1/kβ T , and where kβ is Boltzmann’s
constant and T is temperature; β can be set to 1 for our purposes

Interaction
enthalpy
Interaction
enthalpy parameter
Temperature

2.2

Between two unlike units, ε1 ; influences configuration variables
Another term for the h-value where h = e2ε1
Temperature T times Boltzmann’s constant kβ is set equal to one

Quick Summary of Key Points

In Figure 2, we saw that the initiating expression, the “variational
free energy,” was being reorganized in two different ways. On the
Left-Hand-Side (LHS), we saw that it led to the (negative of) a simple

8

sum over the log-likelihood of the set of variables associated with the
representational units and the Markov blanket, added to the KullbackLeibler (K-L) divergence term expressing the difference between the
model q and the probability distribution of the external units ψ as
conditioned on the internal units and the Markov blanket. We achieve
this result by re-expressing the probability of the joint co-occurrence,
p(ψ, s, a, r) as a conditional probability, using the formulation for a
Bayesian posterior.
On the Right-Hand-Side (RHS), we see that the re-organization is
much simpler, and can indeed be followed simply by examining the
diagram itself. (There are a few subtleties, which are addressed in the
following sections.) The first term on the RHS is weighted sum over
the joint probability distribution p(ψ, s, a, r). The second term is a
term that looks remarkably like entropy.
The structure of the equation on the RHS, and the “entropy-like”
appearance of the last term, has given rise to expressing the whole
equation as “variational free energy.” This is because there is a morphological similarity between the form of the variational free energy
equation and the classic thermodynamic free energy. (See Appendix A
for a quick review of the basic statistical thermodynamics equations,
with more details presented in Appendix B.)

2.3

Various interpretations

Various authors interpret Eqn. 2 with different notations and descriptive phrases. The purpose of this subsection is to identify a few of
these interpretations, and to tease out exactly what is meant from
exactly what is said. This should make it easier for those reading the
source papers to understand what is actually being presented, and is a
first step towards building a Rosetta stone; giving a cross-correlation
between two different notations.
For example, Friston (2013) presents this Report’s Eqn. 2 as his
Eqn. 2.7 in [2], using the notation
F (s, a, λ) = Eq [G(ψ, s, a, λ)] − H[q(ψ|µ)].
Friston refers to Eq [G] saying that “[T]he last equality just shows
that free energy can be expressed as the expected Gibbs energy minus
the entropy of the variational density.”
However, Sengupta, Stemmler, and Friston [8] state that “U (t) =
− ln p(s(t), ψ(t)|m) corresponds to an internal energy under a genera-

9

tive model of the world, described in terms of the density over sensory
and hidden states p(s, y|m).” (Author’s note: U (t) corresponds to
Eq [G], from [8] and [2], respectively.) Moreover, Sengupta et al. state
that “F (t) is called free energy - by analogy with its thermodynamic
homologue that is defined as internal energy minus entropy. However, it is important to note that variational free energy is not the
Helmholtz free energy ... it is a functional of a probability distribution over hidden (fictive) states encoded by internal states q(y|m),
not the probability distribution over the (physical) internal states.
This is why variational free energy pertains to information about hidden states that are represented, not the internal states that represent
them.”
(Author’s Note 1: For the benefit of those who wish to compare the
information-theoretic approach of Beal, Friston, and others against a
classic statistical thermodynamics formulation, Appendix A derives
fundamental thermodynamic concepts, and Beal’s results compared
with the corresponding statistical thermodynamic formalism are given
in Appendix B. As stated by Sengupta et al., they are not precisely
the same [8].)
(Author’s Note 2: Sengupta et al. [8] refer to a Helmholtz free
energy, and Friston, writing separately, refers to a Gibbs free energy.
Both Helmholtz and Gibbs free energies correspond to thermodynamic
free energy formulations, and involve measurements on a physical system, i.e., temperature, pressure, and volume. The distinction between
Helmholtz and Gibbs free energies disappears when we use the thermodynamic free energy formulations as a metaphor in the information
context.)
It will be clear, in the succeeding derivations, that what is offered
as Eq [G] is not what we are familiar with as the Gibbs free energy
from statistical thermodynamics. However, Sengupta et al. offer the
following explanation as a Lemma:
“Lemma: (complexity minimisation) Minimising the complexity
of a conditional distribution - whose sufficient statistics are (strictly
increasing functions of) some unconstrained internal variables of a
thermodynamic system - minimises the Helmholtz free energy of that
system.”
As proof, they suggest that we can use standard results from
Bayesian statistics [4] in order to express free energy as complexity
minus accuracy. They are, in fact, referring to the derivation in Beal
(2003) that will be the fundamental reference in this Technical Report.

10

They conclude that “In sum, the internal states encoding prior beliefs
about hidden states of the world are those that minimise Helmholtz
free energy and the complexity defined by variational free energy.”
Friston cites Beal (2003) [4] for the derivation of Eqns. 1 and 2. Blei
et al. [9] also provide a useful tutorial. The following sections walk
through the derivations as provided by Beal, using some of the material provided by Blei et al. to support and elucidate certain points.
The goal is to make the match between the free energy equations as
expressed by Beal (and in certain cases, by Blei et al.) with those
used by Friston as clear and as transparent as possible.

3

Important distinction & clarification

Following the transition of the variational Bayes approach from Beal
[4] to Friston (op. cit.), and from thence to an actual, computable
model, requires some subtlety and attention to detail. The most crucial consideration at the outset is that with Beal (and with previous
expostulations on the variational Bayes method), both the actual data
points being modeled and the model itself are expressed with regard
to some underlying variables, xi . Thus, we have the external (or observable, or dependent) variables yi = y(xi ), and the model qxi (xi ).
An illustration of this is shown in Figure 3.
The illustration in Figure 3 serves as a depiction of how Gaussian
models are typically used to illustrate the variational Bayes approach.
Later in this Report, Section 7 introduces an alternative using the
cluster variation method (CVM) for free energy.
In contrast to Beal’s description, with Friston, the external system
and the representation are separated by a Markov blanket. Thus, the
external system’s units, denoted ψ, are distinct from the representational system’s units. Friston’s approach is illustrated in Figure 4.
In a beautiful and intriguing illustration, Friston applies his formulation to the emergence of a Markov blanket, beginning with “an
ensemble of elemental subsystems with (heuristically speaking) Newtonian and electrochemical dynamics ... One can think of these generalized states as describing the physical and electrochemical state of
large macromolecules. Crucially, these states are coupled within and
between the subsystems comprising an ensemble” [2]. In this illustration, the units comprising the Markov blanket and the internal,
“representational” system emerge over time. Appropriately enough,

11

Figure 3: In the variational Bayes method described by Beal, the dependent
variable yi is the data taken over the “hidden” independent variable xi , and
the model is a function of xi .
Friston’s illustration focuses on the dynamic behaviors of the various
units.
The following Table 3 presents a glossary of the thermodynamic
terms used in this Report.

Table 3: Variable definitions for information theoretic terms
Variable
Kullback-Leibler
divergence
Surprisal
Variational free
energy F (s̃, ã, r̃)

Meaning
Relative entropy, or measure of how one probability distribution
differs from a second one; here, the divergence between a model
distribution and the actual system being modeled
Information content, or amount of information gained when a random variable is sampled
Isomorphic in structure to the equation for thermodynamic free
energy, this expresses the difference between the expectation for
the probability distribution over a system and the entropy of a
model system; it can also be expressed as the sum of the negative log evidence (surprisal) and the Kullback-Leibler divergence
between the model and the external system

12

Figure 4: In the variational Bayes method described by Friston, the external system whose units are denoted by ψ, which interacts with a separate
representational system whose units are denoted by r. The two systems are
separated by a Markov blanket composed of sensing (s) and action (a) units.
(Note: tilde notation dropped from this figure.) In comparison with Beal,
the model q is a model of the external system, which is conditioned on the
representational system; q = q(ψ̃|r̃). This is feasible because the external
system units ψ̃ influence the representational units r̃ through the sensory
units s̃.

13

3.1

Primary distinction: Beal and Friston

Turning our attention back to the evolution of Friston’s formulation
from that expressed by Beal, we investigate the correspondence between Beal’s expression of p(yi |θ) in comparison with Friston’s use of
p(s̃, ã, r̃).
In writing p(yi |θ), Beal is actually describing the external system
that is being modeled. He is specifically referring to the (integration
of) the joint probability distribution p(xi , yi |θ), where the yi are the
dependent, or observable variables, and the xi are the independent, or
hidden, or latent variables. Specifically, Beal states (Sect. 2.2.1 [9]),
“Consider a model with hidden variables x and observed variables y.
The parameters describing the (potentially) stochastic dependencies
between variables are given by θ.”
The key to understanding that Beal is describing the external (observable) system (also that which Friston refers to as being denoted by
the units ψ̃) is that both Beal and Friston refer to the model as q(xi )
(see Eqn. 2 as an example). As Friston notes (personal communication), “The link between the two formulations rests upon associating
the causes xi and θ in Beal’s notation with the external states that
cause data (yi ) in Friston’s formulation (i.e., xi and θi correspond to
ψ̃), where the data in Friston’s formulation become the sensory units
states (s̃).”
In support of this, we note that Blei et al. [9] stated that “the
approach is to posit a family of approximate densities Q, which are
defined over the set of latent variables z = z1:m and observations
x = x1:n ... Then, we try to find that member q*(z) of the set Q that
is the Kullback-Leibler divergence (KL) of q*(z) with respect to the
exact posterior p(z|x), which represents the probability distribution
of the latent variables with regard to the observables, given as
q*(z) = argminKL(q(z)||(p(z|x)); q(z) ∈ Q.00
Note that in this explanation by Blei et al., the observable variable
was denoted as x instead of y, but the independent (and hidden)
variable was denoted z. Thus, in Beal, the observables are y and the
latent are x, and in Blei et al., the observables are x and the latent
are z.
In short, common to these different expostulations on the variational Bayesian approach, the model for the observable units is denoted by q, where exact values for q are a function of certain param-

14

eters (θ, in the case of Beal, and m or sometimes µ, in the case of
Friston).
The important thing to note, and the thing that differentiates Friston’s formulation from Beal’s, is that with Beal, both p and q are
applied to the same underlying hidden or independent variable(s) x.
Essentially, p represents the exact observed data, and q is the model
(subject to parameter fitting with θ). In contrast, with Friston, we
are dealing with entirely different sets of units; the external units (denoted by ψ̃) and the internal, representational units (denoted by r̃).
We can express a probability distribution over each, but they are not
necessarily the respective observed data points and modeling functions
taken over the same underlying base set of values.

3.2

Integrating over the model space

As we will note during subsequent derivations (presented in Subsection 4.1), the integration (in various equations) over q is shown as
being with regard to the external system units, ψ̃. More to the point,
Friston uses the notation of integrating over ψ̃, in order to show the
comparison between his formulation and that of Beal.
Specifically, we will see that Beal uses the integration (Section 5)
XZ
p(xi , yi |θ)
L(θ) ≥
dxi qxi (xi ) ln
,
qxi (xi )
i=1

and correspondingly, Friston uses the integration (Subsection 4.3)
!
Z
p(ψ̃, s̃, ã, r̃)
F (s̃, ã, r̃) = − q(ψ̃|r̃) ln
dψ.
q(ψ̃|r̃)
ψ
Friston is clearly making an effort to show the correspondence between his formulation and that of Beal. Also, as he envisions it, a
summation or integration of the model over the external system may
be possible. (His illustration in [2] showed the evolution of the internal states and the Markov blanket from an original “primordial soup”
encompassing all the units.)
For the purposes of this Technical Report, though, we envision a
system where the model system q refers strictly to the internal (representational) units r̃. Over time, the goal is to adjust the units r̃ so
that the free energy of the model q approximates that of the external
system with units ψ̃.

15

Thus, the elements of our system that we’ve been considering so
far consist of three things:
1. The external system which is composed of units ψ̃; we are trying
to model this, and we operate under the presumption that we
cannot always directly compute certain measures on this system,
2. The internal system which is composed of units r̃; at any given
moment we can determine certain measures on this system, yielding L(s̃, ã, r̃) (we are temporarily ignoring s̃ and ã), and
3. A model of the external system expressed via the internal system, q, where the chief distinction is that when we take an actual
value for q, we do so with the presumption that the internal system is brought to a free energy equilibrium for a given set of
parameter values θ. This means that the measures for a given
distribution-in-the-moment, as represented by L, would be adjusted to represent what they would be if the internal system
were brought to equilibrium, for a specific set of θ.
Thus, when it comes to the integration steps, we will consider that
an integration of the model system q over ψ̃ will be interpreted as
integrating over the model units themselves r̃, but with consideration
that the model will have come into a free energy equilibrium (subject
to parameters θ) that is a best approximation, for that set of θ, to the
external system.

4 The variational free energy: K-L divergence and log-likelihood
In Eqn. 2, the free energy is expressed in two different ways:
1. As the difference between an enthalpy-like term and the entropy
of the model system, and
2. As the sum of a surprisal or potential (negative log evidence)
and the K-L divergence between the probability distributions of
the model and the external system.
In this section, we focus on the second half of Eqn. 2; the equality between the “variational free energy” and the sum of the pooled
negative log probability of sensory states (and their accompanying representational and active states) and the K-L divergence. Specifically,
we wish to show that

16

(4)

F (s̃, ã, r̃) = L(s̃, ã, r̃) + DKL [q(ψ̃|r̃)||p(ψ̃|s̃, ã, r̃)].

In achieving this goal, we will also accomplish two other tasks,
namely:
1. Obtain a precise mathematical formation for F (s̃, ã, r̃), and
2. Interpret this mathematical formulation in a useful manner.
We begin our derivation of Eqn. 4 by first considering the definition for the K-L divergence in the context of the system that we are
describing (and using the notation advanced by Friston (2015) [3]).

4.1

Interpreting the K-L divergence

For the discrete case, we write the Kullback-Leibler (K-L) divergence
as

DKL [q(ψ̃|r̃)||p(ψ̃|s̃, ã, r̃)] =

I
X
i=1

q(ψ̃|r̃) ln

q(ψ̃|r̃)
p(ψ̃|s̃, ã, r̃)

!
.

(5)

We briefly interpret the physical meaning of the terms in Eqn. 5.
The K-L divergence measures the divergence between the model q
of (i.e., probability distribution over) the external system, and the
external system itself, ψ̃.
The model q is a model of the external system, ψ̃, which is why
we write q = q(ψ̃). The key feature in computing q is that (for the
application being considered here) we take it at the equilibrium state.
That is, q corresponds to the equilibrium free energy of the external
system, which can be computed (or approximated) if we have a suitable free energy equation. Thus, in Eqn. 5, we are looking at the
divergence between the model of the system at equilibrium and the
probabilities of various components of the system, potentially in a
not-yet-at-equilibrium state.
The parameter(s) θ can indeed influence q, but the notation for θ
is suppressed throughout.
Thus, we can read the term q(ψ̃|r̃) as the “probability distribution
of the model of the external system ψ̃, which is computed based solely
on the value of the representational units r̃ that are isolated from the
external system ψ̃ by a Markov blanket, but these representational
units are to be considered with their at-equilibrium values.”

17

Next, we examine the term p(ψ̃|s̃, ã, r̃), which expresses the probability distribution of units ψ̃ in the external system, conditioned on
the Markov blanket sensory units s̃ and action units ã, along with the
representational units r̃. We recall, from the design of the entire system (external plus Markov blanket plus representational units), and
also from figures given in Friston [2] and Friston et al. [3], and replicated in Figure 4, that the representational units do not communicate
directly with the external units. Thus, the dependence of the ψ̃ is very
much an implicit relationship; one that is at a distance because the
direct interactions of the units in ψ̃ are exclusively with s̃ and ã. Further, the system design is that the sensory units receive inputs from
the external units ψ̃, but do not directly influence the ψ̃ themselves.
Thus, the conditional relationship expressed in p(ψ̃|s̃, ã, r̃) seems a
little forced. However, it is the basis for our next steps in the derivation, and we will think of it simply as stating that the external system
can indeed be influenced by the evolving values for the representational system r̃.
With this in mind, we go back to Eqn. 5, and interpret the K-L
divergence on the Right-Hand-Side (RHS) of the equation. It states
that the K-L divergence is the sum, over all possible states in which
the system can possibly find itself, of the probability distribution of
the model q for a given specific state, multiplying the natural log of
the probability distribution of the model over the probability distribution of the actual, external system, both for that given specific state.
In this expression, the probability distribution of the external system
is conditioned by the states of the Markov blanket and the representational system.
Thinking ahead, we consider how the traditional formulation for
how the relationship between the model and the external system is
expressed, specifically as a K-L divergence. Typically, the actual “external” system is some set of values, p(x), and the model is given as
q(x). The model q is adjusted via certain parameters θ to become close
to p, as illustrated in Figure 3. The summation over values i = 1..I
thus runs through the gamut of possible x values.
In our situation, though, we will be looking at both an external
system and an internal model that will each, separately, come to their
respective free energy equilibrium points. That is, there will not be
a sum over all possible values of some distribution over i; there will
instead be a single probability distribution p and a single probability
distribution q, after each has reached free energy minimization.

18

4.2 Rewriting the Bayesian posterior distribution
Before we rewrite the K-L divergence term of Eqn. 5, we first recall
how the Bayesian posterior probability density can be rewritten, as
framed in Blei et al. [9].
Consider a system that has a set of observable variables v = v1..V
and a set of latent or “hidden” variables w = w1..W . In a feedforward
neural network, for example, the observable variables v would be the
values of the output layer neurons, and the latent (hidden) variables
would be the associated values of the hidden layer w neurons.
Similarly, we can envision many other situations in which we can
identify an observation that is a function of multiple input factors.
Sometimes, not all of those input factors can be directly observed.
In the Bayesian formalism, the prior density of the (set of) latent
variables w is defined as p(w). A Bayesian model relates these latent
variables to the observations v through the likelihood p(v|w). The
interpretation is straightforward; it speaks to the likelihood of observing an outcome or observable variable v given the hidden variables w.
This is called the prior distribution.
Sometimes, though, we don’t have an accurate means of establishing the values for the latent or hidden variables w. Thus, we use
approximate inference to determine the posterior distribution, p(w|v).
This means that we are trying to estimate the values of the hidden
variables, seeing only the values for the observable variables.
To rewrite the probability density, we first consider a system that
can be described in terms of a joint density of latent variables w =
w1..W and observations v = v1..V , where the conditional density function is given as
p(w|v) = p(w, v)/p(v).

(6)

Conversely, we also have
p(w, v) = p(w|v)p(v).

4.3

(7)

Rewriting the K-L divergence

We wish now to rewrite the probability density of the external states
ψ̃ that is conditional on the Markov blanket and internal (representa-

19

tional) states, so that the probability density becomes a joint distribution.
We identify the conditional distribution from Eqn. 5 in terms of
the joint probability distribution p(ψ̃, s̃, ã, r̃), together with the simple
probability distribution over the model states.
(8)

p(ψ̃|s̃, ã, r̃) = p(ψ̃, s̃, ã, r̃)/p(s̃, ã, r̃).
Substituting this result into Eqn. 5, we have

DKL [q(ψ̃|r̃)||p(ψ̃|s̃, ã, r̃)] =

I
X

q(ψ̃|r̃) ln

i=1

q(ψ̃|r̃)p(s̃, ã, r̃)
p(ψ̃, s̃, ã, r̃)

!
,

(9)

which we can reorganize to write as
DKL [q(ψ̃|r̃)||p(ψ̃|s̃, ã, r̃)] =

I
X

q(ψ̃|r̃) ln (p(s̃, ã, r̃))

i=1

+

I
X

q(ψ̃|r̃) ln

i=1

q(ψ̃|r̃)
p(ψ̃, s̃, ã, r̃)

(10)

!
.

Following Beal [4] (Eqns. 2.32 - 2.34), we note that the sum over
the model terms q in the first term on the RHS comes to 1 (implicitly,
there is a double summation there, and q is independent of p), so that
we have
DKL [q(ψ̃|r̃)||p(ψ̃|s̃, ã, r̃)] =

I
X

ln (p(s̃, ã, r̃))

i=1

+

I
X

q(ψ̃|r̃) ln

i=1

q(ψ̃|r̃)
p(ψ̃, s̃, ã, r̃)

(11)

!
,

keeping in mind that the q are taken over the hidden or latent variables, and that the sum over i = 1..I is taken over the I units in the
system being modeled.
This is a good place in which to note that Friston typically writes
the first term on the RHS of 11 without the summation sign; e.g., the
summation is subsumed into the notation.
For example, Friston, as Eqn. 2.8 in Friston (2013) [2] and Eqns.
3.2 and 3.4 of Friston et al. (2015) [3], uses

20

L(s̃, ã, r̃) = − ln p(s̃, ã, r̃),

(12)

where clearly the meaning (see Eqn. 11) is
L(s̃, ã, r̃) = −

I
X

ln p(s̃, ã, r̃).

(13)

i=1

As further evidence that Friston intends the summation (or, as
suitable for the situation, an integration) is found in Friston’s expression (2013, see Eqn. 2.7) [2] for F (s̃, ã, r̃), as
!
Z
p(ψ̃, s̃, ã, r̃|m)
dψ.
F (s̃, ã, r̃) = − q(ψ̃|r̃) ln
q(ψ̃|r̃)
ψ
We will discuss this equation in greater context later in this Subsection.
Returning to our original line of though, we rearrange terms in
Eqn. 11 to obtain
!
I
I
X
X
q(ψ̃|r̃)
=−
ln (p(s̃, ã, r̃))
q(ψ̃|r̃) ln
(14)
p(ψ̃, s̃, ã, r̃)
i=1
i=1
+DKL [q(ψ̃|r̃)||p(ψ̃|s̃, ã, r̃)].
Adopting Friston’s notation, in which the summation (or integration, in the case of continuous variables) is subsumed, we can write
!
q(ψ̃|r̃)
q(ψ̃|r̃) ln
= − ln (p(s̃, ã, r̃))
p(ψ̃, s̃, ã, r̃)
(15)
+DKL [q(ψ̃|r̃)||p(ψ̃|s̃, ã, r̃)].
Note that the following equations are being written in Friston’s
style, with summation (or integration) subsumed.
We notice that Eqn. 15 is similar to form of Eqn. 4; sufficiently so
that we can establish the identities for F (s̃, ã, r̃) and L(s̃, ã, r̃).
For the Left-Hand-Side (LHS) of Eqn. 15, we create the identity
for F (s̃, ã, r̃) as

21

!
q(ψ̃|r̃)
F (s̃, ã, r̃) = q(ψ̃|r̃) ln
p(ψ̃, s̃, ã, r̃)
!
p(ψ̃, s̃, ã, r̃)
= −q(ψ̃|r̃) ln
.
q(ψ̃|r̃)

(16)

This gives us the precise form for F (s̃, ã, r̃); the variational free energy. We note the specific difference between this Eqn. 16 and Eqn. 5;
both have the form of a K-L divergence. However, in Eqn. 16, the divergence is between the model and the joint distribution of the model
and the external system; in Eqn. 5, the divergence is between the
model and the external system as conditioned on the representational
system and the Markov blanket.
We notice also (in the second part of Eqn. 16) that Friston et
al. prefer to represent the variational free energy as the negative of
a divergence-like term; it is now between the joint probability distribution (of the external system and the model) against the model,
although the multiplying factor is still that of the model distribution.
Similarly, for the first term on the RHS of Eqn. 15, we also take
note of the interpretation offered by Friston (2015) [3], which give us
L(s̃, ã, r̃) = − ln p(s̃, ã, r̃),

(17)

so that L is defined as the negative of the logarithm of the probability
of internal (representational) units, together with the Markov blanket
units.
As another notational note; Friston actually incorporates dependence on the model parameters into this term; see Eqn. 3.1 of Friston
et al. (2015) [3] and Eqn. 2.7 of Friston (2013) [2] for F (s̃, ã, r̃), which
gives
L(s̃, ã, r̃) = − ln p(s̃, ã, r̃|m),
If we were to substitute these two expressions into Eqn. 15, we
would obtain
!
p(ψ̃, s̃, ã, r̃)
F (s̃, ã, r̃) = −q(ψ̃|r̃) ln
q(ψ̃|r̃)
(18)
= L(s̃, ã, r̃) + DKL [q(ψ̃|r̃)||p(ψ̃|s̃, ã, r̃)],

22

which is identical with the second part of Eqn. 4, and also with Friston
(2015), Eqn. 3.2 [3], and also with Friston (2013) Eqn. 2.8 [2].
Once again, it may be useful to consider the distinction between
q and L. More precisely, we need to ask ourselves exactly what it
is that we mean when we speak of p(s̃, ã, r̃). This is presumably the
probability distribution of the internal and Markov blanket states.
However, we have been representing the distribution of the internal
and Markov blanket states as q; the probability distribution of the
model system that is encoded by the internal states r̃.
A useful interpretation is that we may take L(s̃, ã, r̃) to be the actual distribution of the representational system (as computed directly
over its various components), and q to be the computational distribution of the model. As noted by Friston (personal communication), “In
other words, the negative log likelihood of sensory states (and active
plus internal states) pertains to the actual state of affairs, while the
free energy corresponds to the equivalent measure that would be obtained if the sensory units were caused by the latent or hidden states
encoded by the internal states. By minimizing free energy, the two
become close but (in general) will never be exactly the same.”
The physical implication here could be that we will obtain q as
the probability distribution for the model in a free energy-minimized
state. In contrast, the values of specific elements in the distribution
over (s̃, ã, r̃) may, at a certain point, not be in a free energy-minimized
state.
We have thus accomplished half of our goal, in deriving one of the
equalities of Eqn. 2, involving the negative log-likelihood of the probability of states within the model, added to the K-L divergence of the
probability distribution of the model with respect to the probability
distribution of the external units.
Examining Eqn. 16, we note the correspondence between the expression for F (s̃, ã, r̃) given there and the corollary expression given
for the free energy of a system in Friston (2013, see Eqn. 2.7) [2], as
!
Z
p(ψ̃, s̃, ã, r̃)
F (s̃, ã, r̃) = − q(ψ̃|r̃) ln
dψ.
(19)
q(ψ̃|r̃)
ψ
We take note that the integration in Eqn. 19 is over the external
units ψ̃, reinforcing our understanding that the free energy F (s̃, ã, r̃)
is really the variational free energy of the external system, with the
probability distribution in the numerator of the logarithmic term being

23

taken over the joint distribution of external units ψ together with the
internal or representational units r̃ as well as the Markov blanket units.
We notice the correspondence between Eqn. 18 above and Eqn.
2.34 of Beal, in that F (s̃, ã, r̃) = −F (qx (x), θ), where the former notation for the free energy is Friston’s, and the second is Beal’s. (A
minor technical note, is that the free energy of a probability distribution (q) is a functional, while the free energy of its sufficient statistics
(r̃) becomes a function.’) Correspondingly, Eqn. 18 is precisely the
negative of Eqn. 2.34 in Beal.
Now, we wish to show the first part of Eqn. 2, which expresses
the same free energy in terms of an expectation of log-likelihood of a
certain term (whose precise nature will be clarified) minus the entropy
of the model as applied to the external units (which will also need to
be verified).

5 The variational free energy: log- likelihood expectation and entropy
The previous Subsection 4.3 presented a derivation for the second
half of Eqn. 2, giving an expression for the variational free energy in
terms of the (negative of the) log-likelihood (over the representational
system) and the K-L divergence (of the model vis-à-vis the external
system). In this section, we show how the other equality expressed in
Eqn. 2 can be derived, giving the free energy in terms of what Friston
calls an “expected enthalpy” and an entropy term, the exact natures
of which will be determined as we proceed [3].
Several sources remark that the while the first term in the second
line of Eqn. 2 is computable, the second term (the K-L divergence)
is not [4, 9]. This then motivates the expression given on the first
line of the equation, with the intention of giving an alternative - and
computable - formulation for the variational free energy F .
The derivation of the first part of Eqn. 2 is found in Beal (2003)
[4], Eqns. 2.15 and 2.16.
For convenience, Eqn. 2 (Eqn. 3.2 in Friston et al. (2015) [3]) is
presented again, as
F (s̃, ã, r̃) = Eq [L(x̃)] − H[q(ψ̃|r̃)]
= L(s̃, ã, r̃) + DKL [q(ψ̃|r̃)||p(ψ̃|s̃, ã, r̃)].

24

Our goal is to verify the first equality presented in this equation.
To accomplish this, we follow a line of reasoning presented in Beal
(2003) [4], who introduced a formulation for the log likelihood.
We begin with Beal’s Eqn. 2.10, given as

L(θ) ≡ ln p(y|θ) =

n
X

ln p(yi |θ) =

i=1

n
X

Z
dxi p(xi , yi |θ).

ln

(20)

i=1

Beal’s Eqns. 2.12 - 2.16 are reproduced here as

L(θ) =

X

=

X

Z
dxi p(xi , yi |θ)

ln

i=1

Z
ln

dxi qxi (xi )

i=1

≥

XZ

dxi qxi (xi ) ln

i=1

=

X Z

p(xi , yi |θ)
qxi (xi )
p(xi , yi |θ)
qxi (xi )


Z
dxi qxi (xi ) ln p(xi , yi |θ) −

dxi qxi (xi ) ln qxi (xi )

i=1

=

X Z



Z

dxi qxi (xi ) ln p(xi , yi |θ) −

dxi qxi (xi ) ln qxi (xi )

i=1

≡ F (qx1 (x1 ), ..., qxn (xn ), θ).
(21)
In the preceding Eqn. 21, we note that the last two lines are those
that interest us; we see there a formal similarity between those terms
and those in the first equality expression of Eqn.2. Specifically, we
desire to show a correspondence between Beal’s Eqns. 2.12 - 2.16,
given as

L(θ) =

X

Z
ln

i=1

≥

X Z

dxi qxi (xi )

p(xi , yi |θ)
qxi (xi )


dxi qxi (xi ) ln p(xi , yi |θ) −

Z
dxi qxi (xi ) ln qxi (xi )

i=1

≡ F (qx1 (x1 ), ..., qxn (xn ), θ),
(22)
and Friston’s equation, which we’ve presented here as Eqn. 2 (Eqn.
3.2 in Friston et al. (2015), and which we present again as

25

F (s̃, ã, r̃) = Eq [L(x̃)] − H[q(ψ̃|r̃)].

(23)

The “greater-than-or-equal” relation in Eqn. 22 is due to Jensen’s
inequality, and is essential to one of the steps shown in Eqn. 21; this
is a minor omission in Friston’s phrasing, and does not substantially
impact our translation.
We will note, as we pursue our investigation, that Friston’s identification of F is the negative of that used by Beal; this will change the
direction of the inequality, but will again not impact our work.
As a precursor step, we use the equality case and take negative of
Beal’s expression from Eqn. 22 and write
F (s̃, ã, r̃)
= −F (qx1 (x1 ), ..., qxn (xn ), θ)

X Z
=−
dxi qxi (xi ) ln p(xi , yi |θ)

(24)

i=1

 Z

− − dxi qxi (xi ) ln qxi (xi ) .
We identify the three separate equivalences that we will wish to
make, correlating Friston’s terms (Eqn. 25) with Beal’s (Eqn. 24);
specifically that
F (s̃, ã, r̃)
= −F (qx1 (x1 ), ..., qxn (xn ), θ)
X Z
p(xi , yi |θ)
=−
ln dxi qxi (xi )
,
qxi (xi )

(25)

i=1

and
Eq [L(x̃)] = −

X Z


dxi qxi (xi ) ln p(xi , yi |θ) ,

(26)

dxi qxi (xi ) ln qxi (xi ).

(27)

i=1

and
Z
H[q(ψ̃|r̃)] = −

We remind ourselves (to avoid confusion for any who would be
reading and comparing the original documents) that Friston’s F (s̃, ã, r̃)
is the negative of Beal’s F (qx1 (x1 ), ..., qxn (xn ), θ).

26

We will address each of these three correspondences in the following
three subsections, respectively.

5.1 Equivalence of the variational free energy
expressions
In this subsection, we will show the correspondence given previously
as Eqn. 25
F (s̃, ã, r̃)
= −F (qx1 (x1 ), ..., qxn (xn ), θ)
X Z
p(xi , yi |θ)
=−
ln dxi qxi (xi )
.
qxi (xi )
i=1

We pause to recollect, from Subsection 4.3, Eqn. 16, the term that
Friston has identified for variational free energy. We state this again
here for reference as
!
q(ψ̃|r̃)
F (s̃, ã, r̃) = q(ψ̃|r̃) ln
p(ψ̃, s̃, ã, r̃)
!
(28)
p(ψ̃, s̃, ã, r̃)
= −q(ψ̃|r̃) ln
.
q(ψ̃|r̃)
We rewrite Beal’s expresssion from Eqn. 22, by taking the negative
of all terms and dropping the inequality
X Z
p(xi , yi |θ)
−L(θ) = −
ln dxi qxi (xi )
qxi (xi )
(29)
i=1
= −F (qx1 (x1 ), ..., qxn (xn ), θ).
We note that there is indeed the desired resemblance. To be more
clear, we are seeking the correspondence that can be expressed as

q(ψ̃|r̃) ln

p(ψ̃, s̃, ã, r̃)
q(ψ̃|r̃)

!

=

X

Z
ln

i=1

p(xi , yi |θ)
dxi qxi (xi )
.
qxi (xi )

(30)

Clearly, the desired terms are present and in their appropriate
order. The key differences are that Beal (on the Right-Hand-Side, or

27

RHS) explicitly identifies the summation and integration steps, and
that the Friston formalism is expanded; it includes the entire set of
elements; ψ̃, s̃, r̃, and r̃.
This makes sense; the entire “universe” encompassed in the Friston
model is expressed via ψ̃, s̃, r̃, and r̃. Correspondingly, the “universe”
modeled in Beal’s approach is the set of observable data points yi
and the associated latent variables xi . The parameter θ is expressly
identified in Beal’s notation; it is suppressed in this particular notation
by Friston, but is evident in various Friston writings (op. cit.).
We give our attention to how Beal’s expression integrates over
the q(xi ). More precisely, Beal gives an integration over the hidden
or latent elements xi , and a summation over the units yi . Friston’s
approach simply specifies a distribution q associated with each specific
probabilistic state p. However, as discussed earlier, Friston’s notation
subsumes the summation (or integration, as appropriate).
This is a reasonable transition, as in the system being described by
Friston, we no longer are assessing the values of p and q over the same
underlying hidden variables x. Rather, the p corresponds to the external system, and the q corresponds to the internal (representational)
system, which we are bringing into alignment with the external system.

5.2

Equivalence of the entropy expressions

For ease in flow, we next address the equivalence of the two entropy
terms, as this is relatively straightforward.
Friston identifies an entropy term H (using this notation, common
to information theory, rather than the more classic thermodynamic
notation S), and we desire that it be equivalent to Beal’s term, as
expressed previously in Eqn. 27, which we restate here (using Beal’s
notation) as
Z
H[q(ψ̃|r̃)] = − dx qx (x) ln qx (x),
which we can also write (using Friston’s notation) as
Z
H[q(ψ̃|r̃)] = − d(ψ̃|r̃) q(ψ̃|r̃) ln q(ψ̃|r̃).
We recall that the fundamental definition for the entropy of a system is given (see Appendix B) as

28

S = −k

X

Pn ln Pn ,

(31)

n

where Pn refers to the probability of a unit being in energy state
n. This is a classic entropy formulation, and we see it replicated in
Eqn. 27. The thing that we wish to carefully note is that in Eqn. 27,
even though the entropy is being expressed as a function of q(xi )
(using Beal’s notation) or q(ψ̃|r̃) (using Friston’s notation), the units
that are being summed (or integrated) are those in the model, not
in the external system. Thus, H is a function of the model system
represented by q.
Very specifically, when it comes to evaluating this function, we
would not need a distribution over all possible states in the model.
Rather, the computational engine which this Technical Report envisions is one in which the external and internal systems separately come
to free energy minima. Thus, when that minimum point is achieved,
there would be a single existent value for q; the one which represents
the free energy-minimized state for a given set of parameters θ. Friston
(personal communication) notes that “A complementary perspective
on this computational saving follows from Feynman’s original motivation; namely, that we have converted a very difficult integration
problem into an easy optimization problem. Here, the optimization
problem simply entails minimizing variational free energy.”

5.3

Equivalence of the enthalpy expressions

Finally, we wish to show the equivalence between the enthalpy terms.
The word “enthalpy” may be a misnomer here, but is being used in
the classic sense of thermodynamics, in which (see Appendix A) the
free energy F is equal to the enthalpy H (which is the classic notation
for enthalpy, although U is sometimes used, depending on the version
of free energy being described) minus the temperature T times the
entropy S, or (in the case of this manuscript as well as in Friston’s
work and most information theoretic works) H.
Thus, the most classic equation in thermodynamics is
F = H − T S,
which states that the free energy is the enthalpy minus temperature
times entropy, and where enthalpy is denoted H and entropy is denoted S.

29

The equations presented by Beal and Friston have the same formal
structure as the classic free energy equation from statistical thermodynamics, as stated in Eqn. 2. The version offered by Friston is replicated
here as
F (s̃, ã, r̃) = Eq [L(x̃)] − H[q(ψ̃|r̃)],
and note again that Friston uses H for entropy, instead of the thermodynamic S.
The temperature T has been absorbed in the derivations presented
in this work; we are dealing with something called a reduced free
energy (and also reduced entropy and reduced enthalpy), which are
dimensionless quantities. (Note also that this “reduction” also normalizes the thermodynamic variables with regard to the total number
of units in the system. See Appendix A for a review of basic thermodynamics.)
We have already established the correspondence between the Friston’s variational free energy F (s̃, ã, r̃) and (the negative of) that used
by Beal, and also identified it as corresponding (in position and form)
to the classical free energy. We have also established the correspondence of Friston’s entropy term H with (the negative of) that used by
Beal, and identified it as corresponding to the classical entropy term.
(In this case the actual expressions are very much aligned.)
We now seek to identify the correspondence between Friston’s
enthalpy-like term, Eq [L(x̃)], and the negative of that used by Beal.
Specifically, we want to establish Eqn. 26, restating it here for convenience as

X Z
Eq [L(x̃)] = −
dxi qxi (xi ) ln p(xi , yi |θ) .
(32)
i=1

We also take note of the interpretation offered by Friston (2015)
[3], which states that L(x̃) = − ln p(ψ̃, s̃, ã, r̃|m) (see Lemma 3.1 and
also Eqn. 3.2), or more specifically
L(x̃) = L(ψ̃, s̃, ã, r̃) = − ln p(ψ̃, s̃, ã, r̃),

(33)

so that L is defined as the negative of the sum of the logarithm of the
joint probability of the external and internal (representational) units,
together with the Markov blanket units.
We have previously addressed the nature of L in Subsection 4.3,
and thus will just briefly recapitulate cogent arguments here.

30

First, we examine the term ln p(xi , yi |θ). The joint probability of
the dependent variables yi , co-occurring with the independent variables xi , as conditioned by the model system parameters θ, is consistent with Friston’s notation involving a joint probability distribution.
Second, we consider the integration over the qxi (xi ) times the logarithm of the probability. As noted previously, the q and the p address
the distributions over different systems, and thus are independent (to
a first order). Thus, we can separate out the integration of the q.
The agreement with Eqn. 33 becomes self-evident, if we associate the
external states with x, and the sensory states (plus active and internal
states) with y.

5.4

Recapitulation and summary

We now recast Eqn. 21 using Friston’s notation.
Further, since L(ψ̃, s̃, ã, r̃) = −ln(p(ψ̃, s̃, ã, r̃|m)), the signs on the
terms on the RHS of Eqn. 21 have been changed throughout, along
with the direction of the inequality.
A key feature in the following Eqn. 34 is that Friston is taking the
integration over the units ψ̃ in the external system, similar to how Beal
is summing over the observable units y. However, we will conduct our
integration (or summation, which is more literally the case) over the
units in the model system, as discussed in Subsection 3.2.
Specifically, Friston’s starting point is Eqn. 2.7 in [2], given as


Z
p(ψ, s, a, r)
F (s, a, r) = − dψ q(ψ|r) ln
q(ψ|r)
ψ
= Eq [L(ψ, s, a, r)] − H[q(ψ|µ)].
Note that the tilde notation, indicating generalized variables, is
dropped, conforming with the notation that Friston uses in [2], where
Friston uses G for L in [2].
Friston’s interpretation is that “Here, free energy is a functional
of an arbitrary (variational) density q(ψ|r) [q(ψ|λ) in the original article] that is parametrized by internal states. The last equality just
shows that free energy can be expressed as the expected Gibbs energy minus the entropy of the variational density.” (Friston (2013)
[2], immediately after Eqn. 2.7.)
The corresponding expressions, from Eqns. 2.12 - 2.16 in Beal [4]
are given as

31

L(θ) ≥

XZ

dxi qxi (xi ) ln

i=1

=

X Z

p(xi , yi |θ)
qxi (xi )


dxi qxi (xi ) ln p(xi , yi |θ) −

Z
dxi qxi (xi ) ln qxi (xi )

i=1

≡ F (qx1 (x1 ), ..., qxn (xn ), θ).
The full derivation, using Friston’s notation, can be found as
L(s, a, r) = − ln(p(ψ, s, a, r|m))
Z
= − dψ ln (p(ψ, s, a, r))
ψ


Z
p(ψ, s, a, r)
= − dψ ln q(ψ|r)
q(ψ|r)
ψ


Z
p(ψ, s, a, r)
≤ − dψ q(ψ|r) ln
q(ψ|r)
ψ
Z
Z
= − dψ q(ψ|r) ln (p(ψ, s, a, r)) +
dψ q(ψ|r) ln (q(ψ|r))
ψ

ψ

= Eq [G(ψ, s, a, r)] − H[q(ψ|µ)]
≡ F (s, a, r).
(34)
A notational point is that in this equation, G refers to the tjhermodynamic Gibbs free energy, which is being used here in a didactic
manner.
As another small note, Friston shifts notation between the thirdto-last and the second-to-last lines of this equation, where he expresses
the results in Friston (2013) [2]. In the third-to-last equation, he has
the expression involving q(ψ̃|r̃). In the second-to-last equation, he
uses q(ψ̃|µ). A rationale is that after the integration (where the units
that are being considered in the model q are dependent on the actual
representational units r̃), the dependence of q on r̃ no longer needs
to be explicitly stated. The introduction of µ is simply noting that
the computation for the model q was done with reference to sufficient
statistics or parameters µ, which are associated with the internal states
(µ = r̃).

32

6

Discussion

Now that we’ve done a detailed derivation for both of the equalities
expressed in Eqn. 2, it is useful to step back and ascertain exactly what
is meant by these paired statements, which are reproduced below for
convenience.
F (s̃, ã, r̃) = Eq [L(x̃)] − H[q(ψ̃|r̃)]
= L(s̃, ã, r̃) + DKL [q(ψ̃|r̃)||p(ψ̃|s̃, ã, r̃)].
The first expression for the variational free energy puts the influence of the external units in the first free energy term Eq [L(x̃)]. By
stating that we desire the expectation of L(x̃), we are pushing to identify L at the point at which we “expect” the system to come to a
stable state, i.e., a free energy minimum.
The influence of the “variation” or the perturbation to the system is expressed in terms of the “entropy of the variational density,”
H[q(ψ̃|r̃)]. This puts the variation or perturbation of the external
units in the context of the expected values for the internal and Markov
blanket units.
The second expression for the variational free energy simply identifies a free energy-like term that involves only internal and Markov
blanket units; L(s̃, ã, r̃). (In statistical terms, this is known as the
marginal likelihood; having integrated out dependencies on the external states or causes of sensory states. In Bayesian statistics, this is
also known as the (negative) log model evidence (see below).)
The extracted influence of the expected external units (those typically associated with a specific state of internal and Markov blanket
units) is now combined with the influence of the variational (or perturbed) external units, within the Kullback-Leibler divergence term,
DKL [q(ψ̃|r̃)||p(ψ̃|s̃, ã, r̃)].
(In terms of Bayesian statistics, this is the divergence between the
approximate and true posterior. This means that minimizing free
energy is equivalent to approximate Bayesian inference.)
This Technical Report has, thus far, served to present in detail a
derivation for the ideas behind the variational Bayes approach, and
provided a detailed correlation between the notation used by one author (Beal) and that used by Friston, in his extension of variational
Bayes to a more general case, in which an external system is separated
from a “representational” system by a Markov blanket of sensory and

33

active units. These are two different ways of envisioning the variational Bayes approach in action.

6.1

Free Energy Physical Interpretation

We consider that the free energy formulation that we have been developing describes a system with external units ψ, together with a model
system that contains internal units that encode “latent” or “hidden”
states, in terms of their sufficient statistics r̃, that are separated from
the external system by a Markov blanket comprising sensory units s̃
and action units ã, as illustrated in Figure 1 of [2]. In other words,
internal states encode probability distributions over latent states that
‘could have’ caused the sensory states.
Eqn. 35 gives us the free energy of the system, where the elements
of F (s̃, ã, r̃) are formulated in terms of the probability distribution
over ψ̃ in terms of q(ψ̃|r̃), which is the density distribution posed by
the model. In contrast, L(s̃, ã, r̃) is a function strictly of the units
associated with the model, where the elements include the representational (“latent”) units r̃ along with the Markov blanket units s̃ and
ã. Finally, the K-L divergence term (the final term on the RHS of
Eqn. 35) expresses the divergence between the model (expressed as q)
and the external system (expressed as p), given the Markov blanket.
Thus, we can understand that Eqn. 35 expresses the free energy
of the system (F (s̃, ã, r̃)) as the sum of the free energy of the model
(L(s̃, ã, r̃)) plus the extent to which the model diverges from the external system.

6.2

Free Energy as a Lower Bound

Beal notes that F (qx (x), θ) is a lower bound on L(θ) and is a functional
of the free distributions qxi (xi ) and of θ (the dependence on y is left
implicit). The inequality introduced in the third expression makes use
of Jensen’s inequality.
Beal notes: “Defining the energy of a global configuration (x, y) to
be ln(p(x, y|θ)), the lower bound F (qx (x), θ) ≤ L(θ) is the negative of
a quantity known in statistical physics as the free energy: the expected
energy under qx (x) minus the entropy of qx (x) (Feynman, 1972; Neal
and Hinton, 1998).”
Beal further notes that F (qx (x), θ) is the negative of what is
known, in statistical thermodynamics, as the free energy of a system,

34

which is the expected energy (H) under qx (x) minus the entropy of
qx (x). Thus, when we shift to the notation of Friston (op.cit.), we
reverse the signs on all of the terms on the right-hand-side of Eqn. 34.
As is often noted [2, 4, 9], since the DKL >= 0, the free energy
for the model is a lower bound for the free energy of the external
system. As the model is brought closer to alignment with the external
system (the K-L divergence decreases), the free energy of the model
approaches that of the external system (L(s̃, ã, r̃) => F (s̃, ã, r̃)).

7 The variational free energy in a new
computational engine
7.1

2-D cluster variation method overview

This Technical Report is more aligned with Friston’s approach, and
yet has some key differences. We envision the formulation of a representational system whose component elements are pre-specified, and
which is distinct from the external system that is being represented.
Further, we envision a total system (external together with representation) in which both the external and representational systems can,
and indeed do, separately achieve free energy minimization. Their
ability to do this requires, of course, that a free energy equation
exists for each of these respective systems.
One way in which we can have a system that allows for both free
energy minimization and suitable modeling richness is to use a 2D system constructed as a grid of bistate nodes, as is shown in the
following Fig. 5. In such a system, we can use the cluster variation
method (CVM) to compute a free energy, for which the entropy term
is more complex than is typically used. The theoretical basis for this
was first developed by Kikuchi [10], and then jointly by Kikuchi and
Brush [11]. A more recent desription is provided in Maren [7].
The key measurable variables within a CVM system are the configuration variables. In addition to the simple identification of proportional numbers of “on” (A, black) and “off” (B, white) nodes, these
configuration variables also account for the various kinds of nearestneighbor (yi ) and next-nearest-neighbor (wi ) pairs, as well as the six
different kinds of triplets (denoted zi ). (A figure in Appendix C illustrates these different configuration variables.)
In using the CVM method for describing the free energy, the equi-

35

librium distribution of nodes is governed by two enthalpy parameters,
ε0 and ε1 . These parameters are the only “tunable” parameters available in the CVM formulation, and thus are identified with θ, as used
by Friston (op. cit.) and Beal [4].
For the case where the distribution of units into the two states
A and B is equiprobable, the activation enthalpy parameter ε0 is by
definition zero. This leaves only a single “tunable” parameter, ε1 ; the
interaction enthalpy parameter. For this specific case, where the fractions of A and B nodes are equal, there is an analytic solution that
provides the relative equilibrium fractions of the different configuration variables as a function of ε1 . Due to how the equilibrium solution
for the configuration variables is expressed, it is easier to refer to a
parameter that is a function of ε1 than that specific value itself. Thus,
we normally use the h-value, where h = exp(2ε1 ).
The analytic solution is not particularly accurate for larger h-values
(e.g., h > 1.6), but it provides a starting point for computational free
energy minimization, for a given system and a corresponding given
h-value.
Formally speaking, to apply the free energy principle (or indeed
variational Bayes to any given data), it is entirely sufficient to specify
a generative model in terms of a joint distribution over data and their
latent causes or, in a Markov blanket partition, sensory and external
states (where sensory states are augmented with internal and active
states in the Markov blanket formalism).
Appendix C describes the implicit generative model that CVM
entails to give an idea of the sort of data it can generate and therefore
explain or recognize. The following subsections present an illustration
of how the 2-D CVM would actually look in application.

7.2

CVM illustration

The following Fig. 5 illustrates initial prototype designs for two systems; (a) corresponds to the external (ψ̃) system, and (b) corresponds
to the representational system (r̃). (This follows notation introduced
by Friston [3].) The grid pattern of active (A) and inactive (B) units
is suitable for modeling using a 2-D cluster variation method (CVM)
free energy equation, as described in Maren [7].
Neither of the two systems depicted in Fig. 5 are at equilibrium;
both are hand-crafted with the intent of embodying a scale-free type of
system. Thus, the first step was to identify a likely h-value candidate

36

(for the external, or Ψ̃, system), and then to computationally bring
that system into a free energy minimum for that particular h-value,
which was determined to be approximately 1.2. (Detailed experimental results are in Maren [12].)
In actuality, we would most likely not know the h-values (plural
because we would not be assured of the equiprobability of A and B
nodes) for the external Ψ̃ system. We would likely be able to sample
the configuration variables at various locations, and for various degrees
of granularity, for the external system. These would become the inputs
(s̃) to the units in the representational system r̃.
The two systems shown in Fig. 5 have similar pattern configurations, with the exception that the larger system shown in (a) has clusters that are proportionately larger than the clusters in the smallerscale representational system (b). The natures of the patterns within
each, though, are much the same. Thus, to a first order, they should
have similar (reduced) free energies. More to the point, we envision
that the representational system shown in (b) can be brought into
alignment with that of (a), or (more specifically) be brought to a
free energy minimium with the same (or similar) h-value as with the
h-value corresponding to the external system of (a).

7.3 Interpreting the CVM in the variational
Bayes framework
The variational Bayes method provides a framework for a new computational engine, and the first step towards this is illustrated in Figure 6.
As with the previous Fig. 5, the larger-scale system on the left (a)
corresponds to the external system. In the case of Fig. 6, though,
the system has been brought to a free energy minimum, for the case
where ε0 = 0 (since the system has been designed with equiprobable
distribution of A and B nodes), and where h = 1.2. (Recall that
h = exp(2ε1 ).) The selection of h = 1.2 was done by first (computationally) counting the distribution of all the different nearest-neighbor
and next-nearest-neighbor pairs, as well as the different triplets, and
then computing their relative fractions as configuration variables.
Using the analytic solution for equilibrium values of the configuration values as functions of h, it was possible to estimate a range of
possible values for h. (Since the original system of Fig. 5 was not at
equilibrium, the various configuration values corresponded to different analytic h-values.) For simplicity, the next step was done using

37

Figure 5: Illustration of two systems, arranged so that a 2-D CVM-based
free energy can be directly computed for each. (a) The external system,
with units denoted ψ̃. (b) The representational system, showing only the
representational units,(r̃). The Markov blanket around the grid of representational units is not shown in this figure. The dark and light-shaded grey
and mottled units to the upper and right edges of each system illustrate the
wrap-around from the left and bottom edges, used to compute the configuration variables leading to the free energies of each system. Both systems show
an approximate scale-free distributuion of islands of dark (A) units in a sea
of white (B) units. The systems are designed with equiprobable distribution
of units into states A and B (xA = xB = 0.5), so that the (reduced) free
energies of each can be computed directly, using the analytic solution provided in Maren [7]. Details of the corresponding thermodynamic calculations
are found in Maren [12], and a detailed exposition is in progress [22]. The
systems shown in this figure have been hand-designed to illustrate a potential scale-free configuration; they have not yet been brought into free energy
minimization.

38

Figure 6: (a) The external system Ψ̃ has been brought to a free energy
minimum for the case where h = 1.2. Sampling this system provides different
inputs to the representational system with units r̃. In reality, we would not
directly know the h-values corresponding to Ψ̃. However, we would trust
that the system r̃, taking its configuration values from sensing applied to the
units ψ̃, would also be at equilibrium. Finding the h-values for r̃ would give
us the parameters for the model q̃, shown in (b). In this particular case, as
the full set of h-values corresponding to different configuration values still
needs to be developed, the system q̃ was devised for illustration purposes by
performing free energy minimization on r̃, shown in the previous Fig. 5, for
h = 1.2. The equilibrium configuration values for Ψ̃ and q̃ are shown in (c).

39

h = 1.2, which was the h-value corresponding to the nearest-neighbor
pairs for unlike nodes. For details, see Maren [12].)
We can see, in Fig. 6, that in both the external system (a) and the
model (b), some of the respective units ψ̃ as well as the units in the
model q have taken on different values. (The total numbers of units in
states A and B remains equal, in each of these systems. This allows
us to apply the analytic solution as a starting point for selecting an
h-value.)
For each of these systems, we see a set of configuration variables
that now represent at-equilibrium values for the case where h = 1.2.
Under normal circumstances, we would be directly bringing the external system Ψ̃ to equilibrium; we would instead be sampling it with
our sensory units s̃. These sensory units would influence the representational units r̃.
As we bring the model of the representational system into free equilibrium, the configuration variables reflect what would be the case for
overall equilibrium in the external system Ψ̃. These configuration variables describe the topography of an at-equilibrium system. Further,
the equilibrium state for this set of configuration variables corresponds
to a specific h-value, which here functions as a model parameter θ. (In
a more complete build-out of this approach, we would be able to vary
both the activation enthalpy ε0 and the interaction enthalpy ε1 parameters, where for our purposes, h = exp(2ε1 ). This means that we
would be able to identify a full set of configuration variables with just
the parameter set θ = (ε0 , ε1 ).
As the phase space map for various equilibrium configuration values versus different h-values becomes worked out, it will be possible to
find a corresponding set of h-values given an initial set of configuration
values. It will then be possible to perform free energy minimization
on the system r̃, using different candidate h-values together with estimates for the activation enthalpy parameter ε0 , to obtain a resultant
model q̃ that provides an acceptable fit to the units in the representational system r̃.
This mechanism can further be used to model the external system
Ψ̃ as it moves through different states, with various corresponding
h-values. This means that we would potentially have a means for
modeling evolving system dynamics over time. Moreover, the model
would be encapsulated into an h-values trajectory, which would be a
relatively simple θ model.

40

8

Conclusions

“‘What?’ Female was an alien language, but he usually could
translate it well enough to understand what was being said. But this
[was] ...”
Tangled Webs
Anne Bishop (2008), p. 159 (Hardcover edition).
This Technical Report has served three purposes:
1. Perform a “Rosetta Stone” translation,
2. Describe how the external and representational systems begin
as separate entities, each of which can (separately) come to free
energy equilibrium, and
3. Introduce a method for system representation that could, within
itself, undergo free energy minimization in order to yield a resulting model which could be described using only one or two
parameters (the θ elements of the model q).
There has been substantial grumbling within the research community about how difficult it has been to read and understand Karl
Friston’s various articles. (See Freed [13] as just one example.) Some
of this is notational; Friston has changed his notation subtly - just
enough to be difficult for (and perhaps maddening to) the reader throughout his various articles. Yet, a growing sense that he’s presenting a very useful approach is driving more and more researchers
to attempt to read his works. (See, e.g., Raviv [14].)
This desire to understand the fundamental variational Bayes approach, and Friston’s extension to describing external systems and
their corresponding representational systems (separated by a Markov
blanket), is growing. The variational Bayes methods are receiving
greater attention, as a next step in machine learning methods, as recently described by Yellapragada and Konkimalla [15]. Wainwright
and Jordan (2008) have published an extensive tutorial on variational
Bayes, setting it in the overarching context of graph theory [16].
Thus, the first intention of this work has been to perform a “Rosetta
Stone” translation between the variational Bayes derivation as given
by Beal [4] and the subsequent ones given by Friston [1, 2, 3], with
particular attention to how the shifts in notation reflect a move from
an envisioning where both the external and representational systems
are predicated on the same underlying variables xi to one in which

41

the external and model states can be separated. This should make
Friston’s works more readable to the broader scientific community.
The second intention has been envisioning how this formulation
can be used for a scenario in which the external and representational
systems begin as separate entities, each of which can (separately) come
to free energy equilibrium. (As an example, see Friston and Frith [17]
for an example cast in terms of communication and birdsong.) This is
important, because we have not typically thought about how various
systems (whether external or representational) need to be expressed
in a way that allows free energy minimization.
As one of Friston’s key points is that free energy minimization underlies crucial processes (including brain processes), we need to have
a better understanding of this premise. Some work, such as that done
by a team led by Moran and published by Cullen et al. [18], has
already shown the validity of this approach. That work shows how
a variational Bayes approach can outperform reinforcement learning,
within a specific and constrained operational environment. Those experiments indicate a promising direction for future investigation.
The third intention has been to introduce a means for representing a system, that is, the r̃ component of the system model, using a
2-D cluster variation method approach. This gives us a representation for which we can write a free energy equation, and thus carry
out explicit free energy minimization, leading to parameter identification for the free energy-minimized state. This approach has only
been briefly sketched; greater expostulation is provided elsewhere and
further developmental work is underway.
It is possibly this last intention that will prove the most valuable
over time. There is currently a paucity of useful models for which
free energy minimization is an inherently appropriate method. Specifically, the well-known Ising model (which has become dearly beloved
within deep learning circles) does not offer sufficient richness for more
complex system modeling. The 2-D CVM approach allows both for
richness in expression and a simplicity in terms of the two parameters
that govern this expression.
The impediment thus far has been that the CVM approach has
been theoretically obscure, and its practical capabilities so far unknown. In fact, the phase space behavior of this model - in terms
of identifying how the activation and interaction enthalpy parameters
impact the resulting free energy-minimized states - has not yet been
fully mapped out. This is largely a computational problem, somewhat

42

aided and abetted by (limited) analytic solutions. Work on the 2-D
CVM is underway, which should make this model available for use in
the near future as a means for implementing model systems that can,
within their own nature, be free energy-minimized. This will introduce
a new kind of modeling capability for a wide range of applications.

Acknowledgments
I am enormously indebted to Karl Friston for careful, detailed, and
thoughtful reviews, together with very useful suggestions for rewording
a few explanations.

Declaration of No Conflicts
The author declares that the research was conducted in the absence
of any commercial or financial relationships that could be construed
as a potential conflict of interest.

Code Availability
The Python code for computing the 2-D CVM configurations, together with the corresponding entropy, enthalpy, and free energy values, will available from the author (as soon as the summary paper is published) on GitHub, and also on the author’s website at
www.aliannajmaren.com/patents-publications/.
Those who want early (and very rough) code drafts may contact
the author at: alianna@aliannajmaren.com. An alternative address
is alianna.maren@northwestern.edu, although emails to this address
tend to get lost in the swarm of student emails. Those who “Opt-In”
at the author’s website (www.aliannajmaren.com) will receive word
when code is released, along with word on new experimental results
with the 2-D cluster variation method.

43

A Appendix: Fundamental thermodynamic concepts
In various commentaries, researchers note that the term “thermodynamic free energy,” as used by Friston (op. cit.) does not really
correspond to a a true thermodynamic free energy. Similarly, there is
a difference in the enthalpy term, as computed and used in Friston’s
work (and in others using the variational Bayes method) and in the
notion of enthalpy as it is found in statistical thermodynamics.
This Appendix briefly overviews some of the key concepts in statistical (and classical) thermodynamics, so that it is easier to compare
the formalisms resulting from the variational Bayes method described
in the body of this Report with the corresponding formalisms from
statistical thermodynamics, as is commonly known.
Note that the thermodynamic quantities of free energy (F ), enthalpy (H), and entropy (S) are all extensive variables; their values
are subject to the number of total units in a given system. However,
we will work throughout with the reduced variables, (F̄ ), the enthalpy
(H̄), and the entropy (S̄), for which the previous values have been divided through by N kβ T , where N is the total number of units in the
system, kβ is Boltzmann’s constant, and T is the temperature. This
reduces all values to dimensionless quantities which are independent
of the size of the systems under consideration. For the remainder of
this work, the overhead bar notation on the reduced thermodynamic
variables will be dropped; all quantities are understood to be reduced.
F = H − T S,

(A-1)

where F , called the free energy, is the energy available to do work, H
is the enthalpy (also called the internal energy) of a system, T is the
(absolute) temperature, and S is the entropy.
From a statistical thermodynamics perspective, in order to calculate any of these terms, we first need the probabilistic distribution of
units in the system among available states. (Several of the following
equations are drawn from Salzman [19], who has provided a lucid and
cogent introduction. Another useful source, especially for describing
how microstates are computed, is found in Maren [20].)

44

A.1

The classic partition function

To introduce the statistical thermodynamics approach to describing
the free energy of a system, we begin with a simple (and classical)
expression for the probability of finding a system in the quantum state
i, characterized by energy Ei , as
Pi ∝ exp(−Ei /kβ T ),

(A-2)

where kβ is Boltzmann’s constant and T is temperature.
We note that the energy Ei describes the energy of the entire
system of N units, and that there very well may be degeneracy in the
ways in which various units can be assembled to yield a certain energy.
As is true for any probability distribution,
n
X

Pi = 1.

(A-3)

i=1

In Eqn. A-2, we stated a proportionality. Now, to find the proportional constant c, we state that
Pi = c exp(−Ei /kβ T ),

(A-4)

which gives us
n
X
i=1

Pi =

n
X

c exp(−Ei /kβ T ) = c

i=1

n
X

exp(−Ei /kβ T ) = 1,

(A-5)

i=1

so that
c = 1/

n
X

exp(−Ei /kβ T ).

(A-6)

i=1

This sum of probabilities becomes a valuable quantity in and of
itself; we refer to it as the partition function, Q (and in some sources
referred to as Z), so that
Q=

n
X

exp(−Ei /kβ T ).,

(A-7)

i=1

which allows us to phrase a distinct probability as
P = exp(−Ei /kβ T )/Q.

45

(A-8)

A.2

The classic enthalpy formulation

Now, we define the average energy H, or enthalpy, of a system to be
the expectation for the energy of the system, which can be described
as the average of the sum of all the energies of the system,
H = hhEi ii
n
X
=
Ei Pi
i=1

=

n
X

Ei exp(−Ei /kβ T )/Q

(A-9)

i=1
n

1 X
Ei exp(−Ei /kβ T ).
=
Q
i=1

For simplicity, we introduce the notation that β = 1/kβ T , so that
n

1 X
H=
Ei exp(−βEi ).
Q

(A-10)

i=1

Now, we notice that we can make a further simplification, by observing that
Ei

exp(−βEi )
1 ∂
=−
exp(−βEi )
Q
Q ∂β

(A-11)

so that
∂
exp(−βEi )
∂β
Thus, we can rewrite Eqn. A-10 as
Ei exp(−βEi ) = −

H=

(A-12)

n
X
Ei exp(−βEi )

Q

i=1
n

=−

1 X ∂
exp(−βEi )
Q
∂β

(A-13)

i=1

=−

n
1 ∂ X
exp(−βEi ).
Q ∂β
i=1

We notice, from Eqn. A-7 that the entire of the summation in
Eqn. A-13 is exactly Q itself. Thus, we can rewrite the expression for
H in Eqn. A-13 as

46

n
1 ∂ X
1 ∂
H=−
exp(−βEi ) = −
Q.
Q ∂β
Q ∂β

(A-14)

i=1

We recall the expression for the derivative of a logarithmic function, that
∂
1 ∂y(x)
ln(y(x)) =
.
∂x
y ∂x

(A-15)

Thus, noticing the correspondence between Q = Q(β) = y(x), we
can identify that
∂
1 ∂Q(β)
ln(Q(β)) =
.
∂β
Q ∂β

(A-16)

This allows us to rewrite Eqn. A-14 as

H=−

1 ∂
∂
∂
Q = − ln(Q(β)) = − ln(Q),
Q ∂β
∂β
∂β

(A-17)

dropping the functional dependence of Q on β in the last expression.
This gives us a very powerful means for expression the enthalpy,
or internal energy, of a system in terms of ln(Q). However, it is not a
completely general expression for H. Instead, we note that by taking
the (negative of) the derivative of ln(Q) with respect to β, we are
moving to a value of ln(Q) that maximizes (minimizes) the function
in terms of temperature (actually, 1/T ). This then leads us to the
value of enthalpy, H, that helps to minimize the overall value for the
free energy, F . The value of H that would occur in this case (taking
into account the impact of entropy), would then be the expected value
of H when the system is at equilibrium.
What we can generalize from this is not so much the specific formulation for H (as a partial derivative of ln(Q) with respect to β),
but rather, that we are looking for an expected value of H. Depending on how the system is formulated, it could be a different resulting
expression.

47

B Appendix B: Variational Free Energy: Enthalpy and Entropy
This Appendix provides more detail on the derivation of the free energy equation as given in Friston [2], [3], using the formulation established by Beal [4], and making the correspondence between the notations of each. It yields the expression of the variational free energy in
terms of what Friston refers to as expected energy or enthalpy (and
in one source [3], as “thermodynamic free energy”) plus an entropy
term. This expected energy or enthalpy is actual the expectation for
the (negative of the) log-likelihood of a certain distribution, as given
in Eqn. 33, which is restated here as
L(x̃) = L(ψ̃, s̃, ã, r̃) = − ln p(ψ̃, s̃, ã, r̃),
If we were to use a 2-D CVM grid to represent the external and
internal (representational) states, we would take our probabilities as
the actual fractional values for the different configuration variables,
and we would use the entropy term from the 2-D CVM formalism (see
Appendix C, and references cited therein) to suggest a structuring for
the probabilities in the L(x̃) and entropy terms.
We will, very shortly, follow a line of argument introduced by Beal.
One of the steps that he makes at a certain conclusion gives a form
of the enthalpy equation, which is fundamentally the same as used by
Friston (op. cit.), and is the one that we have shown in Section 5. It
will be that
XZ
H=
dxi qxi (xi ) ln p(xi , yi |θ).
(B-1)
i=1

In the next few paragraphs, we will show that Eqn. B-1 serves
analogously to Eqn. A-17. It fits the role of enthalpy in what is being
described in a “free energy” formalism. However, it is not a derivative equation; it is the expectation for the natural logarithm of the
probability of certain variables.
By examining the correspondence between the two expressions (the
variational Bayes in comparison with the thermodynamic), when we
come to expressing the full free energy for the representational system
(using the formulation expressed by Beal), the free energy derivation
will be much more lucid.

48

Beal [4] (Sect. 2.2.1) introduces the scenario for parameter learning with the notion of a generative model with hidden variables x
and observed variables y, where the dataset of observed variables
y = {y1 , ..., yn } are generated by the set of hidden variables x =
{x1 , ..., xn }, and where the n items in each case are independent and
identically distributed (i.i.d.). He identifies the parameters describing
the (potentially) stochastic dependencies between variables as θ. The
probability distribution for observing y (Beal, 2003, Eqn. 2.9) is given
as
p(y|θ) =

n
Y

p(yi |θ) =

i=1

n Z
Y

dxi p(xi , yi |θ).

(B-2)

i=1

This tells us that the probability distribution of the observable
variables yi is conditioned on the parameters θ.
We compare this with our earlier expression for the probability that
a system would be in the ith energy state, where we stated in Eqn. A-7
that the partition function Q (which served as a normalizing factor)
is given as
Q=

n
X

exp(−Ei /kβ T ),

i=1

and from Eqn. A-8 that probability is given as
P = Pi = exp(−Ei /kβ T )/Q.
The difference in the two formulations is that, in Eqn. A-8, we are
dealing with the probability of finding a system in a given ith energy
state, where there could indeed be multiplicity of units inhabiting
various components of that overall system’s energy state, and there
can also be degeneracy in the units inhabiting the various states. This
means, various units, indistinguishable from each other, can inhabit
the energy states so that there are multiple means of counting the
units in various states and coming up with the same overall ith system
energy.
In contrast, the formulation given in Eqn. B-2 deals with a full set
of observed variables, y = {y1 , ..., yn }.
As we know from the formulation of joint probabilities, the joint
probability of observing variable y1 in a given state i, p(y1 = i), together with the probability of observing variable y2 in its own given
state j, p(y2 = j), is p(y1 = i)p(y2 = j). Thus, for a set of such states,

49

y = {y1 , ..., yn }, we need the product of each of the unique variable’s
probability, which yields the first part of Eqn. B-2;
p(y|θ) =

n
Y

p(yi |θ).

(B-3)

i=1

As a second step in making the correlation between Eqn. B-2 and
the combination of Eqns. A-7 and A-8, we examine the formulation
(from Eqn. B-2)
Z
p(yi |θ) = dxi p(xi , yi |θ).
(B-4)
We note that Eqn. B-4 essentially states that the observable variable(s) yi are dependent on a hidden, unobservable set of variables
xi . For each distinct value (or set of values) yi , there are potentially
multiple contributions, drawn over the complete set of xi . The notation here (keeping to that used by Beal) is just a little ambiguous;
it does not mean that the set of countable variables xj is exactly the
same as the set of countable variables yi . Rather, it is saying that for
a given instance of a set of variables yi , there is a corresponding set
of variables xi , xi ≡ {Xi } = {xi,1 , xi,2 , ..., xi,J }, where J is the total
number of elements in the set of variables {Xi } contributing to values
for yi .
This means, since each of these contribute to the value for yi , that
summation (rather than multiplication) is needed. Since the realm of
variables constituting {Xi } is assumed here to be large, integration
rather than summation is used. This, then, gives us a plausibility
argument in support of Eqn. B-2.
Before moving on, we need one more step. Eqn. B-1 involves more
than the probability distribution of Eqn. B-2. We note that in Eqn. B1, we have a summation rather than a product, the natural logarithm
of p(xi , yi |θ) as opposed to just a simple statement of the probability,
and an additional modulating term, qxi (xi ).
To see how these occur, we go back to our original definition of the
enthalpy, H, as given in Eqn. A-17;
H=−

1 ∂
∂
∂
Q = − ln(Q(β)) = − ln(Q).
Q ∂β
∂β
∂β

Suppose that we have a probability distribution given as

50

p(y|θ) =

n
Y

p(yi |θ).

(B-5)

i=1

Then, the natural logarithm of this distribution is given as
ln p(y|θ) = ln

n
Y

p(yi |θ) =

i=1

n
X

ln p(yi |θ).

(B-6)

i=1

We do not have agreement between the formulation given in
Eqn. B-1 and that given in Eqn. A-13 together with Eqn. A-14.
Moving on, we now turn our attention to the derivation for the
free energy as introduced in Beal [4].
Beal introduces a formulation for the log likelihood in his Eqns.
2.12 - 2.16, reproduced here:

L(θ) =

X

Z
dxi p(xi , yi |θ)

ln

i=1

=

X

dxi qxi (xi )

p(xi , yi |θ)
qxi (xi )

dxi qxi (xi ) ln

p(xi , yi |θ)
qxi (xi )

Z
ln

i=1

≥

XZ
i=1

=

X Z

Z
dxi qxi (xi ) ln p(xi , yi |θ) −


dxi qxi (xi ) ln qxi (xi )

i=1

=

X Z

 Z
dxi qxi (xi ) ln p(xi , yi |θ) − dxi qxi (xi ) ln qxi (xi )

i=1

≡ F (qx1 (x1 ), ..., qxn (xn ), θ).
(B-7)
Beal notes that F (qx (x), θ) is a lower bound on L(θ) and is a
functional of the free distributions qxi (xi ) and of θ (the dependence
on y is left implicit). The inequality introduced in the third expression
makes use of Jensen’s inequality.
Beal notes: “Defining the energy of a global configuration (x, y) to
be ln(p(x, y|θ)), the lower bound F (qx (x), θ) ≤ L(θ) is the negative of
a quantity known in statistical physics as the free energy: the expected
energy under qx (x) minus the entropy of qx (x) (Feynman, 1972; Neal
and Hinton, 1998).”

51

Thus, both F (qx (x), θ) and L(θ) refer to free energy formalization,
however, L(θ) can be greater than F (qx (x), θ). Alternatively, we can
say that F (qx (x), θ) is a lower bound on L(θ).
Essentially (in Beal’s conception; Friston’s is reversed), we’re saying that the free energy of the model is going to be lower than the
free energy of the system being modeled; L ≥ F . If we are going to
improve the accuracy of the model, we will be bringing F (qx (x), θ)
towards L(θ).
Beal further notes that F (qx (x), θ) is the negative of what is
known, in statistical thermodynamics, as the free energy of a system,
which is the expected energy (H) under qx (x) minus the entropy of
qx (x). Thus, when we shift to the notation of Friston (op.cit.), we will
reverse the signs on all of the terms on the right-hand-side of Eqn. B-7
(second-to-last line of the equation), leading up to Beal’s definition of
F (qx (x), θ).
According to this understanding, and changing the signs of the
terms to deal with Beal’s use of F (qx (x), θ) as the negative of the
free energy, we have the expected energy (or enthalpy) of a system H
is given as
XZ
H=−
dxi qxi (xi ) ln p(xi , yi |θ),
(B-8)
i=1

and
S=−

XZ

dxi qxi (xi ) ln qxi (xi ).

(B-9)

i=1

The definition for the entropy of a system is given as
S = −kβ ln Ω.

(B-10)

An alternative formulation is
S = −kβ hln P i,

(B-11)

where P is the probability distribution over all states. Thus, S is the
expectation of the probability of the variable for which various states
are possible; i.e., this correlates directly with Eqn. B-9, and where Ω
is the grand partition function, and kβ is Boltzmann’s constant.
From Feynman (1972), Eqn. 1.1, that

52

Q=

X

exp(−En /kT ) ≡ exp(−F/kT ).

(B-12)

n

From Feynman (1972) we have the definition for F , the Helmholtz
free energy, as
!
X
F = −kT ln Q = −kT ln
exp(−En /kT )
(B-13)
n

and also (Eqn. 1.3)
S = −k

X

Pn ln Pn ,

(B-14)

n

where (Eqn. 1.4)
Pn =

1
exp(−En /kT ).
Q

(B-15)

Further, the average energy per unit, U (also known as the enthalpy), is given as (Eqn. 1.7)
U=

1 X
En exp(−En /kT ),
Q n

(B-16)

which can be rewritten as
U=

X

En Pn .

(B-17)

n

Essentially, Eqn. B-17 states that the enthalpy of a system (the
total energy of the system), is simply the sum of the energy-per-state,
multiplied by the probability that a unit will be in that state, where
the whole is summed over all the units in the system.
This derivation by Feynman is perhaps a bit more intuitive than
that put forth in Appendix A, and may be preferred.

C Appendix: The Cluster Variation
Method
This Appendix provides a very brief overview of the cluster variation
method (CVM), specifically the 2-D CVM. In particular, it provides:

53

1. Notion of the configuration variables, together with illustrations
of how they appear within a 2-D CVM grid,
2. The free energy equation for the 2-D CVM, along with the equations for the equilibrium values for the different configuration
variables, which are analytically available when there is an equiprobable distribution of nodes into states A and B; i.e., x1 = x2 =
0.5, and
3. A very quick sketch of the actual free energy minimization protocol, which defines how an actual at-equilibrium 2-D CVM grid
configuration can be obtained, together with all associated configuration variable values and thermodynamic values for the system.
The goal of this Appendix is to provide just enough information
to make Section 7 more readable for those who wish to understand
the potential role of a 2-D CVM system in a computational system
embodying a variational Bayes approach, within the context used here
of separating the representational system from the external one via a
Markov blanket.
For those wishing to pursue the 2-D CVM in more depth, the most
accessible starting place is provided in Maren [7]. This overviews the
CVM approach for both 1-D and 2-D systems. It also suggests how,
in particular, a 2-D CVM approach can potentially relate to modeling
neural activation topographies, and can also fit in with descriptions of
statistical mechanics in the brain.
The CVM was first developed by Kikuchi [10], and then jointly
by Kikuchi and Brush [11]. Kikuchi and Brush presented an analytic
solution for both the 1-D and 2-D systems for the equiprobable distribution case. They did not provide details for this analytic solution.
The derivation steps for the 1-D case are in Maren (2014) [21], and
for the 2-D case are in Maren (2019) [22].

C.1

Configuration variables

The cluster variation method, introduced by Kikuchi [10] and refined
by Kikuchi and Brush [11], uses an entropy term that includes not only
the distribution into simple “on” and “off” states, but also distribution
into local patterns, or configurations, as illustrated in the following
figure.

54

A 2-D CVM is characterized by a set of configuration variables,
which collectively represent single unit, pairwise combination, and
triplet values. The configuration variables are denoted as:
• xi - Single units,
• yi - Nearest-neighbor pairs,
• wi - Next-nearest-neighbor pairs, and
• zi - Triplets.
The degeneracy factors βi and γi (number of ways of constructing a
given configuration variable) are shown in the following figure; β2 = 2,
as y2 and w2 can be constructed as either A-B or as B-A for y2 , or
as B- -A or as A- -B for w2 . Similarly, γ2 = γ5 = 2 (for the triplets),
as there are two ways each for constructing the triplets z2 and z5 . All
other degeneracy factors are set to 1.

Figure 7: Illustration of the configuration variables for the cluster variation
method, showing the ways in which the configuration variables yi , wi , and zi
can be constructed, together with their degeneracy factors βi and γi .

55

Notice that within the preceding figure, the triplets z2 and z5 have
two possible configurations each: A-A-B and B-A-A for z2 , and BB-A and A-B-B for z5 . This means that there is a degeneracy
factor of 2 for each of the z2 and z5 triplets.

C.2

Free energy for the 2-D CVM

The analytic solution for the case where x1 = x2 = 0.5 can be found
when we are using the full interaction enthalpy term of ε1 ∗ (2y2 − y1 −
y3). This solution is presented in Maren (2019) [22].
The free energy equation for a 2-D CVM system, including configuration variables in the entropy term, is
Ḡ2−D = G2−D /N =
ε1 (−z1 + z3 + z4 − z6 )
" 3
#
3
2
6
X
X
X
X
− 2
βi Lf (yi )) +
βi Lf (wi )) −
βi Lf (xi )) − 2
γi Lf (zi )
i=1

+µ(1 −

i=1
6
X

i=1

i=1

γi zi ) + 4λ(z3 + z5 − z2 − z4 )

i=1

(C-1)
where µ and λ are Lagrange multipliers, and we have set kβ T = 1.
The single enthalpy parameter here is ε1 , with the enthalpy parameter for unit activation implicitly set to zero, as the intention has
been to solve the above equation for an analytic solution, which is possible only in the case where x1 = x2 = 0.5, meaning that the per-unit
enthalpy activation parameter ε0 = 0.
When we use ε1 (2y2 −y1 −y3 ) = ε1 (−z1 +z3 +z4 −z6 ) as the enthalpy
expression (as is done in the previous equation), we can obtain an
analytic solution for each of the configuration variables. For example,
we find the expression for z3 in terms of h as
z3 =

(h − 3)(h + 1)
.
8[h2 − 6h + 1]

(C-2)

(Note: See Maren (2019) [22] for full derivations. This corresponds
with Eqn. (I.25) in Kikuchi and Brush (1967) [11].)
Similar expressions can be obtained for the remaining configuration
variables.

56

The experimentally-generated results from probabilistically-generated
data sets correspond to the analytic results in the neighborhood of
ε0 = 0. The reason that the range is so limited is that the analytic
solution makes use of equivalence relations as expressed above.
The resulting solution of Eqn. C-2 clearly has a divergence in it,
due to the quadratic expression in the denominator. There are two
solutions to the quadratic expression. We are interested in the case
where the value of h > 1 indicates that ε1 > 0, which is the case
where the interaction enthalpy favors like-near-like interactions, or
some degree of gathering of similar units into clusters. This means
that we expect that the computational results would differ from the
analytic as h approaches the divergence point.
The divergence in the analytic solution is an artifact. However, it
does indicate that for larger h-values, the analytic solution will not
be accurate. Thus, for high h-values, we take the analytic solution
simply as a starting point, and invoke a protocol for determining the
correct configuration variable values associated with a given h-value,
as described in Maren [22].

C.3 Free energy minimization protocol for the
2-D CVM
An initial 2-D CVM grid, whether manually designed or randomlygenerated, is typically not at equilibrium. More specifically, the various configuration variable values will typically correspond to different
h-values. Each h-value indicates a unique free energy minimum solution. Thus, we need to take the initial grid through a free energy
minimization process, in order to obtain a grid where the various configuration variables all correspond to a single free energy minimum.
This requires using a free energy minimization protocol.
This protocol takes a computational approach, so that given an
initial 2-D CVM grid pattern, the steps are to:
1. Obtain an initial estimate for a candidate h-value,
2. Determine the associated thermodynamic values for that particular h-value estimate and current set of configuration values,
and
3. Adjust the node activations in order to minimize the free energy
for that given h-value, yielding a new grid configuration and associated set of configuration variables and thermodynamic values.

57

See Maren [23] for the code verification and validation documentation. Code release will be provided at a later date.
As a preliminary step, a computer program is used to obtain the
actual counts for each of the different configuration variables. The
next step is to find the corresponding h-values for each of three different configuration variables; z1 , z3 , and y2 . These are selected because,
taken together, they are reasonably descriptive of the grid topography:
• z1 - A-A-A triplets; indicates the relative fraction of A units
that are included in “islands” or “land masses”; this also (indirectly) indicates the compactness of these masses,
• z3 - A-B-A triplets; indicates the relative fraction of A units
that are involved in a “jagged” border (one that involves irregular
protrusions of A into a B space), or the presence of one or more
“rivers” of B units extending into landmass(es) of A units, and
• y2 - A-B nearest-neighbor pairs; indicates the relative extent
to which the A units are distributed among the surrounding B
units.
Initially, each of these configuration variables will correspond to
a different h-value. (This corresponding h-value can be found graphically, via a look-up table, or by extrapolation, using Eqn. C-2 and
similar equations.) This gives us a set of (typically) three h-values.
We can determine which h-value to use via any number of means; it
is reasonable to take an average or mean of the h-values corresponding
to the configuration variable values.
This h-value then is used to define the corresponding ε1 in a program that will iteratively modify the grid configuration. (This is for
the case where x1 = x2 = 0.5, so that ε0 = 0.)
More specifically, the program will randomly select two units, and
ascertain that the first is in the A state and the other is in the B
state. (Random selection continues until one of each has been found.)
The program then “swaps” the two nodes’ states; that which was A
becomes B and vice versa. The program then computes the new set
of configuration variables and the corresponding new thermodynamic
values. If the free energy is reduced, the swap is kept; if not, it is
reversed. The program continues this for a predetermined number of
trials.
Graphical display of the free energy values through this process
shows that the free energy typically drops relatively fast, and then is
impervious to future node swaps.

58

This is, of course, an extremely heavy-handed and simplistic approach. It does not take into account any sense of what might be accomplished by intelligently selecting candidate nodes for which a “flip”
in activation would have the greatest free energy impact. Such a more
sophisticated strategy would require an object-oriented approach, and
the current program is simplistic in terms of node representations.
However, these initial and exploratory experiments have produced
interesting topologies. For example, as shown in the body of this
article, a free energy-minimized grid topography will often have “spider legs” of A units connecting various islands and landmasses of A.
Studies of free energy-minimized topographies are in progress.

C.4 Application to a Variational Bayes Approach
The notion behind offering the 2-D CVM for the extension of variational Bayes into modeling a representational system rests on the
premise that both the external and representational systems, composed of ψ̃ and r̃ units respectively, can be expressed using a 2-D
CVM. The elements for the representational system would be created
by sampling areas of the external system; that is, the sensory elements
s̃ of the Markov blanket would generate elements of r̃.
It is reasonable that neither the external nor the representational
systems would be completely at free energy equilibrium. In the case
of the Ψ̃ system, this could reasonably be due to local influences and
events, and also as the system can be differentially changing in response to various inputs. In the case of the representational system
with r̃ units, this can be attributed to creating its unit activations via
sampling from the ψ̃ units.
The model q is formed by bringing the representational system
r̃ into free energy equilibrium. In this approach, we would actually
go through a free energy minimization process, as that is literally
feasible when we have a 2-D CVM grid. The resulting parameters θ
are the set of (ε0 , ε1 ) values that describe the free energy-minimized
resultant 2-D CVM grid. These two parameters then indicate the
corresponding configuration variables, which define the nature of the
grid’s topography.
While this, in itself, is somewhat interesting, the real value would
lie in taking this kind of 2-D CVM grid into a computational engine.
Inputs from an external source (s̃) can be used to generate certain

59

activations across the grid. The free energy minimization process then
modifies these activations. The resulting node activations can then be
“learned” (using any number of neural network learning methods).
What makes this process potentially interesting and useful is that
we can then take one more step. We can create temporal persistence
of a unit’s activation, as a function of the degree to which it is central
to an island or landmass of similar units. In short, we have a means for
inducing temporal persistence that is dependent on a form of lateral
interactions (i.e., neighborliness to units that are similarly in an active
state). This means that a given unit’s activation is now a function of
two factors; the typical input from an external stimulus, and a lateral
interaction.

References
[1] K. Friston, “The free-energy principle: a unified brain theory?,”
Nat. Rev. Neurosci., vol. 11, p. 127138, 2010. doi:10.1038/nrn2787.
[2] K. Friston, “Life as we know it,” Journal of The Royal Society
Interface, vol. 10, no. 86, 2013.
[3] K. Friston, M. Levin, B. Sengupta, and G. Pezzulo, “Knowing ones
place: a free-energy approach to pattern regulation,” J. R. Soc.
Interface, vol. 12, p. 20141383, 2015. doi:10.1098/rsif.2014.1383;
available online at: http://dx.doi.org/10.1098/rsif.2014.1383.
[4] M. J. Beal, Variational algorithms for approximate Bayesian inference. PhD thesis, University College London, 2003. PDF:
http://www.cse.buffalo.edu/faculty/mbeal/papers/beal03.pdf.
[5] R. P. Feynman, Statistical Mechanics. Reading, MA: Benjamin,
1972, 1998.
[6] G. E. Hinton and D. van Camp, “Keeping neural networks simple by minimizing the description length of weights,” in Proc. of
COLT-93, p. 513, 1993. doi:10. 1145/168304.168306.
[7] A.J. Maren, “The cluster variation method: a primer for neuroscientists,” Brain Sciences, vol. 6, no. 4, p. 44, 2016.
[8] B. Sengupta, M. B. Stemmler, and K. J. Friston, “Information and
efficiency in the nervous system–a synthesis,” PLoS Comput Biol.,
vol. 9, no. 7:e1003157, 2013. doi:10.1371/journal.pcbi.1003157.
PMID:23935475. PMCID:PMC3723496. Epub 2013 Jul 25.

60

[9] D. M. Blei, A. Kucukelbir, and J. D. McAuliffe, “Variational inference: A review for statisticians.” arXiv:1601.00670v4 [stat:CO],
2 Nov 2016.
[10] R. Kikuchi, “A theory of cooperative phenomena,” Phys. Rev.,
vol. 988, no. 81, p. 127138, 1951.
[11] R. Kikuchi and S.G. Brush, “Improvement of the cluster variation
method,” J. Chem. Phys., vol. 47, p. 195, 1967.
[12] A.J. Maren, “2-D cluster variation method:
Comparison of Computational and Analytic Results,” June, 2010.
GitHub:
github.com/ajmaren/2D-Cluster-Variation-Method;
MS (TM) PPT Slidedeck: 2D-CVM-Expts-vary-eps0-and-eps1computational-2019-06-17v4.pptx.
[13] P. Freed, “Research Digest,” Neuropsychoanalysis, vol. 12,
no. 1, p. 103-106, 2010. doi:10.1080/15294145.2010.10773634;
https://doi.org/10.1080/15294145.2010.10773634.
[14] S. Raviv, “The genius neuroscientist who might hold the
key to true AI,” Wired, vol. 11, p. 127138, November, 2018. https://www.wired.com/story/karl-friston-free-energyprinciple-artificial-intelligence/.
[15] M.S. Yellapragada and C.P. Konkimalla, “Variational Bayes:
a report on approaches and applications.” arXiv:1905.10744v1
[cs.LG] 26 May 2019.
[16] M.J. Wainwright and M.I. Jordan, “Graphical models, exponential families, and variational inference,” Foundations and
Trends in Machine Learning, vol. 1, no. 1-2, p. 1 - 305, 2008.
doi:10.1561/2200000001.
[17] K.L. Friston and C. Frith, “A duet for one,” Consciousness and Cognition, vol. 36, p. 390-405, Nov., 2015.
doi:10.1016/j.concog.2014.12.003.
[18] M. Cullen, B. Davey, K.J. Friston, and R.J. Moran, “Active Inference in OpenAI Gym: a paradigm for computational investigations
into psychiatric illness,” Biological Psychiatry CNNI, vol. 3, no. 9,
p. 809-818, September, 2018. doi:10.1016/j.bpsc.2018.06.010.
[19] W. Salzman,
Course Materials for Chemistry 480B
- Physical Chemistry,
ch. An introduction to partition functions.
2001.
Published online at:
http://cbc.arizona.edu/∼salzmanr/480b/480b.html.

61

[20] A.J. Maren, Statistical Mechanics, Neural Networks, and Artificial Intelligence: The Précis, In progress. Select chapters available
for download at: http://www.aliannajmaren.com/book/.
[21] A.J. Maren, “The Cluster Variation Method I: 1-D Single Zigzag
Chain: Basic Theory, Analytic Solution and Free Energy Variable
Distributions at Midpoint (x1 = x2 = 0.5),” Themasis Technical
Report 2014-002 (ajm). 2014. doi:10.13140/2.1.4415.6485.
[22] A.J. Maren, “Protocol for Free Energy Minimization in the 2-D
Cluster Variation Method Grid at the Equiprobable Distribution
Axis,” Themasis Technical Report 2019-002 (ajm). 2019. In preparation. To be uploaded to arXiv.
[23] A.J. Maren, “Free Energy Minimization Using the 2-D Cluster
Variation Method: Initial Code Verification and Validation,” Themasis Technical Report 2018-001v2 (ajm). v1: 2018; v2: 2019.
arXiv:1801.08113v2 [cs.NE] 25 Jun 2019.

62

