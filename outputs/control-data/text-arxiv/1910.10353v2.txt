A Novel Energy-conserving Scheme for Eight-dimensional
Hamiltonian Problems
Shiyang Hu1 , Xin Wu1,2,† , Guoqing Huang1 , Enwei Liang2

arXiv:1910.10353v2 [gr-qc] 25 Dec 2019

1. Department of Physics, Nanchang University, Nanchang 330031, People’ s Republic of China
2. Guangxi Key Laboratory for Relativistic Astrophysics & School of Physical Science and Technology,
Guangxi University, Nanning 530004, People’ s Republic of China
† xinwu@gxu.edu.cn

ABSTRACT
We design a novel, exact energy-conserving implicit nonsymplectic integration method for an
eight-dimensional Hamiltonian system with four degrees of freedom. In our algorithm, each partial derivative of the Hamiltonian with respect to one of the phase-space variables is discretized
by the average of eight Hamiltonian difference terms. Such a discretization form is a second-order
approximation to the Hamiltonian gradient. It is shown numerically via simulations of a FermiPasta-Ulam- β system and a post-Newtonian conservative system of compact binaries with one
body spinning that the newly proposed method has extremely good energy-conserving performance, compared to the Runge-Kutta; an implicit midpoint symplectic method, and extended
phase-space explicit symplectic-like integrators. The new method is advantageous over very long
times and for large time steps compared to the state-of-the-art Runge-Kutta method in the accuracy of numerical solutions. Although such an energy-conserving integrator exhibits a higher
computational cost than any one of the other three algorithms, the superior results justify its
use for satisfying some specific purposes on the preservation of energies in numerical simulations
with much longer times, e.g., obtaining a high enough accuracy of the semimajor axis in a Keplerian problem in the solar system or accurately grasping the frequency of a gravitational wave
from a circular orbit in a post-Newtonian system of compact binaries. The new integrator will
be potentially applied to model time-varying external electromagnetic fields or time-dependent
spacetimes.
Subject headings: Black hole physics — Computational methods — Computational astronomy — Chaos
— Compact binary stars

1.

not conserve the invariants of motion and, therefore, cause a secular, unphysical increase in energy
errors even if these systems are conservative. In
this sense, such non-geometric methods are generally discarded. Instead, geometric integration
methods (Hairer et al. 2006) are usually used.
Without doubt, symplectic integrators (Ruth
1983; Feng & Qin 1987; Forest 1990; Wisdom &
Holman 1991; Zhong et al. 2010) are a class of
geometric integration methods. They not only
preserve symplectic structures of Hamiltonian systems but also show no intrinsic unbounded accumulation of energy errors due to their long-term

Introduction

Numerical integration schemes are convenient
to handle many complicated nonlinear dynamical problems, such as the motion of relativistic
charged particles in external electromagnetic fields
(Kopáček & Karas 2014) and general relativistic
systems of compact binaries consisting of black
holes and/or neutron stars (Thorne & Hartle 1985;
Kidder 1995; Buonanno et al. 2006). Although explicit Runge-Kutta (RK) integrators can generally
give very accurate solutions to these systems, they
are nonsymplectic/nongeometric methods that do

1

numerical stability. Symmetric methods (Quinlan
& Tremaine 1990) are similar to the symplectic integrators and do not lead to a secular, unphysical
energy drift. Extended phase-space methods (Pihajoki 2015; Liu et al. 2016; Luo et al. 2017; Li &
Wu 2017) are also explicitly symplectic-like or are
symmetric schemes. As a point to note, the socalled conservation of energies in these integrators
does not mean that these algorithms strictly conserve the energy integrals without any truncation
errors from a theoretical viewpoint, but that does
mean that these algorithms show no secular drift
in the energy errors from a numerical viewpoint.
Are there a class of energy-conserving integrators that can exactly conserve the energy integral
of a conservative Hamiltonian from the theoretical viewpoint? Yes, there are. As a path to
obtain them, the gradient of the Hamiltonian is
discretized by use of Hamiltonian difference terms
so that the Hamiltonian can be exactly conserved
numerically step by step. This conservation of the
Hamiltonian of the system is said to be energy
conservation.1 First-order discrete Hamiltonian
gradient schemes were constructed by Chorin et
al. (1978) and Feng (1985). The construction of
such first-order Hamiltonian-conserving methods
is simple, but those of second-order Hamiltonianconserving schemes may be complicated. The
second-order discretization of the Hamiltonian
gradient depends on the dimension of the Hamiltonian. The second-order discrete gradient scheme
for a 4-dimensional Hamiltonian system with two
degrees of freedom can be found in some references
(Qin 1987; Itoh & Abe 1988; Wang et al. 2008;
Feng & Qin 2009). The discretization of each partial derivative of the Hamiltonian with respect to
one of the position and momentum variables is
the average of four Hamiltonian difference terms.
Recently, an extension to a 6-dimensional Hamiltonian system with three degrees of freedom was
given by Bacchini et al. (2018a). Here, each component of the Hamiltonian gradient is replaced
with the average of six Hamiltonian difference
terms. The number of such average values adds up
to six. This energy-conserving integration scheme

was used to model time-like and null geodesics in
general relativity (Bacchini et al. 2018b). These
exact energy-conserving algorithms are implicit
and nonsymplectic.
It is worth pointing out that the exact conservation of energies is important during numerical
studies of the long-term evolution of conservative
systems in astrophysics. This requirement satisfies
a physical need of conservative systems. In addition, it is based on a need of some specific purposes in numerical simulations with much longer
times. For example, the Keplerian energy of a
pure Keplerian two-body problem in the solar system closely depends on the orbital semimajor axis,
mean motion, and mean anomaly (Murray & Dermott 1999). The conservation of the Keplerian energy in numerical simulations results in improving
the accuracy of the semimajor axis, eliminating
the Lyapunov instability of orbits, and suppressing
the fast accumulation of numerical errors along the
in-track direction. In particular, this leads to accurately grasping periodic motion (i.e. the orbital
frequency of a circular, spherical or quasi-spherical
orbit) in a system of two black holes (Kidder 1995)
over long times – that is, accurately grasping the
frequency of a gravitational wave emitted from the
circular, spherical, or quasi-spherical orbit. This
is because the frequency of the wave from the circular orbit doubles the frequency of the circular
orbit.
Considering the importance of conserving energy in numerical integrations of long-term evolution of objects in astrophysics, we will generalize
the work of Bacchini et al. (2018a) and construct
a new exact energy-conserving integration method
for an eight-dimensional Hamiltonian with four degrees of freedom in the present paper. This scheme
is also based on Hamiltonian differencing and replaces the Hamiltonian gradient with the average
of eight Hamiltonian difference terms. This discrete average is still a second-order approximation
to the Hamiltonian gradient. This is the main aim
of this paper.
The paper is organized as follows. A new
energy-conserving method is given in Section 2.
Taking a Fermi-Pasta-Ulam- β system (Skokos et
al. 2008; Gerlach et al. 2012) as a tested model
in Section 3, we check the numerical performance
of the new method, compared to that of the RK
method; the implicit midpoint rule (Feng 1986;

1 In

the present paper, this presentation is only based on
the general case in which the Hamiltonian represents some
form of the energy of the system. If the Hamiltonian differs from the energy, then Hamiltonian-conserving does not
mean energy-conserving.

2

Zhong et al. 2010; Mei et al. 2013); and extended phase-space methods (Pihajoki 2015; Liu
et al. 2016; Luo et al. 2017; Li & Wu 2017). We
also focus on the dynamical features of order and
chaos of some orbits in the system. Then, a postNewtonian conservative system of compact binaries with one body spinning (Damour et al. 2000a,
2000b, 2001; Nagar 2011) is another tested model
in Section 4. Finally, our main results are concluded in Section 5. The extended phase-space explicit methods for inseparable Hamiltonian problems are introduced briefly in the Appendix.
2.

value of H(q1n , q2n , q3n , q4n , p1n , p2n , p3n , p4n )
at an nth step is labeled as H(00000000), and
that of H(q1(n+1) , q2(n+1) , q3(n+1) , q4(n+1) , p1(n+1) ,
p2(n+1) , p3(n+1) , p4(n+1) ) at an (n + 1)th step is
marked as H(11111111). In addition, we take
q1n = q10 , q1(n+1) = q11 , · · · . Using these notations, we discretize Equations (1) and (2) as follows:
q11 − q10
=
h
1 H(00001000) − H(00000000)
[
8
p11 − p10
H(00011000) − H(00010000)
+
p11 − p10
H(00011001) − H(00010001)
+
p11 − p10
H(00111001) − H(00110001)
+
p11 − p10
H(00111011) − H(00110011)
+
p11 − p10
H(01111011) − H(01110011)
+
p11 − p10
H(01111111) − H(01110111)
+
p11 − p10
H(11111111) − H(11110111)
+
],
p11 − p10

A new energy-conserving method

Let us consider an N -dimensional Hamiltonian
problem H(q, p), which corresponds to the following Hamiltonian canonical equations:
q̇ =
ṗ

=

∂H
,
∂p
∂H
.
−
∂q

(1)
(2)

From an nth step to an (n+1)th step, these derivatives have discrete forms:
qn+1 − qn
∆t

= [H(qn , pn+1 ) − H(qn , pn )]
/(pn+1 − pn ),

pn+1 − pn
∆t

(3)

= [H(qn , pn+1 ) − H(qn+1 , pn+1 )]
/(qn+1 − qn ).

q21 − q20
=
h
1 H(00000100) − H(00000000)
[
8
p21 − p20
H(10000100) − H(10000000)
+
p21 − p20
H(10001100) − H(10001000)
+
p21 − p20
H(10011100) − H(10011000)
+
p21 − p20
H(10011101) − H(10011001)
+
p21 − p20
H(10111101) − H(10111001)
+
p21 − p20
H(10111111) − H(10111011)
+
p21 − p20
H(11111111) − H(11110111)
],
+
p21 − p20

(4)

It is easy to obtain from the two equations that
H(qn+1 , pn+1 ) − H(qn , pn ) = 0.

(5)

That means that the discretized Equations (3) and
(4) do exactly conserve the Hamiltonian. Therefore, they are an energy-conserving scheme in the
general case. In fact, the discrete gradient is only
a first-order approximation to the gradient of the
Hamiltonian, ∇H. In what follows, we consider
how to construct an energy-conserving scheme
with a second-order approximation to the gradient
of an 8-dimensional Hamiltonian with four degrees
of freedom.
Now, let q be a 4-dimensional position vector,
and p be a four-dimensional momentum vector,
i.e. q = (q1 , q2 , q3 , q4 ) and p = (p1 , p2 , p3 , p4 ).
h = ∆t is a time step. For simplicity, the
3

(6)

(7)

q31 − q30
=
h
1 H(00000010) − H(00000000)
[
8
p31 − p30
H(01000010) − H(01000000)
+
p31 − p30
H(01000110) − H(01000100)
+
p31 − p30
H(11000110) − H(11000100)
+
p31 − p30
H(11001110) − H(11001100)
+
p31 − p30
H(11011110) − H(11011100)
+
p31 − p30
H(11011111) − H(11011101)
+
p31 − p30
H(11111111) − H(11111101)
+
],
p31 − p30
q41 − q40
=
h
1 H(00000001) − H(00000000)
[
8
p41 − p40
H(00100001) − H(00100000)
+
p41 − p40
H(00100011) − H(00100010)
+
p41 − p40
H(01100011) − H(01100010)
+
p41 − p40
H(01100111) − H(01100110)
+
p41 − p40
H(11100111) − H(11100110)
+
p41 − p40
H(11101111) − H(11101110)
+
p41 − p40
H(11111111) − H(11111110)
+
];
p41 − p40

p11 − p10
=
h
1 H(10000000) − H(00000000)
− [
8
q11 − q10
H(10001000) − H(00001000)
+
q11 − q10
H(10011000) − H(00011000)
+
q11 − q10
H(10011001) − H(00011001)
+
q11 − q10
H(10111001) − H(00111001)
+
q11 − q10
H(10111011) − H(00111011)
+
q11 − q10
H(11111011) − H(01111011)
+
q11 − q10
H(11111111) − H(01111111)
+
], (10)
q11 − q10

(8)

p21 − p20
=
h
1 H(01000000) − H(00000000)
− [
8
q21 − q20
H(01000100) − H(00000100)
+
q21 − q20
H(11000100) − H(10000100)
+
q21 − q20
H(11001100) − H(10001100)
+
q21 − q20
H(11011100) − H(10011100)
+
q21 − q20
H(11011101) − H(10011101)
+
q21 − q20
H(11111101) − H(10111101)
+
q21 − q20
H(11111111) − H(10111111)
+
], (11)
q21 − q20

(9)

4

p31 − p30
=
h
1 H(00100000) − H(00000000)
− [
8
q31 − q30
H(00100010) − H(00000010)
+
q31 − q30
H(01100010) − H(01000010)
+
q31 − q30
H(01100110) − H(01000110)
+
q31 − q30
H(11100110) − H(11000110)
+
q31 − q30
H(11101110) − H(11001110)
+
q31 − q30
H(11111110) − H(11011110)
+
q31 − q30
H(11111111) − H(11011111)
+
], (12)
q31 − q30

These Hamiltonian differencing symmetric forms
in the right-hand sides of Equations (6)-(13) possess a second-order accuracy. There is not a systematic method by means of which the difference
equations 6-13 have been constructed.
The difference schemes of Equations (6)-(13)
for 8-dimensional Hamiltonian problems are not
symplectic although they are energy conservative.
If Equations (1) and (2) are nonlinear, Equations
(6)-(13) should be solved by an iterative method,
such as a Newton iterative scheme. However,
the iterative solution does not converge when one
or more denominators of the right-hand sides in
Equations. (6)-(13) tend to zero or are sufficiently
small. In order to avoid the occurrence of numerical singularities, we should rewrite as much as
possible each Hamiltonian difference term so that
all same factors between the denominator and the
numerator are eliminated in the Hamiltonian difference. If some singularities or sufficiently small
denominators still arise, the difference of a certain
function is replaced with the partial derivative of
the function. More details on how to handle this
kind of numerical singularities were provided by
Bacchini et al. (2018a).
In what follows, we are interested in evaluating the performance of the new energy-conserving
(EC) scheme applied to two models. For comparison, an RK method, an implicit midpoint symplectic (IS) method (Feng 1986; Zhong et al. 2010;
Mei et al. 2013) and an extended phase-space
explicit symplectic-like (ES) integrator (Pihajoki
2015; Liu et al. 2016; Luo et al. 2017; Li & Wu
2017) are employed. The extended phase-space
method is simply described in the Appendix.

p41 − p40
=
h
1 H(00000010) − H(00000000)
− [
8
q41 − q40
H(00010001) − H(00000001)
+
q41 − q40
H(00110001) − H(00100001)
+
q41 − q40
H(00110011) − H(00100011)
+
q41 − q40
H(01110011) − H(01100011)
+
q41 − q40
H(01110111) − H(01100111)
+
q41 − q40
H(11110111) − H(11100111)
+
q41 − q40
H(11111111) − H(11101111)
+
]. (13)
q41 − q40

3.

FPU β lattice

An FPU system (Skokos et al. 2008; Gerlach et
al. 2012) with N dimensions describes the motion
of N particles interaction each other. An FPU β
lattice is a perturbed FPU system. For our purpose, we take into account an 8-dimensional FPU
β system with four degrees of freedom as follows:

The discretization of each partial derivative of the
Hamiltonian with respect to one of the position
and momentum variables is the average of eight
Hamiltonian difference terms.
It is easy to find
P
that the left-hand side of 4i=1 [Equation (5 + i)
· (pi1 − pi0 ) − Equation (9 + i) · (qi1 − qi0 )] vanishes, and the right-hand side is H(11111111) −
H(00000000)–that is, the discrete Equations (6)(13) of the Hamiltonian Equations (1) and (2) exactly satisfy the energy-conserving condition (5).

H(q, p) =

4
X
p2
i

i=1

+β

5

2

+

4
X
(qi+1 − qi )2
[
2
i=0

(qi+1 − qi )4
].
4

(14)

Boundary conditions are q0 = q5 = 0, and β is a
non-negative parameter.
When the new energy-conserving method EC
is applied to this system, its implementation is
given here. A key point lies in that singularities
or small denominators in the difference terms in
the right-hand sides of Equations (6)-(13) should
be eliminated as much as possible. For example,
the difference term in the right-hand side of Equation (6) is [H(00001000) − H(00000000)]/(p11 −
p10 ) = (p11 + p10 )/2. As another example,
[H(10011000) − H(00011000)]/(q11 − q10 ) = [1 +
2
2
β(q11
+ q10
)/2](q11 + q10 )/2 + (q11 + q10 − 2q20 ){1 +
β[(q20 −q11 )2 +(q20 −q10 )2 ]/2}/2 in Equation (10).
In this way, all denominators in the right-hand
sides of Equations (6)-(13) are no longer present.
Hence, with the Newton iterative method the iterative solutions of Equations (6)-(13) acting on
the system of Equation (14) have no difficulty.
Taking β = 1.5 and the time step of h =
0.01, we choose two orbits whose initial conditions are q = (0.1, 0.1, 0.2, 0.2) for orbit 1, and
q = (0.1, 0.1, 0.2, 1.1) for orbit 2. As shown in
Figure 1, the RK method shows a secular growth
in the Hamiltonian error, but the new method
EC, the implicit symplectic method IS and the
extended phase-space method ES do not. The
latter three methods make the energy stable. In
this sense, they are regarded as energy-conserving
schemes. As to the numerical accuracy of the energy, the RK method is the worst, the IS and ES
integrators are almost the same, and the new algorithm EC is the best. In particular, the energy
error is smaller in several orders for EC than for IS
or ES. It is clear that the new energy-conserving
method is greatly superior to both the implicit
symplectic method and the extended phase-space
method in the conservation of the Hamiltonian.
Figures 1(a) and (b) show that the energy error of orbit 1 given by the new method EC is two
orders less than that of orbit 2. This is due to the
two orbits having different dynamical behaviors.
The maximum Lyapunov exponents λ in Figure
2 (a) and the fast Lyapunov indicators Λ in Figure 2 (b) show the regularity of orbit 1 and the
chaoticity of orbit 2. Here, the Lyapunov exponents are calculated in terms of the two-particle
method (Wu & Huang 2003). A bounded orbit
is chaotic if its Lyapunov exponent tends to a
stabilized positive value but is regular when the

maximum Lyapunov exponent is zero. The fast
Lyapunov indicators are also based on the idea
of the two-particle method (Wu et al. 2006). If
this indicator grows in a power law with time
log10 t, the bounded orbit is ordered. However, it
is chaotic if this indicator grows in an exponential
law. According to these criteria for the Lyapunov
exponents and the fast Lyapunov indicators distinguishing between the two cases of order and chaos,
we can easily determine the dynamical features of
orbits 1 and 2 in Figure 2 (a) and (b).
Note that the energies of orbits 1 and 2 are
0.031 and 1.815, respectively. This shows that
chaos occurs easily for a large energy. Using the
newly proposed algorithm through many numerical tests, we find that under the present circumstances, chaos is absent for the energy smaller than
0.5, whereas it is present for the energy larger than
0.5. Table 1 and Figure 3 relate to the regularity
and chaoticity of some orbits.
4.

Post-Newtonian Hamiltonian of compact binaries with One body spinning

Various orbits in a post-Newtonian Hamiltonian of compact binaries with one body spinning
are used to test the numerical performance of
the new algorithm. These orbits include circular,
spherical, quasi-spherical, and eccentric orbits.
4.1.

Dynamical model

Since the novel algorithm is only limited to the
use of eight-dimensional systems, we consider a
compact binary system in which only one body
spins. This system consists of two black holes
with masses m1 and m2 . The total mass is M =
m1 +m2 . We take a reduce mass of µ = m1 m2 /M ,
a mass ratio of γ = m1 /m2 and a mass parameter of η = µ/M = γ/(1 + γ)2 . r = (x, y, z) is
a coordinate of body 1 relative to body 2, and
n = r/r is a radial unit vector, where r = |r| is a
radius. We suppose that the spin motion of body
1 is described by S1 . The speed of light, c, and
the constant of gravity, G, are one geometric unit,
c = G = 1. The dynamics of compact binaries
can be described by the following post-Newtonian
(pn) Hamiltonian (Damour et al. 2000a, 2000b,

6

order. The Newton-Wigner-Pryce spin supplementary condition κ = 0 (Mikóczi 2017) is used.
In addition, the Hamiltonian (15) uses dimensionless operations: r → M r, t → M t, H → µH,
L → M µL, and S1 → M µS1 , i.e.,

2001; Nagar 2011):
H(r, p, S1 ) =

Ho (r, p) + Hso (r, p, S1 )
+Hss (r, S1 ).
(15)

Ho is an orbital part, consisting of the Newtonian, the first-order post-Newtonian (1pn), and
the second-order post-Newtonian (2pn) terms:

S1 = S1 Ŝ1 ,

p2
1
− ,
2
r

H1pn

=

(17)

1
1
(3η − 1)p4 − [(3 + η)p2
8
2r
1
(18)
+η(n·p)2 ] + 2 ,
2r

∂H
dS1
× S1 .
=
dt
∂S1

Hss

gα

gβ

Sγ
L

=
=

1
η
(gα + gβ )S1 · L,
3
r
γ
η
[3(Sγ · n)2 − S2γ ],
2r3

19 2 3
ηp + η(n · p)2
8
2
1
−(6 + 2η) ],
r
3
5
3
=
− ( + 2η)p2 + η(n · p)2
2
8
4
1
− (5 + 2η),
r
1
= (1 + )S1 ,
γ
= r × p.

(27)

It is clear that S1 is a two-dimensional vector with
three components. The Hamiltonian (15) is completely canonical and has 8-dimensional phasespace variables, q∗ = (q, θ) and p∗ = (p, ξ). This
canonical system is labeled as

Spin effects have spin-orbit couplings of Hso (r, p, S1 ),
and spin-spin couplings of Hss (r, S1 ). The two
types of spin contributions are written as
Hso

(26)

In this case, the application of the new algorithm
of Equations (6)-(13) to the system (15) becomes
difficult. This problem can be solved with the aid
of the canonical, conjugate spin cylindrical-like coordinates θ and ξ constructed by Wu & Xie (2010):
q
S1 = (ρ cos θ, ρ sin θ, ξ)⊺ , ρ = S12 − ξ 2 . (28)

1
1
(1 − 5η + 5η 2 )p6 + [(5 − 20η
=
16
8r
−3η 2 )p4 − 2η 2 (n · p)2 p2
1
−3η 2 (n · p)4 ] + 2 [(5 + 8η)p2
2r
1
(19)
+3η(n · p)2 ] − 3 (1 + 3η).
4r

H2pn

χ1 m21
.
µM

χ1 is a dimensionless parameter given at the interval [0, 1], and Ŝ1 is a unit spin vector.
The position and momentum variables, r and
p, are conjugate because they satisfy the Hamiltonian canonical equations (1) and (2). However,
the spin variable, S1 , is not because its evolution
equation is a non-canonical equation

Ho = Hn (r, p) + H1pn (r, p) + H2pn (r, p), (16)

Hn =

S1 =

(20)
H(q∗ , p∗ ) = H(q, p, S1 ),
(21)

(29)

which has four independent integrals: the total
energy (i.e. H) and three components of the total
angular momentum vector, J = L+S1 . Therefore,
H is integrable and non-chaotic.

= 2+[

(22)

4.2.

Numerical investigations

Without doubt, the new energy-conserving algorithm given by Equations (6)-(13) is suitable for
the canonical system H in Equation (29). Problems of numerical singularities or small denominators may frequently occur but can be solved in
terms of the suggestions given in Section 2.
Taking the parameters χ1 = 1, γ = 1 and initial conditions
y = z = px = pz = θ = ξ = 0 and
p
py = (1 − e)/x, we plot Figure 4(a) in which the

(23)
(24)
(25)

Here, the spin-orbit couplings have 1.5pn and
2.5pn terms and the spin-spin couplings are at 2pn
7

Hamiltonian errors of the above algorithms solving orbit 1 in Table 2 are shown. The new method
EC, the implicit symplectic integrator IS, and the
extended phase-space method ES can make the
Hamiltonian errors stable. The energy error for
EC is of the order of 10−15 , and those for IS and
ES remain of the order of 10−6 . The energy error for RK increases with time and reaches about
an order of 10−5 when the integration time arrives at 106 . These results are what we expect
and seem to be independent of the initial eccentricity, e. See Table 2 for more information. The
results are obtained from large initial orbital radii
and different time steps. For a small initial radius
and a fixed time step, e.g. r = x = 40 and h = 0.1
in Table 3, these algorithms that act on some orbits show a similar performance. Of course, there
are some differences. The energy errors for the
three methods, RK, IS, and ES, are closely associated to the initial eccentricity and become large
with the increasing eccentricity, but the energy
error for the new scheme EC is not very sensitive dependent on the initial eccentricity and still
remains of the order of 10−14 after the integration time 105 . These results in Tables 2 and 3 are
given when the spin-orbit couplings and the spinspin couplings are included. What about relative
position errors of these algorithms? When more
accurate solutions given by an eighth- and ninthorder Runge-Kutta-Fehlberg algorithm of variable
step sizes are taken as reference solutions, the relative position errors that these methods show can
be obtained in Figure 4(b). As the integration
times are long enough and a larger time step is
adopted, the position errors remain stable for the
new method EC, whereas they grow with time for
the other three methods. Particularly for the RK
method, its position errors are larger than for EC
after a long enough time.
It is not only at the starting time but also at
any time that the eccentricity of orbit 10 in Table 3 is always identical to zero in Equation (16)
when no body spins. In fact, this orbit is an exact
circular orbit. This is because it satisfies the conditions of circular orbits on the equatorial plane:
dr/dt = ∂Ho /∂pr = 0, pr = 0, and ∂Ho /∂r = 0,
where pr = n · p denotes a radial momentum.
In this case, p2 = p2r + L2z /r2 = L2z /r2 , where
Lz = xpy = 6.6473 is the z component of the
orbital angular momentum, L. The angular fre-

quency of the circular orbit is ωo = ∂Ho /∂Lz =
0.0038. Such a circular orbit is used to check
the numerical performance of these methods. Because this orbit is only limited to staying at a sixdimensional phase space of the system in equation (16), the energy-conserving method of Bacchini et al. (2018a) rather than the new energyconserving scheme is suitable for integrating this
orbit. The four methods give the energy errors
(not plotted) to the circular orbit, like those to
orbit 1 in Figure 4(a). They almost remain of the
radius r = 40 of the circular orbit in Figure 5(a)
when the integration times are short. However,
the position errors for RK will be larger than for
the EC method as the integration times last long
enough in Figure 5(b). This result looks like that
of orbit 1 in Figure 4(b). The EC method does
not show a secular growth in the position errors
in Figures 4(b) and 5(b). Of course, there is a
typical difference between Figures 4(b) and 5(b)
that the implicit symplectic integrator IS and the
extended phase-space method ES have a secular
growth in the position errors of orbit 1 but do not
have in the position errors of the circular orbit.
When the spin-orbit couplings in Equation (20)
are added to the orbital part (16), the term Hso
is a conserved quantity and does not contain pr .
Therefore, dr/dt = 0 is still existent. The radius
r = 40 remains invariant, but the orbit is a spherical orbit rather than a circular orbit because of
the spin of body 1 leading to the precession of
orbits. This spherical orbit with the angular frequency ωso = ωo + ∂Hso /∂Lz = 0.0038 is an orbit in a eight-dimensional phase space and so our
new EC method rather than the energy-conserving
method of Bacchini et al. (2018a) becomes useful.
The four algorithms show the preference of such
a spherical orbit during a short integration time
in Figure 5(c). The position errors in Figure 5(d)
are also similar to those in Figure 5(b). A difference lies in that the position errors are smaller
for RK than for EC. When the spin-spin interactions in Equation (21) are also included, these
methods almost give same Figure 5(e) that the
radius r oscillates around 40.025 in a small amplitude and the spherical orbit is slightly destroyed.
This destruction of the spherical orbit is not large
because the spin-spin effects are small compared
to the spin-orbit ones. With the inclusion of the
spin-spin couplings, the spherical orbit yielded by

8

the spin-orbit couplings becomes a quasi-spherical
orbit. The position errors given by these schemes
for the quasi-spherical orbit in Figure 5(f) are almost the same as those for the spherical orbit in
Figure 5(d). If the time step h = 1 in Figure 5 is
replaced with a small time step h = 0.01 in Table
4, the relative position errors are the smallest for
ES but the largest for EC. RK and IS have almost
the same errors.
Now, let eccentrical orbits (e.g. the eccentrical
orbit 11 in Table 3) be used as tested orbits. For
this case, the energy errors (not plotted) that the
four algorithms show are nearly the same as those
in Figure 4(a). The relative position errors have
secular growths for the four algorithms, as shown
in Figure 6. They are larger for RK than for EC
after a long enough time.
Seen from the above numerical experiments, the
new method is the most effective to conserve energies compared to the other three schemes. However, it is not superior to the RK method in the accuracy of numerical solutions when the time step is
small and the integration time is not long enough,
as shown in Figures 4(b), 5(b), (d), (f), and 6 and
Table 4. In other words, such energy-conserving
integrators are typically characterized by larger
trajectory errors. This is because numerical errors
that are prevented in the energy are then reversed
to the position. For periodic or bounded motion,
such errors can be typically ignored, since they
will mostly result in frequency/phase mismatches
without causing the disruption of the bounded orbit. On the other hand, the energy-conserving integrators are nonsymplectic, hence they are not
characterized by conservation of phase-space trajectories. The highly geometric character of these
integrators suffices in preserving phase space trajectories to a high degree. It is, however, not
impossible that some geometric features of the
trajectory may suffer from additional numerical
errors, which would be absent in symplectic integrators. Besides this drawback, the energyconserving integrators need much additional computational cost, since they are implicit and involve
a system of nonlinear equations that are handled
during the computation. This fact is conformed in
Table 5.

5.

Summary

The novel energy-conserving method given by
Equations (6)-(13) is specifically designed for an
eight-dimensional Hamiltonian system with four
degrees of freedom. In this algorithm, eight partial
derivatives of the Hamiltonian with respect to each
phase-space variable are discretized and the discretization of the partial derivatives is the average
of eight Hamiltonian difference terms. This average gives a second-order accuracy to the Hamiltonian derivative. This algorithm is implicit and
can be solved with the aid of the Newton iterative method when the Hamiltonian is nonlinear.
It is exactly energy conserving from the theoretical viewpoint but is nonsymplectic.
When the FPU-β lattice is chosen as a tested
model, the newly proposed method is shown to
have extremely good numerical performance in the
conservation of energy. Regardless of whether the
considered orbit is regular or chaotic, this new
algorithm is greatly superior to the RK method,
the implicit midpoint symplectic method, and the
extended phase-space explicit symplectic-like integrator. Of course, the energy-conserving accuracy
of the new algorithm is better for the ordered case
than for the chaotic case. Using the new energyconserving method, we find several regular orbits
and chaotic ones in the system. The threshold
of energies between order and chaos can also be
found under a certain circumstance. When the
post-Newtonian conservative system of compact
binaries with one body spinning is used as another tested model, the newly proposed method
is still extremely good in the preservation of energies regardless of initial orbital eccentricities. It
is advantageous over very long times and for large
time steps compared to the state-of-the-art RK
method in the accuracy of numerical solutions. It
exhibits a higher computational cost than any one
of the other three algorithms.
For some specific purposes on the preservation
of energies in numerical simulations with much
longer times,2 such energy-conserving integrators
2 The

purposes, e.g., are to obtain higher accuracies of the
semimajor axis, mean motion, and mean anomaly in the
Keplerian problem in the solar system, or to accurately
grasp the frequency of a gravitational wave emitted from
the circular, spherical, or quasi-spherical orbit in relativistic post-Newtonian systems of compact binaries.

9

are worth recommending for application. The new
integrator could be used to simulate relativistic
charged particles moving in a time-varying external electromagnetic field (Pétri 2017). Such a field
can be described by an associated time-dependent
Hamiltonian. This Hamiltonian H has eight dimensions, including three spatial coordinates +
time, three velocity components, and time change
with respect to proper time (i.e. the Lorentz
factor). By extending the phase space of the
Hamiltonian, we will obtain a zero Hamiltonian
e = H + p0 , where p0 is a momentum with reH
spect to time. This would provide a mean to
simulate charged particles in time-varying external fields with exact zero-Hamiltonian conservation, which is a very desirable feature in the context of test particle simulations in high-energy
astrophysical scenarios. The new integrator will
also be suitable for modeling a time-dependent
spacetime (Bohn et al. 2015). Although the
Hamiltonian H = 12 g αβ pα pβ for the spacetime,
dS 2 = gαβ dxα dxβ does explicitly depends on the
coordinate time, t, it has an invariant quantity,
H = −1/2. From the theory, this invariant quantity can still be preserved by the new integrator.
With the aid of the integrator, the characteristic of gravitational waves for circular, spherical,
quasi-spherical, and eccentric orbits in relativistic
post-Newtonian systems of compact binaries will
be analyzed in the future work.

APPENDIX
Extended phase-space explicit leapfrog integrators for inseparable Hamiltonian problems
Usually, an explicit second-order leapfrog integrator of Wisdom & Holman (1991) is not suitable
for Hamiltonian problems with inseparable forms
of coordinates and momenta. However, it is still
valid if the extended phase-space method of Pihajoki (2015) is considered.
Although a Hamiltonian H(q, p) is inseparable,
its modified form is
Γ(q, q̃, p, p̃) = H1 (q, p̃) + H2 (q̃, p),

(30)

where H1 = H2 = H, can be split into two solvable
parts, H1 and H2 . A(h) is an operator of H1 ,
and B(h) is another operator of H2 . The leapfrog
algorithm for the new Hamiltonian Γ is
h
h
S(h) = A( )B(h)A( ).
2
2

(31)

Under the same initial conditions, the original
solution (q, p) and the extended solution (q̃, p̃)
should be the same. However, their coupled
derivatives lead to both solutions having some differences. To make the two solutions equal, the
leapfrog S(h) needs maps as feedback after the
two solutions, e.g.,

Acknowledgments

ES(h) = M ⊗ S(h),

The authors would like to express their deep
gratitude to the referee for valuable comments and
suggestions. This research has been supported
by the National Natural Science Foundation of
China (grant Nos. 11533004, 11973020, 11663005,
11533003, and 11851304), the Graduate Innovation Foundation of Jiangxi Province (grant No.
YC2018-S002), the Special Funding for Guangxi
Distinguished Professors (2017AD22006), and the
Natural Science Foundation of Guangxi (grant No.
2018GXNSFGA281007).

(32)

where M is a map. These permuted maps can be
given in various forms, such as the maps of Pihajoki (2015) and Liu et al. (2016). As a good
choice of the map M , the midpoint permutations
between the old variables (q, p) and the new variables (q̃, p̃) are given by Luo et al. (2017):
q + q̃
2
q + q̃
2
p + p̃
2
p + p̃
2

→ q,
→ q̃,
→ p,
→ p̃.

(33)

This algorithm ES is an extended phase-space
explicit leapfrog integrator. The inclusion of the
10

Kidder, L. E. 1995, Phys. Rev. D, 52, 821

permuted map makes this algorithm nonsymplectic. However, this integrator is a symmetric
method and shows no secular growth in the errors
of energy.

Kopáček, O., & Karas, V. 2014, ApJ, 787, 117
Li, D., & Wu, X. 2017, Mon. Not. R. Astron. Soc.,
469, 3031

REFERENCES

Liu, L., Wu, X., Huang, G., et al. 2016, Mon. Not.
R. Astron. Soc., 459, 1968

Bacchini, F., Ripperda, B., Chen, A. Y., et al.
2018a, Astropys. J. Suppl., 237, 6

Luo, J., Wu, X., Huang, G., et al. 2017, Astrophys.
J., 834, 64

Bacchini, F., Ripperda, B., Chen, A. Y., et al.
2018b, Astropys. J. Suppl., 240, 40

Mei, L., Wu, X., & Liu, F. 2013, Eur. Phys. J. C,
73, 2413

Bohn, A., Throwe, W., Hébert, F., et al. 2015,
Class. Quantum Grav., 32, 065002

Mikóczi, B. 2017, Phys. Rev. D, 95, 064023

Buonanno, A., Chen, Y., & Damour, T. 2006,
Phys. Rev. D, 74, 104005

Murray, C., & Dermott, S. 1999, Solar System Dynamics (Cambridge: Cambridge Univ. Press)

Chorin, A., Huges, T. J. R., Marsden, J. E., et al.
1978, Comm. Pure and Appl. Math., 31, 205

Nagar, A. 2011, Phys. Rew. D, 84, 084028
Pétri, J. 2017, J. Plasma Phys. 83, 705830206

Damour, T., Jaranowski, P., & Schäfer, G. 2000a,
Phys. Rev. D, 62, 084011

Pihajoki, P. 2015, Celest. Mech. Dyn. Astron.,
121, 211

Damour, T., Jaranowski, P., & Schäfer, G. 2000b,
Phys. Rev. D, 62, 044024

Qin, M. 1987, J. Comput. Math., 5, 203

Damour, T., Jaranowski, P., & Schäfer, G. 2001,
Phys. Rev. D, 513, 147

Quinlan, G. D., & Tremaine, S. 1990, Astron. J.,
100, 1964

Feng, K. 1985, in Proc. 1984 Beijing Symp. on Differential Geometry and Differential Equations,
ed. K. Feng (Beijing: Science Press), 42

Ruth, R. D. 1983, IEEE Trans. Nucl. Sci., 30, 2669
Skokos, C., Bountis, T., & Antonopoulos, C. 2008,
Eur. Phys. J. SP. T., 165, 5

Feng, K. 1986, J. Comput. Math., 4, 279

Thorne, K. S., & Hartle, J. B. 1985, Phys. Rev.
D, 31, 1815

Feng, K., & Qin, M. 1987, Lect. Notes Math.,
1297, 1

Wang, Y. S., Wang, B., & Qin, M. Z. 2008, Science
in China (Series A Math), 51(11), 2115

Feng, K., & Qin, M. Z. 2009, Symplectic Geometric Algorithms for Hamiltonian Systems
(Hangzhou, New York: Zhejiang Science and
Technology Publishing House, Springer)

Wisdom, J., & Holman, M. 1991, Astron. J., 102,
1528
Wu, X., & Huang, T. 2003, Phys. Lett. A, 313, 77

Forest, E., & Ruth, R. D. 1990, Physica D, 43, 105

Wu, X., Huang, T., & Zhang, H. 2006, Phys. Rew.
D, 74, 083001

Gerlach, E., Eggl, S., & Skokos, C. 2012, Int. J.
Bifurc. Chaos, 22, 1250216

Wu, X., Xie, Y. 2010, Phys. Rew. D, 81, 084045

Hairer, E., Lubich, C., & Wanner, G. 2006,
GeometricNumerical Integration: StructurePreserving Algorithms for Ordinary Differential
Equations (2nd edn., Springer, Berlin)

Zhong, S. Y., Wu, X., Liu, S. Q., et al. 2010, Phys.
Rev. D, 82, 124040

Itoh, T., & Abe, K. 1988, J. Comp. Phys., 76, 85

This 2-column preprint was prepared with the AAS LATEX
macros v5.2.

11

Table 1: Dynamical Features of Several Orbits in
the FPU-β System. These orbits have the same
initial momentum p = (0, 0, 0, 0) but different positions q = (q1 , q2 , q3 , q4 ). E = H corresponds to
the energy of each orbit.
Orbit
1
2
3
4
5
6
7
8
9
10

Initial Position
(0.1,0.1,0.2,0.2)
(0.1,0.1,0.2,1.1)
(0.5,0.5,0.5,0.5)
(0.55,0.5,0.5,0.5)
(0.6,0.5,0.5,0.5)
(0.62,0.5,0.5,0.5)
(0.7,0.5,0.5,0.5)
(0.75,0.5,0.5,0.5)
(0.8,0.5,0.5,0.5)
(0.85,0.5,0.5,0.5)

E
0.031
1.815
0.297
0.335
0.382
0.403
0.504
0.581
0.670
0.772

Dynamics
order
chaos
order
order
order
order
chaos
chaos
chaos
chaos

12

Table 2: After Integration Time t = 106 , Hamiltonian Errors ∆H of the four algorithms EC, RK, ES, and IS
Act on Several Orbits in the post-Newtonian problem of compact binaries with One body spinning, Given
by Equation (29). The spin-orbit
couplings and spin-spin effects are included together. Initial values of x,
p
e are given below, py = (1 − e)/x, and other initial values are 0. The time step h for each orbit may be
different.
Orbit
x
e
h
EC
RK
ES
IS
1
120 0.0
15 8.37 × 10−16 2.83 × 10−6 1.53 × 10−8
3.05 × 10−8
2
120 0.1
5
6.79 × 10−16 2.47 × 10−7 3.23 × 10−9
6.46 × 10−9
−16
−6
−8
3
120 0.2
10 3.37 × 10
5.77 × 10
1.65 × 10
3.32 × 10−8
−16
−7
−9
4
150 0.35
4
1.41 × 10
4.87 × 10
3.10 × 10
6.22 × 10−9
−16
−5
−8
5
150 0.55
5
9.29 × 10
2.06 × 10
2.78 × 10
5.40 × 10−8
−15
−5
−9
6
180 0.6
5
2.68 × 10
1.33 × 10
2.64 × 10
5.66 × 10−9
−15
−5
−6
7
200 0.65
8
1.39 × 10
6.71 × 10
1.48 × 10
2.99 × 10−6
8
200 0.7
2
2.88 × 10−15 3.31 × 10−6 3.51 × 10−11 1.20 × 10−10
9
240 0.8 2.5 5.74 × 10−15 2.84 × 10−5 9.36 × 10−10 1.71 × 10−11

Table 3: After Integration Time t = 105 , Hamiltonian Errors ∆H of the four algorithms EC, RK, ES, and
IS Solve some orbits in the post-Newtonian problem of compact binaries with One body spinning, Given by
Equation (29). The spin-orbit couplings and spin-spin effects are included together. Initial value of x is 40,
those of py and e are given below, and other initial values including the initial canonical spin cylindrical-like
coordinates θ and ξ are 0. The time step h = 0.1 is fixed.
orbit
10
11
12
13
14
15

py
0.166
0.158
0.141
0.122
0.100
0.071

e
0.0
0.0
0.2
0.4
0.6
0.8

EC
6.03 × 10−16
5.07 × 10−15
2.07 × 10−15
7.74 × 10−15
6.88 × 10−15
1.50 × 10−14

RK
1.34 × 10−10
5.27 × 10−10
2.31 × 10−9
4.60 × 10−8
1.43 × 10−6
1.19 × 10−5

ES
2.88 × 10−14
2.08 × 10−10
1.27 × 10−9
2.07 × 10−10
2.73 × 10−8
7.16 × 10−10

IS
5.71 × 10−14
4.16 × 10−10
2.55 × 10−9
4.15 × 10−10
5.49 × 10−8
1.15 × 10−10

3

(a) orbit 1

-3

(b) orbit 2

RK

-3

)

)

-6

ES

-6

ES

-9

IS

log10(

log10(

RK

0

-12

-15

EC

IS

-9

-12

EC

-15

-18

-18
1

2

3

4

1

2

3

4

log10t

log10t

Fig. 1.— Hamiltonian errors for several integrators solving orbits 1 and 2 in the FPU-β system. EC, RK, ES,
and IS correspond to the new energy-conserving scheme, the RK method, the implicit midpoint symplectic
algorithm, and the extended phase-space explicit symplectic-like integrator, respectively.

13

Table 4: Relative Position Errors for the Four Algorithms that Solve the Circular, Spherical, and Quasispherical orbits in Figure 5. Here, the time step h = 0.01 is unlike the time step h = 1 in Figure 5 (b), (d)
and (f).
Steps
300
600
900
1800
2000

EC
6.9 × 10−10
1.4 × 10−10
2.1 × 10−9
4.6 × 10−9
5.2 × 10−9

300
600
900
1800
2000

3.4 × 10−10
6.0 × 10−10
7.8 × 10−10
6.0 × 10−13
5.4 × 10−10

300
600
900
1800
2000

3.4 × 10−10
6.1 × 10−10
7.8 × 10−10
7.9 × 10−12
5.3 × 10−10

Circular Orbit
RK
7.0 × 10−14
2.8 × 10−13
6.4 × 10−13
2.5 × 10−12
3.1 × 10−12
Spherical Orbit
7.0 × 10−14
2.8 × 10−13
6.4 × 10−13
2.5 × 10−12
3.1 × 10−12
Quasi-Spherical orbit
7.0 × 10−14
2.8 × 10−13
6.4 × 10−13
2.5 × 10−12
3.1 × 10−12

ES
2.0 × 10−14
7.2 × 10−14
1.5 × 10−13
6.4 × 10−13
7.9 × 10−13

IS
3.7 × 10−14
1.4 × 10−13
3.2 × 10−13
1.3 × 10−12
1.6 × 10−12

2.0 × 10−14
7.2 × 10−14
1.6 × 10−13
6.4 × 10−13
7.9 × 10−13

3.7 × 10−14
1.4 × 10−14
3.2 × 10−13
1.3 × 10−12
1.6 × 10−12

1.7 × 10−14
7.5 × 10−14
1.7 × 10−13
6.4 × 10−13
7.9 × 10−13

3.5 × 10−14
1.4 × 10−13
3.2 × 10−13
1.3 × 10−12
1.6 × 10−12

20

0

(a)

(b)

2

-1

2

15

log10

FLI

-2

10

5

-3

1

1
-4

0
0

1

2

3

4

log10t

1

2

3

4

log10t

Fig. 2.— Lyapunov exponents λ and fast Lyapunov indicators Λ for the new algorithm EC solving orbits 1
and 2 in the FPU-β system. Orbit 1 is ordered, whereas orbit 2 is chaotic.

14

12

(a)

(b)

-1

10

8

9

7

10
7

9

8

9

5

FLI

log10

3
-2

6

6

6
3

4

3

-3

5

4

0

1

2

3

4

1.5

2.0

2.5

log10t

3.0

3.5

4.0

log10t

Fig. 3.— Lyapunov exponents λ and fast Lyapunov indicators Λ for the new algorithm EC solving other
orbits in the FPU-β system.

(a) orbit 1

-3

-2

(b) orbit 1

RK

EC

RK
-6

log10(

IS

-9

log10(

r/r )

)

-3

ES

-12

-5

-6

EC

-15

IS

-4

-7

ES

-18
2

3

4

5

6

5.0

5.2

5.4

5.6

5.8

6.0

log10t

log10t

Fig. 4.— Hamiltonian errors, ∆H and relative position errors of the four algorithms, EC, RK, ES, and
IS solving orbit 1 in the post-Newtonian problem of compact binaries with one body spinning, given by
Equation (29). The spin-orbit couplings and spin-spin effects are included together. The initial conditions
and parameters of orbit 1 are given in Table 2. The time step is h = 15.

15

40.20

(a) circular orbit

(b) circular orbit

-3

40.15

RK

EC

r/r )

40.10

IS

-6

40.00

log10(

r

40.05

39.95

39.90

-9

ES
39.85

39.80
0

400

800

1200

1600

5.0

2000

5.2

5.4

5.6

5.8

6.0

log10t

t
40.20

(c) spherical orbit
-2

40.15

(d) spherical orbit
EC

40.10

RK

r/r )

-4

40.00

IS

-6

log10(

r

40.05

39.95

-8

39.90

ES

39.85

-10

39.80
0

400

800

1200

1600

5.0

2000

5.2

5.4

5.6

5.8

6.0

log10t

t

(e) quasi-spherical orbit

(f) quasi-spherical orbit
-2

40.04

EC

r/r )

RK

40.02

-4

log10(

r

IS

40.00

-6

ES

-8

-10

39.98
0

400

800

1200

1600

5.0

2000

5.2

5.4

5.6

5.8

6.0

log10t

t

Fig. 5.— Left: evolution of the radii r with time t. Right: relative position errors. Panels (a) and (b):
circular orbit in the non-spinning case. Panels (c) and (d): spherical orbit in the spin-orbit case. Panels
(e) and (f): quasi-spherical orbit with the inclusion of spin-orbit couplings and spin-spin effects. EC in
(a) and (b) denotes the energy-conserving method of Bacchini et al. (2018a) because this circular orbit is
considered in a six-dimensional phase space, but it is our new method in (c)-(f) because the spherical and
quasi-spherical orbits are considered in a eight-dimensional phase space. The time step is h = 1.

16

0

orbit 11

RK

log10(

r/r )

EC

-3

IS

-6

ES

-9
5.0

5.2

5.4

5.6

5.8

6.0

log10t

Fig. 6.— Relative position errors for the four algorithms solving the eccentrical orbit 11 in Table 3. The
time step is h = 1.

Table 5: CPU times (unit: Seconds) for the Four
Methods Solving Various Orbits with Different
Time Steps h. The integration times are t = 106
for orbits 1-9 and t = 105 for orbits 10-15.
Orbit
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15

h
15
5
10
4
5
5
8
2
2.5
0.1
0.1
0.1
0.1
0.1
0.1

EC
59
176
86
214
171
172
107
428
342
905
918
890
866
841
848

RK
1
3
1
3
3
3
2
6
5
13
13
13
13
13
13

ES
1
4
2
5
4
4
2
9
8
19
19
19
19
19
19

IS
2
6
3
7
6
6
4
13
11
25
25
25
26
27
27

17

