1

Cryo-Electron Microscopy Image Analysis Using
Multi-Frequency Vector Diffusion Maps

arXiv:1904.07772v1 [cs.CV] 16 Apr 2019

Yifeng Fan, Zhizhen Zhao

Abstract—Cryo-electron microscopy (EM) single particle reconstruction is an entirely general technique for 3D structure
determination of macromolecular complexes. However, because
the images are taken at low electron dose, it is extremely hard
to visualize the individual particle with low contrast and high
noise level. In this paper, we propose a novel approach called
multi-frequency vector diffusion maps (MFVDM) to improve the
efficiency and accuracy of cryo-EM 2D image classification and
denoising. This framework incorporates different irreducible representations of the estimated alignment between similar images.
In addition, we propose a graph filtering scheme to denoise the
images using the eigenvalues and eigenvectors of the MFVDM
matrices. Through both simulated and publicly available real
data, we demonstrate that our proposed method is efficient and
robust to noise compared with the state-of-the-art cryo-EM 2D
class averaging and image restoration algorithms.

I. I NTRODUCTION

2D projection images

Electron Microscope
Particles in unknown 3D pose

ice
Contrast Transfer Function

CMOS Detector
(corrupted by noise)

Fig. 1: Illustration of image formation in cryo-EM: The electron
beam projects the randomly oriented particles. The projection
image is modulated by the contrast transfer function (CTF)
and corrupted by noise with extremely low SNR.

Scientific breakthroughs often build upon successful visualization of objects invisible to the human eye. The 2017 model reduces the number of refinement iterations and leads to
Nobel Prize in Chemistry was awarded for the development of a better reconstruction [40]. Alternative 3D ab initio modeling
cryo-electron microscopy (cryo-EM) that allows us to image method uses higher-order moments of the 2D images, such as
biomolecules in their native functional states at high resolution. sample mean, covariance, and triple correlation [9]. Moment
This method has moved biochemistry into a new era. In cryo- estimation is sensitive to noise, therefore better image denoising
EM experiments, the purified protein particles are distributed is crucial for moment based 3D reconstruction. Therefore, it
evenly within the special sample grid holes assuming a variety is important to have fast and accurate algorithms for the 2D
of random orientations (see Fig. 1). The single particle images analysis and denoising.
are boxed out during the particle picking step [12], [8]. Despite
Many existing cryo-EM single particle reconstruction softthe recent progress, there still remain a lot of challenges for the ware packages [22], [4], [31] contain algorithms for 2D class
current computational framework of cryo-EM single particle averaging. Most common methods use K-means clustering with
reconstruction (SPR). For example, in its present form, the iterative rotational alignment and clustering. On the other hand,
methodology still cannot resolve high resolution structures of the ASPIRE class averaging pipeline in [40] performs robust
small particles with molecular weights below 50kDa due to rotational invaraint nearest neighbor search and alignment
low contrast and signal-to-noise ratio (SNR) [27].
estimation. It uses steerable principal component analysis
To improve the image quality, a crucial step is the alignment (sPCA) to efficiently denoise the large image dataset and uses
and averaging of the 2D projection images, a procedure known rotationally invariant features to identify images of similar
as “2D class averaging.” The 2D analysis of cryo-EM data views. For extremely noisy images, the initial nearest neighbor
is used to assess the data quality. They can be used for classification has many outliers and it uses vector diffusion
direct observation to look for heterogeneity, discover symmetry, maps (VDM) [30], [29] to further improve the nearest neighbor
and separate particles into subgroups for additional analysis. classification by taking into account the consistency of inBetter denoising also increases the diversity of the selected plane rotations along multiple paths that connect neighboring
particle views during particle picking, which is crucial for 3D images through their common neighbors. The improved nearest
reconstruction. The denoised images are used for common- neighbors are aligned and averaged to form class averaged
lines based 3D ab initio reconstruction [34]. A good initial images that enjoy higher SNR. However, VDM might fail at
lower SNRs and generating class averages by rotational and
YF is with the Department of Electrical and Computer Engineering,
University of Illinois at Urbana-Champaign, Urbana, IL, 61820 USA e-mail: shift alignment is time consuming and prone to interpolation
yifengf2@illinois.edu
error.
ZZ is with the Department of Electrical and Computer Engineering,
In this paper, we introduce a new algorithm called multiUniversity of Illinois at Urbana-Champaign, Urbana, IL, 61820 USA e-mail:
zhizhenz@illinois.edu .
frequency vector diffusion maps (MFVDM) to improve the

2

efficiency and accuracy of cryo-EM 2D image classification and
denoising. Based on the initial nearest neighbor identification
and alignment, we find including different irreproducible
representations of SO(2) can improve the nearest neighbor
classification and alignment estimation. To denoise the images,
we use the eigenvalues and eigenvectors of the MFVDM
matrices to filter the Fourier-Bessel expansion coefficients
of the images and reconstruct the images from the denoised
expansion coefficients. To demonstrate our method, we perform
comparions with the state-of-the-art algorithms for denoising
on two real experimental datasets and simulated datasets at
different SNRs.
II. R ELATED W ORK

denoising performance compared to sPCA. The assumption that
the data lie close to a low dimensional manifold was widely
used in natural image analysis and computer vision problems.
Various global and local filtering have been proposed [32], [2],
[36], [6], [25], [18], [37], [3] for image denoising, inpainting,
and super-resolution.
III. M ETHODS
A. Image Formation Model and Geometry
In cryo-EM single particle experiments, each protein sample
is embedded in a thin ice layer at an unknown orientation
characterized by a 3 × 3 orthogonal matrix R ∈ SO(3),
(R = [R1 , R2 , R3 ]). The single particle image I is formed
as the X-ray transform of the underlying 3D electron density
of the macromolecule. Excluding the contribution of noise,
the intensity I(x, y) of the pixel located at (x, y) in the
image plane corresponds to the line integral, I(x, y) =
R∞
φ(xR1 +yR2 +zR3 )dz, where φ is an unknown 3D volume

In the following we review the cryo-EM 2D class averaging and denoising methods. Traditional 2D class averging
uses unsupervised classification methods, such as K-means
clustering and reference-free alignment [5]. However, since
the images can be in-plane rotated, they cannot be aligned −∞
in a fixed coordinate system. For the image I, the matrix R can
well without being first separated into distinct classes. On the
be divided into two parts: (1) the last column R3 represents
other hand, it is hard to separate classes when the images
the viewing direction v = R3 and uniquely defines a point
are not aligned well [23]. This leads to a ‘chicken and agg’
on a 2-dimensional quotient manifold M = SO(3)/SO(2)
problem and approaches that iterate between alginment and
(2-dimensional unit sphere) for a generic volume without
classification [5] aim to solve it, including maximum-likelihood
symmetry; (2) the first two columns of R, namely R1 and R2 ,
(ML) estimation [26], [24], [21], [16] and the neural network
form a basis of the tangent plane TI M and they correspond
for kernel probability density estimator self-organizing map
to the x, y coordinates in the 2D projection image.
(KerDenSOM) [19]. These methods share a drawback of the
The image is corrupted by two phenomena: a contrast transfer
high sensitivity to initialization. Therefore, to avoid this, [40]
function (CTF) [5] and noise. The CTF is analogous to the
introduced rotationally invariant features to identify nearest
effects of defocus in a conventional light camera. It modulates
neighbors and the corresponding alignments. It then uses a
the phase amplitudes and flips the signs of the phases in the
nonlinear dimensionality reduction method, VDM [29], to
Fourier domain, which leads to a systematic alteration of the
improve the nearest neighbor search. Images are denoised
image data (see Figs. 2(a) and 2(b)). The parameters for CTFs
by a weighted average of their aligned nearest neighbors.
are assumed to be known or estimated through standard tools.
Another type of approaches aims to denoise EM images
A simple CTF correction method that does not affect the noise
without 2D classification and averaging and contains two
statistics is called phase flipping [20], which corrects the sign
main methods: (1) steerable PCA (sPCA) [39], [38] and (2)
of the phases, but not its ampltitude. In our framework, we
covariance Wiener filtering (CWF) [1]. SPCA computes the
preprocess the raw images by phase flipping.
covariance matrices using the truncated expansion coefficients
For noisy particle images (see Fig. 2(c)), 2D class averaging
of the noisy images on steerable basis [38], [10] and uses a
is an important step to denoise and check the quality of the
Wiener-type filtering to denoise the coefficients. For applicadataset. It first identifies images with similar views and registers
tions to real cryo-EM images, which are convolved by the point
those images by in-plane rotation and shifts. In this paper, we
spread function of the electron microscope lens, it requires
assume that the particles are well centered, and later in the
a data preprocessing step “phase flipping” [20] and does not
experimental results, we show that the algorithms are robust
correct for the phase amplitudes. The second method CWF
to small shifts.
improves the sPCA by estimating the mean and covariance
For a pair of images Ii and Ij , it is natural to use the
matrix of the clean data without the lens effect, followed by
rotational invariant distance (RID) dRID (i, j) to identify images
denoising and deconvolution to correct the Fourier phases and
of similar views,
amplitudes of the images. However, neither sPCA nor CWF
take into account the geometric structure of the projection
dRID (i, j) = min kIi − Rα Ij k ,
(1)
α∈[0,2π)
images as illustrated in Fig. 3.
Recently, steerable graph Laplacian (SGL) [11] uses a kernel where Rα is an operator that rotates image Ij counter-clockwise
matrix defined on pairs of images including all rotated versions. by an angle α. The associated optimal in-plane rotation
The eigenvectors of the kernel matrix correpsond to steerable alignment is denoted by αij . The underlying alignment angle
manifold harmonics on the group invariant data manifold. The for images of similar views is determined by Ri and Rj
denoising step uses the truncated global basis to filter the according to [40, Eqs. (4) and (5)]. The vertices on the blue
steerable coefficients of the EM images. By taking into account spheres in Fig. 3 depict the viewing directions. In the noiseless
of the nonlinear geometric structure of the data, it improves the case, small dRID indicates close viewing directions. Therefore,

3

Fig. 2: Simulated 70S ribosome projections images: (a) Clean projection images. (b) Clean images altered by CTFs. (c) to (e)
Images contaminated by additive white Gaussian noise at SNR = 0.05, 0.02, 0.01.
𝟏𝟐𝟖°

𝟐𝟖°
−𝟏𝟒𝟗°

−𝟏𝟐𝟏°

𝟔𝟗°

𝟑𝟐°
−𝟖𝟒°

𝟗𝟔°
−𝟏𝟑𝟕°

𝟏𝟔𝟔°

−𝟒𝟖°°
−𝟐𝟕

Noisy data

MFVDM denoising (𝑆𝑁𝑅 = 0.05)

−𝟏𝟎𝟓°

Clean neighbor graph

𝟔𝟐°

−𝟏𝟒𝟐°

Clean data

(Noisy) Small-world graph

−𝟒°
MFVDM classification & alignment

Fig. 3: Illustration of MFVDM pipeline: Left: Noisy (clean) data samples of a single particle are collected. Middle: The distance
dRID defines a neighborhood graph (clean data) and a small world graph (noisy data) on the unit 2-sphere. Among local
neighborhood images, the alignments are consistent for clean data.Right: Using multiple frequency representation, MFVDM is
able to remove shortcuts (orange dash lines) and improve the alignment accuracy, then graph filters are used for denoising.

connecting image pairs with small dRID form a neighborhood
graph on the sphere as shown in the upper middle panel in
Fig. 3. However, when the images are extremely noisy, noise
aligns well instead of the underlying signals. This results in
connecting images of distant views (see the shortcut red edges
in the lower middle panel of Fig. 3) and error in the estimation
of αij .
To address these challenges, we first use the filtered sPCA
coefficients of the images [38] to compute dRID and αij ,
which can withstand certain level of noise. Furthermore, in
the following subsections, we introduce a graph based method
to robustly learn the nonlinear geometrical structure of the
image data. The new pipeline combines multiple irreducible
representations of the compact alignment group with a random
walk executed on a graph where nodes correspond to images
and edges denote connections. We then use the learned basis
of the manifold to improve nearest neighbor search, alignment,
denoising, and deconvolution.
B. Multi-Frequency Vector Diffusion Maps
For clean projection images, since the viewing directions
of the images lie on a 2-sphere, by using dRID , we are able

to build a local neighborhood graph (V, E) over the sphere
with the nodes V representing the viewing directions and the
edges E connecting images of similar views, i.e., (i, j) ∈ E
indicates hvi , vj i ≈ 1. All the views of similar images are in a
small spherical cap (see the upper middel panel of Fig. 3). In
addition, the rotational alignment has cycle consistency among
the neighbors, i.e., summing over angles along the cycles will
be close to 0 mod 2π.
Based on this graph structure for n images, we build a class
of n × n Hermitian matrices Wk , for k = 0, 1, . . . , k̃,
(
eıkαij (i, j) ∈ E,
Wk (i, j) =
(2)
0
(i, j) ∈
/ E,
where
αij = −αji . The degree of each node deg(i) =
P
j:(i,j)∈E 1. We define a diagonal matrix D of the same size
as Wk with D(i, i) = deg(i). Then the matrix Sk = D−1 Wk
is applied to vectors u in the complex plane, which can be
viewed as an averaging operator for the tangent vector fields,
since
X
1
(Sk u)(i) =
eıkαij u(j).
(3)
deg(i)
j:(i,j)∈E

4

Algorithm 1: MFVDM nearest neighbor search and alignment
Input: Nearest neighbors list and alignment angles for
noisy cryo-EM images from initial classification
in [40]
Output: s-nearest neighbors for each image and the
corresponding optimal alignments α̂ij , for
(i, j) ∈ E
1 for k = 1, . . . , k̃ do
fk according
2
Construct the normalized affinity matrix W
to Eqs. (2) and (4)
3
Compute the largest m eigenvalues
(k)
(k)
(k)
fk and the
λ1 ≥ λ2 , ≥, . . . , ≥ λm of W
(k) m
corresponding eigenvectors {ul }l=1
(k)
4
Compute the truncated MFVDM embedding Vt,m
according to Eq. (6)
5 end
6 Compute the normalized affinity using Eq. (7)
7 Identify s nearest neighbors for each data point
8 Compute α̂ij for nearest neighbor pairs using Eq. (9)

(𝑘)

𝑢4 (𝑗)

𝑖
(𝑘)

𝑢5 (𝑖)

𝑙1

...

𝑙2

𝑙𝑑−1

𝑙𝑑

(𝑘)

𝑢1 (𝑖)
(𝑘)

(𝑘)

𝑢3 (𝑗)

𝑢5 (𝑗)
𝑜

𝑗

𝑢

(𝑘)

𝑢4 (𝑖)
High affinity:

(𝑘)
𝑢3 (𝑖)

Low affinity:

1
1
|| + +…+ + || > || + +…+ + ||
𝑑
𝑑

(a) Affinity

(𝑘)

(𝑖)

2
(𝑘)
𝑢1 (𝑗)
𝑢(𝑘) (𝑗)

(𝑘)

𝑢2 (𝑗)

𝑢(𝑘) (𝑖)

(b) Alignment

Fig. 4: Illustration of MFVDM affinity and alignment. (a) At
each frequency k we average the vectors transported along
paths of length 2 connecting i and j. If the transportations are
consistant, the nodes have high affinity. (b) When vi = vj , the
tangent planes TIi M and TIj M coincide and the eigenvectors
fk satisfy Eq. (8).
of W

with m < n. When t is small and m and k̃ are chosen
properly [14], the embedding is able to preserve the topological
structure of the underlying data manifold and is robust to noise
perturbation.

The operator Sk transports vectors from the tangent spaces
TIj M to TIi M, for all nearest neighbor j, and then averages
the transported vectors in TIi M (see Fig. 4a).
Nearest Neighbor Search: Based on the truncated mapping,
When the images are noisy, the evaluation of dRID is not we identify nearest neighbors by the normalized affinity A
accurate and creates shortcut edges, resulting in a small world defined as
graph [35] (see lower middle panel of Fig. 3) and leads to
* (k)
+
(k)
k̃
X
Vt,m (i)
Vt,m (j)
poor class average process. To address this problem, note
A(i, j) =
,
.
(7)
(k)
(k)
the rotational alignment consistency breaks along the shortcut
kVt,m (i)k kVt,m (j)k
k=1
edges, i.e., if (i, j) ∈ E is a shortcut, the transportations on
different paths between (i, j) are inconsistent (see Fig. 4a). Since we take into account various irreducible representations
Therefore, we define the affinity between (i, j) by taking into of SO(2) and the consistency of the corresponding transforaccount the consistency of transporting the vectors rotated at mations over the graph, this new affinity in Eq. (7) is able to
different angular frequencies k along the paths with length avoid shortcuts, and is more robust to noise compared to VDM
Pk̃
2t, as k=1 |Sk2t (i, j)|2 . Since Sk is similar to the symmetric (see Fig. 6).
fk ,
Rotational Alignment: To estimate the in-plane rotational
matrix W
−1/2
−1/2
alignment
angles for images of similar views, we notice that the
fk = D
W
Wk D0
,
(4)
0
fk encode the alignment information between
eigenvectors of W
we can quantify the consistency by computing neighboring images, as illustrated in Fig. 4b. Specifically, for
Pk̃
2
f 2t
f
images of the same views vi = vj , the corresponding entries
k=1 |Wk (i, j)| . Since Wk is Hermitian, it has real
(k) n
eigenvalues {λl }l=1 in descending order and the associated of eigenvalues are vectors in the complex plane and,
(k)
(k)
(k)
eigenvectors {ul }nl=1 . With the MFVDM mapping defined
ul (i) = eıkαij ul (j), ∀ l = 1, . . . , n.
(8)
as

n
When the viewing directions are close but not identical, Eq. (8)
(k)
(k)
t (k)
(k)
Vt : i 7→ (λl λ(k)
,
(5) holds approximately. Therefore, we minimize the mean squared
r ) hul (i), ur (i)i
l,r=1
(k) (k)
(k) (k)
error between λl ul (i) and eıkα λl ul (j) for all l and k
D
E
2
(k)
(k)
2t
f (i, j) = Vt (i), Vt (j) for k = 1, . . . , k̃. to estimate the in-plane rotational alignment, , which can be
we have W
k
Through the nonlinear-embedding in (5), the similarity of two simplified to
images can be evaluated by the inner product of the embedded
k̃ X
m 
2t
X
(k)
(k)
(k)
vectors. VDM [29] is a special case of MFVDM with k̃ = 1. It
α̂ij = arg max
λl
ul (i)ul (j)e−ıkα . (9)
was shown in [29] that the VDM can be well approximated by
α
k=1 l=1
using only the few largest eigenvalues and their corresponding
The optimal alignment can be approximated by locating
eigenvectors. Similarly, we truncate MFVDM mapping as
the peak
of the FFT of the zero-padded z, where z(k) =

m
Pm  (k) 2t (k)
(k)
(k)
t (k)
(k)
(k)
Vt,m : i 7→ (λl λ(k)
)
hu
(i),
u
(i)i
,
(6)
ul (i)ul (j).
r
r
l
l=1 λl
l,r=1

5

The MFVDM nearest neighbor search and alignment alSince eigenvectors with smaller eigenvalues are more oscilgorithm in Alg. 1 is very efficient in terms of runtime and latory and easily perturbed by noise, it is necessary to truncate
memory requirements, because it is based on the computation with the top m eigenvalues. The filtered expansion coefficients
of the top eigenvectors of several sparse Hermitian matrices, are,
which can be easily parallelized.
Â(k) = D−1/2 U h(Λ )U ∗ D1/2 A(k) ,
(11)
k

C. Denoising and CTF Correction
Algorithm 2: MFVDM denoising and CTF correction
Input: s-nearest neighbor list and the corresponding
optimal alignment angles α̂ij estimated from
Alg. 1, image and absolute CTF expansion
coefficients aik,q and cik,q , for i = 1, . . . , n
Output: Denoised images Iˆ1 , . . . Iˆn
1 for k = 0, 1, . . . , kmax do
fk according
2
Construct the normalized affinity matrix W
to Eqs. (2) and (4)
(k)
3
Compute the top m eigenvectors {ul }m
l=1 and the
corresponding eigenvalues
(k)
(k)
(k)
λ1 ≥ λ2 , ≥, . . . , ≥ λm
(k)
(k)
4
Use the ul and λl to filter the image expansion
coefficients using Eq. (11) and CTF expansion
coefficients.
5 end
6 Reconstruct Iˆ1 , . . . Iˆn using Eqs. (12) and (13).
The digital image Ii can be modeled as discrete samples of
an underlying continuous function with bandlimit κ and the
particle is well concentrated within radius of R. Therefore, the
Fourier coefficients of the image can be well approximated by
the truncated expansion on Fourier-Bessel basis ψκk,q (ξ, θ) [38]
on the disk of radius κ,
F(Ii )(ξ, θ) =

kX
max

pk
X

aik,q ψκk,q (ξ, θ).

k

k

where Uk∗ denotes the complex conjuate transpose of Uk . The
filtering and truncation of the eigenvalues help denoise the
expansion coefficients. Similarly, we can compute the effective
CTFs if the same filtering operation are applied to the Ci
and get filtered effective CTF coefficients Ĉ (k) according to
Eq. (11).
The Fourier coefficients of the denoised image without
CTF correction is recovered from the denoised expansion
coefficients,
 
F Iei (ξ1 , ξ2 ) =

kX
max

pk
X

âik,q ψκk,q (ξ1 , ξ2 ),

(12)

k=−kmax q=1

where (ξ1 , ξ2 )P
are locatedP
on the Cartesian grid points. For CTF
pk
i
k,q
ei (ξ1 , ξ2 ) = kmax
C
k=−kmax
q=1 ĉk,q ψκ (ξ1 , ξ2 ). The MFVDM
denoising steps are outlined in Alg. 2.
ei , we perform the following
Based on the effective CTF C
CTF correction to estimate the underlying projection image,
  

F Iei (ξ1 , ξ2 )
 (x, y).
Iˆi (x, y) = F −1 
(13)
ei (ξ1 , ξ2 )
C
The main advantage of filtering the expansion coefficients
compared to the 2D class averaging in many existing software
packages [4], [22] is that it does not explicitly align images of
similar views which is computationally expensive and prone
to interpolation errors.

(10)

k=−kmax q=1

When Ii is rotated by an angle α, the expansion coefficients
aik,q will be transformed to ak,q e−ıkα . Similarly, for each
projection image’s absolute CTF Ci , the expansion coefficients
are cik,q .
We first denoise the expansion coefficients aik,q using the
MFVDM eigenvectors and eigenvalues, and reconstruct the
denoised images. Let us denote by A(k) and C (k) the matrices
of the coefficients with angular frequency k, obtained by putting
aik,q and cik,q for all i and all q into a matrix of size n × pk ,
where the rows are indexed by the image number i and the
columns are indexed by the index q. Applying Sk to A(k)
denoises the expansion coefficients by directly averaging the
coefficients among its nearest neighbors. However this process
over-smoothes the underlying signal. Following [28], [7], we
use 2Sk − Sk2 as another denoising operator. The operator is
related to forward and backward diffusion on the graph that
first smoothes and then sharpens the signal defined on the
graph. This filter reduces the blurring caused by averaging
using Sk . It is equivalent to applying spectral filters to the
eigenvalues, with h(λ) = λ and h(λ) = 2λ − λ2 for Sk and
2Sk − Sk2 respectively.

IV. E XPERIMENTAL R ESULTS
We apply our method on three cryo-EM datasets to obtain
denoised images: (1) a simulated dataset with additive white
Gaussian noise and altered by CTFs, (2) two experimental
datasets. All experiments were performed on a Linux system
with a 60 cores Intel Xeon CPUs (12 cores were used), running
at 2.3GHz with 512GB RAM in total. We compare with several
state-of-the-art approaches: (1) ASPIRE[40], (2) Covariance
Wiener Filter (CWF)[1], (3) RELION[22], (4) Steerable Graph
Laplacian (SGL)[11].
Parameter Setting: In all experiments, for MFVDM we use
50 nearest neighbors to build the graph, we set k̃ = 10, m = 50
and denoising filter h(λ) = 2λ−λ2 . In ASPIRE we also use 50
nearest neighbors to generate class averages, and in RELION
we set 200 classes with 25 iterations (50 particles per class
has in average). In SGL we follow the algorithms in [11],
where we use K = 256 point FFT and keep km = 50 smallest
eigenvalues for each m. Empirically we find these settings
efficient and effective, and all these methods are not sensetive
to the choice of parameters. More details are available in the
appendix.

6

Fig. 5: Image samples of simulated 70S ribosome dataset. From left to right: noisy projection images, clean projection
images and denoised results by MFVDM, MFVDM∗ , RELION, SGL, CWF, ASPIRE. Rows show different noise levels
SNR = 0.05, 0.02, 0.01.

A. Simulated Dataset - 70S ribosome

Rotational Alignment: We evaluate alignment by computing
αij − α̂ij for all pairs of nearest neighbors (i, j), where αij
is ground truth and α̂ij is the estimate. Fig. 6 shows the
histograms of errors for all nearest neighbor pairs. Note that
at SNR = 0.01, MFVDM achieves more accurate estimation
of in-plane rotational alignment than other methods, which
indicates, again, MFVDM is more robust to noise.
1 Here all images are divided into N = 20 different defocus groups
and 1µm ≤ ∆z ≤ 4µm. The electron beam energy E = 200KeV with
corresponding wavelength λ = 0.025Å and spherical aberration cs = 2mm.
Pixel size is 2.82Å.

0.1

0
0

10

20

30

40

Angle between viewing directions
0.2

sPCA
VDM
MFVDM
Relion

0.1

0
0

10

20

30

40

Angle between viewing directions
0.2

sPCA
VDM
MFVDM
Relion

0.1

0
0

10

20

30

40

Angle between viewing directions

Proportion of neighbors

Rotational alignment

sPCA
VDM
MFVDM
Relion

Proportion of neighbors

0.2

Proportion of neighbors

SNR = 0.05

Proportion of neighbors
Proportion of neighbors

SNR = 0.02
SNR = 0.01

Nearest Neighbor Search: We evaluate nearest neighbor
search by inspecting the distribution of angles between the
viewing directions of nearest neighbor pairs, defined as θij =
arccoshvi , vj i. Accurate search means all θij s in the same
group should concentrate to 0 within a small spherical cap.
Since the viewing direction of each projection image is known,
we plot the histograms of θij for nearest neighbor lists identified
by different appoaches. Fig. 6 shows, at high SNR, MFVDM
and VDM have similar results. When SNR = 0.01, MFVDM
identifies more nearest neighbors that concentrate in the small
spherical cap than other methods. This indicates that MFVDM
is more robust to noise.

Nearest neighbor search

Proportion of neighbors

The simulated dataset is prepared from the 3D structure
of 70S ribosome, the original volume of 70S ribosome is
129 × 129 × 129 voxels and the volume is centered. Then
n = 104 projection images with 129 × 129 are generated from
uniformly distributed directions over SO(3). Moreover, the
effects of contrast transfer functions (CTFs) are included 1 .
In addition, white Gaussian noise is added with various noise
levels as signal to noise ratio (SNR) = 0.05, 0.02, 0.01. Notebly
these are typical cases in real problem. Samples are shown in
Fig. 2. We evaluate our results on three aspects: (1) nearest
neighbor search, (2) rotational alignment, and (3) denoising.

sPCA
VDM
MFVDM
Relion

0.1
0.05
0
-10

-5

0

5

10

Error of rotational alignment
sPCA
VDM
MFVDM
Relion

0.1
0.05
0
-10

-5

0

5

10

Error of rotational alignment
sPCA
VDM
MFVDM
Relion

0.1
0.05
0
-10

-5

0

5

10

Error of rotational alignment

Fig. 6: Histograms of Left: angles between viewing directions
of nearest neighbors identified by different approaches, Right:
rotational alignment errors by different approaches. The horizontal axes are in degrees. Rows show different noise levels
SNR = 0.05, 0.02, 0.01. Lines of VDM and MFVDM overlap
in the top two rows.

Denoising: Fig. 5 presents the denoising of CTF-affected
image samples at various SNR levels. To emphasize the
significance of a denoised graph by MFVDM (see Fig. 3),
we use sPCA to build the noisy graph then denoising, which is
denoted as MFVDM∗ . It can be seen that all methods preform
well at high SNR = 0.05. While at low SNR cases, MFVDM
and RELION outperform SGL, CWF and ASPIRE, whose

7

TABLE I: Average MSE, PSNR and SSIM of denoised images
on 70S ribosome. The reference are clean projection images
without CTFs (see Fig. 2(a)).
SNR

MFVDM∗

MFVDM

TABLE IV: The runtime (in minutes) of different methods on
TRPV1 and HIV-1 Nef datasets. RELION∗ represents RELION
with GPU acceleration.

SGL

CWF

ASPIRE

Dataset

MFVDM

RELION

TRPV1
HIV-1 Nef

43
32

366
308

0.05

MSE
PSNR
SSIM

0.0177
47.7
0.966

0.0186
47.3
0.965

0.0193
47.2
0.963

0.0313
45.2
0.943

0.0376
44.3
0.950

0.02

MSE
PSNR
SSIM

0.0223
46.7
0.959

0.0267
46.0
0.953

0.0280
45.6
0.948

0.0487
43.2
0.920

0.0972
40.2
0.885

0.01

MSE
PSNR
SSIM

0.0383
44.6
0.932

0.0429
43.3
0.914

0.0527
43.1
0.910

0.0637
42.0
0.902

0.273
35.6
0.715

TABLE II: The runtime (in minutes) of different methods on
70s ribosome, at SNR = 0.01. RELION∗ represents RELION
with GPU acceleration.
MFVDM

RELION

RELION∗

SGL

CWF

ASPIRE

12

465

117

12

11

15

TABLE III: The volume resolutions (lower is better) for 70S
ribosome
MFVDM

RELION

CWF

SGL

ASPIRE

14.8Å

25.4Å

44.4Å

39.5Å

17.7Å

RELION∗ CWF
284
127

82
71

SGL

ASPIRE

51
36

63
49

the improved denoising of 2D projection images. In Fig. 8,
for each denoising method, we show the 3D reconstruction of
70S ribosome from 1000 denoised projection images (original
SNR = 0.01) using common-lines based algorithm [33]. The
corresponding noisy images are the same for each method. It
shows that only MFVDM achieves a comparatively accurate
reconstruction and the results from other methods are noisy or
lose significant sub-structures. In addition to visual inspection,
we use the Fourier shell correlation (FSC) [5] between
the reconstruction and the original volume to quantify the
resolution, which is determined by the 0.143 cutoff of FSC
(see Tab. III).
B. Experimental Datasets
We test the performance of MFVDM on two public experimental datasets available in the Electron Microscope Pilot
Image Archive (EMPIAR) [15]: (1) TRPV1 ion channel[13]
(for brevity, TRPV1), (2) HIV-1 Nef[17]. Noisy samples are
shown in the first column of Fig. 9. For each dataset we take
n = 104 images as input to perform each approach.

results are blurry and have lost detailed information. In addition,
MFVDM outperforms MFVDM∗ , especially for SNR = 0.01,
this indicates the effects of MFVDM neighbor search and Colored Noise Whitening: Consider the experimental cryoEM images are typically corrupted by colored noise, we need to
alignment. In Appendix we show more denoised results.
first prewhiten the raw images: We estimate the power spectrum
In Fig. 7 we present more denoising samples to compare the
of noise based on the corner pixel values, since particles are
results from MFVDM and RELION, at SNR = 0.05, 0.02, 0.01.
contained in the middle of the images. Then we whiten each
It shows at high SNR, e,g, SNR = 0.05, both methods achieve
image using the estimated noise power spectrum and perform
a good performance. While at lower SNR cases as 0.02 or
CTF correction via phase flipping. We perform nearest neighbor
0.01, RELION could fail to denoise on some images, which
search, alignment, and denoising on the pre-processed images.
are shown in chaos. Also a few images have been classified
After denoising, we recolor the denoised images by multiplying
incorrectly. However, MFVDM still almost work. Again, this
the estimated noise power spectrum in the Fourier domain and
show the robustness of MFVDM.
perform CTF correction based on (13).
MSE, SSIM and PSNR: In Tab. I we present the average of
Denoising: The sample denoised images are displayed in
mean squared error (MSE), peak SNR (PSNR) and structural
Fig. 9. Here we generated the clean template images from the
similarity index (SSIM) on the denoised images. Notebly
reference map and estimated the most similar template for each
MFVDM outperforms other approaches with the smallest MSE
raw image. We used the 3D auto refine tool in RELION 2.1 to
and largest PSNR and SSIM, at all SNR levels. For RELION,
carry out the template matching (notice the closest projection
since its denoising result includes unknown inplane shifts, we
may not be the truth beneath the raw image due to the high
are unable to fairly evaluate such measurements on RELION.
level of noise). Visually, MFVDM denoised images are cleaner
Runtime: Tab. II compares the runtime of different approaches. than the results of other methods. Due to the lack of ground
We take n = 104 noisy images with SNR = 0.01 as input, and truths, i.e., particle orientations and clean images, we cannot
output all denoised ones. All methods use the same amount compare the classification and alignment results as before, and
of computational resource (12 cores CPU). The MFVDM provide the MSEs, SSIMs and PSNRs for the denoised images.
denosing, by building a nearest neighbor graph and filtering it, To quantitatively evaluate the methods for 2D image analysis,
runs much faster than RELION which is an iterative procedure. we evaluate the 3D ab initio models constructed from those
Even though with GPU implementation, RELION still takes denoised images. In Appendix we show more denoised results.
more time. The runtime of SGL and ASPIRE are similar to Runtime: In Tab. IV we report the runtime of different
MFVDM due to their similar procedures. This demonstrates approaches, for denoising n = 104 images. Similar to the
that MFVDM is more efficient compared to other approches. synthetic example, MFVDM denoising is the most efficient
3D Ab Initio Model: The 3D ab initio modeling benefits from

pipeline compared with other approaches.

8

Fig. 7: More sample images for denoising simulated projections from 70S ribosome, by MFVDM and RELION, at noise levels
SNR = 0.05, 0.02, 0.01.

Fig. 8: 3D reconstructions of 70S ribosome using 1000 denoised images as shown in Fig. 5 at SNR = 0.01.

9

Fig. 9: Image samples of top: TRPV1; Bottom: HIV-1 Nef datasets. From left to right: raw images, closest projection: the
clean projection images from the reference map that have the highest correlation with the noisy images estimated by RELION.
the denoised results by MFVDM, RELION, CWF, SGL and ASPIRE.
Ref. Low Res. MFVDM

TRPV1

Ref.

CWF

SGL

RELION

Ref.

SGL

Ref. Low Res. MFVDM

SGL

ASPIRE

CWF

ASPIRE

RELION

Ref.

CWF

RELION

Ref.

CWF

ASPIRE

Ref. Low Res. MFVDM

RELION

Ref.

Ref. Low Res. MFVDM

HIV-1 Nef

Ref. Low Res. MFVDM

RELION

SGL

Ref. Low Res. MFVDM

ASPIRE

RELION

Ref.

CWF

SGL

ASPIRE

CWF

SGL

ASPIRE

Fig. 10: 3D ab initio models of top: TRPV1; Bottom: HIV-1 Nef, with denoised images from MFVDM, RELION 2D class
averaging, CWF, SGL, and ASPIRE 2D class averaging. Three views of the volumes are shown in columns. ’Ref.’ represents
the reference volume, ‘Ref. Low Res.’ represents the Gaussian filtered reference volume.
3D Ab Initio Model: In Fig. 10, we show the 3D ab initio TABLE V: The volume resolutions (lower is better) for TRPV1
models generated from 1000 denoised images with identical and HIV-1 Nef.
underlying noisy images. The TRPV1 volumes are generated
Dataset
MFVDM RELION
CWF
SGL
ASPIRE
by RELION 3D Initial Model with 50 iterations. The HIV-1
TRPV1
15.88Å
15.88Å
16.93Å
19.54Å
21.16Å
Nef volumes are generated by common-lines algorithm [33].
HIV-1 Nef
8.69Å
9.78Å
39.12Å
39.12Å
16.76Å
Fig. 10 shows that MFVDM and RELION are able to achieve
good initial models that are similar to the Gaussian filtered and resolutions (see Tab. V) for both datasets. Our new
reference volumes. Other methods lose significant sub-sructure. pipeline outperforms the state-of-the-art methods and is able
In addition, we compute the Fourier shell correlation (FSC) to efficiently produce accurate initial models for cryo-EM.
in Fig. 11. It shows that the reconstruction based on the
MFVDM denoised images achieves the highest correlations

10

1

1

MFVDM
RELION
CWF
SGL
ASPIRE

0.8
0.6

MFVDM
RELION
CWF
SGL
ASPIRE

0.5

0.4
0.2
0

0

-0.2
0

0.02

0.04

0.06

0.08

0.1

0

0.05

0.1

0.15

Fig. 11: Fourier shell correlation (FSC) between the reconstruction and the Reference volume (high resolution). Blue dashed
line is the 0.143 cut-off criterion. Left: TRPV1, Right: HIV-1
Nef.
V. C ONCLUSION
Cryo-EM imaging will benefit from the cross fertilization
of ideas with the computer vision community. Here, we
proposed a new framework for cryo-EM image restoration
by defining a new metric based on MFVDM to improve the
rotationally invariant nearest neighbor search among a large
number of extremely noisy images. This new metric takes into
account of the consistency of the irreducible representations
of the alignments along connected paths. The eigenvectors
of the MFVDM matrices contain alignment information for
images of similar views and are therefore used for optimal
alignment estimation. The denoised graph structure allows
the computation of robust global basis on the data manifold.
The resulting graph filtering schemes are able to efficiently
denoise the Fourier-Bessel expansion coefficients of the images
and perform CTF correction. Through the simulated and
experimental datasets, we demonstrated our proposed methods
outperform the state-of-the-art 2D class averaging and image
restoration algorithms.
R EFERENCES
[1] T. Bhamre, T. Zhang, and A. Singer. Denoising and covariance estimation
of single particle cryo-em images. Journal of structural biology,
195(1):72–81, 2016.
[2] A. Buades, B. Coll, and J.-M. Morel. A non-local algorithm for image
denoising. In Computer Vision and Pattern Recognition, 2005. CVPR
2005. IEEE Computer Society Conference on, volume 2, pages 60–65.
IEEE, 2005.
[3] S. H. Chan. Performance analysis of plug-and-play admm: A graph
signal processing perspective. arXiv preprint arXiv:1809.00020, 2018.
[4] J. De la Rosa-Trevín, J. Otón, R. Marabini, A. Zaldivar, J. Vargas,
J. Carazo, and C. Sorzano. Xmipp 3.0: an improved software suite for
image processing in electron microscopy. Journal of structural biology,
184(2):321–328, 2013.
[5] J. Frank. Three-dimensional electron microscopy of macromolecular
assemblies: visualization of biological molecules in their native state.
Oxford University Press, 2006.
[6] D. Giannakis, P. Schwander, and A. Ourmazd. The symmetries of
image formation by scattering. i. theoretical framework. Optics express,
20(12):12799–12826, 2012.
[7] G. Gilboa, N. Sochen, and Y. Y. Zeevi. Forward-and-backward diffusion
processes for adaptive image enhancement and denoising. IEEE
transactions on image processing, 11(7):689–703, 2002.
[8] A. Heimowitz, J. Andén, and A. Singer. Apple picker: Automatic particle
picking, a low-effort cryo-em framework. Journal of structural biology,
204(2):215–227, 2018.
[9] Z. Kam. The reconstruction of structure from electron micrographs of
randomly oriented particles. Journal of Theoretical Biology, 82:15–39,
1980.
[10] B. Landa and Y. Shkolnisky. Steerable principal components for spacefrequency localized images. SIAM journal on imaging sciences, 10(2):508–
534, 2017.

[11] B. Landa and Y. Shkolnisky. The steerable graph laplacian and its
application to filtering image data-sets. arXiv preprint arXiv:1802.01894,
2018.
[12] R. Langlois, J. Pallesen, J. T. Ash, D. N. Ho, J. L. Rubinstein, and
J. Frank. Automated particle picking for low-contrast macromolecules
in cryo-electron microscopy. Journal of structural biology, 186(1):1–7,
2014.
[13] M. Liao, E. Cao, D. Julius, and Y. Cheng. Structure of the TRPV1 ion
channel determined by electron cryo-microscopy. Nature, 504(7478):107,
2013.
[14] C.-Y. Lin and H.-T. Wu. Embeddings of Riemannian manifolds
with finite eigenvector fields of connection laplacian. arXiv preprint
arXiv:1604.05707, 2016.
[15] A. Ludin, P. K. Korir, J. Salavert-Torres, G. J. Kleywegt, and A. Patwardhan. EMPIAR: A public archive for raw electron microscopy image
data. Nature Methods, 13(387–388):387–388, 2016.
[16] D. Lyumkis, A. F. Brilot, D. L. Theobald, and N. Grigorieff. Likelihoodbased classification of cryo-EM images using FREALIGN. Journal of
structural biology, 183(3):377–388, 2013.
[17] K. L. Morris, C. Z. Buffalo, C. M. Sturzel, E. Heusinger, F. Kirchhoff,
X. Ren, and J. H. Hurley. HIV-1 Nefs are cargo-sensitive AP-1
trimerization switches in tetherin and MHC-I downregulation. bioRxiv,
page 276733, 2018.
[18] S. Osher, Z. Shi, and W. Zhu. Low dimensional manifold model for
image processing. SIAM Journal on Imaging Sciences, 10(4):1669–1690,
2017.
[19] A. Pascual-Montano, L. Donate, M. Valle, M. Barcena, R. PascualMarqui, and J. Carazo. A novel neural network technique for analysis
and classification of em single-particle images. Journal of structural
biology, 133(2-3):233–245, 2001.
[20] P. A. Penczek. Image restoration in cryo-electron microscopy. In Methods
in enzymology, volume 482, pages 35–72. Elsevier, 2010.
[21] S. H. Scheres. Maximum-likelihood methods in cryo-EM. part II:
Application to experimental data. Methods in enzymology, 482:295,
2010.
[22] S. H. Scheres. Relion: Implementation of a bayesian approach to cryoEM structure determination. Journal of Structural Biology, 180:519–530,
2012.
[23] S. H. Scheres, R. Núñez-Ramírez, Y. Gómez-Llorente, C. San Martín, P. P.
Eggermont, and J. M. Carazo. Modeling experimental image formation
for likelihood-based classification of electron microscopy data. Structure,
15(10):1167–1177, 2007.
[24] S. H. Scheres, M. Valle, R. Nuñez, C. O. Sorzano, R. Marabini,
G. T. Herman, and J.-M. Carazo. Maximum-likelihood multi-reference
refinement for electron microscopy images. Journal of molecular biology,
348(1):139–149, 2005.
[25] P. Schwander, D. Giannakis, C. H. Yoon, and A. Ourmazd. The
symmetries of image formation by scattering. ii. applications. Optics
express, 20(12):12827–12849, 2012.
[26] F. Sigworth. A maximum-likelihood approach to single-particle image
refinement. Journal of structural biology, 122(3):328–339, 1998.
[27] F. J. Sigworth. Principles of cryo-EM single-particle image processing.
Microscopy, 65(1):57–67, 2016.
[28] A. Singer, Y. Shkolnisky, and B. Nadler. Diffusion interpretation of
nonlocal neighborhood filters for signal denoising. SIAM Journal on
Imaging Sciences, 2(1):118–139, 2009.
[29] A. Singer and H.-T. Wu. Vector diffusion maps and the connection
laplacian. Communications on pure and applied mathematics, 65(8):1067–
1144, 2012.
[30] A. Singer, Z. Zhao, Y. Shkolnisky, and R. Hadani. Viewing angle
classification of cryo-electron microscopy images using eigenvectors.
SIAM Journal on Imaging Sciences, 4(2):723–759, 2011.
[31] G. Tang, L. Peng, P. R. Baldwin, D. S. Mann, W. Jiang, I. Rees, and
S. J. Ludtke. Eman2: an extensible image processing suite for electron
microscopy. Journal of structural biology, 157(1):38–46, 2007.
[32] C. Tomasi and R. Manduchi. Bilateral filtering for gray and color images.
In Computer Vision, 1998. Sixth International Conference on, pages
839–846. IEEE, 1998.
[33] L. Wang and A. Singer. Exact and stable recovery of rotations for
robust synchronization. Information and Inference: A Journal of the
IMA, 2(2):145–193, 2013.
[34] L. Wang, A. Singer, and Z. Wen. Orientation determination of cryo-EM
images using least unsquared deviations. SIAM journal on imaging
sciences, 6(4):2450–2483, 2013.
[35] D. J. Watts and S. H. Strogatz. Collective dynamics of ‘smallworld’networks. nature, 393(6684):440, 1998.
[36] J. Yang, J. Wright, T. S. Huang, and Y. Ma. Image super-resolution
via sparse representation. IEEE transactions on image processing,
19(11):2861–2873, 2010.

11

[37] R. Yin, T. Gao, Y. M. Lu, and I. Daubechies. A tale of two bases: Localnonlocal regularization on image patches with convolution framelets.
SIAM Journal on Imaging Sciences, 10(2):711–750, 2017.
[38] Z. Zhao, Y. Shkolnisky, and A. Singer. Fast steerable principal component
analysis. IEEE transactions on computational imaging, 2(1):1–12, 2016.
[39] Z. Zhao and A. Singer. Fourier–bessel rotational invariant eigenimages.
JOSA A, 30(5):871–877, 2013.
[40] Z. Zhao and A. Singer. Rotationally invariant image representation for
viewing direction classification in cryo-em. Journal of structural biology,
186(1):153–166, 2014.

A PPENDIX
A. More Experimental Results
In this section, we provide more experimental results on the
simulated dataset (70S ribosome) and the experimental datasets
(TRPV1 and HIV-1 Nef). The parameter setting is the same
as the main paper.
Simulated Dataset: In Fig. 12 and Fig. 13 we show more
denoised images of 70S ribosome by MFVDM, MFVDM∗ ,
RELION 2D class averaging, SGL, CWF, and ASPIRE 2D
class averaging at SNR = 0.05, 0.02, 0.01. All methods
preform well at high SNR (SNR = 0.05). As the noise level
increases, MFVDM outperforms other methods. Some class
averages generated from RELION does not have any structural
information and a few images are classified incorrectly. SGL
and CWF are able to denoise and preserve the main structure,
but some detailed information has been lost. ASPIRE appears
noisier due to the fact that it only averages s-nearest neighbors
directly. It shows that compared with the existing methods,
MFVDM is more robust to noise. In addition, the performance
of MFVDM∗ (without Alg. 1 in the main paper) is worse
than MFVDM, especially at SNR = 0.01, this indicates the
importance of MFVDM nearest neighbor search and alignment.
Experimental Datasets: In Figs. 14 and 15 we show more
denoising results for two experimental datasets: TRPV1 and
HIV-1 Nef, by the following approaches: MFVDM, RELION
2D class averaging, SGL, CWF and ASPIRE 2D averaging.
We generated the clean template images from the reference
map and estimated the most similar template for each raw
image. We used the 3D auto refine tool in RELION 2.1 to
carry out the template matching (notice the closest projection
may not be the truth beneath the raw image due to the high
level of noise). The Figs. 14 and 15 show that our proposed
method (MFVDM) is able to recover all views. RELION is
good at recovering a few views, however, some class-means
have very poor quality. The MFVDM and RELION 2D class
averaing outperform CWF, SGL and ASPIRE on these real
datasets.
For the real image data, we cannot use the estimated closest
projections to directly evaluate 2D image denoising in terms
of MSE, SSIM and PSNR, because (1) the real single particle
images are not perfectly centered, and (2) the estimated closest
projections might be inaccurate. Therefore, the quantitative
evaluation for real data is through the comparisons of the
resolution of the reconstructed volume and the Fourier shell
correlations shown in the main paper.

12

Fig. 12: Image samples of simulated 70S ribosome dataset. From top to bottom: noisy projection images, clean projection
images and denoised results by MFVDM, MFVDM∗ . Columns show different noise levels SNR = 0.05, 0.02, 0.01.

13

Fig. 13: Image samples of simulated 70S ribosome dataset. From top to bottom: denoised results by RELION, SGL, CWF and
ASPIRE. Columns show different noise levels SNR = 0.05, 0.02, 0.01.

14

Fig. 14: Image samples of TRPV1 dataset. Noisy: raw projection images. Closest projection: the clean projection images
from the reference map that have the highest correlation with the noisy images estimated by RELION. MFVDM, RELION,
SGL, CWF, ASPIRE: the corresponding denoised images.

15

Fig. 15: Image samples of HIV-1 Nef dataset. Noisy: raw projection images. Closest projection: the clean projection images
from the reference map that have the highest correlation with the noisy images estimated by RELION. MFVDM, RELION,
SGL, CWF, ASPIRE: the corresponding denoised images.

