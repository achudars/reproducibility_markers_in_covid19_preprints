bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

A simple model of a quadruped discovers single-foot walking
and trotting as energy optimal strategies
1

2

Delyle T. Polet *, John E. A. Bertram ,
1 Department of Biological Sciences, University of Calgary, Calgary, Alberta, Canada
2 Department of Cell Biology and Anatomy, Cumming School of Medicine, University of
Calgary, Calgary, Alberta, Canada
* dtpolet@ucalgary.ca

Abstract
It is widely held that quadrupeds choose steady gaits that minimize their energetic cost
of transport, but it is difficult to explore the entire range of possible footfall sequences
empirically. We present a simple model of a quadruped that can spontaneously produce
any of the 2300+ planar footfall sequences available to quadrupeds. Through trajectory
optimization of a work and force-rate cost, and a large sample of random initial guesses,
we provide stronger evidence towards the global optimality of symmetrical four-beat
walking at low speeds and two beat running (trotting) at intermediate speeds. Using
input parameters based on measurements in dogs (Canis lupus familiaris), the model
predicts the correct phase offset in walking and a realistic walk-trot transition speed. It
also spontaneously reproduces the double-hump ground reaction force profile observed
in walking, and the smooth single-hump profile observed in trotting, despite the model’s
lack of springs. However, the model incorrectly predicts duty factor at the slowest
speeds, and does not choose galloping as globally optimal at high speeds. These
limitations might point to missing levels of complexity that could be added to future
quadrupedal models, but the present results suggest that massive legs, elastic
components, head-neck oscillations and even multi-linked legs are not critical
determiners for the optimality of natural quadrupedal walking and trotting.

April 13, 2019

1/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

Author summary
Why do quadrupedal mammals move in consistent ways, when so many options are
available? We tackled this problem by determining energetically-optimal gaits using a
simple computational model of a four-legged animal. The model can use virtually any
pattern of movement (physics-permitting!) but selects natural movement strategies as
energetically optimal. The similarities between the computer-based predictions and
natural animal movement are striking, and suggest mammals utilize movement
strategies that optimize energy use when they move.

Introduction

1

When unconstrained at a given speed, members of a species of quadrupedal will

2

generally select a common gait, which is seldom unique to that species alone [1–4]. The

3

consistency of gait choice is remarkable, given how many alternatives exist. McGhee

4

and Jain [5] noted that while 5040 unique footfall sequences are available to quadrupeds,

5

only 21 varieties had been reported by the mid-1970s. Within these varieties, some very

6

consistent patterns emerge. With few exceptions, mammals choose a lateral or diagonal

7

sequence (four-beat) walk at slow speeds, a running trot (two-beat) at intermediate

8

speeds, and a gallop at high speeds [6, 7]. Before the trot-gallop transition, healthy

9

mammals use highly symmetrical gaits, with foot touchdown and liftoff on the left side

10

of the body being repeated exactly half a stride later on the right side [1, 8, 9]. Why

11

should the same patterns repeatedly emerge among quadrupedal mammals, despite the

12

incredible morphological diversity and near limitless gait possibilities?

13

It is widely held that the gaits chosen by quadrupeds at a particular speed are those

April 13, 2019

14

that minimize metabolic energy expenditure [1–4, 10]. Since locomotion is an

15

energy-intensive activity, it is reasonable to suppose that animals have evolved some

16

means to lower the energetic cost of locomotion. Indeed, humans seem remarkably

17

sensitive to cost of transport, or energetic expenditure per unit weight per unit distance,

18

even shifting their gait in response to unusual stimuli in accordance with energetic cost

19

mitigation [11–13]. It is more difficult to train animals to perform unusual gait tasks,

20

but Hoyt and Taylor [10] showed that horses will exhibit increased metabolic cost of

21

2/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

transport if they perform walking, trotting or galloping outside their natural speed

22

ranges, and tend to chose speeds that minimize cost of transport within each gait.

23

But why are particular gaits energy minimizing for particular animals at particular
speeds? Some have pointed to elastic elements as a key aspect [14–16]. Gan et al. [15]

25

found that natural gaits of horses could be replicated by a passive dynamic model with

26

springs as legs. Xi et al. [16] found that a four-beat walk is work minimizing at slow

27

speeds and a two-beat run (trotting or pacing) minimizes work at high speeds. They

28

pointed to their use of elastic elements as an important reason why their model

29

exhibited a double-hump ground reaction force (GRF) profile in walking and single

30

hump GRFs in running

31

If elastic elements are prerequisites for gait optimality, it has important implications

32

for the evolutionary history of gait. In particular, it suggests that appropriately-tuned

33

tendons must have evolved before the gaits we see in modern organisms first appeared

34

in their ancestors [17].

35

We may do well in taking guidance from bipedal research using work-based

April 13, 2019

24

36

optimization methods. By incrementally increasing the complexity of the models used,

37

we can determine what parameters are necessary prerequisites for generating the

38

phenomenon of interest. Srinivasan and Ruina [18] used a “minimal” biped; effectively,

39

a point mass with one massless leg. (As it was constrained to perform symmetrical gaits

40

with no double-stance, the single leg could be reflected into the other leg for the next

41

step, effectively representing a biped.) By minimizing work at a given step length and

42

speed, the model predicted pendular walking at slow speeds and running at high speeds.

43

However, it could not recreate double-stance dynamics, had infinitesimal stance

44

duration in running, and discovered a strange “pendular run” at some combinations of

45

speed and stride length.

46

Hasaneini et al. [19] added a trunk and legs with realistic masses and moments.

47

Their model discovered natural walking and running, as well as forward leaning of the

48

torso in vertical ascent, and bang-coast-bang swing dynamics among other

49

commonly-reported features of natural human gait. Importantly, neither model used

50

elastic elements, and both discovered double-hump GRFs in walking and single-hump in

51

running, suggesting that elastic morphological features are not necessary prerequisites

52

to the optimality of the solutions observed (and more likely, evolutionary

53

3/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

post-adaptations).

54

In complex models of locomotion, the solution space of possible gaits tends to

55

increase in scope and dimensionality, and so is necessarily more difficult to explore. Xi

56

et al. [16] relied on a small number of preset footfall sequences to seed optimization,

57

bringing into question whether other footfall sequences not explored in the study might

58

have been energy-minimizing.

59

An advantage of the model in [16] was an explicit modelling of rate-dependent

60

energetic penalties; in their case viscous damping. While limb work was the only cost in

61

the above bipedal models, there is increasing evidence from the human physiology

62

literature that muscle activation costs, in addition to muscular work, are an important

63

determiner of gait. That is, there is increased metabolic cost for changing muscular

64

forces quickly, even if work is held constant [20–22]. While the mechanism is currently

65

unknown, rate penalties explain much about gait selection, particularly the stride length

66

and duty factor vs. speed relationship [23–25].

67

To what extent can a simple, minimally constrained energy-optimization model,

April 13, 2019

68

without springs, forced pendular exchange or forced stability, predict gait choice in

69

quadrupeds? Do natural gaits emerge from such a simplified model and are they energy

70

minimizing? Does a force-rate cost substantially enhance empirical agreement? We

71

explore these questions with a planar, two-point-mass optimization model that can

72

perform any of the footfall sequences available to quadrupeds. We compare the

73

simulation results to empirical data on dogs only, but we anticipate the results are more

74

broadly applicable across quadrupedal mammals.

75

Methods

76

Trajectory optimization of a minimal quadruped

77

Generalized model of a quadruped

78

We use a simplified model of a quadruped based on the bipedal model in [18], but

79

extended to four legs. A rigid trunk connects two point masses. Each point mass has

80

two massless limbs that can extend or contract. The quadruped is two-dimensional and

81

lives in the sagittal plane (Fig 1).

82

4/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

Fig 1. The simple quadrupedal model used in this paper.
Two point masses sit on massless legs that can extend and contract. The point masses
are connected with a rigid trunk. Five morphological parameters are necessary as input:
the mass of the fore and hind quarters (mF and mH , respectively), the trunk length
(lb ), and the maximum length of the fore and hind limbs (lFmax and lHmax , respectively).
Two kinematic variables are also necessary: the stride length (D) and the average
horizontal speed (U ). From these seven constant inputs, the optimal control chooses
footfall positions (fij ) and over twenty independent temporal variables, including
ground reaction forces and their rate of change (Fijk and Ḟijk ), center of mass position
and velocity (x and ẋ) and body pitch angle and angular velocity (θ and θ̇).

Each limb comes as a “trailing” and “leading” virtual limb pair. A “trailing” limb
acts through a rear footfall position, and a “leading” limb acts through a forward

84

footfall position exactly one stride length (D) in advance of the trailing footfall position

85

(the leading right-hind in Fig 1 is shown as a dotted line). The trailing limb is active

86

before the leading limb (following convention, trailing and leading are spatial terms, not

87

temporal ones). Since we are interested in periodic motion, we can always shift the

88

temporal frame of reference so that, for one limb, touchdown occurs before liftoff. For

89

this limb, only one virtual limb and one footfall position is necessary.

90

The organism travels in a vertical gravitational field with downward acceleration g

91

at an average horizontal speed U in stride length D. The quadruped has forequarter

92

mass mF and hindquarter mass mH . Its maximum limb lengths are lFmax and lHmax for

93

the fore and hindlimbs, respectively.

94

We use trajectory optimization techniques (sometimes referred-to as optimal control)

95

to discover optimal gaits (for a beginner’s overview see [26]; for a more advanced

96

treatment see [27]). The basic idea is that the aspects of gait the organism can directly

97

control (e.g. footfall positions and forces in time) are chosen so as to minimize some

98

cost function within particular constraints. These constraints can include physical or

99

geometric limitations (e.g. mechanical dynamics or maximum limb length) or even

100

biological limitations (e.g. an upper bound on force output or muscle shortening rate).

101

Our hypothesis is that quadrupedal mammals choose whichever gait minimizes

102

metabolic cost per unit distance. The primary contributor to energetic cost is limb

103

work, the combined positive and negative work performed by each limb:

104

T

Jw = ∫ ∑ ∣Fi (t)l˙i (t)∣ dt,
0

April 13, 2019

83

(1)

i

5/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

where T is the stride period, Fi is the absolute force acting through limb i and li is the

105

length of limb i. li is defined as the distance between the fore- or hindquarters and

106

footfall position fi (see S1 Appendix). Note that we make no distinction between

107

positive and negative muscle work efficiencies. While these efficiencies can alter optimal

108

solutions in unsteady gaits [28], in steady gaits on level ground an equal amount of

109

positive and negative work must be performed. Therefore, in the absence of other forms

110

of dissipation (like foot-ground collisions or viscous effects) or asymmetric elastic energy

111

recovery, the relative efficiencies of positive and negative work do not change the

112

optimal solution.

113

The secondary cost is that of a force-rate penalty. Since the exact choice of rate

114

penalty has little effect on the agreement with empirical data [29] (some fitting is

115

required in any case, since the mechanism is unknown), we used a well-behaved squared

116

cost in force rate,

117

T

Jr = ∫

2
c1 Ḟi

dt,

(2)

0

where c1 is a fitting parameter. A side benefit of the force rate cost is that it smooths

118

the otherwise impulsive solutions that result from work-minimizing solutions [29, 30].

119

The resulting objective of the optimization (in the absence of augmentation for
complementarity minimization), reflecting the metabolic cost of transport in the

121

absence of a basal metabolic rate, is

122

Jtot =

April 13, 2019

120

Jw + Jr
,
mgD

(3)

where D is the stride length.

123

Variables

124

Trajectory optimization involves two classes of time-dependent variables. Any variable

125

that does not have a time derivative constraint is a “control variable”. For the ideal

126

problem, these are the time derivative of limb forces, Ḟi . Those which have time

127

derivative constraints are called “state variables”. The limb forces Fi are one such state,

128

as are the positional variables x and y (the horizontal and vertical position of the center

129

of mass), and θ, the trunk pitch angle (Fig 1). Since the dynamics are constraints on

130

6/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

acceleration, the time derivatives of x, y and θ are also states. Finally, “parameters” are

131

time-invariant quantities that are unknown at the outset of the problem. For the

132

quadrupedal locomotion problem, these are the footfall positions fi (Fig 1).

133

Constraints

134

Single-phase optimal control problems involve four types of constraints: Path and

135

Endpoint Constraints and Variable and Integral Bounds. Path constraints must be

136

satisfied for all time, whereas Endpoint Constraints must be satisfied at the temporal

137

start and end of the problem. Variable bounds are upper and/or lower limits to the

138

magnitude of variables that must also be satisfied for all time, whereas Integral bounds

139

are limits to the value of mathematical statements integrated through time.

140

The mathematical statements of the constraints of the problem are stated in S1

141

Appendix. Briefly, solutions to the optimal control problem must satisfy the following

142

path constraints:

143

P1. mechanical dynamics are satisfied,

144

P2. fore and hind masses must always be above ground,

145

P3. limb lengths are not to exceed prescribed values (measured limb length),

146

P4. leading limbs are active strictly after trailing limbs, and

147

P5. limbs are below the body: forelimb torques are always positive and hindlimb

148

torques are always negative.

149

Constraint P3 determines the stepping sequence. In effect, all limbs are in contact

April 13, 2019

150

with the ground at all times; however, the forces may only be active when limbs are

151

sufficiently short. Once a solution is found, we can examine the ground reaction forces

152

to assess contact. If force is nonzero, that limb is in contact with the ground; if forces

153

are zero, that limb is not in contact. With this method, we do not need to specify

154

contact sequence a priori, an advantage over the multiple shooting method used by [16].

155

One disadvantage of this method is that solutions exhibit a discontinuity at ground

156

contact, which requires special treatment and makes the problem more difficult to solve.

157

The relative simplicity of our optimal control problem makes the implementation

158

tractable, despite this disadvantage.

159

7/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

Constraint P5 ensures that legs are always ventral to the body, a sensible limitation
for cursorial quadrupedal mammals. Curiously, if this constraint was removed, the

161

simulation frequently discovered bipedal running. This finding deserves further analysis

162

as it may have implications for the evolution of bipedal locomotion, but is beyond the

163

scope of the present study.

164

The following endpoint constraints are prescribed:

165

E1. kinematics are periodic, and

166

E2. Force for each given limb is equal at the start and end of stride (Force Continuity)

167

Both endpoint constraints come out of the definition of a steady gait. An integral

168

constraint is also prescribed:

169

I1. the vertical and fore-aft impulse generated by the left legs is equal to the impulse
generated by the right legs.

170

171

The rationale is that breaking this constraint would cause the animal to turn or tip.

172

Including the constraint lowered solve time, while removing the constraint did not seem

173

to change the optimal solution.

174

Variables in optimal control problems may be bounded in some way. For the present
case, the ideal bounds on variables and time are:

175

176

′

B1. Ground reaction forces are pushing forces (Fi > 0).

177

B2. Reference limb is not active at boundary (Fref (0) = Fref (1) = 0).

178

B3. The horizontal position of the center of mass starts at x = 0 and ends at x = D.

179

B4. The simulation starts at t = 0 and ends at t = U /D,

180

′

′

where U is the mean fore-aft speed during a stride. Altogether, this idealized

April 13, 2019

160

181

problem involves 27 unknown variables: 16 state variables, 7 control variables, and four

182

parameters. These unknowns are all determined by optimizing the objective while

183

satisfying the constraints. Only five morphological parameters are needed as inputs: the

184

body length, fore- and hindlimb lengths, and mass of the fore- and hindquarters. Three

185

additional inputs are required: Average horizontal speed, stride length, and

186

gravitational acceleration.

187

8/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

However, there are several numerical issues with the above implementation. These

188

are resolved by alterations to the optimal control problem, as discussed in the next

189

section

190

Numerically well-conditioned optimal control problem

191

Three numerical issues arise in the ideal implementation. The first is the presence of a

192

non-smooth objective due to the absolute-value function of the integrand (Eq 1). The

193

second is due to non-smooth optimal solutions. The final issue is due to poor scaling,

194

arising because several variables have vastly different magnitudes. Each issue can be

195

ameliorated by reformulating the problem.

196

Non-smooth functions in optimal control problems can be reformulated using slack

197

variables [27]. Two slack variables are required for every instance of the absolute value

198

function; thus 14 new controls are introduced (pi ≥ 0 and qi ≥ 0). In addition, new path

199

constraints are required, one set for redefining the operand of the absolute value

200

function (S1 Appendix), and another for enforcing orthogonality of the slack variables:

201

pi qi = 0.

(4)

Unfortunately, Eq 4 is a complementarity condition, as are several other constraints

202

(P3, P4 and P5) which require special treatment [27, 31]. Complementarity constraints

203

are of the form,

204

ai (t)bi (t) = 0 or ai (t)bi (t) ≤ 0,
where ai (t) and bi (t) are arbitrary variables [27]. One way to manage these conditions

205

is to introduce “relaxation parameters” that effectively smooth the constraint, as

206

ai (t)bi (t) − si = 0,

April 13, 2019

si > 0.

(5)

These relaxation parameters decrease the accuracy of the solution (compared to the

207

solution of the non-smoothed problem), but by iteratively reducing the values of si , we

208

can get arbitrarily close to the true solution.

209

We can further ratchet down the relaxation parameters by incorporating them into

210

the optimization problem. We make si decision variables (controls), and augment them

211

9/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

with the penalty

212

T

J˜ = J + ∫ c3i si dt

(6)

0

where c3i is a constant chosen to be sufficiently large [31]. Then, the optimizer tends to

213

reduce the value of si , making the solution more accurate.

214

While it is not necessary to use both the strategy 5 and 6, we found that

215

incorporating both reduced solve time and eased implementation. Our strategy was to

216

start by not enforcing complementarity conditions (c3i were 0 and si were allowed to

217

take on any positive value) and then to increased the coefficients c3i as we increased the

218

resolution on each iteration. An exception to this was in the slack variable

219

complementarity condition itself (Eq 4), which, on every iteration except the first, was

220

not enforced except through the augmentation

221

T

J˜ = J + ∫ c2 (pi qi ) dt,

(7)

0

where c2 = 1 E - 3.

222

The resulting cost function for the optimization (prior to normalization), was

J˜tot =

223

T
1
2
∫ (∑ pi + qi + c1 Ḟi + c2 pi qi + ∑ c3j sj ) dt
mgD 0
i
j

(8)

The final issue, poor scaling, was partially helped by normalization (next section),

April 13, 2019

224

but further ameliorated through the automatic scaling feature

225

(‘automatic-hybridUpdate’) in GPOPS-II [32]. Automatic scaling requires all

226

unbounded variables to be redefined with finite bounds. Selected bounds are shown in

227

S1 Table, and were chosen to be much larger than the expected magnitude of the

228

variables, but small enough to improve scaling of the optimal control problem (see S2

229

Appendix for further details).

230

Normalization

231

All variables were normalized. Times were normalized to T ≡ D/U , lengths were

232

normalized to lb , and forces were normalized to mg, yielding a nondimensional time

233

constant

234

√
T̂ ≡ T g/lb

(9)

10/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

′

In this paper, normalized variables are noted with a prime exponent (e.g. x → x ).
Since the force rate coefficient c1 (Eq 2) may have biological significance, it was also
2

236

-1

normalized. However, since c1 Ḟ must have units of J s , the proper normalization is

237

c1 = c1 mg/(lb T ), breaking dynamic similarity, and making lb and m an explicit part of

238

the optimization. [25] noticed a similar issue with their rate penalty breaking dynamic

239

similarity. Instead of the above normalization, we determined an appropriate

240

′

′

normalized force-rate penalty constant (c1D ) for the Dalmatian documented in [33]

241

moving with time constant T̂D . For all other cases, c1 (T̂ ) was scaled relative to c1D as

242

′

c1 (T̂ ) = c1D
′

′

T̂d
T̂

′

.

The augmentations to the cost function (Eq 8) were not scaled.

243

While the characteristic length for the computational problem was lb , we will report
non-dimensional speed as the square root of the Froude number,

244

245

√
′
Uh = U / glhmax ,

(10)

following a common convention in other literature [1, 33].

246

Implementation of the trajectory optimization problem

247

The optimal control problem was solved using a Direct Collocation (DC) method with

248

hp-Adaptive Gaussian Quadrature, implemented in GPOPS-II (v. 2.1) [32]. This

249

software also supplied mesh-refinement methods. The resulting nonlinear problem was

250

solved using the nlp-solver SNOPT (v. 7.4-1.1) [34, 35]. GPOPS-II mesh tolerance was

251

−4

set to 10 .

252

Numerical solutions to optimal control problems require an initial guess. Values at

253

each of the 16 initial grid points for each variable were chosen from a uniform

254

pseudo-random distribution within the bounds of each variable. An exception is the

255

horizontal position state variable, which was set as [0, D] for the start and ending

256

conditions, respectively, and interpolated linearly between those values for intermediate

257

grid points.

258

The algorithm for finding the pseudo-global optimum (the optimum among all valid

April 13, 2019

235

11/45

259

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

solutions) is as follows. An initial randomized guess was passed to GPOPS-II with one

260

mesh refinement step. For this initial step, the slack variable orthogonality constraint

261

(Eq 4) was explicitly enforced with c2 and all c3i set to 0 (Eq 8). This step allowed the

262

program to more quickly approach a feasible region. The output was then

263

down-sampled and passed back to GPOPS-II, this time with two mesh iterations steps,

264

no slack variable orthogonality constraint and with the fully augmented objective (Eq 8,

265

with c2 = 1 E - 3 and c3i = [100 10 10] (relaxation parameter coefficients for P3, P4 and

266

P5, respectively). This process was repeated two more times, with c2 = 1 E - 3 and

267

c3i = [1000 100 100], with three and finally 8 mesh iterations. The final solution was

268

saved and the problem reset with a new random guess, until the required number of

269

random guesses were explored. Other settings used for SNOPT and GPOPS-II are

270

listed in S2 Table.

271

For exploring the effect of c1 on the solution in one test case, 100 initial guesses were

272

used. For the three detailed test cases, 500 initial guesses were used. For comparison to

273

the large empirical dataset from [36], the number of guesses depended on the speed,

274

since lower speeds required longer solution times per guess but the final solutions were

275

not strongly affected by the initial guess. For
0.6 <
′
Uh

′
Uh

≤ 1 500 guesses were used; for 1 <

′
Uh

′
Uh

≤ 0.6, 250 guesses were used; for

276

≤ 2, 750 guesses were used; and for

277

> 2, 1000 initial guesses were used.

278

Each solution was determined as “valid” on the basis of (1) satisfactory mesh error

279

(lower than the tolerance of 1e-4) and (2) satisfactory (low) constraint violation. The

280

second criteria was especially critical for complementarity conditions, which were not

281

explicitly enforced and were violated more often than the other constraints.

282

Among valid solutions, the lowest cost solution was selected as the (pseudo-)global

April 13, 2019

283

optimum as determined by Jtot (Eq 3). That is, since constraints were checked through

284

the above validation step, the augmented parts of the objective (regarding constraint

285

violation) were ignored as part of the relative optimality of one solution as compared to

286

the others.

287

12/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

Empirical data

288

The model requires five inputs: stride length, speed, body length, center of mass

289

position, and limb lengths. As validation of the model, duty factor, phase offset, and

290

ground reaction force profiles are also required. These empirical data were acquired for

291

single speeds from four studies [33, 37, 38], representing dogs moving at a slow walk,

292

medium walk, and trot, respectively. In addition, [36] provides curves for duty factor,

293

stride length, and phase offset as a function of speed from a large dataset. While all

294

these studies supply a length calibration (e.g. shoulder height, withers height), they do

295

not supply all necessary body proportions (except for [33], which supplies shoulder and

296

hip locations in Figure 12 of that study). These additional proportions were taken from

297

sagittal view images of the breed standard from the American Kennel Club

298

website [39–41]. The acquired parameters are summarized in Table 1.

299

Forelimb length was taken as the length from manus to shoulder joint in standing.
Hindlimb length was taken as length from pes to hip joint in standing. Body length was
taken as hip to shoulder joint in standing. Masses were assumed concentrated at
shoulder and hip, following [37]. To determine center of mass location (or, equivalently,
the anterio-posterior body mass distribution [42]), a balance of torque approach was
used following [43]. Briefly, since the net moment about the center of mass must be zero
during steady, periodic locomotion, the net torque produced by the hindlimbs in the
sagittal plane must be equal and opposite to the forelimbs. Assuming the trunk is
approximately horizontal during the stride, then
1

mF = 2 DFf ∫ ŷ ⋅ FF (ts ) dts
′

′

and

(11)

with

(12)

0
1

mH = 2 DFh ∫ ŷ ⋅ FH (ts ) dts ,
′

′

0
′

′

′

m ≡ mF + mH = 1

(13)

where DFf and DFh are the duty factors of the fore and hind limbs, respectively, ŷ is

300

the vertical unit vector, FF and FH are the fore and hindlimb ground reaction forces,

301

and ts is “stance time” (time during stance for a given foot, normalized to stance

302

duration). mi = mi /m where m is the total body mass. Due to measurement error, the

303

′

′

′

final condition is not always met. To correct for these errors, mF and mH were scaled

April 13, 2019

13/45

304

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

′

by 1/m , ensuring that their sum was exactly 1 (Table 1).

305

Forces were derived from Fig 8 in [37], while the footfall sequence was derived from

306

Fig 9. Ground reaction forces and footfall sequence were also pulled from Fig. 5a in [33],

307

and Fig 1 in [38] and Fig 3 in [44], for comparison to modelled predictions.

308

The standard error in mean phase offset from [37] was found by the authors to be
small, and so was not reported for most limbs. Variation in footfalls could not be

310

calculated from [33] as these authors reported only one footfall sequence at the speed of

311

interest. The standard deviation in duty factor was reported by [38] in their Table 1,

312

but error in phase offset was not reported. For this, we took the range of phase offsets

313

observed in Fig 1 in [38] as a measure of the natural variation in phase offset. We used

314

the same approach for both phase offset and duty factor in [44], using their Fig 3b.

315

Error bars in gait diagrams for our Fig 4 therefore represent twice standard deviation

316

where available, and range of observed values otherwise.

317

We required empirical gait transition speeds to compared to our model. The concept

318

of “a transition speed” in dogs is somewhat misleading, and Maes et al. [36], observed

319

more of a transition zone: speeds where dogs were almost equally likely to be choosing

320

one gait or another. We quantified the probability of dogs choosing one gait or another

321

using their data (Fig 4 in [36]), and binned observations in

April 13, 2019

309

′
Uh

= 0.1 increments.

322

Trotting and Pacing were combined as one gait, as were Transverse, Slow Rotary and

323

Fast Rotary Gallops. The relative frequency (number of observations for a particular

324

gait divided by the total number of observations at that speed) are shown in S1 Fig. We

325

defined the gait transition point as the speed where the relative frequency of one gait

326

(e.g. walking) transitions from greater than 0.5 to less than 0.5.

327

Data availability

328

Data supporting this work is available as supplemental files using a comma-delimited

329

format.

330

14/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

Table 1. Empirical data used for validation and as input (bold) for the model. PL is
pair lag, the fraction of stride between left hind and left fore touchdown (sometimes
referred to as pair offset or phase offset). DFh and DFf are mean duty factor of the hind
and fore limbs, respectively. *Not reported at the original source [36]; derived from [37]
Main Source:
Breed

′

′

mf (m )
′
′
lh , lf
lb (m)
Proportions
source:
′
′
Uh , D
Hildebrand gait
classification

[37]

[33]

[38]

[36]

Mix: 50%
Rhodesian
Ridgeback
0.63 (0.95)
0.91, 0.75
0.63
[41]

Dalmation

Labrador
Retriever

Belgian
Malinois

0.61 (1.12)
0.89, 0.79
0.61
Fig 12 in [33]

0.66 (1.01)
0.86, 0.72
0.52
[40]

0.63*
1.01, 0.92
0.48
[39]

0.34, 1.3

0.39, 1.21

1.15, 2.0

Walk in diagonal
couplets lateral

Walk in singlefoot
lateral sequence

Running trot

D = 1.04 + 1.36Uh
Variable

0.20
0.61
0.67

0.50
0.40
0.51

Uh Dependent
”
”

′

′

sequence

Gait Formula
PL
DFh
DFf

0.15
0.65
0.69

′

Results and Discussion

331

Initial validation and fitting of rate cost

332

The simulation was run for the morphology, speed and stride length derived from [33],

333

as outlined in Table 1 for a number of rate penalties (c1 in Eq 2). Empirically, the

334

prescribed speed corresponded to a moderate walk [9]. The simulation spontaneously

335

discovered a four-beat walk– specifically, a singlefoot walk [9]– as cost-minimizing

336

regardless of rate penalty.

337

For all rate penalties, the simulation predicts a “double-hump” shape in ground

April 13, 2019

338

reaction force to be optimal (Fig 2), a common characteristic of both bipedal and

339

quadrupedal walking [45]. In bipedal locomotion, this shape arises from the

340

pre-heelstrike pushoff [46–48], a dynamic “trick” for minimizing energetic losses at foot

341

contact. The pre-heelstrike pushoff redirects the center-of-mass velocity so that it is less

342

in line with the leading limb, thus reducing the amount of negative work the leading

343

limb needs to do [24, 49]. The same “trick” seems to be discovered by the model; a

344

second peak in the trailing limb ground reaction force occurs prior to the first peak in

345

the leading limb.

346

15/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

Fig 2. Empirical forelimb GRF (black) from [33] compared to model
predictions for a range of force-rate penalty coefficients (c1 in Eq 2).
′
At lower c1D , the solution becomes more impulsive, as expected from a work-minimizing
′
“bang-coast-bang” solution [30]. As c1D increases, the force peaks become more shallow,
but in all cases the optimal solution maintains the double-hump profile characteristic of
walking bipeds and quadrupeds under most situations. The morphological data is based
on a Dalmation from [33] (see also Fig 4B)

The amplitudes of the peaks are affected by the magnitude of the force-rate cost. A

347

purely work-based objective is expected to have impulsive foot-down and

348

push-off [18, 19, 29, 30], but this would incur a large force rate penalty. The model

349

compromises on a solution with smooth GRF, with larger peaks if the force rate penalty

350

is small, and smaller peaks if the penalty is large.

351

Five multipliers on rate penalties are compared in Fig 3. As rate penalty increases,

352

both fore and hind limb duty factors increase and remain relatively similar, but exhibit

353

increasing divergence. Duty factor is strongly dependent on rate penalty because mean

354

vertical force must remain constant (supporting weight), but longer actuation time

355

allows the required force to be supplied over a longer time. At the lowest rate penalties,

356

duty factor and phase offset approach the work minimizing solutions of 0.5 and ≈ 0.25,

357

respectively, for symmetrical walking [50]. Phase offset is fairly insensitive to rate

358

penalty, but exhibits a slight decrease with increased force-rate cost.

359

Fig 3. Optimal duty factors and left-fore phase offsets (pair lag) vs
′
′
magnitude of force rate cost coefficient (c1D ) at Uh = 0.39.
As force-rate penalties increase, duty factor increases to slow the generation and
reduction of force. Optimal duty factors remain close, but exhibit some divergence at
′
larger c1D . Phase offset decreases slowly with force rate penalty. At no point do optimal
duty factors and phase offset simultaneously match the empirical values (dotted lines)
from [33]. The morphological data is based on a Dalmation from [33] (see also Fig 4B).

While either fore or hind duty factor can be tuned to be arbitrarily close to

April 13, 2019

360

empirical values, matching both is not possible through adjusting rate penalty alone in

361

this case. Furthermore, since phase offset is relatively insensitive to rate penalties, it is

362

likewise difficult to tune. The results of this analysis imply that, while adding a rate

363

penalty enhances agreement with empirical data, it alone cannot explain the

364

discrepancy between work-minimizing solutions and empirical results, at least for this

365

highly simplified model. This finding is in contrast to human locomotion models, where

366

the simple addition of a force-rate penalty enhances empirical agreement

367

16/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

substantially [24, 29].

368

′

c1D = 3 E - 3 matches the empirical GRF profiles (Fig 2) and duty factors (Fig 3) for

369

this test case fairly well. It is used as the coefficient of choice for further exploration in

370

the remaining test cases.

371

Detailed comparison to four test cases

372

Three cases are examined in detail in Fig 4. In the first two cases, the optimization

373

correctly predicts a symmetrical, four-beat walking solution with double-hump ground

374

reaction forces. In the third and fourth case, the optimization correctly predicts

375

two-beat run with near-simultaneous fore-hind contact and single-hump GRFs. The

376

optimization also correctly predicts the gait to be a “grounded run” [51], in the sense

377

that it exhibits in phase potential and kinetic energy changes, but no flight phase

378

(Fig 5H). For trotting, two empirical results from related studies [38, 44] are compared

379

to the same optimization solution, demonstrating the range of “normal behaviour” in

380

trotting for this breed. Overall, the simulation matches either empirical result fairly

381

well, demonstrated by the substantial overlap of stance and similar shape of the GRFs,

382

but matches neither perfectly.

383

Fig 4. Optimal solutions compared to empirical data for three test cases.
Left column shows an outline of the dog breed in question, and the points used as
morphological measurements. Middle column shows that gait diagrams for the empirical
(grey) and optimal solutions (light blue) have substantial overlap (dark blue). Right two
columns demonstrate that empirical ground reaction forces (GRF, black lines)
qualitatively match optimization results. The optimization GRF from left (solid blue
line) and right limbs (dashed red line) are very similar, reflecting the symmetrical
solutions that are discovered. At slow speeds (A-B), the simulation discovers a
singlefoot walking gait, while at an intermediate speeds (C-D) it discovers trotting,
′
matching natural gait choice in dogs. All optimizations use c1D = 3 E -3 . Empirical
data and morphological measurements from [37, 41] (A), [33] (B), [38, 40] (C)
and [40, 44] (D). For left column, circles show shoulder and hip positions, with relative
size indicating the relative mass carried at these points. x indicates centre of mass
position. For middle column, LH = Left Hind limb, RH = Right Hind, LF = Left Fore,
RF = Right Fore. Error bars in phase are described in the methods.

The substantial overlap between optimization and empirical gait diagrams

April 13, 2019

384

demonstrates the success of the optimization approach. It must be emphasized that any

385

of the 5040 quadrupedal foot contact sequences could have been selected by the

386

optimization. While, in a planar sense, many of these gaits are the same (for example,

387

17/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

Fig 5. These locally optimal solutions are a sample of the diverse gaits possible with
the model. Each stick figure is a freeze-frame of a different part of the gait cycle. The
first still (leftmost, purple) is at touchdown of the left hind limb. Each still is separated
from the next in time by one tenth of the stride time, culminating at the next left-hind
touchdown. x marker represents center of mass location. At both a walking speed (left
column) and running speed (right column) asymmetric (upper two rows) and symmetric
gaits (bottom two rows) are possible. y-axis scale is equal to the x-axis.

there’s no distinction between a lateral and diagonal sequence gait), there are still 2352

388

event sequences that are unique in a planar sense. Moreover, the model could even

389

exclude limbs, adding more options to its repertoire.

390

Fig 5 shows some examples of locally optimal gaits discovered by the optimizer.
These included asymmetrical (Fig 5A,B,E,F) and symmetrical gaits (Fig 5C,D,G,H),

392

some that can be related to natural gaits (Fig 5C,D,F-H), and some that are clearly

393

unnatural (Fig 5A,B). The model also did sometimes use fewer than four limbs (Fig 5E).

394

Yet the pseudo-globally optimal gaits are readily identified as those naturally chosen by

395

dogs at those speeds (Fig 5D,H) and match the empirical solutions fairly closely

396

(Fig 4B-D).

397

Only the second case (Fig 4B) was “tuned” with the force rate penalty; the same

398

penalty was used in all other cases. Yet even within this tuning, the optimization

399

always selected a gait that was qualitatively similar to the empirical data (Figs 2 and 3).

400

These results come despite fairly rough empirical estimates, varying morphological

401

parameters, and many simplifying assumptions in the model (avoiding springs, most

402

joints, and using the simplest possible mass distribution).

403

Forces are predicted fairly well, at least qualitatively in terms of shape and

April 13, 2019

391

404

magnitude. While shapes of the ground reaction forces are an optimization decision, the

405

relative magnitude of these forces are highly constrained. The mass distributions used

406

were taken from empirical vertical forces in the first place (Eq 11-13), and kinematic

407

periodicity ensures that net torque around the body is zero. Furthermore, mean net

408

vertical force must equal body weight. Assuming the body remains relatively horizontal,

409

then these two conditions completely determine the mean vertical force produced by

410

either pair of limbs. While these arguments emphasize that little merit should be seen

411

in matching relative magnitudes (apart from duty factor predictions), they do show that

412

the quadruped’s center of mass must be biased towards one pair of limbs to get

413

18/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

fore-hind differences in (mean) GRF magnitude. Without bias, there can be no

414

difference in mean vertical forces produced by the fore and hind limbs; single-point mass

415

models of quadrupedal locomotion cannot capture this effect [52].

416

While the mean magnitude of GRF is not very informative, the shape is. The
optimization predicts a double-hump GRF profile for walking, and single hump for

418

trotting. These predictions are born out in the empirical cases, although the magnitude

419

of the force peaks in the slowest case is substantially lower than predicted. The

420

empirical forces for the hind feet in the intermediate walking case (Fig 4B) were derived

421

using a questionable method from simultaneous contact of fore and hind limbs on a

422

force plate [33], and are not considered reliable.

423

The shape of simulation forces appear realistic for two reasons. First, the force-rate

424

penalty ensures they are smooth (as averaged or filtered empirical ground reaction

425

forces tend to be). Second, the work cost promotes double-hump walking and single

426

hump trotting GRFs. The double-hump profile is representative of a “pre-heelstrike”

427

trailing-limb pushoff, which redirects velocity prior to contact of the leading limb,

428

avoiding some negative work. The roughly symmetrical, single hump profile is

429

representative of a short, largely vertical contact of the limbs, which are work

430

minimizing in point-mass bipedal models [49]. Our interpretation is in contrast to [16],

431

who say all shape characteristics (double hump, single humps) are from “oscillation

432

modes” due to springs and resonant properties of the system. Despite not having any

433

springs, similar double-hump walking and single hump running GRFs emerge from our

434

energy-minimizing model.

435

While spring-mass systems are often used to approximate the emergent gait

April 13, 2019

417

436

behaviour, they are not the only system that describes the behaviour well and should

437

not be taken as a prerequisite for “spring-like” behaviour. Rather, spring-like behaviour

438

emerges from energy minimization [17–19, 49], even in the absence of springs.

439

It is difficult to tell if differences between solutions in Fig 4 are due to differences in

440

morphological input or prescribed speed. To control for these differences, the model was

441

compared to a large dataset using Belgian Malinois dogs of similar sizes over a large

442

speed range [36].

443

19/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

Comparison to a large kinematic dataset

444

The results of the simulations are compared to empirical results in Fig 6. Optimal mean
duty factor (averaged across all limbs) matches empirical values very well for
(Fig 6A) following its slow decay as speed increases. For

′
Uh

′
Uh

≥ 0.5,

< 0.5, the predicted duty

445

446

447

factor is almost constant at approximately 0.6. As with the other test cases (Fig 4), the

448

model predicts singlefoot walking as the optimal gait at low speeds, and trotting as

449

optimal at high speeds (Fig 6B). The phase offset is predicted well for all walking and

450

trotting speeds, with all phase offsets lying within 0.1 of the empirical values for

451

′
Uh

452

≤ 1.75. The model predicts a sharp transition to a trotting gait between

′
Uh

= 0.65

′

and 0.7, close to the empirical transition point of Uh = 0.8 (S1 Fig). Curiously, the

453

simulation chooses a transition speed almost exactly at the slowest self-selected trotting

454

′

speed (Uh = 0.65) observed by Maes et al. [36] (S1 Fig). While a true gallop never

455

emerges from the optimization, even well past the natural trot-gallop transition of 1.9

456

′

(S1 Fig), slight asymmetry begins to emerge from the solution for Uh > 2 (Fig 6C).

457

Fig 6. Pseudoglobal optimal solutions (markers) are compared to a large
dataset for Belgian Malinois dogs [36].
(A) A slowly decaying duty factor with increasing speed is predicted well by the model
for medium to fast speeds, using c1D = 3 E - 3. At slow speeds, the model remains
constant, slightly above impulsive predictions, while the empirical data approaches 1. A
swing period at half the natural pendular period (NPP) does not explain the
discrepancy. 95% CI for empirical duty factor is shown as a thin dotted line. (B) The
optimal phase offset matches empirical values well for walking and trotting speeds, and
the optimal walk-trot transition is very close to the natural transition speed. However,
the model does not transition to a gallop after the natural trot-gallop transition speed
(C) Pair offset (time between contact of the hind and fore limbs) is shown against speed.
A perfectly symmetrical gait would have pair offsets of 0.5 in both left and right limbs;
walking and trotting in dogs is highly symmetrical both naturally [53] and in the model.
Galloping is an asymmetrical gait, and past the trot-gallop transition, the optimal gait
becomes asymmetrical. Empirical phase offsets are mean values for each gait [36]

Response of optimal duty factor to speed

458

′

Above Uh = 0.5, optimal values follow the empirical trendline closely. The decaying

459

behaviour of duty factor is at odds with an impulsive trot (DF = 0), which would be

460

work-optimal. Below about

April 13, 2019

′
Uh

= 0.5, the optimal duty factor levels off at about 0.6,

461

slightly above the work-minimizing prediction of 0.5 for a walk [50]. A similar pattern of

462

constant duty factor shifting suddenly to a decay with increasing speed was also

463

20/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

observed by Hubel and Usherwood [25] in their biped model with an analogous work +

464

rate penalty objective (though the rate penalty was peak-power in their case, rather

465

than force rate).

466

Work-minimal walking should have DF = 0.5 because double stance involves costly
simultaneous positive and negative work [30, 48]. Work-minimal running gaits should

468

have DF = 0 because a vertical impulse at stance avoids costly fore-aft decelerations.

469

The increase in duty factor above work-minimizing predictions in our model is due to

470

the force rate penalty, which allows both these additional costs in order to avoid

471

impulses. However, as speed increases, enhancing stance duration involves

472

ever-increasing excursion angles, and so larger and larger fore-aft forces, increasing work

473

costs. Therefore, the optimal solution is to decrease duty factor as speed increases to

474

manage this tradeoff.

475

It is interesting that the simple addition of a rate penalty yields such high agreement

476

with duty factor at high speeds, especially since the model does not include massive

477

limbs, springs, or a compliant back, nor does it use the correct (galloping) gait at high

478

speeds. If rate penalties (whether force/time, power or activation penalties) are real

479

phenomena, we would expect their influence to be most pronounced at higher speeds,

480

where, since stride time is shorter, by necessity forces must be produced more quickly,

481

power is higher, and muscles must be activated more frequently.

482

The discrepancy at lower speeds can be partially explained by leg swing dynamics.

483

There is a cost to swinging legs during locomotion [54, 55] that is minimized when the

484

leg is swung close to its natural frequency [56]. As a result, quadrupeds (including dogs)

485

tend to decrease stance duration, rather than swing duration, as speed increases [36, 57].

486

If swing costs dominated, at all speeds it would be advantageous to the animal to

487

adjust its duty factor such that swing time was exactly half the natural swing period,

488

i.e.

489

1
DF = 1 −
,
2fn T

April 13, 2019

467

(14)

where fn is the leg natural frequency and T is stride time. Taking T as given (based on

490

empirical data), and using the allometric equations from [58] for dog leg natural

491

frequencies, we can generate the predicted curve shown in Fig 6a. It takes on a similar

492

shape to the empirical data at low speeds, but lies well under the curve. According to

493

21/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

the data from [36], dogs drive their legs in swing at about twice natural frequency on

494

average during walking. The reasons for this are unclear; nevertheless, including limb

495

moment of inertia might account for some of the discrepancy between the predicted

496

duty factor and empirical data.

497

Response of Phase Offset to speed

498

Phase offset for each limb from the optimal solutions are compared to empirical data

499

from [36] in Fig 6B. Left-hind touchdown (LHTD) is set at t = 0, and all phase offsets

500

are timed relative to LHTD. For ease of comparison, at natural walking speeds optimal

501

gaits are transformed so that, if left fore touchdown (LFTD) occurs after right fore

502

touchdown (RFTD), the left and right forelimbs are swapped. For trotting and

503

galloping speeds, the opposite transformation is used. Since the model is planar, these

504

transformations result in no change in cost while making all two-beat gaits “trots” and

505

all four-beat gaits lateral sequence. While in theory quadrupeds can perform 5040 event

506

sequences, swapping left and right limbs leaves 2352 unique “planar” quadrupedal

507

footfall sequences for the optimizer to choose from; any of these sequences can be

508

performed at any speed, but only a small number are found to be optimal.

509

At low speeds, the model predicts a fore-hind phase difference between 0.23 and 0.27,
close to the 0.25 phase predicted from impulsive walking with even mass distribution

511

and equal fore and hindlimb lengths [50, 59]. The mean empirical phase offset for

512

walking of 0.16 ± 0.05 (mean ± standard deviation) does not differ greatly from either of

513

these values. For 0.7 ≤

′
Uh

≤ 1.15, the optimal solution is to use a symmetric trot, with

closely-associated fore-hind contacts. Above

′
Uh

= 1.2, the fore-hind contact becomes

514

515

dissociated, with forelimbs leading or lagging associated hindlimbs by 0.05 to 0.11. For

516

′
Uh

517

≥ 2.5, the gait becomes somewhat asymmetrical, with either the fore or hind pair

exceeding a 0.5 phase difference. In no case did a galloping gait emerge as globally

518

optimal, despite the model settling on galloping as locally optimal in a number of cases.

519

We find that galloping should not use less work than trotting for this model, in

520

agreement with others who have analyzed alternative rigid back models [16, 60]. The

521

difference in cost between galloping and trotting is slight, however. For example, the

522

model spontaneously discovered a galloping solution with CoT = 0.58, only 1% higher

523

cost than the minimal-cost trotting solution at the same high speed of

April 13, 2019

510

′
Uh

= 2.8 (CoT =

22/45

524

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

0.56). Previous studies have shown that galloping becomes optimal at high speeds with

525

an elastic, compliant spine [61–64]. Future work could add active compliance to our

526

model’s trunk, to see whether true elastic return is necessary for the optimality of

527

galloping, or whether any form of compliance (even active compliance) makes galloping

528

more economical.

529

Despite initializing the optimization from over 8000 randomized initial guesses, only

530

four-beat walking and two-beat running (or slight deviations thereof) were discovered as

531

pseudo-global optimal solutions. This is strong evidence (but not definitive proof) that

532

these are globally optimal solutions for the quadrupedal configuration investigated

533

(Fig 1) with a work-based cost and force-rate penalty.

534

Again, these results emerge despite the simplicity of the modelling approach, and the
absence of springs. This is further evidence that natural walking, trotting and pacing

536

are energetically optimal even without elastic elements. We are not suggesting that

537

tendons (or springs in robotic quadrupeds) do not potentially reduce energetic cost,

538

only that they are not necessary prerequisites for the optimality of natural gait. A gait

539

could emerge as a recurrent strategy within a species because of its low energetic cost,

540

and well-tuned tendons (such as the digital flexor and interosseus tendons in horses [65])

541

can then arise through natural selection to complement those strategies.

542

The discovery of trotting (as opposed to tolting) as energetically optimal is

543

consistent with an analysis of Usherwood [66]. A dimensionless pitch moment of inertia

544

can be defined as [67]

545

4I
Iˆ =
,
mlb2

(15)

or the moment of inertia relative to the radius of gyration of the body. To a first

546

approximation, for Iˆ > 1, tolting is energetically optimal; otherwise trotting is [66]. In

547

our case, Iˆ = 0.93, not far from a more realistic estimate of 0.84 for dogs [33, 68]. Since

548

these dimensionless moments of inertia are less than 1, we expect the model (and dogs)

549

to find trotting to be less expensive than a running walk.

550

However, some deviation from exact trotting– perfect symmetry and fore-hind offset
of 0.5– was observed at higher speeds. Moreover, while a clear singlefoot contact

551

552

′

pattern was observed for Uh < 0.65, and a clear trotting pattern emerged for

553

′

0.65 < Uh < 1.2, at higher speeds the footfall pattern was less consistent. Pair

April 13, 2019

535

554

23/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

dissociation became more common, but was not always optimal (for example at

555

′

Uh = 1.8 and 2.2) and the optimal gait became asymmetric (but regularly increasing

556

asymmetry was not observed in the pseudoglobally optimal solutions; Fig 6C).

557

One reason for the lack of a consistent pattern may be that there are more variable

558

locally optimal gaits at higher speeds. To explore this possibility, we plot phase offsets

559

for all valid solutions for four speeds from the walking, trotting, slow gallop and fast

560

gallop ranges (Fig 7). Each solution is both feasible (satisfying the constraints and

561

dynamics), and locally optimal (that is, the NLP solver reported successful

562

convergence). Each solution lives in a 3D space of foot contact phase lag: [Hind Lag,

563

Pair Lag, Fore Lag] = [HL,PL,FL], defined as fraction of time between touchdown of

564

left-hind and right-hind (Hind Lag), left-hind and left-front (Pair Lag) and left-front

565

and right-front (Fore Lag). These phase lags are sketched in Fig 4B and follow the basic

566

terminology used by Abourachid et al. [69]. Note that our Pair Lag (PL) differs from

567

their definition (PLAbourachid = 1 − PL), since we use the left-hind leg as reference while

568

Abourachid et al. used right-front. Color represents cost of each solution, with dark

569

blue as low cost, yellow as high cost, and light blue as intermediate.

570

Fig 7. All local optima found for the model for each speed based on a
Belgian Malinois morphology.
Each row corresponds to a given speed condition, and each data point is a feasible local
optimum arising from energy optimization from one random guess, with relative cost
′
(CoT - min CoT for a given Uh ) indicated by color. Solutions are plotted in terms of
Hind Lag (HL), Pair Lag (PL) and Fore Lag (FL), defined in Fig 4. As speed increases,
solutions become more variable. Pseudo-global optimal solutions for each case are
shown in Fig 6. Bottom row: Some recognizable gaits and their positions in the plots.
Dashed line: hind symmetry; dotted line: fore symmetry; dot-dash line: simultaneous
right-hind and left-front contact (as in a canter) ▪ diagonal singlefoot □ lateral
singlefoot ⋄ trot ⬩ pace ▵ transverse gallop ▴ rotary gallop • perfect symmetry
′

As speed increases, less solution clustering is observed. At a slow speed (Uh ≈ 0.4),

571

only two clusters emerge, at [0.5, 0.25, 0.5] and [0.5, 0.75, 0.5], representing symmetrical

572

′

singlefoot walking (lateral or diagonal, respectively [9]). At a higher speed (Uh ≈ 1.2),

573

clustering becomes less pronounced, but two clusters emerge; one at [0.5, 0.5, 0.5]

574

(symmetrical trotting) and another at [0.5, 0, 0.5] (symmetrical pacing). However,

575

unlike the walking case, symmetry is not as clearly optimal, as represented by the large

576

scatter of solutions between 0.25 < {HL, FL} < 0.75 compared to

577

At a slow galloping speed

April 13, 2019

′
(Uh

′
Uh

= 0.38

= 2.00), clustering has all but disappeared. Still,

24/45

578

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

bands of viable solutions emerge; in particular, many solutions emerge in the range

579

0.20 < {HL, FL} < 0.80 with any PL, while solutions are rare outside this range. A

580

wide band of low-cost solutions emerges at FL = 0.5, with some bias towards HL = 0.5

581

(symmetrical trotting). However, small clusters also emerge at the nodes [{0.25,

582

0.75},PL,{0.25, 0.75}], representing galloping (transverse if HL = FL, rotary otherwise).

583

Interestingly, solutions cluster around the PL = HL line in the leftmost plot,

584

representing simultaneous contact of fore and hind limbs. A canter would lie on this line.

585

Interestingly, small clusters of high-cost solutions also emerge at {HL, FL} = {0, 1},

586

representing a bound, half-bound, or pronk (depending on PL and the difference

587

between HL and FL). These solutions emerged at all speeds, but were never globally

588

optimal, reflecting the results of [16].

589

Why are solutions more variable at higher speeds? One reason may be that phase

590

and event sequence impact cost less at higher speeds than at lower speeds. Fig 8A

591

shows how cost changes with increasing speed. Reflecting both human [70] and animal

592

studies [10], the cost of transport in walking is highly sensitive to speed, while the cost

593

of transport of running is much less so; however, minimum and median cost always

594

increases with speed. Despite the increased costs in running, the range in CoT is fairly

595

small at higher speeds compared to walking. Relative to the increases in cost, the CoT

596

range of feasible solutions decreases considerably from lowest speed to highest speed

597

(Fig 8B) At high speeds, virtually all combination of phase are explored (Fig 7), with

598

little change in cost (Fig 8). Optimizing locomotion at higher speeds appears to involve

599

searching a flat and fuzzy cost landscape for the best gaits.

600

Fig 8. (A) Median Cost of Transport increases linearly for walking speeds (solid line),
but exhibits a sharp change to a slower rate of increase after the walk-trot transition
(dashed line), mirroring the response to speed of walking and running observed in
human data [71]. The range of the costs of feasible solutions (whiskers) increases up to
the walk-trot transition, and then settles into a near-constant range. The distribution of
costs is heavily skewed, as indicated by the median value approaching the minimum at
all speeds. This indicates that the solvers tended to discover solutions with costs close
to the minimal value, but occasionally were “trapped” in local optima with costs far
from the minimum. (B) As speed increases, the standard deviation of the distribution of
costs of transport gets smaller, relative to the minimal cost, indicating that the variance
in costs of local optima is relatively smaller at higher speeds than at lower speeds

April 13, 2019

The variability in locally optimal solutions may somewhat reflect reality; dogs

601

exhibit substantial natural variation in gait at higher speeds. For example, empirical

602

25/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

Fig 9. Symmetrical gaits discovered by the model compared to all
symmetrical gaits in dogs observed by Hildebrand [53]
Data points (black) from Fig 1 and contour (line) in Fig 2 of [53], representing mean
duty factor and Pair Lag for symmetrical gaits in dogs, are overlaid on all locally
optimal symmetrical solutions (coloured circles) discovered by the model for the Belgian
Malinois dataset (Fig 6). The empirical contour takes on a “C” shape in the upper
(lateral sequence) region of the plot. The optimal solutions take on two “C” shapes, one
in the upper half and one in the lower, as lateral and diagonal sequence gaits have equal
cost in a planar model. While there is some discrepancy in lower duty factor, there is
substantial overlap between Hildebrand’s contour and the clustering of locally optimal
solutions in the model. Each coloured data point represents one solution from a
different random guess at any of the speeds represented in Fig 6. Colour represents cost
relative to the minimal cost solution at that given speed. Gait definitions, according to
Hildebrand [9], are shown on right.

data from [38, 44] indicate that duty factor and pair dissociation can vary at the same

603

trotting speed in labradors (Fig 4C,D). The transition from trot-gallop is much less

604

pronounced than walk-trot (S1 Fig), and while trots and rotary gallops are the most

605

common running gaits, dogs will also pace and use transverse gallops [36]. If the relative

606

cost between these gaits are not substantial, then factors apart from energetics might

607

dictate locomotory decisions.

608

The plots in Fig 8 represent a combination of symmetrical and asymmetrical

609

solutions. Hildebrand [53] studied the symmetrical gaits of domestic dogs in great detail,

610

and discovered that dogs (across a large range of speeds and breeds) choose a limited

611

subset of symmetrical gaits from the total “gait space” available to them (every

612

combination of duty factor and pair lag from 0 to 1). Does the limited scope of C. lupus

613

familiaris gait represent a fluke of evolution, a physical constraint, or is it the result of

614

an energy optimization process?

615

In Fig 9 we plot all the symmetrical gaits preformed by dogs and recorded by

616

Hildebrand [53], as well as the “C-shaped” contour that he thought captured the scope

617

of locomotory behaviour most meaningfully. Overlaid on these data are all the feasible

618

convergent results from every condition studied in Fig 6. Color represents relative cost,

619

that is the deviation of the cost for a given solution from the minimal cost at the same

620

speed. Each data point is a complete optimization from a single random guess, resulting

621

in a solution that satisfied all dynamics and constraints, and where successful

622

convergence towards local optimality was indicated by the NLP solver.

623

The vast majority of symmetrical solutions, as well as the lowest cost, lie within a

April 13, 2019

26/45

624

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

similar “C-shape” to that observed by Hildebrand. Infrequently, sub-optimal but feasible

625

solutions are discovered outside the range observed by Hildebrand. Their presence

626

indicates that such solutions are possible– so there seems to be no plausible physical

627

constraint to prevent dogs from entering that region of gait space– but their relative

628

high cost indicates that they are unlikely to be chosen from an optimization process.

629

In contrast, the solutions along the C contour are frequently discovered by the

630

optimization process. All are local optima; solutions that the optimizer converged on.

631

The remarkable similarity between the distribution of optimal solutions and

632

Hildebrand’s empirical observations suggests that dogs are also optimizing cost of

633

transport when selecting gait.

634

Notably, Hildebrand’s results combined observations from dog breeds of varying sizes

635

and shapes (from Basset hounds to Great Danes [53]), yet the simulations used only one

636

morphological set, based on Belgian Malinois. The consistency between simulations and

637

empirical data, despite the differences in size, is due to dynamic similarity. While a

638

small and large dog may move differently at the same absolute speed, they are moving

639

at different dimensionless speeds (the square root of Froude numbers, Eq 10) and so

640

have different dynamic constraints and opportunities. Yet when their dimensionless

641

speed is similar, their behaviour is similar [1]. As our simulation probed a large range of

642

Froude numbers, we explored the scope of dynamic regimes that dogs (of all sizes)

643

might be expected to experience in level, steady movement.

644

Harder to explain is the similarity between our results and Hildebrand’s despite

645

differences in morphological shape. The similarity seems to suggest that general shape

646

(at least as far as limb length to body length ratios and mass distribution) has little

647

effect on the optimality of trotting, pacing, and single foot walking over other

648

symmetrical gaits. The effect of morphology on the optimality of gait is something that

649

could be explored with the present model by systematically varying morphological

650

inputs.

651

One major discrepancy between the empirical and simulation results is the presence

April 13, 2019

652

in the latter of a lower “C” that is a reflection of the first, upper “C”. In this planar

653

model there is no energetic distinction between a pair lag of p and p ± 0.5, so it should

654

come as no surprise that for every optimal gait in the upper region, there is an equally

655

optimal gait in the lower region with the same duty factor but with a phase increase of

656

27/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

0.5. However, the discrepancy opens the question of why dogs (and most other

657

quadrupedal mammals [7, 72]) use symmetrical gaits with pair lag less than 0.6 as

658

opposed to higher pair lags. This is a question that a planar model cannot answer, but

659

may be explained by considering full three-dimensional dynamics.

660

Conclusions

661

We developed a minimally constrained quadrupedal model capable of any of the 2300+

662

planar contact sequences available to quadrupeds. Of those possibilities, it found two

663

basic gaits– four-beat walking in singlefoot, and two-beat trotting or pacing– as

664

energetically optimal. It also transitioned spontaneously from walking to trotting at a

665

realistic speed. While limb work was the chief contributor to cost, an additional

666

force-rate penalty led to better prediction of duty factor. Despite no enforcement of gait

667

symmetry, the optimal gaits were highly symmetrical except at high speeds, as observed

668

in natural gait.

669

The GRF profiles were double-hump in walking and single-hump in trotting despite
no springs being present in the model. This sheds doubt on the claim that these

671

features result from “oscillation modes of the legged system’s compliance” [16]. Instead,

672

they are the result of work-minimizing strategies; the “pre-heelstrike” pushoff in walking

673

and near-vertical “pseudo-elastic” contact in running [49].

674

Galloping did not emerge as optimal at high speeds in our model, but elastic-limb

675

models exhibit the same result if elastic elements are not included in the trunk. Future

676

work will examine whether galloping emerges as optimal if the torso is allowed to extend

677

or contract actively. This would test whether elastic elements of the spine are truly

678

necessary for the optimality of galloping.

679

Limb work with a small force-rate penalty has substantial explanatory power.

April 13, 2019

670

680

Despite simplified morphological parameters, the model predicted gait well at slow and

681

intermediate speeds across several breeds of dog, demonstrating that detailed

682

morphological modelling are not necessary to explain gait choice. While the factors

683

affecting duty factor choice at slow walking remain a mystery, we believe that duty

684

factor at higher speed is determined by the competing costs of work (lowering duty

685

factor) and force rate (increasing it). However, little is known about the physiological

686

28/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

mechanisms for this rate cost, and it could be an exciting avenue for further research.
Singlefoot walking and trotting emerged as optimal gaits despite over 8000 random

688

guesses being used to seed optimization. This strongly suggests (but does not prove)

689

that these gaits are globally optimal strategies at their respective speeds, at least for the

690

modelling configuration used. It is unlikely that alternate gaits exist which would

691

further minimize quadrupedal cost of transport at slow and intermediate speeds.

692

During locomotion, mammals are likely optimizing a work-based cost function with

693

some form of force-rate related energetic penalty. Although elastic elements can lower

694

metabolic cost of transport, they were likely not prerequisites to the evolution of

695

modern gait in mammals, but rather complemented preexisting, metabolically optimal

696

strategies.

697

Acknowledgments

698

The authors would like to thank S. Javad Hasaneini for assistance in designing the

699

trajectory optimization model, and Jessica M. Theodor (University of Calgary) for the

700

use of her computing resources.

701

References
1. Alexander RM, Jayes AS. A Dynamic Similarity Hypothesis for the Gaits of
Quadrupedal Mammals. J Zool. 1983;201(1):135–152.
doi:10.1111/j.1469-7998.1983.tb04266.x.
2. Alexander RM. Optimization and Gaits in the Locomotion of Vertebrates.
Physiol Rev. 1989;69(4):1199–1227.
3. Biancardi CM, Minetti AE. Biomechanical Determinants of Transverse and
Rotary Gallop in Cursorial Mammals. J Exp Biol. 2012;215(23):4144–4156.
4. Pennycuick CJ. On the Running of the Gnu (Connochaetes Taurinus) and Other
Animals. J Exp Biol. 1975;63(3):775–799.

April 13, 2019

687

29/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

5. McGhee RB, Jain AK. Some Properties of Regularly Realizable Gait Matrices.
Math Biosci. 1972;13(1):179 – 193.
doi:http://dx.doi.org/10.1016/0025-5564(72)90033-8.
6. Alexander R, Langman V, Jayes A. Fast Locomotion of Some African Ungulates.
J Zool. 1977;183(3):291–300.
7. Loscher DM. Kinematische Anpassungen Zur Kollisionsreduktion Im Schritt
Vierfüßiger Lauftiere. Freie Universität Berlin; 2015.
8. Hildebrand M. Symmetrical Gaits of Horses. Science. 1965;150(3697):701–708.
9. Hildebrand M. Analysis of Tetrapod Gaits: General Considerations and
Symmetrical Gaits. In: Herman RM, Grillner S, Stein P, Stuart D, editors.
Neural Control of Locomotion. vol. 18 of Advances in Behavioral Biology. Plenum
Press New York; 1976. p. 203–236.
10. Hoyt DF, Taylor CR. Gait and the Energetics of Locomotion in Horses. Nature.
1981;292:239–240.
11. Bertram JEA. Constrained Optimization in Human Walking: Cost Minimization
and Gait Plasticity. J Exp Biol. 2005;208(6):979–991. doi:10.1242/jeb.01498.
12. Selinger JC, O’Connor SM, Wong JD, Donelan JM. Humans Can Continuously
Optimize Energetic Cost during Walking. Curr Biol. 2015;25(18):2452–2456.
doi:10.1016/j.cub.2015.08.016.
13. Polet DT, Schroeder RT, Bertram JEA. Reducing Gravity Takes the Bounce out
of Running. J Exp Biol. 2018;221(3):jeb162024. doi:10.1242/jeb.162024.
14. Geyer H, Seyfarth A, Blickhan R. Compliant Leg Behaviour Explains Basic
Dynamics of Walking and Running. Proc R Soc B Biol Sci.
2006;273(1603):2861–2867. doi:10.1098/rspb.2006.3637.
15. Gan Z, Wiestner T, Weishaupt MA, Waldern NM, Remy CD. Passive Dynamics
Explain Quadrupedal Walking, Trotting, and Tölting. J Comput Nonlinear Dyn.
2016;11(2):021008.

April 13, 2019

30/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

16. Xi W, Yesilevskiy Y, Remy CD. Selecting Gaits for Economical Locomotion of
Legged Robots. Int J Robot Res. 2016;35(9):1140–1154.
doi:10.1177/0278364915612572.
17. Bertram JEA, Hasaneini SJ. Neglected Losses and Key Costs: Tracking the
Energetics of Walking and Running. J Exp Biol. 2013;216(6):933–938.
doi:10.1242/jeb.078543.
18. Srinivasan M, Ruina A. Computer Optimization of a Minimal Biped Model
Discovers Walking and Running. Nature. 2006;439(7072):72–75.
doi:10.1038/nature04113.
19. Hasaneini SJ, Macnab C, Bertram JEA, Leung H. The Dynamic Optimization
Approach to Locomotion Dynamics: Human-like Gaits from a
Minimally-Constrained Biped Model. Adv Robot. 2013;27(11):845–859.
20. Russ DW, Elliott MA, Vandenborne K, Walter GA, Binder-Macleod SA.
Metabolic Costs of Isometric Force Generation and Maintenance of Human
Skeletal Muscle. Am J Physiol-Endocrinol Metab. 2002;282(2):E448–E457.
doi:10.1152/ajpendo.00285.2001.
21. Doke J, Kuo AD. Energetic Cost of Producing Cyclic Muscle Force, Rather than
Work, to Swing the Human Leg. J Exp Biol. 2007;210(13):2390–2398.
doi:10.1242/jeb.02782.
22. Dean JC, Kuo AD. Energetic Costs of Producing Muscle Work and Force in a
Cyclical Human Bouncing Task. Journal of Applied Physiology.
2011;110(4):873–880. doi:10.1152/japplphysiol.00505.2010.
23. Kram R, Taylor CR. Energetics of Running: A New Perspective. Nature.
1990;346:265–267.
24. Kuo AD. A Simple Model of Bipedal Walking Predicts the Preferred Speed–Step
Length Relationship. J Biomech Eng. 2001;123(3):264. doi:10.1115/1.1372322.
25. Hubel TY, Usherwood JR. Children and Adults Minimise Activated Muscle
Volume by Selecting Gait Parameters That Balance Gross Mechanical Power and
Work Demands. J Exp Biol. 2015;218(18):2830–2839. doi:10.1242/jeb.122135.

April 13, 2019

31/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

26. Kelly M. An Introduction to Trajectory Optimization: How to Do Your Own
Direct Collocation. SIAM Rev. 2017;59(4):849–904. doi:10.1137/16M1062569.
27. Betts JT. Practical Methods for Optimal Control and Estimation Using
Nonlinear Programming. Smith RC, editor. Advances in Design and Control.
Society for Industrial and Applied Mathematics; 2010.
28. Croft JL, Schroeder RT, Bertram JEA. Determinants of Optimal Leg Use
Strategy: Horizontal to Vertical Transition in the Parkour Wall Climb. J Exp
Biol. 2019;222(1):jeb190983. doi:10.1242/jeb.190983.
29. Rebula JR, Kuo AD. The Cost of Leg Forces in Bipedal Locomotion: A Simple
Optimization Study. PLOS ONE. 2015;10(2):e0117384.
doi:10.1371/journal.pone.0117384.
30. Srinivasan M. Fifteen Observations on the Structure of Energy-Minimizing Gaits
in Many Simple Biped Models. J R Soc Interface. 2010;8(54):74–98.
doi:10.1098/rsif.2009.0544.
31. Baumrucker BT, Renfro JG, Biegler LT. MPEC Problem Formulations and
Solution Strategies with Chemical Engineering Applications. Computers &
Chemical Engineering. 2008;32(12):2903–2913.
doi:10.1016/j.compchemeng.2008.02.010.
32. Patterson MA, Rao AV. GPOPS-II: A MATLAB Software for Solving
Multiple-Phase Optimal Control Problems Using Hp-Adaptive Gaussian
Quadrature Collocation Methods and Sparse Nonlinear Programming. ACM
Trans Math Softw. 2013;41(1):1.
33. Jayes A, Alexander R. Mechanics of Locomotion of Dogs (Canis Familiaris) and
Sheep (Ovis Aries). J Zool. 1978;185(3):289–308.
34. Gill PE, Murray W, Saunders MA. SNOPT: An SQP Algorithm for Large-Scale
Constrained Optimization. SIAM Rev. 2005;47(1):99–131.
35. Gill PE, Murray W, Saunders MA, Wong E. User’s Guide for SNOPT 7.7:
Software for Large-Scale Nonlinear Programming. La Jolla, CA: Department of
Mathematics, University of California, San Diego; 2018. CCoM 18-1.

April 13, 2019

32/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

36. Maes LD, Herbin M, Hackert R, Bels VL, Abourachid A. Steady Locomotion in
Dogs: Temporal and Associated Spatial Coordination Patterns and the Effect of
Speed. J Exp Biol. 2008;211(1):138–149. doi:10.1242/jeb.008243.
37. Griffin TM, Main RP, Farley CT. Biomechanics of Quadrupedal Walking: How
Do Four-Legged Animals Achieve Inverted Pendulum-like Movements? J Exp
Biol. 2004;2072(20):3545–3558. doi:10.1242/jeb.01177.
38. Bertram JEA, Lee DV, Case HN, Todhunter RJ. Comparison of the Trotting
Gaits of Labrador Retrievers and Greyhounds. Am J Vet Res.
2000;61(7):832–838. doi:10.2460/ajvr.2000.61.832.
39. American Kennel Club. Belgian Malinois Dog Breed Information - American
Kennel Club; 2017. http://www.akc.org/dog-breeds/belgian-malinois/.
40. Club AK. Labrador Retriever Dog Breed Information; 2018.
https://www.akc.org/dog-breeds/labrador-retriever/.
41. Club AK. Rhodesian Ridgeback Dog Breed Information; 2018.
https://www.akc.org/dog-breeds/rhodesian-ridgeback/.
42. Lee DV, Stakebake EF, Walter RM, Carrier DR. Effects of Mass Distribution on
the Mechanics of Level Trotting in Dogs. J Exp Biol. 2004;207(10):1715–1728.
doi:10.1242/jeb.00947.
43. Gray J. Studies in the Mechanics of the Tetrapod Skeleton. J Exp Biol.
1944;20(2):88–116.
44. Bertram JEA, Lee DV, Todhunter RJ, Foels WS, Williams AJ, Lust G. Multiple
Force Platform Analysis of the Canine Trot: A New Approach to Assessing Basic
Characteristics of Locomotion. Vet Comp Orthop Traumatol. 1997;10(3):160–169.
doi:10.1055/s-0038-1632588.
45. Bertram JEA. Considering Gaits: Descriptive Approaches. In: Understanding
Mammalian Locomotion: Concepts and Applications. John Wiley & Sons; 2016.
p. 27–50.
46. Tucker VA. The Energetic Cost of Moving About. AmSci. 1975;63(4):413–419.

April 13, 2019

33/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

47. McGeer T. Dynamics and Control of Bipedal Locomotion. Journal of Theoretical
Biology. 1993;163(3):277–314. doi:10.1006/jtbi.1993.1121.
48. Donelan JM, Kram R, Kuo AD. Simultaneous Positive and Negative External
Mechanical Work in Human Walking. J Biomech. 2002;35(1):117 – 124.
doi:http://dx.doi.org/10.1016/S0021-9290(01)00169-5.
49. Ruina A, Bertram JEA, Srinivasan M. A Collisional Model of the Energetic Cost
of Support Work Qualitatively Explains Leg Sequencing in Walking and
Galloping, Pseudo-Elastic Leg Behavior in Running and the Walk-to-Run
Transition. J Theor Biol. 2005;237(2):170–192. doi:10.1016/j.jtbi.2005.04.004.
50. Usherwood JR, Williams SB, Wilson AM. Mechanics of Dog Walking Compared
with a Passive, Stiff-Limbed, 4-Bar Linkage Model, and Their Collisional
Implications. J Exp Biol. 2007;210(3):533–540. doi:10.1242/jeb.02647.
51. Usherwood JR, Szymanek KL, Daley MA. Compass Gait Mechanics Account for
Top Walking Speeds in Ducks and Humans. J Exp Biol. 2008;211(23):3744–3749.
doi:10.1242/jeb.023416.
52. Usherwood JR, Self Davies ZT. Work Minimization Accounts for Footfall Phasing
in Slow Quadrupedal Gaits. eLife. 2017;6(5):630–650. doi:10.7554/eLife.29495.
53. Hildebrand M. Symmetrical Gaits of Dogs in Relation to Body Build. JMorph.
1968;124(3):353–359.
54. Marsh RL, Ellerby DJ, Carr JA, Henry HT, Buchanan CI. Partitioning the
Energetics of Walking and Running: Swinging the Limbs Is Expensive. Science.
2004;303(5654):80–83. doi:10.1126/science.1090704.
55. Steudel K. The Work and Energetic Cost of Locomotion. I. The Effects of Limb
Mass Distribution in Quadrupeds. J Exp Biol. 1990;154(1):273–285.
56. Doke J, Donelan JM, Kuo AD. Mechanics and Energetics of Swinging the Human
Leg. J Exp Biol. 2005;208(3):439–445. doi:10.1242/jeb.01408.
57. Kilbourne BM, Hoffman LC. Scale Effects between Body Size and Limb Design
in Quadrupedal Mammals. PLOS ONE. 2013;8(11):e78392.
doi:10.1371/journal.pone.0078392.

April 13, 2019

34/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

58. Myers MJ, Steudel K. Morphological Conservation of Limb Natural Pendular
Period in the Domestic Dog (Canis Familiaris): Implications for Locomotor
Energetics. J Morphol. 1997;234(2):183–196.
doi:10.1002/(SICI)1097-4687(199711)234:2¡183::AID-JMOR5¿3.0.CO;2-D.
59. Smith AC, Berkemeier MD. Passive Dynamic Quadrupedal Walking. In:
Robotics and Automation, 1997. Proceedings., 1997 IEEE International
Conference On. vol. 1; 1997. p. 34–39 vol.1.
60. Alexander RM, Jayes AS, Ker RF. Estimates of Energy Cost for Quadrupedal
Running Gaits. J Zool. 1980;190(2):155–192.
61. Alexander RM, Dimery NJ, Ker RF. Elastic Structures in the Back and Their
Role in Galloping in Some Mammals. J Zool. 1985;207(4):467–482.
doi:10.1111/j.1469-7998.1985.tb04944.x.
62. Alexander RM. Why Mammals Gallop. AmZool. 1988;28(1):237–245.
63. Cao Q, Poulakakis I. On the Energetics of Quadrupedal Running: Predicting the
Metabolic Cost of Transport via a Flexible-Torso Model. BB. 2015;10(5):056008.
64. Yesilevskiy Y, Yang W, Remy CD. Spine Morphology and Energetics: How
Principles from Nature Apply to Robotics. Bioinspir Biomim. 2018;13(3):036002.
doi:10.1088/1748-3190/aaaa9e.
65. Wentink GH. Biokinetical Analysis of the Movements of the Pelvic Limb of the
Horse and the Role of the Muscles in the Walk and the Trot. AE.
1978;152(3):261–272. doi:10.1007/BF00350524.
66. Usherwood JR. An Extension of the Collisional Model of the Energetic Cost of
Support Qualitatively Explains Trotting and the Trot-Canter Transition. J Exp
Zool Part A. 2019; p. Forthcoming.
67. Raibert MH. Legged Robots That Balance. MIT Press; 1986.
68. Alexander RM. Optimum Walking Techniques for Quadrupeds and Bipeds. J
Zool. 1980;192(1):97–117. doi:10.1111/j.1469-7998.1980.tb04222.x.

April 13, 2019

35/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

69. Abourachid A, Herbin M, Hackert R, Maes L, Martin V. Experimental Study of
Coordination Patterns during Unsteady Locomotion in Mammals. J Exp Biol.
2007;210(2):366–372. doi:10.1242/jeb.02632.
70. Farley CT, McMahon TA. Energetics of Walking and Running: Insights from
Simulated Reduced-Gravity Experiments. J Appl Physiol. 1992;73(6):2709–2712.
71. Hasaneini SJ, Schroeder RT, Bertram JEA, Ruina A. The Converse Effects of
Speed and Gravity on the Energetics of Walking and Running. bioRxiv. 2017; p.
201319. doi:10.1101/201319.
72. Lemelin P, Schmitt D, Cartmill M. Footfall Patterns and Interlimb
Co-Ordination in Opossums (Family Didelphidae): Evidence for the Evolution of
Diagonal-Sequence Walking Gaits in Primates. J Zool. 2003;260(4):423–429.
doi:10.1017/S0952836903003856.

1

Supporting Information

S1 Appendix. Mathematical statements of constraints.

S2 Appendix. Justification for variable bounds.

S1 Table. Optimization variable bounds.

S2 Table. Main settings for the optimization procedure.

S1 Fig. Relative frequency of walking, trotting/pacing and galloping as
speed increases. Walking shown in blue, trotting/pacing in red and galloping in green.
Observations normalized to total count in each bin. Data from Maes et al., Fig 4 [36].

S1 File. Optimal solutions for specific cases. Pseudo-globally optimal ground
reaction forces, footfall positions and initial kinematic conditions are given for the
results with varying force-rate penalty, as well as the other test cases, as shown in
Figs 2-4.

April 13, 2019

36/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

S2 File. Duty factor, phase and cost for all valid solutions discovered for a
range of speeds using Belgian Malinois morphology, as displayed in Figs
6-9. ‘nlpinfo’ are the SNOPT exit conditions, with nlpinfo < 10 indicating satisfactory
convergence on a local optimum. Phase is relative to the left-hind limb touchdown.

April 13, 2019

37/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

Figures and Tables

Fig 1

April 13, 2019

38/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

0.8

0.7

0.6

0.5

0.4

0.3

Real
Sim, c'1D = 3 E-5
Sim, c'1D = 3 E-3

0.2

Sim, c'1D = 1 E-2

0.1

0
0

0.2

0.4

0.6

0.8

1

Fig 2

April 13, 2019

39/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

0.8
Hind DF

Fore DF

PO

real

0.7

0.6

0.5

0.4

0.3

0.2
10 -5

10 -4

10 -3

10 -2

Force rate penalty coefficient (c'1D )

Fig 3

April 13, 2019

40/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

Fig 4

April 13, 2019

41/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

Fig 5

April 13, 2019

42/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

1
Optimization
Empirical [37]
95% CI

0.8
0.6
0.4

Impulsive
walking

0.2
0

swing period = NPP/2

A

0.8

LF

RH

RF

0.6
0.4
0.2
0

B

0.5

Walk Trot

Trot Gallop

Left
Right
Symmetry

C

0
0

0.5

1

1.5

2

2.5

3

Fig 6

April 13, 2019

43/45

bioRxiv preprint doi: https://doi.org/10.1101/580779; this version posted April 13, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.

U′h

Hind Lag
0

Hind Lag
0.75

1

0

Fore Lag

0.5

1.15

0.5

Pair Lag
0.75

1

0

0.25

0.5

0.75

1

0.5

0

0

1

1

0.5

2.00

1

0.5

0.5

2.87

1

0.5

Fore Lag

0

1

0.4
CoT - min(CoT)

0

Pair Lag

Fore Lag

0

1

Pair Lag

0.5

0

0.5

0

0

0

1

1

1

0.5

0.5

Fore Lag

Pair Lag

0.25

1

Fore Lag

Pair Lag

0.5

1

0.38

Pair Lag

0.25

0.5

0

0
0

0.25

0.5

Hind Lag

0.75

1

0
0

0.25

0.5

Hind Lag

0.75

1

0

0.25

0.5

0.75

1

Pair Lag

Fig 7

April 13, 2019

44/45

20 ; this version posted April 13, 2019. The copyright holder for this preprint (which was not
bioRxiv preprint doi: https://doi.org/10.1101/580779
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY 4.0 International license.
10
0
1

0.5

0
0.6
0.4
0.2
0
0

0.5

1

1.5

2

2.5

3

Fig 8

0

Lateral Sequence

3/16

7/16

Trot

0.1

13/16

0.05

15/16

0

CoT - min CoT

11/16

Diagonal Sequence

9/16

Pace

1
0.7

Lateral Single- Diagonal
Couplets
foot
Couplets

Pair Lag

5/16

Diagonal Single- Lateral
Couplets
Couplets
foot

Pace

1/16

0.6

0.5

0.4

0.3

Duty Factor

Fig 9

April 13, 2019

45/45

