bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Invasion implies substitution in
ecological communities with class-structured populations
Tadeas Priklopil1 and Laurent Lehmann1
1

Department of Ecology and Evolution, University of Lausanne

Abstract
Long-term evolution of quantitative traits is classically and usefully described as the directional
change in phenotype due to the recurrent fixation of new mutations. A formal justification for such
continual evolution ultimately relies on the ”invasion implies substitution” principle. Here, whenever
a mutant allele causing a small phenotypic change can successfully invade a population, the ancestral (or wild-type) allele will be replaced, whereby fostering gradual phenotypic change if the process
is repeated. It has been argued that this principle holds in a broad range of situations, including
spatially and demographically structured populations experiencing frequency and density dependent
selection under demographic and environmental fluctuations. However, prior studies have not been
able to account for all aspects of population structure, leaving unsettled the conditions under which
the “invasion implies substitution”-principle really holds. In this paper, we start by laying out a
program to explore and clarify the generality of the “invasion implies substitution”-principle. Particular focus is given on finding an explicit and functionally constant representation of the selection
gradient on a quantitative trait. Using geometric singular perturbation methods, we then show that
the ”invasion implies substitution”-principle generalizes to well-mixed and scalar-valued polymorphic
multispecies ecological communities that are structured into finitely many demographic (or physiological) classes. The selection gradient is shown to be constant over the evolutionary timescale and
that it depends only on the resident phenotype, individual growth-rates, population steady states and
reproductive values, all of which are calculated from the resident dynamics. Our work contributes
to the theoretical foundations of evolutionary ecology.

1

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

1

Introduction

A central theme in evolutionary biology is to understand how organisms have evolved to become adapted
to their environment. Of particular relevance is to understand adaptation to biotic environments which
contain, and are altered by, the interactions of the organism with members of its own and other species
(Pásztor et al., 2016; Estrela et al., 2018). Examples of such interactions permeate the biological world,
they include competition for resources, mate choice, helping behavior and cultural learning to name a
few, and will here be collectively referred to as social interactions. Social interactions, however, may
lead to complex frequency and/or density-dependent evolutionary dynamics. It may thus be felt that in
general not much can be said about the evolutionary adaptive trajectory of social traits.
Notwithstanding this complexity, it has been extensively argued that when mutations cause only small
changes to the phenotype under selection, the evolutionary trajectory of a phenotype can be continual
under directional selection, proceeding by a gradual, small-step by small-step transformation of the phenotype under focus (e.g., Hamilton, 1964; Eshel, 1983; Metz et al., 1995; Geritz et al., 1998; Rousset
and Billiard, 2000; Leturque and Rousset, 2002; Rousset, 2004; Rousset and Ronce, 2004; Geritz, 2005;
Rousset, 2006; Dercole and Rinaldi, 2008; Durinx et al., 2008; Lehmann and Rousset, 2014; Dercole and
Geritz, 2016). Such a paradigmatic Darwinian process (e.g., Dawkins, 1997) relies on the “invasion
implies substitution”-principle, which is the ultimate fixation in the population of any mutant that is
being favored by selection when initially rare. The “invasion implies substitution”-principle has been
suggested to hold not only for arbitrary social interactions, but also in cases where populations are spatially and demographically (physiologically) structured and subject to demographic and environmental
fluctuations (Rousset, 2004; Geritz, 2005; Durinx et al., 2008; Lehmann and Rousset, 2014) and has been
called a “gift from God” (Hamilton, 1988).
The intuitive argument for justifying “invasion implies substitution”-principle relies on considering two
alleles, a wild-type (resident) allele coding for some phenotype and a mutant allele coding for some
closely similar phenotype. The argument is then that the dynamics of an appropriately weighted average
mutant allele frequency p in the population is much slower than the dynamics of all other variables
governing the demographic and genetic make-up of the population, such us population densities and
genetic associations like relatedness or linkage disequilibria (see Figure 1 panels A and B and Rousset,
2004, p. 196 and p. 206-207 for an early general discussion of this argument). Consequently, the genetic
and ecological variables (collectively referred to as population dynamical variables) that operate in fast
population dynamical time can be assumed constant at the slow evolutionary time at which the mutant
frequency p changes, rendering selection essentially frequency-independent. More precisely, the expected
change ∆p in (weighted) mutant frequency p is supposed to follow a dynamical equation like
∆p = δV(p)S + O(δ 2 ),

(1)

where δ is the phenotypic deviation between mutant and resident phenotype, and V(p) is frequencydependent but always a positive measure of genetic variation at the loci under selection, e.g., for a well-

2

S

population
dynamical variables

A)
RESIDENT DYNAMICS

“average”
mutant frequency

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

B)
p

inv

s
plie
n im
o
i
s
a

n
utio
stit
sub

1

0

C)
TRAIT SUBSTITUTION
SEQUENCE

long-term
evolutionary time

evolutionary time

population
dynamical time

Figure 1: The three timescales that are relevant for the “invasion implies substitution”-principle. A)
The population dynamical timescale at which all fast genetic and demographic (ecological) dynamical
variables converge to their steady state. Here, the individual growth-rate matrix H determines the
resident dynamics. B) The evolutionary timescale at which the (weighted average) mutant frequency
p changes, and where the mutant allele may or may not substitute its ancestral resident allele. Here,
the fast population dynamical variables are at their steady state and thus constant. C) The long-term
evolutionary timescale at which the phenotype under selection changes (also called meso-evolutionary
timescale, Metz, 2011). The trait under selection takes values in the trait space Z. This panel gives
the timescale of the trait substitution sequence where each individual trait substitution is defined as an
invasion implies substitution event.
mixed population this is simply p(1 − p) with p being the average mutant frequency in the population.
Moreover, S is a frequency-independent selection gradient, which is a function of the fast population
dynamical variables and is calculated for a resident population. Whenever the selection gradient S is
non-zero, (1) says that if mutant frequency p increases when rare it substitutes the resident; that is, it
substitutes its ancestral phenotype. This is the “invasion implies substitution”-principle.
Decoupling the slow evolutionary variable p from the fast population dynamical variables, however, is
not straightforward in complex communities that exhibit population structure. When individuals are
structured into different demographic classes such as age or size classes, or when individuals inhabit
different spatial locations, it is not obvious how to define the mutant frequency and on which timescale
does it operate (Leturque and Rousset, 2002; Rousset and Ronce, 2004; Rousset, 2006). Indeed, classspecific mutant frequencies and thus also the mean mutant frequency in the population are usually not
purely slow evolutionary variables (Leturque and Rousset, 2002; Rousset and Ronce, 2004). Moreover,
when individuals are structured into continuous or countably infinite age-classes and habitats (Metz and
Diekmann, 1986; Diekmann et al., 1998, 2001; Rousset, 2006), population dynamical variables such as
population densities or genetic associations are not necessarily fast either (Greiner et al., 1994; Rousset,
2006; Gyllenberg, 2007). In both situations a standard timescale separation method is not readily
applicable, or, may not even be possible.
Despite of these complications, it has been conjectured that the “invasion implies substitution”-principle

3

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

nevertheless holds in structured populations (Rousset, 2004; Durinx et al., 2008; Metz and de Kovel,
2013), more specifically, in populations with finite number of demographic and spatial classes where
individuals are characterized by scalar-valued traits (Rousset, 2004). The central step here follows
from the realization that when the mutant frequency in the population p is defined as the class-specific
reproductive weighted average frequency (e.g., Stubblefield and Seger, 1990; Taylor, 1990; Leturque and
Rousset, 2002; Rousset, 2004; Lehmann and Rousset, 2014; Grafen, 2015), it is a purely slow evolutionary
variable operating in purely slow evolutionary time. Consequently, this suggests that the dynamics of
the weighted average frequency p can be generically cast in the form (1) and moreover with a selection
gradient that can be partitioned according to the following generic form
"

#
XX
∂H
∂H
S=v
+
Rothers in ω,c n.
∂zself
∂zothers in ω,c

(2)

ω∈G c∈D

Here, the matrix H is a resident growth-rate matrix whose elements hab give the rates at which individuals
are produced into demographic class a ∈ D by a single resident individual in demographic class b ∈
D and D denotes the demographic class-space. This matrix has v and n as leading left and right
eigenvectors giving, respectively, the resident individual reproductive values and steady states (see Figure
2 for the partition of S). Because eigenvectors can be scaled arbitrarily, in an alternative but equivalent
formulation the class-specific population densities n can be replaced by a probability distribution of a
demographic class, i.e., by class frequencies. The partial derivatives

∂H
∂zself

and

∂H
∂zothers in

ω,c

are taken with

respect to the phenotype (more precisely, with respect to the contribution of an allele on the phenotype)
of the individual whose growth-rate we are considering, and with respect to the phenotype of individuals
in all the spatial and demographic classes over which we are summing ω ∈ G, c ∈ D, respectively,
where G denotes the spatial class space (i.e., the number of distinct spatial locations an individual can
inhabit). These derivatives are usually interpreted as fitness effects caused by mutations (see also Figure
2), and the matrix Rothers in ω,c weights these effects by the average genealogical relationship between
individuals that occupy the same spatial and demographic class as the individual whose growth-rate
is being considered, and individuals in spatial class ω ∈ G and demographic class c ∈ D. That is,
the elements of Rothers in ω,c are neutral relatedness coefficients (Rousset, 2004). To our knowledge, no
generalizations of (2) to more generally structured populations are known.
Equation (2) is consistent with all previous work on the “invasion implies substitution”-principle. In
particular, two categories of demographically unstructured population models have treated the “invasion
implies substitution”-principle in depth. The first category are well-mixed (panmictic) population models
with fluctuating demography caused by density and frequency-dependent selection (Geritz, 2005; Meszéna
et al., 2005; Dercole and Rinaldi, 2008; Dercole and Geritz, 2016), where population density is the single
population dynamical variable. These models include scalar-valued (Dercole and Rinaldi, 2008; Dercole
and Geritz, 2016) and vector-valued traits (Geritz, 2005; Meszéna et al., 2005), arbitrary (Dercole and
Rinaldi, 2008) or tightly clustered polymorphisms (Meszéna et al., 2005), as well as populations that are
part of a larger ecological community (Dercole and Rinaldi, 2008). The “invasion implies substitution”principle was here proven by singularly perturbing (Fenichel, 1979; Wiggins, 1994; Jones, 1995; Hek,
4

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

a

c

a

c

b
spatial class

local habitat

spatial class

Figure 2: The partitioning of the selection gradient S as an inclusive fitness effect. Suppose that, as a
thought experiment, the deviation between the mutant and resident phenotype δ is set to zero for all
mutant individuals in the population (i.e., all individuals have the same phenotype). Then, suppose a
“button” is pressed so that all mutant individuals in the population “switch” to expressing the small δ
deviation. Pressing the button can (marginally) affect the production rate hab of class a offspring of a
randomly sampled mutant individual residing in demographic class b in a given discrete spatial location
(denoted as “local habitat” in the figure) in two ways. First, it can affect the production “directly”
because the individual in class b expresses the δ deviation, which results in marginal effect ∂z∂self hab on
self. Second, the mutant can also be affected “indirectly” due to social (frequency or density dependent)
interactions with other mutant individuals expressing the δ deviation, which results in marginal effect
∂hab
∂zothers in ω,c multiplied by the (relative) probability that individuals in ω, c also have the mutation (which
is conditional on the individual in class b), i.e., the probability Rb,others in ω,c where Rothers in ωc =
(Rb,ωc )a∈D . Because there are nb individuals in class b and the reproductive value of the produced
∂
individuals in a is va , the selection gradient in (2) is obtained from va [ ∂z
hab + ∂z∂ω,c hab Rb,ωc ]nb by summing
over all possible spatial and demographic classes.
2010; Kuehn, 2015) the slow evolutionary dynamics in order to obtain an approximation for the mutant
frequency dynamics resulting from small but nonzero deviations between mutant and resident phenotypes
(Dercole and Rinaldi, 2008; Dercole and Geritz, 2016, see an alternative proof of Geritz, 2005). Such
perturbation analysis is essential in situations where fast population dynamical variables (e.g. population
density) may not persist under the perturbation caused by the invasion of a mutant phenotype (Geritz
et al., 2002) and may lead e.g. to a catastrophic extinction of the population (Ferriere, 2000; Gyllenberg
and Parvinen, 2001; Parvinen, 2016). The selection gradient was then shown to take the form S =

∂h
∂zself

(Dercole and Rinaldi, 2008; Dercole and Geritz, 2016), where population density comes into play as an
argument of the growth-rate function.
The second category of demographically unstructured models (Wakeley, 2003; Roze and Rousset, 2003;
Wakeley and Takahashi, 2004; Rousset, 2004, 2006) assumes that the population exhibits spatial or
group structure with limited dispersal, but as the population is not assumed to experience demographic
fluctuations all spatial locations are identical and so all individual belong to the same demographic class.
Thus, the single population dynamical variable is the genealogical relationship between individuals within
a group (that is of constant and finite size), i.e., the relatedness between group members. Invasion implies
substitution was shown to hold by using the diffusion approximation method for two timescales developed
in Ethier and Nagylaki (1980, 1988), where one scales up a finite population model by letting the number
of groups to go to infinity while the phenotypic deviation between mutant and resident phenotypes goes
to zero. Because the only population dynamical variable is density-independent relatedness (whose
5

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

dynamics is further linear), relatedness itself depends smoothly on the evolving phenotype, and so the
aforementioned results are robust against small but nonzero phenotypic deviations caused by the invasion
of a mutant phenotype (for instance, no bifurcation leading to population extinction can occur). This
method was applied in the island model of dispersal (i.e., the spatial structure considered in Wright,
1931) for the discrete-time Wright-Fisher model (Wakeley, 2003) and for the Moran model (Wakeley and
Takahashi, 2004), whereas (Roze and Rousset, 2003; Rousset, 2004, 2006) showed that the “invasion
implies substitution”-principle holds for a much larger class of discrete-time population models including
diploid populations (in the absence of over and under-dominance), and showed that the selection gradient
can be expressed as S =

∂h
∂zself

+

∂h
∂zothers Rothers

(Roze and Rousset, 2003; Rousset, 2004, 2006). A

related model considers isolation by distance (Rousset, 2006). Here the timescale separation is obtained
by utilizing the observation that the genealogical relationships between individuals in different spatial
locations can be captured by studying the proportions of distributions of coalescence times (Slatkin,
P
∂h
+ ω∈G ∂zothers
Rothers in ω
1991). The selection gradient was then shown to take the form S = ∂z∂h
self
in ω
and since the population is structured into countably infinite number of spatial locations, the population
dynamical variable (relatedness coefficient) is of a countably infinite dimension.
Some studies have also discussed invasion implies substitution in demographically structured populations
in both well-mixed and group-structured populations with limited dispersal. First and most recently,
Lion (2018a,b) discusses the “invasion implies substitution”-principle for a haploid well-mixed population
that is assumed demographically class-structured and part of a larger ecological community. Here, the
focus is given to the dynamics of the trait mean for a polymorphic trait that is tightly clustered around its
mean. Consequently, the timescale separation arguments were made in terms of aggregate variables such
as trait means and variances instead of the full distribution of mutant frequencies, which should actually
be considered in a full proof of the “invasion implies substitution”-principle, but nevertheless it was
shown that the selection gradient takes form S = v ∂z∂H
n. Second, the “invasion implies substitution”self
principle has been considered in the island model of dispersal with finite but demographically fluctuating
local population sizes (Rousset, 2004; Rousset and Ronce, 2004; Lehmann et al., 2016); division into
demographic classes such as age or size classes (Rousset, 2004); and sex-classes with different ploidy levels
(Roze and Rousset, 2004) and sex-specific imprinting (Van Cleve et al., 2010). Here, it is argued that
the timescale separation between the mutant frequency and the local genetic and demographic structure
holds when the mutant frequency is defined as the average frequency weighted by (demographically)
class-specific reproductive values (Taylor, 1990; Leturque and Rousset, 2002; Rousset, 2004) and using
the timescale separation arguments of Ethier and Nagylaki (1980, 1988), in which case the selection
h
i
∂H
gradient can be expressed under the form S = v ∂z∂H
+
R
n (Rousset, 2004; Lehmann
other
∂zothers
self
et al., 2016). Similarly to the spatially structured model without demographic fluctuations, these models
contain only one spatial location and so relatedness only needs to be calculated within groups that belong
to the same demographic class (notice no summation in the selection gradient). However, no explicit,
step-by-step full proof of the “invasion implies substitution”-principle has actually been detailed for
these class-structured models (beyond invoking that Ethier and Nagylaki, 1980, 1988 applies to them,
e.g., Rousset, 2004, p. 196) and thus remains wanting in the literature. In particular, because each group
6

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

consists of individuals that fluctuate between different demographic classes the growth-rate functions
as well as relatedness can be density-dependent under certain scenarios, which requires a more detailed
analysis on the robustness of the evolutionary mutant frequency dynamics under small but non-zero
perturbations caused by the invasion of the mutant.
In summary, while the “invasion implies substitution”-principle seems to be well established for several
biological scenarios, there is no completely detailed proof specifying all steps for the case of demographically and spatially class-structured populations. More generally, it remains to explore and clarify the
following sets of questions pertaining to the adaptive dynamics of closely similar phenotypes, and which
could be called the “invasion implies substitution”-principle program.
(I) What is the validity and generality of the “invasion implies substitution”-principle in structured
populations with respect to the trait space, the demographic class space, and the spatial class space
(respectively Z, D, G)?
(II) If the principle holds in a given model, (a) what conditions must the resident growth-rate matrix (or
operator) H satisfy, and (b) can the evolutionary dynamics of the mutant phenotype systematically
be expressed as in (1)?
(III) If the mutant dynamics satisfy (1), can we find an explicit expression for the selection gradient S
as in (2), that is, can we generically express S in terms of (a) individual reproductive values v,
(b) steady states n, and (c) relatedness R, all of which can be determined from resident quantities
such as the growth-rate matrix H evaluated at the attractor of the ecological community?
Our aim in this paper is to contribute to this program (or quest). Because answering the above question is
complex and has ramification with many evolutionary models, not everything can be answered in a single
paper. We thus consider here a scalar-valued quantitative trait under selection in a clonally reproducing
(or haploid) well-mixed population structured into finitely many demographic classes residing in a larger
ecological community (allowing for arbitrary eco-evolutionary feedback), and prove positive answers to all
three questions (I)-(III) posed above. In so doing, we lay out in detail the concept of singular perturbation
theory and multiple timescale analysis (Fenichel, 1979; Wiggins, 1994; Jones, 1995; Hek, 2010; Kuehn,
2015), which we apply to limited dispersal in a subsequent paper. Because we formulate our model
in continuous-time and from the outset assume that the population size is large, our treatment also
complements previous well-mixed demographically class-structured models (in particular those implied
by the models in Rousset, 2004), which are started with discrete-time and finite total population size
formulation and use scaling of both time and system size to obtain the desired timescale separation
(Ethier and Nagylaki, 1980, 1988; Rousset, 2004).
The rest of this paper is organized as follows. We start Section 2 by constructing a continuous-time
population model that completely describes the population as well as the evolutionary dynamics of the
ecological community. We then move on to study the mutant-resident dynamics in situations where the
mutant and its ancestral resident phenotype are closely similar (Section 3). In Section 4 we proceed to
prove the “invasion implies substitution”-principle by decoupling the slow evolutionary dynamics given
7

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

by the average mutant frequency weighted by class reproductive values from the fast dynamics given by
the population dynamical variables. We conclude by discussing related work and the overall relevance
of our results to evolutionary ecology (Section 5).

2

Model

Consider an infinitely large haploid population where each individual is characterized by a single onedimensional (scalar-valued) continuous trait. The phenotypic value of the trait of each individual is
assumed fixed during its life and individuals are structured into finitely many demographic classes (Taylor, 1990; Charleworth, 1994), e.g. age or size classes, which in contrast to the phenotype may change
throughout their life. The population of interest may also be part of a greater ecological community - individuals of the population interact with individuals from other species (e.g. predator-prey community),
which may also be structured into different phenotypes and demographic classes.

Preliminaries Let Z ⊂ R denote the space of phenotypes, D the set of m ∈ N+ distinct demographic
classes where m is finite, and take time to be continuous. As the present model has no spatial structure,
and thus no spatial classes, we omit the term “demography” in front of the word class. Note that Z and
D jointly give the full description of the life-history of individuals in the population (birth, maturation
and death) and hence jointly define a so-called individual-level state space (Metz and Diekmann, 1986;
Diekmann, 2002).
Moreover, suppose that the population, at least initially, is polymorphic with respect to the trait under
focus with all in all k distinct alleles segregating (each coding for a distinct phenotype), all of which
define the resident population. However, because we will assume that one (and only one) of the k alleles
undergoes a mutation giving rise to a new phenotype denoted zM ∈ Z (M stands for mutant), we single
out its ancestral phenotype and call it the ancestral resident phenotype zR ∈ Z, or simply, the resident.
After mutation, the population thus consists of a mutant allele (with phenotype zM ), a resident allele
(with phenotype zR ∈ Z), as well as k − 1 other alleles, each with their respective phenotypes. Since,
under our assumptions, there is a one to one relationship between allele and phenotype, we will generally
just speak of mutant and resident phenotypes.
It will be useful to distinguish individuals not only by their phenotype but also the class they are in. For
example, a mutant that is in class a ∈ D will be identified with zM,a . We emphasise that zR,a and zM,a
take phenotypic value zR , zM ∈ Z, respectively, for all a ∈ D, and that this notation is introduced (only)
for a bookkeeping purpose, that is, to keep track of individuals moving in time through the individuallevel state space. Finally, to make a distinction between (resident individuals in) resident dynamics and
(resident individuals in) mutant-resident dynamics, we will drop out the subscript denoting residents (R)
whenever we are discussing ecological communities where the mutant phenotypes are absent.
We now first present a model for a polymorphic resident ecological community where the mutant phenotype is assumed absent (Section 2.1). Then, we extend the model to a situation where one of the
8

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

phenotypes has undergone a mutation resulting in an arbitrary mutant phenotype and express the dynamical system in terms of class-specific mutant frequencies (Section 2.2). Finally, in Section 2.3, we give
several consistency relations and properties that relate mutant-resident dynamics to resident dynamics,
which will play a central role in deriving the main results of this paper.

2.1

Resident dynamics

Let n = (na )a∈D ∈ Rm
+ denote the vector of densities (number of individuals per unit space) of (ancestral)
resident individuals in all the possible classes the individuals can be in, with element na ∈ R+ denoting
the density of resident individuals in class a ∈ D. Similarly, z = (za )a∈D ∈ Z m denotes the resident
phenotype vector where element za identifies individuals in class a ∈ D with a phenotype z ∈ Z. The
density vector nP ∈ Rl+ collects, for each class, the density of the other k − 1 resident phenotypes in the
population of the focal species and the densities of the rest of the ecological community. Hence, if we
have a community with a single species l = (k − 1)m, otherwise l > (k − 1)m.
The resident dynamics is given by the set of ordinary differential equations
ṅ = H(z, z, n, nP )n

(3)

ṅP = P(z, n, nP ),
d
”. The matrix
where the dot ” · ” above the density vectors n and nP denotes the time derivative ” dt

H = hab a,b∈D ∈ Rm×m is the (ancestral) resident growth-rate matrix where entry hab (z, z, n, nP )

is a sufficiently smooth growth-rate function giving the rate at which a single individual of class b
produces individuals of class a. We emphasise that the first argument z ∈ Z in the growth-rate matrix
H(z, z, n, nP ) identifies the phenotype of the individual whose growth-rate we are considering, while all
the remaining arguments describe the environment that the individual finds itself in. The matrix P ∈
Rl×l is the growth-rate matrix of the rest of the resident population and the ecological community and
is also a function of the environment that the individuals find themselves in. For notational convenience,
especially when it is clear from the context, we will drop from the growth-rate matrices and functions
all arguments that describe the environment, for example, we may write H(z) instead of H(z, z, n, nP )
and P instead of P(z, n, nP ).
We note that all the growth-rate functions presented in this paper are constructed by assuming an infinitely large well-mixed ecological community, where individuals are assumed to undergo demographic
individual-level processes on a Poissonian basis; the demographic processes can be either asocial where
individuals react by themselves e.g., dying or moving from one age class to another, or social, resulting
from random encounters of pairs of individuals. The probability of any higher order encounter vanishes
in continuous-time models. However, all growth-rate functions can be non-linear and of any complexity
as we allow for arbitrary frequency and/or density dependent (pairwise) interactions. Different underlying assumptions on the encounters between individuals is possible, facilitating e.g. multiplayer games
(Weibull, 1995), but are not dealt with in this paper.

9

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Steady state of the resident dynamics Throughout the paper we assume that there exists an
equilibrium point (n̂, n̂P ) ∈ Rm+l
to which the community given by (3) converges to and then stays at.
+
Importantly, this equilibrium is assumed to be hyperbolically stable, i.e. the real part of the dominant
eigenvalue of the linearized system (3) evaluated at the equilibrium is negative and bounded away from
zero (Hirsch et al., 1974). However, we allow the system (3) to contain multiple non-negative equilibria
or other attractors at which the community could potentially reside. Assuming multiple equilibria or
other attractors is not problematic when considering evolutionary dynamics because the so-called tube
theorem (Geritz et al., 2002) excludes ”attractor switching” for mutant-resident dynamics with closely
similar phenotypes. That is, the dynamics of the mutant with a similar phenotype to a resident will
never evolve to an alternative attractor. In Section 5 we discuss how our results can be extended to more
complicated attractors than equilibria.

2.2

Mutant-resident dynamics

We now introduce the mutant phenotype zM ∈ Z into the resident population. Let nR = (nR,a )a∈D ∈ Rm
+
m
and zM =
and nM = (nM,a )a∈D ∈ Rm
+ denote the vectors of densities and zR = (zR,a )a∈D ∈ Z

(zM,a )a∈D ∈ Z m the vectors of phenotypes of (ancestral) residents and mutants, respectively, in all the
possible classes the individuals can be in. The mutant-resident dynamics is then given by
ṅM = G(zM , zR , zM , nR , nM , nP )nM
(4)

ṅR = G(zR , zR , zM , nR , nM , nP )nR
ṅP = R(zR , zM , nR , nM , nP ),
where G = gab


a,b∈D

∈ Rm×m is the growth-rate matrix of individuals in the mutant-resident population,

such that G(x) := G(x, zR , zM , nR , nM , nP ) is the growth-rate matrix of a phenotype x ∈ {zM , zR } and
that each entry gab (x) is a sufficiently smooth growth-rate function giving the rate at which a single
individual with phenotype x ∈ {zM , zR } in class b ∈ D produces individuals in class a ∈ D. It is
clear from this formulation that as we have assumed the growth-rate matrix G and its arguments be
identical for mutants and residents (except the first), we have assumed that mutants and residents
experience the exact same environment and thus the only difference in their growth-rate is due to their
own phenotype. In particular, every individual is surrounded by equal number (density) of mutants and
residents. Similarly to the second line of of the resident dynamics (3), R ∈ Rl×l is the growth-rate matrix
of the k − 1 remaining resident phenotypes in each class and of the rest of the ecological community.
Relative mutant-resident dynamics Because we are interested in the relative dynamics of mutants
zM ∈ Z and (ancestral) residents zR ∈ Z, it will be convenient to change the dynamical variables by
considering the frequency of mutants pM,a =

nM,a
na

in class a ∈ D, where na = nM,a +nR,a is the total density

of mutants and residents in class a ∈ D. The vectors p = (pM,a )a∈D ∈ [0, 1]m and n = (na )a∈D ∈ Rm
+
are thus the vectors for class-specific mutant frequencies and class-specific total densities of (mutant and
ancestral resident) individuals, respectively. We emphasise that since we are interested in the relative

10

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

dynamics of mutants and their ancestral residents, the mutant frequency pM,a is defined with respect
to mutants and their ancestral residents in class a ∈ D, not all k resident phenotypes present in the
population.
We can now rewrite the mutant-resident dynamics (4) in terms of the class-specific mutant frequencies
p and the class-specific total population densities n as
ṗ = F(zM , zR , zM , p, n, nP )p
(5)

ṅ = Ḡ(zR , zM , p, n, nP )n
ṅP = R(zR , zM , nR , nM , nP ),

where Ḡ = (ḡab )a,b∈D , with ḡab = gab (zM )pM,b + gab (zR )pR,b , is the average mutant-resident growth-rate
matrix, and where F = (fab )a,b∈D ∈ Rm×m is the relative growth-rate matrix (see Appendix 6.1 for a
relative growth rate matrix for an arbitrary phenotype). The entries of the relative growth-rate matrix
for mutants F(zM ) := F(zM , zR , zM , p, n, nP ) are obtained by differentiation
ṗM,a



ṅM,a na − nM,a ṅa
d nM,a
=
=
dt
na
n2a
1
[ṅM,a − pM,a ṅa ]
=
na
X nb
X nb
=
gab (zM )pM,b − pM,a
ḡab ,
na
na
b

(6)
∀a ∈ D,

b

where we have used equations (4) and (5) and the definition of class mutant frequencies pM,a . Motivated
by Lion (2018b, Appendix A.3), it will be useful to rewrite (6) by subtracting and adding a term
P nb
b na ḡab pM,b , to obtain
ṗM,a =

X nb
b

na

[gab (zM ) − ḡab ] pM,b +

X nb
b

na

ḡab pM,b − pM,a

X nb
b

na

ḡab

∀a ∈ D.

(7)

This allows us to partition the mutant relative growth-rate matrix as
F(zM ) = Fsel (zM ) + F̄pc ,

(8a)

where Fsel = (fabsel )a,b∈D ∈ Rm×m and F̄pc = (f¯abpc )a,b∈D ∈ Rm×m with entries, respectively, given by
fabsel (zM ) =

nb
[gab (zM ) − ḡab ]
na

(8b)

and

f¯abpc =



 nb ḡab

∀b 6= a

na


− P
c6=a

nc
na ḡac ,

(8c)

for b = a.

Notice that fabsel (zM ) is proportional to the difference between mutant gab (zM ) and average growth-rates ḡab

11

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

and thus captures the effect of selection (hence the superscript “sel”) on mutant allele frequency change.
The second term f¯abpc is proportional only to average growth-rates ḡab and hence captures non-selective
effects on allele frequency change due to transitions between classes. Since the relative growth-rate of
an individual due to the term f¯abpc is non-selective and thus independent of ones phenotype (see also
Appendix 6.1), the argument present e.g., in fabsel (zM ) is not included in f¯abpc , but it should nevertheless
be kept in mind that F̄pc depends both on mutant and resident traits. Such non-selective transitions
between classes nevertheless affect the dynamics of the mutant frequency, for instance if one class of
individuals, say newborns (or individuals living in a good habitat) have higher reproductive success than
older individuals (individuals living in bad habitat). Such deterministic change of allele frequency due to
non-selective forces have generally been referred to as changes due to “transmission” (following Barton
and Turelli, 1991; Kirkpatrick et al., 2002), since they result from alleles changing contexts (e.g., from
good habitat to bad habitat, from young to old individual; see Kirkpatrick et al., 2002 for more details on
the concept of the context of an allele and a discussion of transmission as an evolutionary force). When
the different contexts an allele can reside in are demographic classes, the changes in allele frequency due
to transmission have been called “passive changes” (Grafen, 2015; Lion, 2018a,b) and we adhere to this
terminology (hence the superscript “pc”).

2.3

Properties of growth-rates

In this section we present three properties that relate mutant-resident dynamics (4) to resident dynamics
(3) and then we apply them to the mutant relative growth-rate matrix (8). These properties and their
applications play a central role in Section 3 when discussing mutant-resident dynamics for closely similar
phenotypes and in Section 4 when proving our main result. The consistency relation given below is fully
analogous to the relation given in (Geritz et al., 2002; Dercole, 2016; Dercole and Geritz, 2016) and the
proposition given below is an analogue to a property derived for unstructured populations in (Meszéna
et al., 2005; Dercole, 2016).
Consistency relations:
G(x, zR , zM , nR , nM , nP )
R(zR , zM , nR , nM , nP )

zR =z
zM =z
zR =z
zM =z

= H(x, z, n, nP )
(9)
= P(z, n, nP ),

for any x ∈ Z. This relation says that the growth-rate of any individual from any population and species
in the ecological community, when all (other) individuals in the population are of the same phenotype
z ∈ Z, is its growth-rate in a resident ecological community (3) where n = nR + nM .

12

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Corollary:
∂
G(zM , zR , zM , nR , nM , nP )
∂zM
∂
G(zR , zR , zM , nR , nM , nP )
∂zM

zR =z
zM =z
zR =z
zM =z

=

∂
H(z, z, n, nP )
∂z

(10)

= 0,

This property follows immediately from the Consistency relation describing the effect that a mutant
phenotype of an individual has on its own growth-rate. Trivially, residents don’t have a mutant phenotype
and so there is no such effect for the resident growth matrix. The same is true also for the matrix R,
but as we don’t need the Corollary for R we haven’t included it here.
Proposition:
∂
G(x, zR , zM , nR , nM , nP )
∂zM,a

zR =z
zM =z

=

∂
H(x, z, n, nP )pM,a ,
∂za

(11)

for any x ∈ Z and for all a ∈ D. This property says that the effect that all mutants in class a ∈ D in
the mutant-resident community (4) have on the individual growth-rate (left-hand side of (11)), is equal
to the effect that all individuals in class a ∈ D in the resident community (3) have on the individual
growth-rate, weighted with the probability that given a random pairwise encounter with an individual of
class a ∈ D, it is a mutant (right-hand side of (11)). This property is a consequence of the growth-rate
function being constructed in terms of pairwise interactions between individuals (generalized mass action
law), and is a direct generalization of the property 4 given for unstructured populations in (Dercole, 2016)
(see also Meszéna et al., 2005).
Properties of relative growth-rates Here we apply the above properties (9)-(11) to the mutant
relative growth rate matrix (8). Substituting the consistency relation (9) into (8) implies that the
selection component of the relative growth-rate matrix Fsel = 0 is a null matrix for phenotypic equality
between mutant and its (ancestral) resident, therefore
F(zM )

zR =z
zM =z

= F̄pc

zR =z ,
zM =z

(12a)

where

fab (zM )

zR =z
zM =z

= f¯abpc

zR =z
zM =z

=



 nb hab (z)

∀b 6= a

na


− P
c6=a

nc
na hac (z),

,

(12b)

for b = a.

for all a, b ∈ D. We thus confirm that under phenotypic equality, selection (i.e., the component Fsel (zM ))
plays no role (as it should not) and that the change in class-specific mutant frequencies is non-trivial
and purely determined by the matrix F̄pc . That is, under phenotypic equality it is the “passive changes”
that determines the dynamics of class-specific mutant frequencies (Taylor, 1990; Stubblefield and Seger,
1990; Charleworth, 1994; Grafen, 2015; Lion, 2018a,b).

13

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

The Corollary (10) and the Proposition (11) immediately imply, respectively, that
∂ sel
f (zM )
∂zM ab
∂
f sel (zM )
∂zM,c ab

zR =z
zM =z
zR =z
zM =z

=

nb ∂
hab (z)(1 − pM,b )
na ∂z

(13a)

= 0,

(13b)

for all a, b, c ∈ D. Analogously to above, both properties describe the effect that a mutant phenotype
has on the mutant relative growth-rate. The property (13a) follows from the fact that the effect of a
mutant phenotype on ones own growth-rate is

∂
∂z hab (z)

if one is a mutant and

∂
∂z hab (z)pM,b

if one is an

average (random) individual in class b ∈ D. The property (13b) in turn follows from the fact that in a
well-mixed population all individuals experience the exact same social environment and hence the effect
that mutants in class c ∈ D have on a mutant growth-rate and an average growth-rate are equal.

3

Mutant-resident dynamics for nearby phenotypes

In this section, we will study the relative mutant-resident dynamics (5) for closely similar phenotypes. To
prove the “invasion implies substitution”-principle by using a timescale separation argument, we wish
that for closely similar phenotypes the mutant frequency in the population is a much slower dynamical
variable than all other dynamical variables in the model. If so, the fast dynamical variables would then
have enough time to reach their steady state (or at least to be sufficiently close to it) and thus could be
considered as constant arguments of the (much slower) evolutionary dynamics of the mutant frequency.
To check the timescale of all dynamical variables present in the relative mutant-resident dynamics (5),
let zM = zR + δ and let us Taylor expand (5) up to the second order about δ = 0,
ṗ = F(zM )

p+δ
δ=0

d
F
dδ

p + O(δ 2 )
δ=0

d
Ḡ
n + O(δ 2 )
dδ δ=0
d
ṅP = R
+δ R
+ O(δ 2 ),
dδ δ=0
δ=0
ṅ = Ḡ

(14)

n+δ

δ=0

which can be rewritten using (9) and (12) as
d
F
p + O(δ 2 )
dδ δ=0
d
ṅ = H(z)n + δ Ḡ
n + O(δ 2 )
dδ δ=0
d
ṅP = P + δ R
+ O(δ 2 )
dδ δ=0
ṗ = F̄pc
0 p+δ

(15)

pc
where F̄pc
0 := F̄ |δ=0 is as given in (12). From these equations, we can see that as all variables p, n

and nP fluctuate at a rate dominated by the terms of order O(1); that is, they are all fast population
dynamical variables. Or, in other words, none of the dynamical variables p, n nor nP are (at least not
purely) slow evolutionary variables dominated by the terms of order O(δ). This is true in particular for
P
the class-specific mutant frequencies p and also for the mean mutant frequency pM = a nna pM,a in the
14

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

population (Appendix 6.2). Since there are no purely slow evolutionary variables, a timescale separation
can’t be readily performed.
In the next Section 3.1, we show that an average mutant frequency weighted by class reproductive values
is the (purely) slow evolutionary variable enabling a timescale separation argument to be made. In the
following Section 3.2, we then find the steady state to which the fast population dynamical variables
approach to, and then in Section 4 we use these results to prove the “invasion implies substitution”principle.

3.1

Class reproductive value weighted average mutant frequency

To find a purely slow evolutionary variable that tracks changes in class mutant frequencies p, thus
tracking also the mean mutant frequency in the population pM , we take an average of p over all pM,a with
weights chosen such that the change of this weighted average mutant frequency vanishes under phenotypic
P
equality. For the moment, let α be an arbitrary vector of weights normalized such as a∈D αa = 1, and
lets denote the average mutant frequency weighted by α with
pα := αp =

X

αa pM,a .

(16)

a∈D

Because we are interested in the dynamics of pα , we follow the steps taken in Lion (2018b, Appendix
A.3), and differentiate with respect to time t and obtain
ṗα = α̇p + αṗ


= α̇ + αF̄pc p + αFsel (zM )p,

(17)

where we have used (5) and (8). Now, the class reproductive values are defined such that for any frequency
distribution p they “cancel” the class transitions due to “passive changes” or transmission between classes
(Taylor, 1990; Leturque and Rousset, 2002; Grafen, 2015; Lehmann and Rousset, 2014; Lion, 2018b),
rendering the dynamics of the weighted frequency (17) solely due to terms of class transitions due to
selection. This requirement is satisfied precisely when the term in the brackets in (17) is zero for all p,
which is true whenever
α̇ = −αF̄pc ,

(18)

P
where F̄pc is as in (8). Note that as f¯aapc = − b6=a f¯abpc , the matrix F̄pc is the infinitesimal generator
matrix for a (backward) continuous-time mutant-resident Markov chain α on the state space D. Using
(18) as the definition for class reproductive values, the dynamics of the weighted mutant frequency (17)
reduces to
ṗα = αFsel (zM )p.

(19)

15

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

We have thus obtained that since α by definition satisfies (18), the dynamics of the weighted mutant
frequency pα is determined purely by the selection component of the relative growth rate matrix as given
in (19) (see for an alternative derivation in terms of individual reproductive values, Appendix 6.5.4).
Interestingly, as we have made no assumptions on the magnitude of δ, the above equation is valid for
arbitrary phenotypic values zM , zR ∈ Z and thus for arbitrary strength of selection. Moreover, because
Fsel |δ=0 = 0 is a null matrix (12), the dynamics of pα under phenotypic similarity (δ small) is
ṗα = δα

d sel
F (zM )
dδ

p + O(δ 2 ).

(20)

δ=0

Because the dynamics of pα for closely similar phenotypes is dominated by the terms O(δ), we will be
able to track mutant frequencies p (and pM ) purely in slow evolutionary time by studying the δ-term of
pα . The average mutant frequency weighted by class reproductive values pα is thus a well suited proxy
for the slow evolutionary dynamics of pM .

Class reproductive values as fast and slow variables Whenever the class reproductive values α
are defined as in (18), the phenotypic values zM and zR as well as the fluctuations in the dynamical
variables p, n, nP , may be arbitrary. The class reproductive values are therefore defined both in fast
and slow time (depending whether the dynamical variables are at their steady state or not) as well as
for any strength of selection (which is determined by the magnitude of δ). If the variables n, nP under
phenotypic equality δ = 0 are at their steady state n̂, n̂P and thus constant in time, the steady state
class reproductive values α̂ are solvable from
0 = α̂F̂pc
0 ,

(21)

pc
where F̂pc
0 = F̄0 (z, n̂, n̂P ). The class reproductive values α̂ can thus be defined as the left eigenvector

of F̂pc associated with the eigenvalue 0. This is the standard definition of the class reproductive values
that have long been used as allele frequency weights in class-structured models (e.g., Stubblefield and
Seger, 1990; Taylor, 1990; Taylor and Frank, 1996; Leturque and Rousset, 2002; Rousset and Ronce,
2004; Rousset, 2004). Therefore, α̂a can be interpreted as the asymptotic probability (looking backward
in time) that the ancestral lineage of a random individual was in class a ∈ D. That is, α̂a gives the
long-term contribution of all genes in class a ∈ D to the future composition of the population (e.g.,
Rousset and Ronce, 2004, p. 131; Lehmann, 2014, eq. 7; Lion, 2018b, p. 624).

3.2

Steady states and the critical and perturbed manifolds

In Section 3.1, we found that the slow evolutionary dynamics of the weighted average mutant frequency
pα (19) is a function of the fast population dynamical variables α, p, n and nP , and that under phenotypic
similarity (δ small) the dynamics of pα (20) is dominated by the terms of order O(δ) and the dynamics
of α, p, n and nP by the terms of order O(1). Under phenotypic equality (δ = 0) it is thus sufficient to

16

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

study
α̇ = −αF̄pc
0 (z, n, nP )
ṗ = F̄pc
0 (z, n, nP )p

(22)

ṅ = H(z, z, n, nP )n
ṅP = P(z, n, nP ),
where we used (15), (19) and where we have for clarity included all the arguments. Therefore, in fast
population dynamical time, the variables (α, p, n, nP ) fluctuate and are expected to reach their steady
state while the weighted mutant frequency pα stays constant. The steady state (α̂, p̂, n̂, n̂P ) of (22)
must, by definition, satisfy
0 = α̂F̄pc
0 (z, n̂, n̂P )
0 = F̄pc
0 (z, n̂, n̂P )p̂

(23)

0 = H(z, n̂, n̂P )n̂
0 = P(n̂, n̂P ).
We recall from Section 2.1 that the equilibrium solution (n̂, n̂P ) for the bottom two equations exists and
is hyperbolically stable (by assumption), and from Section 3.1 we know that the steady state α̂ exists
and can be calculated from (21). The remaining task is to find the steady state p̂, which can be solved
from
F̄pc
0 (z, n̂, n̂P )p̂ = 0

(24)

⇐⇒
X

f¯abpc (z, n̂, n̂P )

b

δ=0

p̂M,b =

X nb
b

na

hab (z, z, n̂, n̂P )(p̂M,b − p̂M,a ) = 0

∀a ∈ D,

(25)

and is given by
p̂ = (p̂M,1 , . . . , p̂M,m ) = (p, . . . , p),

(26)

where the class-specific mutant frequencies pM,a in all classes a ∈ D are equal. Notice that any value of
p (biologically meaningful values lie between 0 and 1) gives a solution to (24) and hence the complete
solution to (24) consists of infinite number of equilibria (which lie on a line; note that such a degenerate
solution results from the fact that F̄pc
0 is a non-invertible matrix, Appendix 6.3). The exact value
of p ∈ [0, 1] to which the class mutant frequencies pM,a approach to, ∀a ∈ D, depends on the initial
condition p(t = 0). Interestingly, since by definition pα (t) = α(t)p(t) for all t as given in (16), and
since under phenotypic equality the weighted average frequency is constant in fast population dynamical
time (ṗα = 0 as shown in Section 3.1, but note that in slow time pα is no longer a constant), we must
P
have that α(0)p(0) = pα (0) = pα (t) = limt→∞ pα (t) = a α̂a p̂M,a = p, and so p̂M,a = p = pα (t) for all

17

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

a ∈ D and for all t; that is, the asymptotic mutant allele frequency in each class is equivalent to the
reproductive value weighted mutant frequency.
We have thus obtained that whenever the mutant and resident phenotypes are equal δ = 0, the dynamics
given by system (22) approaches in fast population dynamical time a steady state (α̂, p̂, n̂, n̂P ), which
is solved from (23). We represent the infinite number of equilibrium points (α̂, p̂, n̂, n̂P ) satisfying (23)
as the set
M0 = {(α̂, p̂, n̂, n̂P ) ∈ ∆m × [0, 1]m × Rm+l
| p̂M,a = pα ∀a ∈ D},
+

(27)

where ∆m is the mth simplex and the subscript 0 indicates that we are studying the dynamics for
the case where δ = 0 (see Figure 3, top panel). The set M0 is the so-called critical (or equilibrium)
manifold (Jones 1995, Definition 1, p. 49; Kuehn 2015, p. 12, see also Appendix 6.4.2 and recall that a
manifold is here a sub-space of the original state space). This M0 manifold defines in fast population
dynamical time the set of equilibrium (or critical) points to which the dynamical system with phenotypic
equality δ = 0 approaches to. As such, it can be thought of as the state space for the average weighted
mutant frequency pα when δ = 0 (see Figure 3). Because (n̂, n̂P ) is hyperbolic and the critical manifold
M0 is compact (the set of points are bounded and closed) consisting of a neutral line of equilibria, it
follows that M0 is compact and a normally hyperbolic invariant manifold (Appendix 6.4.2). Roughly
speaking, invariant manifold is normally hyperbolic if the dynamics near the manifold is governed by the
hyperbolicity condition while the dynamics on the manifold is neutral and thus invariant.
Slow manifold As elucidated above, the critical manifold M0 is compact and normally hyperbolic,
and therefore the results of Fenichel (1971, 1974, 1977, 1979, see also Appendix 6.4 and the references
within) guarantee that a perturbed manifold Mδ , the so-called slow manifold (Hek, 2010; Jones, 1995),
for the mutant-resident dynamics under phenotypic closeness exists, is close to, and has identical stability
properties as M0 (see also Figure 3, bottom panels). This slow manifold Mδ is thus a set of points that
are invariant under the flow of the full mutant-resident dynamics for small but nonzero δ (unlike in M0 ,
however, the points in Mδ are not equilibria), while in the neighborhood of Mδ and M0 the dynamics
of the system (22) are equivalent. In other words, because the dynamics under phenotypic equality given
by (22) approaches the critical manifold M0 , so does the dynamics under phenotypic closeness approach
the slow manifold Mδ (see Figure 3 and also, e.g., Jones 1995, Theorem 3, p. 62 and Theorem 6, p. 74).
Moreover, the dynamics of pα when restricted to M0 (in slow evolutionary time) and the dynamics of
pα when restricted to Mδ or to its neighborhood (in fast and slow time) are also equivalent (see a more
detailed discussion in Appendix 6.4). This result plays a fundamental role in Section 4, where we prove
the “invasion implies substitution”-principle by studying the singularly perturbed slow evolutionary
dynamics of pα .

18

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Figure 3: Top panel: Critical and slow manifolds M0 and Mδ , respectively. The critical manifold M0
is obtained from the mutant-resident dynamics under phenotypic equality (δ = 0) by solving (23) and it
consists of a line (infinite number) of equilibria. For the system (5) where δ is small but nonzero there
exists a slow manifold Mδ , which is close to M0 and has the same dynamical properties as M0 (see
bottom panels). Bottom left panel: The fast population (31) and slow evolutionary (32) dynamics of
the singular system where δ = 0. The thin lines with arrows represent the fast dynamical convergence
given by (31) to M0 (where class-specific mutant frequencies are the weighted frequencies pα ), and the
thick line with arrows represents the slow evolutionary dynamics of pα given by (32) on M0 (in this
example mutant frequency increases from 0 to 1). Bottom right panel: The mutant-resident dynamics
(29) or (30) where δ is small but nonzero. The results of Fenichel (1979) say that since the (fast) dynamics
for δ = 0 (bottom left panel) approaches M0 so does the dynamics for small but non-zero δ approach
Mδ . Moreover, the dynamics of pα on Mδ and its neighborhood, is equivalent of the (slow) dynamics
of pα on M0 (left panel).

19

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

4

Invasion implies substitution

We now prove the “invasion implies substitution”-principle for a model presented in this paper whose
resident dynamics is given in (3). We prove the principle by separating the timescales at which the
various dynamical variables of the mutant-resident model (4) operate by using the weighted average
mutant frequency pα . Because the dynamics of pα is a function of class reproductive values α, mutant
frequencies p, (ancestral) resident densities n and the densities nP of the other resident phenotypes and
the rest of the ecological community, the complete mutant-resident dynamics for arbitrary phenotypic
values zR , zM ∈ Z (δ arbitrary) can be written by extending (5) as:
ṗα = αFsel (zM , zR , zM , p, n, nP )p
α̇ = −αF̄pc (zR , zM , p, n, nP )
(28)

ṗ = F(zM , zR , zM , p, n, nP )p
ṅ = Ḡ(zR , zM , p, n, nP )n
ṅP = R(zR , zM , p, n, nP ),

where we have for clarity included all the arguments. Next, we write the dynamics of (28) under
phenotypic similarity in both fast and slow time, and then obtain two distinct limiting singular equations
(by letting δ go to 0) that can be easily analyzed. Finally, we glue them back together by perturbing the
obtained singular equations. By doing this the singular system (δ = 0) serves as an approximation to a
mutant-resident dynamics under phenotypic similarity (δ small but nonzero) such that all its dynamical
properties are preserved.
Let t denote the fast population dynamical time (the original time used throughout this paper) and let
τ denote the slow evolutionary time (see also Figure 1). Setting τ = δt we obtain the relation dτ = δdt
and then write the mutant-resident dynamics for closely similar phenotypes (δ small but nonzero) either
using the original time variable t
dpα (t)
dt
dα(t)
dt
dp(t)
dt
dn(t)
dt
dnP (t)
dt

= δα

d sel
F (zM )
dδ

p + O(δ 2 )
δ=0

= −α(t)F̄pc
0 + O(δ)
= F̄pc
0 p(t) + O(δ)

(29)

= H(z)n(t) + O(δ)
= P + O(δ)

20

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

or using the new time variable τ
dpα (τ )
dτ
dα(τ )
δ
dτ
dp(τ )
δ
dτ
dn(τ )
δ
dτ
dnP (τ )
δ
dτ
δ

= δα

d sel
F (zM )
dδ

p + O(δ 2 )
δ=0

= −α(τ )F̄pc
0 + O(δ)
= F̄pc
0 p(τ ) + O(δ)

(30)

= H(z)n(τ ) + O(δ)
= P + O(δ).

Since we haven’t yet taken any limits the two systems (29) and (30) are identical, the only difference is
the notation. Let’s now take the limit δ → 0 and obtain two limiting singular equations, one for fast
population dynamical time
dpα (t)
dt
dα(t)
dt
dp(t)
dt
dn(t)
dt
dnP (t)
dt

=0
= −α(t)F̄pc
0
= F̄pc
0 p(t)

(31)

= H(z)n(t)
=P

and the second for slow evolutionary time
dpα (τ )
d
= α Fsel (zM )
dτ
dδ

p
δ=0

0 = −α(τ )F̄pc
0
(32)

0 = F0 p(τ )
0 = H(z)n(τ )
0 = P.

This confirms that in the fast population dynamical time (31) the average mutant frequency pα stays
constant and that the mutant-resident dynamics reaches the critical manifold M0 as found in (27), and
that the algebraic expression for M0 can be obtained directly from (32).
Because the variables α, p, n, nP in (32) have reached their critical manifold M0 , we evaluate the right

21

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

hand side of the first line in (32) at the M0 to obtain

d
α Fsel
dδ


p
δ=0

M0

"

!
#
X ∂
∂ sel
sel
=
αa
f (zM ) +
f (zM )
pM,b
∂zM ab
∂zM,c ab
a
c
b
δ=0
M0
"
#
X X nb ∂
=
αa
hab (z, z, n, nP )pM,b (1 − pM,b )
na ∂z
a
X

X

b

= pα (1 − pα )

(33)

M0

X X α̂a ∂
hab (z, z, n̂, n̂P )n̂b ,
n̂a ∂z
a
b

where we used (13). Therefore, by defining v = (va )a∈D as a vector of reproductive values va =

αa
na

of an

individual in class a ∈ D (see Appendix 6.5 for more details), then at M0 we have
v̂a =

α̂a
,
n̂a

(34)

and using (33) we can write the slow (singular) mutant-resident evolutionary dynamics (32) with a single
equation as
X ∂hab (z)
dpα (τ )
= pα (1 − pα )
n̂b
v̂a
dτ
∂z

(35)

a,b

or in a matrix notation as
∂H(z)
dpα (τ )
= pα (1 − pα )v̂
n̂.
dτ
∂z

(36)

Alternatively, one can express (36) in terms of a probability distribution over all classes, i.e. in terms
P
of class frequencies defined as πa = nna , ∀a ∈ D where n = a na is the total population size. Because
πn = n, where π = (πa )a∈D , one could also scale the individual reproductive values as ν = vn (see
Appendix 6.5) to get
dpα (τ )
∂H(z)
= pα (1 − pα )ν̂
π̂.
dτ
∂z

(37)

The two formulations (36) and (37) are equivalent, each providing a different perspective on the same
evolutionary process. As the matrix H gives the individual growth-rates, the expression in (36) describes
how all (mutant) individuals in different classes contribute to the mutant evolutionary dynamics. In (37),
the focus is on an average carrier of the mutant allele and how that representative individual contributes
to the mutant dynamics when weighted over all classes the carrier of the mutant can be in. The vector
π̂ thus gives the stationary distribution of classes a mutant, which is sampled from the collection of all
mutants (i.e., the mutant lineage), can be in.
Now, whichever formulation (36) or (37) is more convenient, geometric singular perturbation theory
guarantees that after initial convergence, the mutant-resident dynamics (29)-(30) in the neighborhood
of the manifold Mδ is equivalent to (can be approximated by) the dynamics given by the two singular
systems (31) and (32) (see Figure 3 and Appendix 6.4). In particular, the dynamics of the weighted

22

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

mutant frequency pα for small but nonzero δ near Mδ can be approximated by the dynamics given in
(36) and (37) (in Appendix 6.4 the Corollary 3 and the Section 6.4.4). We have thus proved the below
”invasion implies substitution”-proposition and its Corollary, given the following assumption holds.
Assumption (A). Assume that the resident ecological community as defined in (3) contains a hyperbolically stable equilibrium (n̂, n̂P ) ∈ Rm+l to which the resident population converges to and then stays
at.
Invasion implies substitution-proposition. Consider an ecological community with a polymorphic
demographically (physiologically) structured population as defined in (3), and assume that (A) holds.
Suppose that one of the phenotypes in the population undergoes a mutation, and that the mutant phenotype
zM ∈ Z and its ancestral (resident) phenotype zR ∈ Z are closely similar, i.e. δ = zM −zR for some small
δ 6= 0. Then, for sufficiently large time t and/or small δ, the dynamics of the weighted mutant frequency
pα in the resulting mutant-resident ecological community (28) can be approximated on the original time
scale by
dpα (t)
= δpα (1 − pα )S(z) + O(δ 2 ),
dt

(38)

where the frequency-independent selection gradient S(z) can be expressed as
S(z) = v̂

∂H(z, z, n̂, n̂P )
n̂,
∂z

(39a)

or alternatively as
S(z) = ν̂

∂H(z, z, n̂, n̂P )
π̂.
∂z

(39b)

Successful invasion of a mutant implies the substitution of the resident.
Corollary (C). The subset of Z where the assumption (A) holds and where the selection gradient (39)
is nonzero indicates all the possible evolutionary trajectories of the phenotype under selection.

5

Discussion

We provided a proof of an “invasion implies substitution”-principle and gave a positive answer to all three
questions (I)-(III) posed in Section 1 for scalar-valued, polymorphic and well-mixed clonally reproducing
populations that are part of a larger ecological community and that are structured into finitely many
demographic (or physiological) classes.
The separation of ecology and evolution We proved the “invasion implies substitution”-principle
by separating the population dynamical and evolutionary timescales using the weighted average mutant
frequency, and then singularly perturbed the mutant-resident dynamics given as ordinary differential
equations (Fenichel, 1979; Wiggins, 1994; Jones, 1995; Hek, 2010; Kuehn, 2015; Dercole and Geritz, 2016)

23

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

using the phenotypic deviation δ as the perturbation parameter. In this method, which is fully detailed
in Appendix 6.4 for the present context, one proceeds in three steps. First, one must be able to write the
mutant-resident dynamics for small values of δ in a fast-slow form ṗ = δσ(p, x, δ), ẋ = ϕ(p, x, δ), where
p represents a weighted mutant frequency in the population and x should capture all the fast (population
dynamical) variables. In Section 3, however, it became apparent that for small δ all dynamical variables
are fast variables, including class-specific and mean mutant frequencies, and so the model couldn’t readily
be written in the above fast-slow form. The solution here was to introduce a new variable which operates
purely in slow evolutionary time and is a proxy for the mutant frequency. In Section 3.1 we showed that
such a variable is the average mutant frequency weighted by class reproductive values (Taylor, 1990;
Leturque and Rousset, 2002; Rousset, 2004; Lehmann and Rousset, 2014; Engen et al., 2014; Lehmann
et al., 2016).
Once the mutant-resident dynamics is in the fast-slow form, in the second step one starts analyzing
the dynamics of the weighted mutant frequency p. Because studying its dynamics for nonzero δ is a
complicated task, one hopes that the dynamics of the much easier model where δ = 0 could serve as an
approximation for small but nonzero δ. To achieve this, one must first scale time by using δ as the scaling
parameter and then write the mutant-resident dynamics in both fast t and slow time τ = δt while letting
δ go to zero. In this step one thus analyzes two singular systems, one in fast time where p is constant
and x fluctuates according to ẋ = ϕ(p, x, 0), and the other in slow time where x is constant (i.e. is at
the steady state) and p fluctuates according to

d
dτ p

= σ(p, x, 0). For us to be able to draw conclusions

from this singular system the variable x must converge to its steady state in fast time. In our model this
follows directly from the assumption that the resident steady state (n̂, n̂P ) is hyperbolically stable, i.e.
the real part of all eigenvalues of the Jacobian of the linearized resident dynamics are all negative.
In the third and final step one perturbs the above singular equations by applying geometric singular
perturbation results for ordinary differential equations developed in Fenichel (1971, 1974, 1977, 1979).
Provided certain conditions are satisfied, one can then equate the dynamics of the singular equations
where δ = 0 with the original system where δ is small but nonzero (i.e. the perturbed system). Conveniently, the sufficient condition for such a singular perturbation to be possible is that the steady state is
hyperbolic which is true by assumption. Therefore, if invasion implies substitution holds for the singular
system, it holds also for the original (perturbed) mutant-resident dynamics whenever the steady state is
hyperbolic.
The above-mentioned procedure can be applied to more general (demographically) structured models
than the one presented in this paper. First of all, the singular perturbation results in Fenichel (1971, 1974,
1977, 1979) allow a direct generalization of our result to models with attractors other than equilibria,
e.g. to limit cycles where population experiences deterministic periodic fluctuations. Because including
more complicated attractors would require some amount of additional notions (e.g. time-dependent
reproductive values as e.g. discussed in Lion, 2018b) we choose to leave this generalization for future
work. Second, more recent but equivalent results on invariant manifolds for semiflows (Bates et al., 1998,
2000; Kuehn, 2015) accommodate a more general demographic (physiological) structure, in particular,

24

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

allowing for e.g. continuous age or size distributions. However, calculating the hyperbolicity of steady
states is considerably more involved in such cases (Greiner et al., 1994; Gyllenberg, 2007; Kuehn, 2015).
Selection gradient as a map between ecology and evolution The expression for the selection
gradient (39) was obtained directly from the timescale separation argument given in Section 4. We found
that the selection gradient can indeed be written as conjectured in (2), but with relatedness matrix R
playing no role. This is because we assume infinitely large population sizes with no spatial structure
(i.e., a well-mixed population) and hence genealogical relationships between any two individuals do not
affect the direction of selection. Nevertheless, the selection gradient can be written solely in terms of
resident population dynamical variables and resident growth-rates. This is practical since one can then
calculate directly from the resident dynamics which mutations can and cannot fix into the population,
that is, one can calculate the fate of the mutation before the mutation actually takes place. In this sense,
the selection gradient is a ”map” from the ecological to the evolutionary model (see Figure 1).
An analogous selection gradient for large class-structured populations with arbitrary social interactions
in a larger ecological community, and thus having the same biological scope, has been previously derived
in Lion (2018a,b). The model and the method obtaining the selection gradient however depart from ours
in that in Lion (2018a,b) the polymorphism is assumed tightly clustered around its mean and that the
dynamical equations were formulated in terms of change in mean phenotype. Such a formulation provides
links between the dynamics of the mean trait value and the “invasion implies substitution”-principle and
is thus complementary to our approach. The drawback in this approach, however, is that the timescale
of dynamical variables such as class-specific mutant frequencies is not easily accessible. Consequently,
in particular our results on the critical manifold M0 (Section 3.2), allows us to confirm that as the
class-specific trait variance is proportional to the class-specific mutant frequencies, it is indeed a fast
variable approaching the population mean trait variance, a result that was left open in Lion (2018a). We
conjecture that the ideas on tightly clustered phenotypes developed in Meszéna et al. (2005) together
with the results derived in this paper fully justify the selection gradient presented in Lion (2018a,b).
Long-term evolutionary dynamics The main implication of the “invasion implies substitution”principle is that it indicates the set of phenotypes that can invade and substitute their ancestral phenotypes, thus providing a tool to study the long-term evolutionary dynamics of the trait under selection
(panel C in Figure 1 and Corollary in Section 4). The sequential invasion and substitution can occur
whenever the steady state is hyperbolic, thus excluding the possibility of bifurcations that may lead to
catastrophic extinctions, and whenever the selection gradient S(z) is nonzero, i.e. as long as we are
away from the extrema of the adaptive landscape. Such extrema identify the phenotypic values where
invasion no longer implies substitution and where more complicated evolutionary behaviour can occur
(Geritz et al., 1998; Priklopil, 2012; Dercole and Geritz, 2016). Nevertheless, because we have formulated
our model for arbitrarily polymorphic resident populations, the “invasion implies substitution”-principle
holds whenever the selection gradient is non-zero (and the steady state is hyperbolic). This is particularly
true after evolutionary dynamics converges and escapes a phenotypic value that is a branching point:

25

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

“invasion implies substitution”-principle governs the direction of evolution even after the appearance of
new morphs.

5.1

Conclusions

This study is part of a quest aiming at generalizing and formalizing the hypothesis that social traits under frequency and/or density dependent selection are generically subject to directional gradual change,
whenever mutations cause only small deviations to the phenotype under selection (and in the absence of
genetic constraints). Further, directional selection should be quantifiable by a selection gradient that consist of reproductive value and relatedness weighted fitness differentials. In this study this hypothesis was
confirmed for well-mixed ecological communities with demographically (physiologically) class-structured
populations. Our results are directly applicable to several well-known models, such as SIR-models in
epidemiology and stage-structured models in life-history studies, and will be generalized to spatially
structured population with limited disperal in a forthcoming study.

5.2

Acknowledgments

The work of LL was supported by the Swiss NSF grant PP00P3-123344.

26

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

References
N.H. Barton and M. Turelli. Natural and sexual selection on many loci. Genetics, 127(1):229–255, 1991.
P.W. Bates, K. Lu, and C. Zeng. Existence and persistence of invariant manifolds for semiflows in
Banach space, volume 645. American Mathematical Soc., 1998.
P.W. Bates, K. Lu, and C. Zeng. Invariant foliations near normally hyperbolic invariant manifolds for
semiflows. Transactions of the American Mathematical Society, 352(10):4641–4676, 2000.
B. Charleworth. Evolution in age-structured populations. Cambridge University Press Cambridge, 1994.
R. Dawkins. Climbing mount improbable. WW Norton & Company, 1997.
F. Dercole. The ecology of asexual pairwise interactions: The generalized law of mass action. Theoretical
Ecology, 9(3):299–321, 2016.
F. Dercole and S.A.H. Geritz. Unfolding the resident–invader dynamics of similar strategies. Journal of
Theoretical Biology, 394:231–254, 2016.
F. Dercole and S. Rinaldi. Analysis of evolutionary processes: the adaptive dynamics approach and its
applications. Princeton University Press, 2008.
O. Diekmann. A beginners guide to adaptive dynamics. Summer School on Mathematical Biology, pages
63–100, 2002.
O. Diekmann, M. Gyllenberg, J.A.J. Metz, and H.R. Thieme. On the formulation and analysis of general
deterministic structured population models I. linear theory. Journal of Mathematical Biology, 36(4):
349–388, 1998.
O. Diekmann, M. Gyllenberg, H. Huang, M. Kirkilionis, J.A.J. Metz, and H.R. Thieme. On the formulation and analysis of general deterministic structured population models II. nonlinear theory. Journal
of Mathematical Biology, 43(2):157–189, 2001.
M. Durinx, J.A.J. Metz, and G. Meszéna. Adaptive dynamics for physiologically structured population
models. Journal of Mathematical Biology, 56(5):673–742, 2008.
S. Engen, T. Kvalnes, and B. Sæther. Estimating phenotypic selection in age-structured populations by
removing transient fluctuations. Evolution, 68(9):2509–2523, 2014.
I. Eshel. Evolutionary and continuous stability. Journal of Theoretical Biology, 103(1):99–111, 1983.
S. Estrela, E. Libby, J. Van Cleve, F. Débarre, M. Deforet, W. R Harcombe, J. Peña, S. P. Brown, and
M.E. Hochberg. Environmentally mediated social dilemmas. Trends in Ecology & Evolution, 2018.
S.N. Ethier and T. Nagylaki. Diffusion approximations of markov chains with two time scales and
applications to population genetics. Advances in Applied Probability, 12(1):14–49, 1980.

27

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

S.N. Ethier and T. Nagylaki. Diffusion approximations of markov chains with two time scales and
applications to population genetics, ii. Advances in Applied Probability, 20(3):525–545, 1988.
N. Fenichel. Persistence and smoothness of invariant manifolds for flows. Indiana University Mathematics
Journal, 21(3):193–226, 1971.
N. Fenichel. Asymptotic stability with rate conditions. Indiana University Mathematics Journal, 23(12):
1109–1137, 1974.
N. Fenichel. Asymptotic stability with rate conditions, ii. Indiana University Mathematics Journal, 26
(1):81–93, 1977.
N. Fenichel. Geometric singular perturbation theory for ordinary differential equations. Journal of
Differential Equations, 31(1):53–98, 1979.
R. Ferriere. Adaptive responses to environmental threats: evolutionary suicide, insurance, and rescue.
Options Spring, 2000:12–16, 2000.
S.A.H. Geritz. Resident-invader dynamics and the coexistence of similar strategies. Journal of Mathematical Biology, 50(1):67–82, 2005.
S.A.H. Geritz, É. Kisdi, G. Meszéna, and J.A.J. Metz. Evolutionarily singular strategies and the adaptive
growth and branching of the evolutionary tree. Evolutionary Ecology, 12(1):35–57, 1998.
S.A.H. Geritz, M. Gyllenberg, F.J.A. Jacobs, and K. Parvinen. Invasion dynamics and attractor inheritance. Journal of Mathematical Biology, 44(6):548–560, 2002.
A. Grafen. Biological fitness and the price equation in class-structured populations. Journal of Theoretical
Biology, 373:62–72, 2015.
G. Greiner, J.A.P. Heesterbeek, and J.A.J. Metz. A singular perturbation theorem for evolution equations
and time-scale arguments for structured population models. Canadian Applied Mathematics Quarterly,
3(4):435–459, 1994.
M. Gyllenberg. Mathematical aspects of physiologically structured populations: the contributions of
J.A.J. Metz. Journal of Biological Dynamics, 1(1):3–44, 2007.
M. Gyllenberg and K. Parvinen. Necessary and sufficient conditions for evolutionary suicide. Bulletin of
Mathematical Biology, 63(5):981–993, 2001.
W.D. Hamilton. The genetical evolution of social behaviour. I. Journal of Theoretical Biology, 7(1):1–16,
1964.
W.D. Hamilton. This week’s citation classic. Current Contents, 40:16, 1988.
G. Hek. Geometric singular perturbation theory in biological practice. Journal of Mathematical Biology,
60(3):347–386, 2010.

28

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

M.W. Hirsch, R.L. Devaney, and S. Smale. Differential equations, dynamical systems, and linear algebra,
volume 60. Academic press, 1974.
M.W. Hirsch, C.C. Pugh, and M. Shub. Invariant manifolds, volume 583. Springer, 1977.
C.K.R.T. Jones. Geometric singular perturbation theory. In Dynamical systems, pages 44–118. Springer,
1995.
M. Kirkpatrick, T. Johnson, and N. Barton. General models of multilocus evolution. Genetics, 161(4):
1727–1750, 2002.
C. Kuehn. Multiple time scale dynamics, volume 191. Springer, 2015.
L. Lehmann. Stochastic demography and the neutral substitution rate in class-structured populations.
Genetics, 197:351–360, 2014.
L. Lehmann and F. Rousset. The genetical theory of social behaviour. Philosophical Transactions of the
Royal Society B: Biological Sciences, 369(1642):20130357, 2014.
L. Lehmann, C. Mullon, E. Akcay, and J. Van Cleve. Invasion fitness, inclusive fitness, and reproductive
numbers in heterogeneous populations. Evolution, 70(8):1689–1702, 2016.
H. Leturque and F. Rousset. Dispersal, kin competition, and the ideal free distribution in a spatially
heterogeneous population. Theoretical Population Biology, 62(2):169–180, 2002.
S. Lion. From the price equation to the selection gradient in class-structured populations: a quasiequilibrium route. Journal of Theoretical Biology, 447:178–189, 2018a.
S. Lion. Class structure, demography, and selection: reproductive-value weighting in nonequilibrium,
polymorphic populations. The American Naturalist, 191(5):620–637, 2018b.
G. Meszéna, M. Gyllenberg, F.J.A. Jacobs, and J.A.J. Metz. Link between population dynamics and
dynamics of darwinian evolution. Physical Review Letters, 95(7):078105, 2005.
J.A.J. Metz. Thoughts on the geometry of meso-evolution: collecting mathematical elements for a
postmodern synthesis. In The Mathematics of Darwin’s Legacy, pages 193–231. Springer, 2011.
J.A.J. Metz and C.G.F. de Kovel. The canonical equation of adaptive dynamics for mendelian diploids
and haplo-diploids. Interface Focus, 3(6):20130025, 2013.
J.A.J. Metz and O. Diekmann. The dynamics of physiologically structured populations, volume 68.
Springer, 1986.
J.A.J. Metz, S.A.H. Geritz, G. Meszéna, F.J.A. Jacobs, and J.S. Van Heerwaarden. Adaptive dynamics:
a geometrical study of the consequences of nearly faithful reproduction. IIASA Working Paper, 1995.
T. Nagylaki. Dynamics of density-and frequency-dependent selection. Proceedings of the National
Academy of Sciences, 76(1):438–441, 1979.

29

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

K. Parvinen. Evolution by natural selection to extinction. Evolutionary Ecology Research, 17(6):743–756,
2016.
L. Pásztor, Z. Botta-Dukát, G. Magyar, T. Czárán, and G. Meszéna. Theory-based ecology: a Darwinian
approach. Oxford University Press, 2016.
T. Priklopil. On invasion boundaries and the unprotected coexistence of two strategies. Journal of
Mathematical Biology, 64(7):1137–1156, 2012.
F. Rousset. Genetic structure and selection in subdivided populations. Princeton Univ. Press, Princeton,
2004.
F. Rousset. Separation of time scales, fixation probabilities and convergence to evolutionarily stable
states under isolation by distance. Theoretical Population Biology, 69(2):165–179, 2006.
F. Rousset and S. Billiard. A theoretical basis for measures of kin selection in subdivided populations:
finite populations and localized dispersal. Journal of Evolutionary Biology, 13(5):814–825, 2000.
F. Rousset and O. Ronce. Inclusive fitness for traits affecting metapopulation demography. Theoretical
Population Biology, 65(2):127–141, 2004.
D. Roze and F. Rousset. Selection and drift in subdivided populations: a straightforward method for
deriving diffusion approximations and applications involving dominance, selfing and local extinctions.
Genetics, 165(4):2153–2166, 2003.
D. Roze and F. Rousset. The robustness of Hamilton’s rule with inbreeding and dominance: kin selection
and fixation probabilities under partial sib mating. The American Naturalist, 164(2):214–231, 2004.
M. Slatkin. Inbreeding coefficients and coalescence times. Genetics Research, 58(2):167–175, 1991.
J. W. Stubblefield and J. Seger. Local mate competition with variable fecundity: dependence of offspring
sex ratios on information utilization and mode of male production. Behavioral Ecology, 1(1):68–80,
1990.
P.D. Taylor. Allele-frequency change in a class-structured population. The American Naturalist, 135(1):
95–106, 1990.
P.D. Taylor and S.A. Frank. How to make a kin selection model. Journal of Theoretical Biology, 180(1):
27–37, 1996.
J. Van Cleve, M.W. Feldman, and L. Lehmann. How demography, life history, and kinship shape the
evolution of genomic imprinting. The American Naturalist, 176(4):440–455, 2010.
J. Wakeley. Polymorphism and divergence for island-model species. Genetics, 163(1):411–420, 2003.
J. Wakeley and T. Takahashi. The many-demes limit for selection and drift in a subdivided population.
Theoretical Population Biology, 66(2):83–91, 2004.

30

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

J.W. Weibull. Evolutionary Game Theory. Massachusetts Institute of Technology, 1995.
S. Wiggins. Normally hyperbolic invariant manifolds in dynamical systems, volume 105. Springer Science
& Business Media, 1994.
S. Wright. Evolution in mendelian populations. Genetics, 16(2):97, 1931.

31

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

6
6.1

Appendix
Relative growth-rate for arbitrary phenotypes

In the main text, we derived the dynamics for class-specific mutant frequencies (5)-(8), where we obtained
a partition for the relative growth-rate matrix for a (single) mutant F(zM ) = Fsel (zM ) + F̄pc , with a term
F̄pc that is independent of the phenotype of the (single) mutant. Here, we confirm that such a partition
exists independently of the phenotype of the individual whose relative growth-rate we are considering
by proceeding the same way as in the main text, except that we don’t specify the phenotype of the
individual whose relative growth-rate we are calculating. That is, we have


d nX,a
ṅX,a na − nX,a ṅa
=
dt
na
n2a
1
=
[ṅX,a − pX,a ṅa ]
na
X nb
X nb

gab (zM )pM,a + gab (zR )pR,a
gab (zX )pX,b − pX,a
=
na
na
b
b
X nb
X nb
=
gab (zX )pX,b − pX,a
ḡab
na
na
b
b
X nb
X nb
X nb
X nb
=
gab (zX )pX,b − pX,b
ḡab + pX,b
ḡab − pX,a
ḡab
na
na
na
na
b
b
b
b
X nb
X nb
X nb
=
[gab (zX ) − ḡab ] pX,b + pX,b
ḡab − pX,a
ḡab
na
na
na

ṗX,a =

b

b6=a

(40)

b6=a

for all a ∈ D, where ḡab = gab (zM )pM,b + gab (zR )pR,b and X ∈ {M, R}. Defining p := pM and 1 − p := pR
as the vector of class-specific mutant and resident frequencies, respectively, we can write
ṗX = F(zX )pX


= F̄pc (zX ) + F̄pc pX ,

(41)

where the entries of F̄pc (zX ) and F̄pc (zX ), respectively, are
fabsel (zX ) =
f¯abpc =

nb
[gab (zX ) − ḡab ]
na


 nb ḡab
na


− P
c6=a

nc
na ḡac ,

(42)

∀b 6= a
for b = a.

Notice that the component that gives the rates at which passive changes occur F̄pc is the same for both
mutant and resident phenotypes. In fact, an analogous expression can be derived for any polymorphism
P
as long as 1 = X pX,a for all a ∈ D.

6.2

Mean mutant frequency pM and the dynamics of class frequencies

In the main text, we showed that class-specific mutant frequencies p are both fast population dynamical
and slow evolutionary variables. More precisely, we showed that under phenotypic equality (δ = 0) the

32

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

dynamics is dominated by the terms of order O(1) (Section 3) and that p approaches a line of equilibria
where p̂M,a = p for all a ∈ D, after which the dynamics is dominated by the terms of order O(δ) along this
line of equilibria (Section 3.2). Here, we confirm that the same applies for the mean mutant frequency
P
in the total population pM = πp = a πa pM,a .
To confirm this, it is sufficient to show that π approaches in fast population dynamical time an isolated
equilibrium which persist under perturbation of δ. If this is so, then the dynamics of pM is first dominated
by the terms of order O(1) and then of order O(δ) and we get our claim. This is checked immediately from
the following Section 6.2.1 where we detail the dynamics of class frequencies: because by assumption the
steady state n̂ is hyperbolic so is the steady state π̂ in (51) (and thus it persists under perturbations).
6.2.1

The dynamics in terms of class frequencies

In this section we will re-write the resident dynamics (3) and the relative mutant-resident dynamics (5)
in terms of total population densities and class frequencies which are respectively defined as
n=

X

na

a∈D

na
,
πa =
n

(43)
a ∈ D.

Note that since n is a scalar we have the relation
nπ = n.

(44)

Resident dynamics The dynamics of the total density is obtained by using (43) and by differentiation
ṅ =

X

na =

a

XX
a

hab (z)nb =

XX
a

b

where r(z) := r(z, z, n, π, nP ) =

P P
a

hab (z)πb n = r(z)n

(45)

b

b

hab (z)πb is the total mean growth-rate of an individual in

the resident population. The dynamics of class frequencies is obtained by using (43), (45), and by
differentiation
π̇a =

ṅ X 1
ṅa
− πa =
hab (z)nb − r(z)πa
n
n
n
b

=

X

hab (z)πb − r(z)πa ,

∀a ∈ D,

(46)

b

or in a matrix notation
π̇ = (H(z) − r(z)I) π,

(47)

33

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

where I is the identity matrix. We have thus obtained that the resident dynamics (3) can be rewritten
as
ṅ = r(z)n
(48)

π̇ = (H(z) − r(z)I) π
ṅP = P

Relative mutant-resident dynamics Using (5) and an analogous derivation to the previous section,
we obtain for the relative mutant-resident dynamics
ṗ = F(zM )p
ṅ = r̄n
(49)

π̇ = Ḡ − r̄I π
ṅP = R
where r̄ =

P P

+ ḡab pR,b ]πb is the total mean growth-rate of an individual in the total
P P
n
population. Notice that alternatively r̄ = a b [ḡab (zM )qM,b + ḡab qR,b ], where qX,a = X,a
n is the proba

b [ḡab (zM )pM,b

ability that given an individual is sampled from the total population it is an individual in class a ∈ D
with phenotype zX ∈ {zM , zR }.
Steady state under phenotypic equality In section 3.2, we found that the steady state n̂ = n̂M + n̂R
under phenotypic equality δ = 0 can be solved from
0 = H(z, z, n̂, n̂P )n̂,

(50)

and is thus the right eigenvector of the resident matrix H(z, z, n̂, n̂P ) associated with the eigenvalue
0. Here, we are interested to express the steady state under phenotypic equality in terms of the total
population size n and class frequencies π. Using Section 2.3, we have
ṅ = r̄

n = r(z)n

π̇ = Ḡ − r̄I δ=0 π = (H(z) − r(z)I) π,
δ=0

(51)

where the (non-trivial) solutions n̂ and π̂ are obtained from
0 = r(z, z, n̂, π̂, n̂P )

(52)

0 = (H(z) − r(z, z, n̂, π̂, n̂P )I) π̂.
Using (44) the steady state can be written as
(n̂, π̂) = (n̂,

34

n̂
).
n̂

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Note that because r(z) in-front of the identity matrix in (51) is scalar-valued, both n̂ and π̂ are the right
eigenvectors of H(z, z, n̂, n̂P ) associated with the eigenvalue 0 (this is in fact obvious since we have the
relation nπ = n, i.e. an eigenvector scaled by a scalar is also an eigenvector associated with the same
eigenvalue).

6.3

Infinite number of equilibria in M0

Here, we give an argument as to why the singular system δ = 0 contains infinite number of equilibria.
P
Because f¯aapc = − b6=a f¯abpc the matrix F̄pc is a transition matrix with an eigenvalue 0. Because the
eigenvalue is solved from 0 = det[F̄pc − 0 · I] = det[F̄pc ], the determinant of F̄pc is zero implying that
it is not an invertible matrix and hence F̄pc p doesn’t have a unique isolated solution p (see e.g. Hirsch
et al., 1974, Proposition on p. 80).

6.4

Fenichel’s Theorems

Here, we go through in detail the results of Fenichel (1971, 1974, 1977, 1979) that are relevant for the
“invasion implies substitution”-principle so that our paper is self-contained. This section can be seen as
a general recipe on how to translate any mutant-resident dynamical system (that is expressed in terms
of ordinary differential equations) into a singular perturbation problem, and how the theory of Fenichel
allows us to obtain a complete description of the dynamics for the mutant frequency in the full mutantresident model where δ is small but nonzero. We will in most part follow the exposition of Jones (1995);
Hek (2010)(with a small dose of Kuehn, 2015).
The full mutant-resident dynamical model (arbitrary δ) as given in (28) is our starting point
ṗα = αFsel (zM , zR , zM , p, n, nP )p
α̇ = −αF̄pc (zR , zM , p, n, nP )
(53)

ṗ = F(zM , zR , zM , p, n, nP )p
ṅ = Ḡ(zR , zM , p, n, nP )n
ṅP = R(zR , zM , p, n, nP ).
This system can be equivalently written as
ṗα = s(pα , x, δ)

(54)

ẋ = φ(pα , x, δ)
where pα ∈ [0, 1] ⊂ R1 , x = (α, p, n, nP ) ∈ RN
+ (with N = 3m + l), and where
s(pα , x, δ) = αFsel (zM , zR , zM , p, n, nP )p

φ(pα , x, δ) = −αF̄pc (zR , zM , p, n, nP ), F(zM , zR , zM , p, n, nP )p, Ḡ(zR , zM , p, n, nP )n, R(zR , zM , p, n, nP ) .
(55)

35

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

(H1) The functions s, φ are sufficiently smooth.
Given (H1) the Taylor expansion of (54) about δ = 0 is
ṗα = δσ(pα , x, δ)

(56)

ẋ = ϕ(pα , x, δ),
where
σ(pα , x, δ) =

d
s(pα , x, δ)
dδ

+ O(δ)
δ=0

d
ϕ(pα , x, δ) = φ(pα , x, 0) + δ φ(pα , x, δ)
dδ
6.4.1

(57)
2

+ O(δ ).
δ=0

The relative mutant-resident dynamics

As in the main text, let t be the fast (population dynamical) time and τ = δt the slow (evolutionary)
time. For simplicity we will use a dot for the time derivative in fast time (as in the main text) and a
comma for the time-derivative in slow time.
The original (perturbed) fast and slow system We can write, for small but nonzero δ, the system
(56) in both fast and slow time as
ṗα = δσ(pα , x, δ)

(58)

ẋ = ϕ(pα , x, δ),
and
p0α = σ(pα , x, δ)

(59)

δx0 = ϕ(pα , x, δ),
together with (57), and we re-iterate that pα ∈ [0, 1] ⊂ R1 and x ∈ RN
+ (with N = 3m + l).

The singular fast and slow system By taking the limit δ → 0 and by applying (57) we obtain two
singular sets of equations for both fast and slow time:
ṗα = 0

(60)

ẋ = ϕ(pα , x, 0) = φ(pα , x, 0)
and
p0α = σ(pα , x, 0) =

d
s(pα , x, δ)
dδ

δ=0

(61)

0 = ϕ(pα , x, 0) = φ(pα , x, 0).

36

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

6.4.2

Fenichel’s Theorems 1 and 2

Throughout, whenever we are referring to a distance between two nonempty sets we use the notion of
Hausdorff distance (see e.g. Kuehn, 2015, p. 55).
Critical manifold The set of critical (equilibrium) points ϕ(pα , x, 0) = 0 is obtained by solving
N equations yielding an 1-dimensional manifold. That is, the set of critical (equilibrium) points is
parametrized by pα . We will denote a (biologically relevant) subset of those points with
M0 ⊂ { (pα , x) | ϕ(pα , x, 0) = 0 },

(62)

which is the critical manifold mentioned in the main text. The manifold M0 is normally hyperbolic
because (by assumption) the linearization of (58) at each point in M0 has exactly one eigenvalue on the
imaginary axis (Jones, 1995, Definition 1, p. 49). This means that the dynamics in the neighborhood of
this manifold is governed by the non-zero eigenvalues and the flow on the manifold is governed by the
zero eigenvalue, i.e. the dynamics on the manifold is neutral (each point is mapped to itself). Note also
that since [0, 1] is compact the following hypothesis holds throughout.
(H2) The set M0 is compact and normally hyperbolic. Moreover, the linearization of (58) at each
point in M0 has exactly one eigenvalue on the imaginary axis and N eigenvalues on the left-side of the
imaginary axis (i.e. the manifold M0 is locally asymptotically stable).
The following theorem is an adaptation from Jones (1995, Theorem 1, p. 49) and Hek (2010, Theorem
2, p. 354).
Fenichel’s Invariant Manifold Theorem 1. Assuming (H1) and (H2), for δ non-zero but sufficiently
small, there exists a (slow) manifold Mδ that lies within O(δ) of M0 and is diffeomorphic to M0 .
Moreover, it is invariant under the flow of (58).
Remarks: i) Diffeomorphism guarantees that (58) restricted to Mδ is a small perturbation away from
(61) (Hek, 2010, see the final paragraph on p. 354); ii) This theorem has been also given in Hirsch et al.
(1977). iii) Note that at the moment we only know about the flow on the manifold Mδ and not in the
neighborhood of the manifold (which will be addressed in the following theorem). iv) Jones (1995) uses
the concept of local invariance. This concept, however, is not needed in our model because our critical
manifold has a boundary which can’t be crossed by any trajectory (Jones, 1995, see the final paragraph
on p. 49): the two boundaries of M0 are pα = 0 and pα = 1 which are always (for any model and for
any parameter values) invariant.
The following version of the theorem is an adaptation from (Jones, 1995, Theorem 3, p. 62) and (Hek,
2010, Theorem 4, p. 359).
Fenichel’s Invariant Manifold Theorem 2. Assuming (H1) and (H2), for δ non-zero but sufficiently
small, there exists a stable manifold W s (Mδ ) that is diffeomorphic to and lies within O(δ) of W s (M0 ).
Moreover, W s (Mδ ) is invariant under the flow of (58).
37

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Remarks: i) The stable manifolds W s (M0 ) and W s (Mδ ) are N + 1-dimensional. ii) The solutions in
W s (Mδ ) decay to Mδ at an exponential rate (see the next theorem and corollaries), but not to any
specific point. iii) The above theorem holds when we are in a sufficiently close neighborhood of Mδ (this
is being dealt with in Section 6.4.3).

6.4.3

Fenichel’s Theorem 3 and its Corollaries

In this section we will discuss the relative mutant-resident dynamics in the neighborhood D of Mδ (and
hence in the neighborhood of M0 ). A normally hyperbolic critical manifold M0 , by definition, consists
of critical points y0 (where y = (pα , x) and the subscript 0 denotes that the point y is in M0 ), each of
which has its own stable manifold W s (y0 ), which is N -dimensional (Hek, 2010, p. 372, Section 6). We
thus have
W s (M0 ) = ∪y0 ∈M0 W s (y0 ).

(63)

The point y0 ∈ M0 is called a base point and the manifolds W s (y0 ) are fibers of W s (M0 ). Note that in
the previous Theorem 2 we saw that W s (M0 ) perturbs to W s (Mδ ). The question is whether W s (y0 )
also perturbs to an analogues object. This is not obvious because whereas the point y0 is invariant and
so is W s (y0 ), its counterpart W s (yδ ) for yδ ∈ Mδ is not invariant and so isn’t yδ (cause yδ in general
isn’t an equilibrium). However, as discussed in Hek (2010, second and third paragraph on p. 376, Section
6.1.), the whole family W s (Mδ ) is invariant in the sense of the following theorems and corollaries.
Let’s restrict our attention to the neighborhood D of Mδ , where we can safely assume that the linear
terms (eigenvalues) of (58) dominate the dynamics. Lets focus on the trajectories in W s (Mδ ) that are in
the neighborhood D. Let y · t denote the application of a flow after time t to an initial point y. Similarly,
A · t denotes the application of the flow after time t to a set A, and y · [t1 , t2 ] is the resulting trajectory
if the flow is applied over the interval [t1 , t2 ] (Hek, 2010, Section 6.1.).
The following definition is an adaptation from Hek (2010, Definition on p. 376) and Jones (1995, Definition
3 on p. 74).
Definition The forward evolution of a set A ⊂ D restricted to D is given by the set
A ·D t = {y · t | y ∈ A and y · [0, t] ⊂ D}.

(64)

The following version of the theorem is an adaptation from Jones (1995, Theorem 6, p. 74) and Hek
(2010, Theorem 8, p. 376 and Figures in Section 6.1.).
Fenichel’s Invariant Manifold Theorem 3. Assume (H1)-(H2). For every yδ ∈ Mδ , there is an
N -dimensional manifold
W s (yδ ) ⊂ W s (Mδ )

(65)

38

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

that is O(δ) close and diffeomorphic to W s (y0 ). The family {W s (yδ ) | yδ ∈ Mδ } is invariant in the
sense that
W s (yδ ) ·D t ⊂ W s (yδ · t)

(66)

if yδ · r ∈ D for all r ∈ [0, t].
Remark: This somewhat abstract theorem is nicely depicted in a diagram in Hek (2010, p. 377).
The following version of the corollary is an adaptation from Jones (1995, Corollary 1, p. 76) and Hek
(2010, Corollary 9, p. 377).
Corollary 1. There are constants κ, β > 0 so that if y ∈ W s (yδ ) ∩ D, then
||y · t − yδ · t|| ≤ κ exp[−βt]

(67)

for all t ≥ 0 for which y · [0, t] ⊂ D and yδ · [0, t] ⊂ Mδ .
The following corollary immediately follows (Hek, 2010, see the discussion after Corollary 9, p. 378):
Corollary 2. Suppose that y ∈ W s (Mδ ) has a base point yδ ∈ Mδ , then
||y · t∗ − yδ · t∗ || ≤ Cδ,

∀t∗ ≥ β −1 log

κ
.
Cδ

(68)

This means that we can find a point in time t∗ after which the distance between any two points, one
point on Mδ and the other in the neighborhood D, is of distance O(δ). Note the resemblance of this
inequality to Nagylaki (1979, equation (37) on p. 440).
Finally, the following Corollary 3 is central in equating the mutant-relative dynamics for small non-zero
δ in fast (original) time t to the dynamics obtained for the singular system in fast time τ . This follows
from the previous Corollaries 1 and 2 by realizing that instead of talking about forward evolution of
points we may talk directly about trajectories (Hek, 2010, see the final paragraph of Section 6.1.):
Corollary 3. Associated to a trajectory γ(t; y) ⊂ W s (Mδ ), there is trajectory γδ (t; yδ ) ⊂ Mδ , with
γ(0; y) = y and γδ (0; yδ ) = yδ , such that
||γ(t; y) − γδ (t; yδ )|| ≤ Cδ,

∀t ≥ β −1 log

κ
.
Cδ

(69)

Remark: This Corollary gives the justification for the bottom right panel of Figure 3: the trajectory
γδ (t; yδ ) is the trajectory on the slow manifold Mδ , and the trajectory γ(t; y) is the one in the neighborhood of Mδ that is approaching Mδ and the trajectory γδ (t; yδ ).

39

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

6.4.4

Relating the slow-time singular system (36)-(37) to Equation (1)

From Theorem 1, we obtained that Mδ and M0 are O(δ)-distance away, that is, with some abuse of
notation, we got
yδ = y0 + O(δ),

(70)

which in the model (53) reads as
n̂δ = n̂0 + O(δ),

n̂P,δ = n̂P,0 + O(δ),

p̂δ = p̂0 + O(δ),

where p̂ = (p, . . . , p)

α̂δ

= α̂0 + O(δ)
(71)

pα,δ = α̂0 p̂0 + O(δ).
Here, the subscript δ and 0 denote that those variables take values on Mδ and M0 , respectively. Then,
using Corollary 2, we have that the estimates (70) and (71) hold ∀t ≥ β −1 log
yD = y0 + O(δ),

κ
Cδ ,

i.e.
(72)

which in the model (53) reads as
n̂D = n̂0 + O(δ),

n̂P,D = n̂P,0 + O(δ),

p̂D = p̂0 + O(δ),

where p̂0 = (p, . . . , p)

α̂D

= α̂D + O(δ)
(73)

pα,D = α0 p̂0 + O(δ),
∀t ≥ β −1 log

κ
Cδ ,

where we use the subscript D to denote that y takes a value in D. Moreover, by Taylor

expansion we also have ∀t ≥ β −1 log
∂H(z)
∂z

=
D

∂H(z)
∂z

M0

κ
Cδ

that

+ O(δ).

(74)

Now, in the main text (36) (or alternatively (37)) we derived for the slow singular system δ = 0 an
equation
p0α = pα (1 − pα )v̂

∂H
n̂,
∂z

(75)

and by using (72)-(74) and the Corollary 3 we have that pα in the neighborhood D of Mδ can be written
in slow evolutionary time τ as
p0α = pα (1 − pα )v̂

∂H
n̂ + O(δ)
∂z

(76)

and therefore in fast original time t as
ṗα = δpα (1 − pα )v̂

∂H
n̂ + O(δ 2 ),
∂z

(77)

40

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

whenever t ≥ β −1 log

κ
Cδ

(which can also be written in terms of τ ). This gives a full justification to

equation (1) in the main text.

6.5

Individual reproductive values

This exposition in this Appendix is motivated by Lion (2018b) who, in contrast to standard practice in
calculating the reproductive values only at the steady state, defined the reproductive values in both fast
population dynamical as well as slow evolutionary time. We, however, depart from the exposition of Lion
(2018b) by deriving a dynamical equation (analogues to the one in Lion (2018b)) for an alternatively
scaled definition for individual reproductive value. Moreover, in the final Section 6.5.4 we show an
alternative derivation for the dynamics of the weighted mutant frequency pα by using such individual
reproductive values.
In e.g., Taylor (1990); Rousset and Ronce (2004); Lion (2018b) the individual reproductive values are
defined as
νa =

αa
,
πa

∀a ∈ D;

(78a)

namely, such that they satisfy the normalization
ν ·π =

X

νa πa = 1.

(78b)

a

(recall that
va =

P

a

αa = 1). Here, we also use the following definition

αa
,
na

∀a ∈ D,

(78c)

and owing to νa πa = va na , ∀a ∈ D, we have
ν ·π =

X

νa πa = 1

a

v·n=

X

(79)
va na = 1,

a

where ν, v are the vectors of νa and va , respectively. Also, recall that πa n = na and hence
πn = n
(80)
ν = vn.

41

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

6.5.1

The dynamics of va

By differentiation we obtain
1
1
α̇a − va ṅa
na
n
" a
#
X
X nb
1
na
1 X
=−
αb ḡba − αa
ḡab − va
ḡab nb
na
nb
na
na
b
b
b
X
X nb
X nb
vb ḡba + va
=−
ḡab − va
ḡab
na
na
b
b
b
X
vb ḡba , ,
∀a ∈ D,
=−

v̇a =

(81)

b

which can be expressed with a matrix notation as
v̇ = −vḠ.
6.5.2

(82)

The dynamics of νa

Using (8), Section 6.2.1, and performing a similar calculation to above, we obtain
1
1
α̇a − νa π̇a
πa
πa
#
"
#
"
X αb na
αa X nb
νa X
ḡba +
ḡab −
ḡab πb − r̄πa
= −
πa n b
πa
na
πa
b
b
b
X
=−
νb ḡba + νa r̄

ν̇a =

(83)

b

which can be expressed with a matrix notation as

ν̇ = −ν Ḡ − r̄I .
6.5.3

(84)

Individual reproductive values va and νa as left eigenvectors

Using (82) and Section 2.3 the slow evolutionary time definition of v under phenotypic equality δ = 0 is
0 = v̂H(z, z, n̂, n̂P ),

(85)

that is, v̂ is the left eigenvector of the resident matrix H(z, z, n̂, n̂P ) associated with the eigenvalue 0.
Similarly, the slow evolutionary time definition of ν under phenotypic equality δ = 0 is
0 = ν̂ (H(z, z, n̂, n̂P ) − rI) ,

(86)

and because the identity matrix is multiplied by a scalar, the solution to above is equivalent to solving
0 = ν̂H(z, z, n̂, n̂P ),

(87)

42

bioRxiv preprint doi: https://doi.org/10.1101/773580; this version posted October 10, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

hence both ν̂ and v̂ are the left eigenvectors of the resident matrix H(z, z, n̂, n̂P ) associated with the
eigenvalue 0. Moreover, from (80) we have
ν̂ = n̂v̂.
6.5.4

(88)

The dynamics of the weighted mutant frequency using individual reproductive values

Here we show a more direct calculation for the dynamics of the weighted mutant frequency pα . Because
αp =

X
a

αa

X
nM,a
=
va nM,a = vnM
na
a

(89)

we have
pα = αp = vnM = pv .

(90)

Therefore
ṗv = v̇nM + vṅM

(91)

= v̇nM + vG(zM )nM ,
where G(zM ) can be partitioned as
G(zM ) = Gsel (zM ) + Ḡ,

(92)

sel
)a,b∈D and
where Gsel (zM ) = (gab

sel
gab
= gab (zM ) − ḡab ,

∀a, a ∈ D,

(93)

and Ḡ is as in the main text (5). The weighted mutant frequency can thus be written directly in terms
of individual reproductive values as


ṗv = v̇ + vḠ nM + vGsel nM ,

(94)

and by defining v such that it satisfies (82) we get
ṗv = vGsel nM .

(95)

Notice that this is indeed equivalent to (19) and that under phenotypic equality ṗv |δ=0 = 0. Now, taking
the derivative of the above with respect to δ and using Section 2.3 we immediately obtain (36).

43

