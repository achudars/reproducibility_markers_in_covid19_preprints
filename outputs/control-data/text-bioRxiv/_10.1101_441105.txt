bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

1

Bayesian Estimation of Species Divergence Times Using

2

Correlated Quantitative Characters

3

Sandra Álvarez-Carretero1 , Anjali Goswami2,3 , Ziheng Yang2,* and Mario dos Reis1,*

4

1 School

5

UK.

6

2 Department

7

6BT, UK.

8

3 Department

9

* Correspondence

10

11

of Biological and Chemical Sciences, Queen Mary University of London, London E1 4NS,

of Genetics, Evolution and Environment, University College London, London WC1E

of Life Sciences, The Natural History Museum, London SW7 5DB, UK.
to: m.dosreisbarros@qmul.ac.uk and z.yang@ucl.ac.uk.

Abstract

Discrete morphological data have been widely used to study species evolution, but the use of

12

quantitative (or continuous) morphological characters is less common. Here, we implement a

13

Bayesian method to estimate species divergence times using quantitative characters. Quantitative

14

character evolution is modelled using Brownian diffusion with character correlation and

15

character variation within populations. Through simulations, we demonstrate that ignoring the

16

population variation (or population “noise”) and the correlation among characters leads to biased

17

estimates of divergence times and rate, especially if the correlation and population noise are

18

high. We apply our new method to the analysis of quantitative characters (cranium landmarks)

19

and molecular data from carnivoran mammals. Our results show that time estimates are affected

20

by whether the correlations and population noise are accounted for or ignored in the analysis.

21

The estimates are also affected by the type of data analysed, with analyses of morphological

22

characters only, molecular data only, or a combination of both; showing noticeable differences

23

among the time estimates. Rate variation of morphological characters among the carnivoran

1

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

24

species appears to be very high, with Bayesian model selection indicating that the

25

independent-rates model fits the morphological data better than the autocorrelated-rates model.

26

We suggest that using morphological continuous characters, together with molecular data, can

27

bring a new perspective to the study of species evolution. Our new model is implemented in the

28

MCMCtree computer program for Bayesian inference of divergence times. [Bayesian inference,

29

continuous morphological characters, geometric morphometrics, Procrustes alignment,

30

molecular clock, divergence times, phylogeny]

31

Molecular sequences are informative about the relative ages of nodes on a phylogeny, but not about

32

the geological times of divergence or the absolute molecular evolutionary rate. The Bayesian method

33

offers a way to use fossil information to construct a prior on divergence times, which can then be

34

integrated with the molecular data to produce posterior estimates of absolute divergence times

35

(e.g., Thorne et al., 1998; Drummond et al., 2006; Rannala and Yang, 2007). However, modelling

36

clade ages with statistical distributions based on the fossil evidence is challenging. Fossils may

37

provide estimates of minimum clade ages, but maximum clade ages are typically based on the

38

absence of fossil evidence, and are thus hard to justify (Benton and Donoghue, 2007).

39

The problem is illustrated in Figure 1. Imagine we wish to estimate the age of the last common

40

ancestor of species A and B, tAB . The oldest fossil in the A-B ingroup is F, which has known age tF .

41

If we measure time towards the past (so that present time is zero), we can immediately see that

42

tAB > tF , so that the age of the fossil, tF , imposes a minimum constraint on tAB . However, we do not

43

know how close F is to the common ancestor, so tF is a poor indicator of the true age tAB . Current

44

practice is to construct a prior density on tAB , f (tAB ), truncated at tF on the left, and with a long tail

45

extending to the right (back in time) to allow for the uncertainty in the time gap between tF and tAB

46

(Fig. 1). The form of the prior density and the length of the tail are somewhat subjective as they are

47

based on absence of older fossils in the A-B clade (e.g., Tavaré et al., 2002; Drummond et al., 2006;

48

Yang and Rannala, 2006; Benton and Donoghue, 2007).

49

An alternative approach would be to model morphological character evolution, so that we can

50

use morphological data to estimate the morphological distance among extant and fossil species in a

51

phylogeny. Since fossil ages are known, fossils can then be used as “dated-tips” in the Bayesian

52

analysis. Divergence time estimation can then proceed using a morphological alignment of extant
2

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

53

and fossil species, or on a combined data set of molecular data for extant species and morphological

54

data for extant and fossil species. This approach, also known as total-evidence dating (TED), has

55

been pioneered by Pyron (2011) and Ronquist et al. (2012) (see also Nylander et al., 2004; Lee et al.,

56

2009; and Magallón, 2010) using discrete morphological characters under the Mk model of

57

morphological evolution (Lewis, 2001). It has been used to date phylogenies for several groups

58

(e.g., Nylander et al., 2004; Pyron, 2011; Ronquist et al., 2012; Schrago et al., 2013; Slater, 2013;

59

Wood et al., 2013; Arcila et al., 2015; Grimm et al., 2015; Reeder et al., 2015; Winterton and Ware,

60

2015; Larson-Johnson, 2016; Ronquist et al., 2016; Gavryushkina et al., 2017), sometimes producing

61

very old time estimates compared with node-calibration methods, and it is noted to be sensitive to

62

the branching process used to specify the prior on times (O’Reilly et al., 2015; dos Reis et al., 2016).

63

The TED approach has been improved by extensions of the fossilised birth-death process to construct

64

more realistic priors on times (Heath et al., 2014; Gavryushkina et al., 2014; Zhang et al., 2016).

65

Analysis of discrete morphological data under the Mk model has a few limitations. First, the

66

model assumes that rates of change among character states are equal (Lewis, 2001), an assumption

67

that appears unrealistic for the analysis of real data. Although the equal-rates assumption can be

68

relaxed (Pagel, 1994; Wright et al., 2016), this model appears to be rarely used, perhaps because it is

69

computationally expensive (Wright et al., 2016). Second, systematists usually score discrete

70

morphological characters only if the characters are variable or if they are parsimony-informative. In

71

this case, a correction is necessary to account for the ascertainment bias in character scoring (Lewis,

72

2001; Leaché et al., 2015). Correcting for the removal of constant characters is straightforward, but a

73

much more computationally expensive correction is necessary to account for the removal of

74

parsimony-uninformative characters, and it appears that this correction is not properly

75

accommodated in current dating software (dos Reis et al., 2016). Finally, it seems difficult to

76

accommodate correlations among characters in the Mk model. For a morphological alignment with

77

p characters and with each character having k states, a k p substitution matrix is constructed to

78

accommodate correlated character evolution (Pagel, 1994). Such matrices become explosively large

79

for even a moderate number of characters and are computationally intractable (Felsenstein, 2005).

80

Thus, correlation among characters is ignored in Bayesian inference under the Mk model. The

81

threshold model, an alternative to the Mk model for the analysis of ordered categorical data that may

82

easily accommodate correlations among characters, has been championed by Felsenstein (2005;

3

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

83

2012). However, this model does not appear to be currently available for Bayesian inference of

84

topology or divergence times of phylogenies.

85

Quantitative (or continuous) morphological characters offer an interesting alternative to the

86

analysis of discrete characters (Felsenstein, 1988; Slater et al., 2012; Parins-Fukuchi, 2018b,a).

87

Evolution of quantitative characters on a phylogeny can be modelled using diffusion processes such

88

as the Brownian or Ornstein-Uhlenbeck processes (Felsenstein 1973; 1988). An appealing property

89

of these processes is that the resulting likelihood of the characters on the phylogeny is a multivariate

90

normal distribution which can be extended to accommodate correlations among characters and can

91

be easily calculated. Furthermore, because quantitative characters are always variable, an

92

ascertainment bias correction is not necessary. Also, non-homogeneity among characters can be

93

easily accommodated in the normal likelihood: each character may have its own diffusion rate and

94

its own ancestral mean, and thus expensive integration over a distribution of stationary frequencies

95

(as done for the relaxed version of the Mk model, see Wright et al., 2016) is not necessary.

96

Here we explore the use of quantitative characters for Bayesian inference of species divergence

97

times under the Brownian diffusion model of Felsenstein (1973). We use computer simulations to

98

study the performance of the model in obtaining divergence time estimates: we focus on the effect of

99

the sample size (the number of characters analysed) and the fossil age (using young or old fossils in

100

the phylogeny), the strength of the correlation among the characters, and the level of “population

101

noise” on the performance of the method. In the Brownian diffusion model, the means of the

102

characters in populations evolve according to Brownian diffusion, but quantitative measurements on

103

a sample of individuals for a given population of species is expected to show variation around the

104

population mean. This population noise must be explicitly accommodated in the model (Felsenstein,

105

1973). Finally, we study the performance of the method on the analysis of a real data set: a set of

106

cranium landmarks on a carnivoran phylogeny.

4

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

107

THEORY

108

We assume that the species phylogeny (the tree topology) is known. The posterior distribution of

109

times and rates is
f (t, r, θ | D) ∝ f (θ ) f (t) f (r | t, θ ) f (D | t, r, θ ),

(1)

110

where f (θ ) is the prior on model parameters, f (t) is the prior on times, f (r | t, θ ) is the prior on

111

rates, and f (D | t, r, θ ) is the likelihood of the data D. In this paper, the data D may be a molecular

112

sequence alignment S, a morphological alignment M, or a combination of both. Evolutionary rates

113

may then include molecular rates rS and/or morphological rates rM . For combined data, and

114

assumming independent evolution of molecular and morphological characters, the posterior is

f (t, rS , rM , θ | S, M) ∝ f (θ ) f (t) f (rS , rM | t, θ ) f (S | t, rS , θ ) f (M | t, rM , θ ),

(2)

115

where f (S | t, rS , θ ) is the likelihood of the molecular sequence alignment (e.g., calculated under the

116

HKY+Γ substitution model) and f (M | t, rM , θ ) is the likelihood of the morphological alignment,

117

calculated under the Brownian diffusion model of quantitative character evolution (Felsenstein,

118

1973).

119

Likelihood Calculation of Quantitative Characters

120

Calculation of the likelihood is described by Felsenstein (1973; 1981; see also Freckleton, 2012).

121

Let M = {mi j } be a matrix of p continuous morphological characters measured on s species, where

122

mi j is the j-th morphological measurement in species i, with i = 1, ..., s and j = 1, ..., p. Let mi be

123

the vector of p measurements in species i (the i-th row of M). Let R be the p × p correlation matrix

124

among the characters. Write ms+1 for the vector of p (unobserved) ancestral character states at the

125

root of the phylogeny. Character j evolves from its ancestral state ms+1, j to a terminal state mi, j

126

along the branches of the tree by Brownian motion with diffusion rate r = σ 2 (where σ is the

127

diffusion coefficient, Felsenstein, 1973). Then, mi, j is normally distributed with mean ms+1, j and

128

variance v = rt, where t is the elapsed time between the root and the tip species. If we assume that

129

the rates (and thus the variances) are the same across characters (an assumption that can be relaxed),

5

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

130

then mi has a multivariate normal distribution with mean ms+1 and covariance matrix vR. The

131

diffusion rates may vary among lineages (branches) in a phylogeny (Felsenstein, 1981). If rk is the

132

rate in branch k, and tk is the elapsed time along the branch, then vk = rktk is the expected amount of

133

morphological variance accumulated in the lineage. Thus vk is the morphological branch length.

134

Felsenstein (1973) showed that the likelihood of M on a phylogeny of two or more species can be

135

calculated so that it only depends on the branch lengths, v = (vk ), and the correlation matrix, R, but

136

not on the ancestral characters at the root, ms+1 . This simplifies the calculations as ms+1 does not

137

need to be estimated.

138

Now consider a bifurcating, rooted phylogeny of s species. The external nodes (the tips) are

139

labelled 1, . . . , s; the internal nodes are labelled s + 1, . . . , 2s − 1; and s + 1 is the root node. The

140

length of the branch subtending node k is vk . If k is an internal node, let k1 and k2 be its two daughter

141

nodes. Let

v0k =




vk

if k is a tip node,



vk + vk1 vk2
vk +vk
1

else.

2

xk = m0k1 − m0k2 ,



mk
0
mk =


 vk2 mk1 +vk1 mk2
vk1 +vk2

(3)
if k is a tip node,
else.

142

143
144

The likelihood of M on the phylogeny is the product of s − 1 multivariate normal densities, each
corresponding to one of the s − 1 internal nodes. It is given by
2s−1

L(M | v, R) =

∏

L(xk | vk , vk1 , vk2 , R)

(4)

k=s+1

145

where

146

!
1
L(xk | vk , vk1 , vk2 , R) = (2π)−p/2 (v0k1 + v0k2 )−p/2 |R|−1/2 exp − 0
xT R−1 xk .
2(vk1 + v0k2 ) k
147

6

(5)

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

148

Eq. (4) can be calculated efficiently in a computer program using the postorder tree traversal

149

algorithm. When an internal node k is visited by the algorithm, we calculate v0k1 , v0k2 , xk and

150

L(xk | vk , vk1 , vk2 , R) after its daughter nodes have been visited. The m0k are maximum likelihood

151

estimates of the ancestral character states at node k conditioned on the values of vk , vk1 , vk2 , and R.

152

They are obtained for free during MCMC computation, and they may be collected and used as

153

ancestral reconstructions.

154

Correlation Among Characters and Matrix Shrinkage

155

It is useful to find a matrix A such that R−1 = AT A. Then, the exponential in the likelihood of

156

Eq. (5) can be written as

157

1
xT AT Axk
exp − 0
2(vk1 + v0k2 ) k

!

!
1
= exp − 0
zT z ,
2(vk1 + v0k2 )

(6)

158

where z = Axk is a vector. In other words, we can obtain a transformation of the original data

159

Z = MAT , so that the transformed characters in Z are independent. This simplifies the calculation of

160

the likelihood because R only needs to be inverted/decomposed once. Choices for A include the

162

Cholesky decomposition, R = LLT , then A = L−1 , or the Eigen decomposition AT = VD, where V
n√ o
−1
is the matrix of eigenvectors of R , and D = diag
λ is a diagonal matrix of the square root of

163

the eigenvalues (see p. 98 in Ripley, 1987).

161

164

The correlation matrix R can be estimated during Bayesian inference. However, this would make

165

computation prohibitively expensive as we would need to estimate (p2 − p)/2 correlations, which is

166

a large number for even a moderate p. Thus, here we assume that R is given. For example, if we

167

assume R is constant throughout the phylogeny, then we can estimate R from a sample of individuals

168

from a given species. The individuals may be assumed to be independent samples from the

169

population, and R could then be estimated using the traditional unbiased estimate of the covariance.

170

However, a common problem occurs when the number of characters, p, is larger than the number of

171

individuals sampled, s. In this case, the unbiased estimate of R, R̂, tends to become singular (i.e., its

172

determinant is zero) and cannot be inverted (e.g., Schäfer and Strimmer, 2005; Goolsby, 2016), in

173

which case the likelihood of Eq. (5) cannot be calculated. Here we overcome this problem by using
7

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

174

the linear shrinkage estimate of the correlation matrix (Schäfer and Strimmer, 2005):

175

R∗ = δ I + (1 − δ )R̂,

(7)

176

where I is the identity matrix, and δ (0 ≤ δ ≤ 1) is the shrinkage parameter, which controls the level

177

of shrinkage. If δ = 0, the shrinkage estimate, R∗ , is the same as R̂, while if δ = 1, R∗ is the identity

178

matrix.

179

Note that R∗ can always be inverted as long as δ 6= 0, thus allowing calculation of the likelihood

180

of Eq. (5). The value of δ can be chosen by the user or estimated automatically. Schäfer and

181

Strimmer (2005) give an approximate method for automatically estimating δ from the data. Their

182

procedure is implemented in their corpcor R package (see their paper for details of the algorithm).

183

Clavel et al. (2018) discuss further approaches to regularise the estimate of R.

184

Within Population Character Variance

185

Quantitative characters are expected to vary among individuals within a species (Felsenstein, 1973;

186

Ives et al., 2007). Divergence times may be biased if this population level variation (or “population

187

noise”) is large and not accounted for in the Bayesian inference, because the amount of

188

morphological evolution in the phylogeny would be overestimated (Landis and Schraiber, 2017).

189

Write c j for the within population variance of character j. Then mi, j is normally distributed with

190

mean ms+1, j and variance c j + v. In this case, ms+1, j is then the population mean of the character in

191

the ancestral population (Felsenstein, 1973). If all characters have the same variance c, then we can

192

accommodate the population noise in the analysis by setting
v0k = c + vk

193

194

(8)

when k is a tip node (Eqs. 3 and 5).
In real data, different characters may have different variances. In this case, we may obtain

195

estimates of the variances of the characters, ĉ = (ĉ j ), from a population sample at the same time as

196

we estimate R. We can then divide the columns of M by the estimated standard deviations to obtain
8

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

197

n √ o
the scaled matrix M(s) = M × diag 1/ ĉ . The new scaled matrix has thus been standardised so

198

that all characters have the same variance and so that the population noise has unit variance.

199

Inference then proceeds on M(s) by setting c = 1 in Eq. (8). Note that to correct for the correlations

200

among characters, the transformed data matrix used during Bayesian inference is then

201

Z(s) = M(s) AT .

202

Within-lineage and Among-lineage Covariances

203

We note that R here is the within-lineage correlation among the characters, and thus vk R is the

204

within-lineage covariance for the k-th branch. For example, if selective pressure acts to elongate a

205

limb in a species, one would expect the length of the corresponding limb bones to increase. In other

206

words, the bone lengths would co-vary (or co-drift in Brownian parlance) and this would be

207

represented by a positive correlation in the entry of R for the given characters. If the within-lineage

208

variances are different among characters, then the exponent of Eq. (5) must be written as

exp −

1
xTk C−1 xk
0
0
2(vk1 + vk2 )

!
,

(9)

209

where C is then the within-lineage character covariance matrix (this is the same C as in Freckleton,

210

2012). However, if we can normalise the characters to have equal variances by using estimates of the

211

within-population variances (as we do here and as shown in Felsenstein, 1973), then it is not

212

necessary to work with the more complex Eq. (9).

213

The shared ancestry among the species in a phylogeny means that there is also character

214

covariation among lineages. The among-lineage covariance matrix is rT when r is constant (e.g.,

215

when we have a strict morphological clock), and where T is an s × s matrix whose elements are the

216

shared ancestry time-paths for each pair of species (Felsenstein, 1973). For a Brownian model with

217

unequal diffusion rates among branches (Felsenstein, 1981), we must multiply the shared time-paths

218

in T by the branch-specific diffusion rates, rk , resulting in the s × s among-lineage covariance matrix

219

V (see Felsenstein, 1981;Freckleton, 2012). Matrix V only appears explicitly when we write down

220

the joint likelihood for the characters for all species (e.g., Eqs. 1 and 8 in Freckleton, 2012). Eq. (5)

221

here is the node likelihood after the pruning algorithm has been applied, and thus matrix V is not
9

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

222

apparent. However, note the v0k terms are functions of the entries in V. See Felsenstein (1973; 1981)

223

and Freckleton (2012) for full details.

224

SOFTWARE

225

Bayesian inference of divergence times with continuous characters under the model of Eq. (4) is

226

implemented in the computer program MCMCtree v4.9i, part of the PAML package (Yang, 2007).

227

We have extended the mcmc3r R package (dos Reis et al., 2018;

228

https://github.com/dosreislab/mcmc3r) to help the user in preparing morphological alignments for

229

analysis with MCMCtree, and in simulating continuous morphological data using different functions

230

from the ape package (Paradis et al., 2004).

231

SIMULATION ANALYSIS

232

We conduct a simulation study to examine the impact of (i) the number of characters analysed, (ii)

233

the fossil ages, (iii) the population noise, and (iv) the correlation among characters on the estimation

234

of divergence times using morphological data. In particular, we expect that time estimates will

235

deteriorate (i.e., will have large variances or be biased) when analysing small data numbers of

236

characters, when the fossils are too young, when the population noise is high, and when the

237

correlation among characters is strong. To reduce the computational cost, our simulations are carried

238

out using a small number of species under a constant morphological evolutionary rate.
Simulation overview.– The phylogeny in Figure 2, with s = 8 species (5 extant and 3 fossils), is

239
240

used to simulate the quantitative morphological data sets. The morphological evolutionary rate is

241

r = 1 and constant along all the branches of the phylogeny. The simulated data matrices, M, are

242

generated under the Brownian diffusion model using our mcmc3r R package. For simulations with

243

population noise and/or correlations, a population sample of individuals is simulated, which is then

244

used to estimate the vector of character variances, ĉ, and the shrinkage estimate of the correlation,

245

R∗ .

10

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

246

Replicates under each simulation setup (see below) are analysed with MCMCtree to estimate the

247

divergence times (t9 to t15 ) and the morphological rate (r) by MCMC sampling. We use a diffuse

248

gamma prior on the rate, r ∼ Γ(2, 2), with mean 1 and variance 0.5. The prior on the age of the root

249

is assigned a uniform density with soft bounds between 0.8 and 1.2 (corresponding to a calibration

250

of 80 to 120 Ma given our 100 myr time unit). The birth-death-sequential-sampling (BDSS) process

251

(Stadler and Yang, 2013), is used to generate the prior density for the ages of the internal nodes. The

252

BDSS parameters are set as: λBDSS = 1 (the birth-rate), µBDSS = 1 (the death-rate), ρBDSS = 0 (the

253

sampling fraction for extant species), and ψBDSS = 0.001 (the rate of fossil sampling). We chose

254

these parameter values to generate a uniform density on the ages (Fig. S1). We summarise the results

255

by calculating the mean times across the replicates, the mean 95% credibility intervals (CIs), the

256

mean CI-width w (and relative CI-width wr = w/ti ), the coverage (the number of times the true node

257

age falls within the 95% CI), the mean bias, and the mean squared error (MSE). Let t˜i, j be the mean

258

posterior age of node i for replicate j. The mean bias is b = ∑Rj=1 (t˜i, j − ti )/R and the MSE is

259

ε = ∑Rj=1 (t˜i, j − ti )2 /R, where R = 1, 000 is the number of replicates per simulation setup and ti is the

260

true node age. We also calculate the relative bias br = b/ti and the relative error εr = ε/ti . Note the

261

bias is a measure of accuracy of the estimate, while the MSE is a measure of both precision and

262

accuracy. The simulation workflow is summarised in Figure S2.

263
264

265

(i) Effect of the number of characters.– We simulate data sets with p = 100, 1, 000 and 10, 000
characters, assuming independence among characters and no population noise (c = 0).
(ii) Effect of fossil age.– We vary the age of the fossil H, with tH = 0.7, 0.5, 0.3, and 0.1. The

266

ages of the other fossils remain unchanged. Characters are assumed to evolve independently and

267

with c = 0. The data are then simulated using the phylogeny with the new fossil age with p = 100,

268

1, 000 and 10, 000 characters, respectively, giving 3 × 3 = 9 simulation setups.

269

(iii) Effect of population noise.– We simulate data sets with c = 0.25 (low population noise) and

270

c = 0.5 (high population noise) for p = 100, 1, 000 and 10, 000. Characters are assumed to evolve

271

independently. In order to simulate the population noise, we sample s × p random numbers from a

272

normal distribution with mean 0 and variance c, to obtain the s × p noise matrix N. The resulting

273

noise is added to the simulated morphological matrix, M, to generate the noisy matrix

274

M(n) = M + N.

11

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

275

We also simulate a population sample of n = 20 individuals to obtain a n × p population matrix,

276

P, by sampling from the normal distribution with mean 0 and variance c. Before performing

277
278

Bayesian inference, we obtain estimates of the population noise for each character, ĉ = (ĉ j ), using
√
the simulated population sample P, and obtain the scaled matrix M(s) = M(n) diag{1/ ĉ}. As we are

279

scaling M(n) using an estimate of the population variances, ĉ, we expect to observe little discrepancy

280

between the true parameters (rate and divergence times) and their corresponding estimates.

281
282

Therefore, we also scale the noisy matrix by c = (c j ), the vector of true variances. Thus
√
(s)
Mtrue = M(n) diag{1/ c}, which is used as a control test. Bayesian inference then proceeds either

283

on M(s) or Mtrue , with the likelihood corrected by setting c = 1 (Eq. 8). The data are also analysed

284

by setting c = 0 (Eq. 8) to assess the impact of ignoring the population noise on the time estimates.

285

Note that the gamma prior on the morphological rate may be changed to account for scaling of the

286

data sets. When c = 0.25, the morphological rate for the scaled data is r/0.25 = 1/0.25 = 4. Thus,

287

the new gamma prior for the rate is r ∼ Γ(2, 0.5). Similarly, when c = 0.5, the morphological rate

288

for the scaled data is r/0.5 = 1/0.5 = 2, thus the rate prior is set to r ∼ Γ(2, 1). We expect the

289

posterior means of times and rates to be very biased when the population noise is ignored, to have

290

some bias when using M(s) , and to have little or no bias when using Mtrue .

291

(s)

(s)

(iv) Effect of correlation among characters.– We simulate data sets using the constant correlation

292

model, that is, with all the within-lineage correlations in R equal to ρ. We use the correlations

293

ρ = 0.5 and 0.9, and p = 100, 1, 000 and 10, 000. To simulate correlated data, a matrix M is first

294

simulated assuming independent character evolution. Note that M is simulated on the tree, thus it

295

already contains the among-lineage covariance induced by the shared ancestry. Then, we add the

296

within-lineage correlation to M by computing M(R) = MLT , where L is the lower triangular

297

Cholesky decomposition of R. Then, we simulate the s × p noise matrix, N, sampled from a normal

298

distribution with mean 0 and variance c = 0.25, to which within-lineage correlation is added as

299

N(R) = NLT . The noise is then added to M(R) to obtain the noisy matrix, M(n) = M(R) + N(R) .

300

We also simulate a within-population sample of n = 20 individuals to obtain a n × p population

301

matrix, P, by sampling from a normal distribution with mean 0 and variance c = 0.25, to which

302

correlation is added as P(R) = PLT . We use P(R) to estimate ĉ = (ĉ j ), the vector of estimated

303

variances used to obtain M(s) . The vector of true variances, c = (c j ), is used to obtain Mtrue . The

304

shrinkage correlation matrix, R∗ , is also estimated using P(R) . However, note that the shrinkage

(s)

12

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

305

value, δ , has a strong impact on R∗ . Therefore, we test two approaches to generate R∗ : (i) we use

306

the automatic approach of Schäfer and Strimmer (2005) to find the optimum value of δ , and (ii) we

307

fix δ = 0.01, to obtain R∗ close to the unbiased estimate R̂. The Cholesky decomposition of R∗ is

308

then used to obtain the transformed data matrix Z(s) = M(s) AT . M(s) is also analysed directly to

309

assess the effect of ignoring the character correlation. As a control data set, we also obtain A from

310

the true correlation matrix, R, and use it to calculate Ztrue = Mtrue AT . The estimates obtained using

311

Ztrue are expected to be very close to the true rate and divergence times. On the other hand, we

312

expect estimates using Z(s) to have some bias, and estimates using the uncorrected matrix, M(s)

313

(which ignores the correlation), to be very biased.

314

ANALYSIS OF THE C ARNIVORA DATA S ET

315

Morphological Data

316

We analyse the 29 cranium landmarks from 10 extant and 9 extinct carnivoran species (Fig. 3 and

317

Table 1). The landmark data is complete (that is, there are no missing landmarks in any specimens).

318

The landmarks are three dimensional, resulting in p = 3 × 29 = 87 characters. A population sample

319

of 21 common foxes (Vulpes vulpes) is used to estimate the correlations and the population noise for

320

the 29 landmarks. The correlation matrix estimated using the foxes is then used to transform the

321

whole dataset (Eq. 6). This assumes the within-lineage correlations are the same (or at least similar)

322

among the carnivorans analysed.

(s)

(s)

(s)

323

Landmark data are aligned using Procrustes superimposition (Gower, 1975; Rohlf and Slice,

324

1990), a technique in which the landmark coordinates for each individual are translated, rotated, and

325

scaled to unit centroid size so the square of the distance between the individual’s landmarks and the

326

mean landmark coordinates among all the individuals is minimised (see cited literature for details).

327

We perform the Procrustes alignment in two steps. First, we align the 19 carnivoran species

328

(excluding all but one of the foxes) using the Morpho :: procSym function in R (Schlager, 2017),

329

resulting in a 19 × 87 geometric morphometric alignment M. Then, the remaining 20 foxes are

330

aligned to the mean shape of M using the Morpho :: align2procSym function. This is done so that

13

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

331

the alignment is not biased due to the large number of foxes. The resulting Procrustes alignment for

332

the foxes, P (of size 21 × 87), is used to obtain the estimates of the population variances, ĉ, and the

333

shrinkage correlation matrix, R∗ , for the landmark coordinates. The correlation matrix R∗ depends

334

on the orientation of the landmarks, that is, different rotations of P may lead to different estimates of

335

R∗ . Therefore, R∗ must be estimated on a population matrix that has been aligned to the species

336

matrix. Divergence times are estimated on Z(s) , the transformed alignment obtained after scaling M

337

by the population variances, and multiplying by the Cholesky decomposition of R∗ . A summary of

338

the methodology to generate the morphological alignment is given in Figure 4.

339

Molecular Data

340

We use the sequences of the 12 mitochondrial genes (mt-genes) for the 10 extant carnivoran species

341

that are available at the NCBI: cytochrome c oxidase (COX) subunits 1, 2, and 3; cytochrome b

342

(CYTB); NADH dehydrogenase (ND) subunits 1, 2, 3, 4, 4L, and 5; and ATP synthase F0 (ATP)

343

subunits 6 and 8. We do not include ND6 in our analysis because it is not encoded on the same

344

strand of the mitochondrial DNA (mt-DNA) like the other 12 mt-genes, and thus has very different

345

nucleotide compositions. Note that not all the 12 mt-genes are available at the NCBI for the 10

346

extant species analysed. Thus, gaps are introduced in the molecular alignment when a gene is not

347

available for a species. Prank v.150803 (Löytynoja and Goldman, 2005, 2008) is used to align the

348

molecular sequences. The concatenated gene alignment is divided into two partitions: (i) first and

349

second codon positions (12CP) and (ii) third codon positions (3CP).

350

Divergence Times Estimation

351

We estimate the divergence times with MCMCtree on the fixed carnivoran topology of Finarelli and

352

Goswami (2009) and Martín-Serra et al. (2014). We use three data sets: (i) morphological alignment,

353

(ii) molecular alignment in two partitions (12CP + 3CP), and (iii) morphological and molecular

354

alignments (12CP + 3CP) analysed together as three partitions. The molecular data are analysed

355

using the HKY+Γ (Hasegawa et al., 1984, 1985) substitution model, while the Brownian diffusion

356

model of quantitative character evolution (Felsenstein, 1973) is used for the morphological data.
14

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

357

The prior on the ages of the nodes is constructed using the birth-death (BD) process (Yang and

358

Rannala, 2006), if only extant species are analysed, or the birth-death-sequential-sampling (BDSS)

359

model (Stadler and Yang, 2013), if fossil species are included in the analysis. For the BDSS prior we

360

use λBDSS = µBDSS = 1, ρBDSS = 0 and ψBDSS = 0.001; and for the BD prior we use λBD = µBD = 1

361

and ρBD = 0.1. We chose both set of parameters to obtain approximately uniform prior distributions

362

on node ages. Both the BDSS and BD processes are conditioned on the age of the root. Thus, we set

363

a uniform fossil calibration with soft bounds on the root age between 37.3 Ma and 66 Ma, following

364

Benton et al. (2015). The time unit is set to 1 myr.

365

We use a gamma-Dirichlet prior (dos Reis et al., 2014) on the (molecular and/or morphological)

366

rate with shape α = 2 and with the scale parameter β chosen so that the mean of the prior rate (given

367

by α/β ) is close to empirical estimates based on the morphological or molecular branch lengths on

368

the phylogeny. In the gamma-Dirichlet prior, one specifies the prior mean on the overall (average)

369

rate for all partitions, then a Dirichlet distribution is used to partition the total rate among the

370

partitions (see dos Reis et al., 2014 for details). To specify the prior, we first estimated, by maximum

371

likelihood, branch lengths with RAxML v8.2.10 (Stamatakis, 2014) for the molecular alignment,

372

and with CONTML (PHYLIP package, Felsenstein, 1993) for the morphological alignment. The

373

resulting unrooted trees where midpoint rooted, and then we calculated a rough approximation to the

374

number of substitutions, or units of morphological drift, from the tips of the root, and divided these

375

by 52 Ma, the (rounded) midpoint value of the root calibration. This gives a rough idea of the value

376

of the mean rates for the molecular and morphological partitions. These empirical rate estimates are

377

then used to calculate the mean rate for the gamma-Dirichlet prior. Note that the use of α = 2 leads

378

to a very diffuse (large variance) prior on the rate. The chosen values of β for all the data sets are

379

given in Table 2. The data are analysed under the strict clock (STR), the geometric Brownian

380

diffusion (GBM, also known as autocorrelated-rates, Thorne et al., 1998; Yang and Rannala, 2006),

381

and independent log-normal rate (ILN) models (Rannala and Yang, 2007; Lemey et al., 2010). The

382

gamma-Dirichlet prior on σi2 for the GBM and ILN models is σi2 ∼ Γ(2, 2) for both the molecular

383

and the morphological data sets.

15

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

384

Bayesian Selection of Clock and Correlation Models

385

We use Bayes factors (BFs) to select among the three clock models for the morphological and

386

molecular data sets. Marginal likelihoods for each model are calculated using the stepping-stone

387

approach (Xie et al., 2011) as implemented in the mcmc3r R package (dos Reis et al., 2018). The

388

estimated marginal likelihoods are then used to calculate the BFs and posterior probabilities for each

389

clock model. Note that when molecular data only were analysed, the age of the root is fixed to 1 (as

390

there are no fossil tip species to calibrate the tree). In MCMCtree, this is done by using a narrow

391

uniform distribution with soft bounds on the age of the root, U(0.999, 1.001). In this case, the mean

392

of the rate prior needs to be modified to accommodate the different age of the root. Table 2 gives the

393

modified priors.

394

Bayes factors can also be used to select for the correlation model in the morphological data. The

395

marginal likelihood can be calculated by using R = I in Eq. (5), that is, by assuming characters

396

evolve independently, or calculated on Z(s) which has been transformed to account for the correlation

397

among characters. Please note that, when using Z(s) , the likelihood of Eq. (5) must be scaled by the

398

determinant |R∗ | so that the marginal likelihood is calculated correctly. The marginal likelihoods can

399

then be used to calculate the BF and posterior probability for the independent and correlated models.

400

RESULTS

401

Analysis of Simulated Data

402

In general, the simulation results met our expectations. We found that estimates of divergence times

403

and rates for large number of characters and with older fossils were close to the true values. On the

404

other hand, when the data sets were simulated with population noise and/or with correlated

405

characters, but these were not corrected for, the estimated parameters were far from the true values.

406

This bias was particularly large when the population variance was large or when the correlation

407

among characters was very strong. We describe the results in detail below.

408
409

Effect of the number of characters and fossil age.– Figure 5 shows the effect of sample size and
fossil age on posterior estimates of the root age, t9 , and morphological rate, r. Posterior means and
16

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

410

95% quantiles of t9 and r are averaged across all 1,000 simulation replicates and plotted. As

411

expected, uncertainty (as measured by the CI width) in the estimates decreases for larger data sets

412

and when the age of fossil H is the oldest. For example, when tH = 0.1 and p = 100 characters are

413

analysed, the average CI of t9 is 0.8-1.2, which is 0.4 time units wide, or 40% of the root age

414

(Fig. 5A). However, this uncertainty is reduced to only 13% of the root age when analysing

415

p = 10, 000 characters (Fig. 5C). The uncertainty is reduced even further when tH = 0.7 (when the

416

fossil is the oldest), giving a CI width which is about 5% of the root age estimate (Fig. 5C). Note that

417

the younger the fossil is, the larger the distance from the fossil to the root of the tree is, which makes

418

the fossil less informative. The same pattern is observed for the estimates of the morphological rate

419

(Fig. 5A’-C’) and for the rest of the node ages (Tables S1 and S2). Note that, in all cases, the

420

estimates appear unbiased and converging to the true values as the data become more informative.

421

Effect of population noise.– Figure 6 shows the effect of the population noise on the estimates of

422

the root age, t9 , and morphological rate, r, when p = 1, 000 characters are analysed. As above,

423

estimates are averaged across the 1, 000 replicates and plotted. When the population noise is ignored

424

in the analysis (Fig. 6A and A’), the parameters are overestimated and the overestimation is largest

425

for the largest population noise. For example, when c = 0.5 and when c is ignored in the analysis,

426

the average of the posterior mean of t9 is 1.2 (Fig. 6A), which has a mean bias of b = 0.2 or a

427

relative bias of 20%. This is a large bias that cannot be corrected by sampling more characters

428

because the model is misspecified. On the other hand, when c = 0.5 and when ĉ is used to correct for

429

the population noise in the analysis, the relative bias in the estimate of t9 is only about 4% (Fig. 6B).

430

Note that we expect some bias to remain in the estimates because ĉ itself has sampling errors: we

431

need to estimate one variance for each character, and these variance estimates are obtained from a

432

small population sample of 20 individuals. Asymptotically, as the population sample increases to

433

infinity, the sampling errors go to zero and ĉ would converge to the true population variances, c. In

434

this case, we expect to see no bias in the posterior means of t and r. This is exemplified in Figure 6C,

435

where the data has been scaled by the true variances, c, and thus there is almost no bias in the

436

posterior mean of the root age. The pattern of bias in the estimates of t9 when the population noise is

437

ignored in the analysis is also seen for estimates of the morphological rate, r, (Fig. 6A’-C’) and for

438

the rest of the node ages in the phylogeny (Tables S3 and S4).

439

Effect of correlation among characters.– Figure 7 shows the effect of character correlation on
17

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

440

estimates of the root age, t9 , and the morphological rate, r, when p = 1, 000 characters are analysed

441

and when the population noise is c = 0.25. As above, estimates are averaged across the 1, 000

442

replicates and plotted. When both the population noise and the character correlation are ignored in

443

the analysis, the time estimates tend to be more overestimated as the character correlation increases

444

(Fig. 7A). For example, when ρ = 0.9 and when both correlation and noise are ignored, the average

445

estimate of t9 = 1.42, with a bias b = 0.42 or relative bias of 42% (Fig. 7A). This is a very high bias

446

in the estimate. Note that when ρ = 0.9 and the data are corrected for the population noise but not

447

for the correlation, the large bias in the estimate of t9 remains (Fig. 7B). On the other hand, when

448

ρ = 0.9 and both the noise and correlation are taken into account in the analysis, the bias in the

449

estimate of t9 is very small (about 4%, Fig. 7C). This trend, in which t9 is overestimated when the

450

character correlation is ignored, is also observed for the estimates of the other node ages (Tables S5

451

and S6).

452

Strangely, a different pattern is observed for the estimate of the rate. When the population noise

453

and the character correlation are ignored in the analysis, or when the noise alone is corrected for, the

454

bias in the estimate of r are moderate or small (Fig. 7A’-B’). Surprisingly, when ρ = 0.5 and when

455

both the noise and character correlation are corrected for in the analysis, we find that the bias in the

456

estimate of r is very high, an overestimation (relative bias) of about 175% (Fig. 7C’). The bias then

457

decays to about 27% when ρ = 0.9 (Fig. 7C’). We note that these estimates are obtained when using

458

the shrinkage estimate, R∗ , to correct for the correlation. When using the unbiased estimate, R̂, to

459

correct for the correlation, the errors in the estimates of the rate are so large that they cannot be

460

included in Figure 7 (but see Tables S5 and S6). We note that both the estimates R∗ and R̂ are

461

expected to contain large errors as we are estimating too many correlations from a small population

462

sample. For example, when p = 1, 000 characters we have to estimate 499,500 correlations. It

463

appears that estimates of the morphological rate may be sensitive to errors in these estimates.

464

Analysis of the Carnivora Data

465

Morphological tree and Smilodon landmarks.– The morphological tree estimated with CONTML

466

(PHYLIP package, Felsenstein, 1993) is shown in Figure S5. Because the branch length from the

467

root of the tree to the extinct saber-tooth tiger, Smilodon fatalis, is very long, we examined the
18

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

468

landmarks of this specimen for possible problems before Bayesian inference of divergence times.

469

We used the function geomorph :: plotOutliers (Adams and Otárola-Castillo, 2013) in R to

470

calculate the Procrustes distance from each specimen to the mean shape. The resulting plot

471

(Fig. S3A) shows Smilodon as an outlier. In order to elucidate which landmarks place Smilodon as

472

an outlier, we carried out a principal components analyses (PCA) of shape variation, with the first

473

two components shown in Figure S4. Convex hull polygons were added to cluster the specimens: (i)

474

Caniformia or Feliformia suborder, (ii) extant or extinct specimens, and (iii) outgroup or

475

non-outgroup specimens. Moving along PC1 correlates with shrinking of the length of the cranium

476

from the occipital to the maxillar, while PC2 correlates with an increase in the width of the cranium

477

(Fig. S4). Smilodon is located at the extremes of both PCs, that is, it has an unusually short snout and

478

a wide cranium. In other words, while all our specimens except Smilodon have dog- or bear-like

479

skulls, Smilodon has a markedly different, emphatically cat-like shape. This explains the long branch

480

for Smilodon in the morphological tree. Furthermore, Smilodon species have been found to be

481

outliers in larger data sets too (Goswami et al., 2011). We keep Smilodon in the Bayesian analysis to

482

illustrate the large variations in morphological rate in this phylogeny.

483

Bayesian selection of clock and correlation models.– Table 3 shows the results of the Bayesian

484

model selection. For the molecular data, the ILN rates model is best (P = 0.75) when the two

485

molecular partitions are analysed jointly. However, when they are analysed separately, the GBM

486

rates model is best for the third codon positions (P = 0.74), while the ILN is marginaly better for the

487

first and second codon positions (P = 0.53). For the morphological data, the ILN rates model with

488

character correlation is best (P = 1.00). It is worth noting that including character correlation in the

489

model improves the marginal likelihood by over 100 likelihood units compared to the no-correlation

490

model (that is, all clock models are over 100 likelihood units higher when including the correlation).

491

In contrast, when accounting for correlation, the ILN model is only 12.38 and 73.55 likelihood units

492

better than the GBM and STR rate models, respectively. This large likelihood increase for the

493

correlation model emphasizes that correlation is an important feature of morphological data that

494

should be taken into account in the analysis.

495

Divergence time estimation.– All divergence time estimates are obtained under the ILN rates

496

model. Figure 8 shows the time calibrated Carnivora phylogeny. Posterior estimates using

497

molecule-only (Fig. 8E), morphology-only (Fig. 8A,C,D), and joint (molecule and morphology,
19

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

498

Fig. 8B) data sets are consistent with each other as the 95% HPDs of all analyses overlap. However,

499

for some nodes in the phylogeny (e.g., the Canis-Vulpes extant clade), estimated dates are younger

500

for the molecular data. Interestingly, the most precise estimates (i.e., with the narrowest HPDs) are

501

obtained from the joint analysis of morphological and molecular data. Table 4 gives a summary of

502

posterior estimates for the age of the root and extant clade Canis-Vulpes as well as the morphological

503

and molecular rates. Our estimates for the Canis-Vulpes divergence time, which roughly vary

504

between 13–37 Ma (depending on analysis), overlap with the estimates (23–38 Ma) of dos Reis

505

et al., 2012. However, our results are in general older than those of Matzke and Wright, 2016, who

506

report several analyses of discrete morphological characters for various canids. They gave their best

507

estimates for Caninae divergence to be around 10 Ma (but as old as 40 Ma for unrealistic analyses

508

settings).

509

An interesting finding is that there is much more rate variation in the morphological rates than in

511

molecular rates. In other words, molecular rates are more clock-like than morphological ones. For
p
example, the coefficient of variation, CV = exp(σ 2 ) − 1, where σ 2 is the shape parameter (or

512

log-variance) for the log-normal distribution, ranges between 1.3-1.8 for morphological characters

513

and between 0.3-0.4 for the molecular data (Table 4). This indicates that morphological rates are

514

three to four times more variable than molecular data.

510

515

Note that for the scaled landmark data, the within-population variances are set to c = 1. Under

516

the ILN model, the estimated mean amount of morphological evolution from the root of the

517

phylogeny to the tip is r̄morpho × troot = 0.49 × 52 = 25.5. Thus, the population variance represents

518

1/25.5 = 3.9% of the total expected morphological branch length from the root to the tip. That is the

519

amount by which the external branches are extended due to the population noise. The estimated ĉ

520

and R∗ for the Carnivora data are given as Supplementary Material, and also given as example data

521

in our mcmc3r package (which the user can use to reproduce the full Carnivora analysis presented

522

here).

20

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

523

DISCUSSION

524

Character Correlation

525

Our simulations highlight the importance of accounting for character correlation and population

526

noise when continuous morphological data are used for divergence time estimation. However, when

527

both factors are accounted for, we observed an unexpected result in our simulation study: the larger

528

the correlation, the smaller the error to estimate both divergence times and evolutionary rate.

529

Furthermore, the largest error occurred when ρ = 0.50, and the error was more dramatic on the rate

530

estimates (see Fig. 7C and C’). The reasons for this are not clear to us, but we speculate that this may

531

be due to the use of the shrinkage correlation matrix, R∗ . Estimating the character correlations is a

532

notoriously difficult task (e.g., Goolsby, 2016) as usually the number of characters is much larger

533

than the number of samples, and thus the traditional estimate of the covariance matrix cannot be

534

inverted. Therefore, it may be a worthwhile effort to assess the effects of different approaches to

535

estimate the correlation matrix (e.g., Clavel et al., 2018). Other such approaches include matrix

536

bending (e.g., Meyer and Kirkpatrick, 2010) or Bayesian estimation of the correlation matrix. The

537

latter approach offers good prospects as the Bayesian estimate of the matrix would be regularised by

538

the use of a prior, leading to well behaved estimates. The Wishart distribution (a multivariate

539

generalisation of the gamma distribution) is the conjugate prior of the precision matrix (the inverse

540

of the covariance matrix) and can thus be used to obtain the posterior of the precision matrix

541

analytically from a population sample. From this posterior we could then obtain samples of the

542

precision matrix during MCMC, and use them to obtain the data transformation (Eq. 6). This

543

approach, although computationally expensive, has the advantage of incorporating the uncertainty

544

about the correlation estimates into the analysis.

545

In this paper we assumed the correlations among characters are the same throughout the

546

phylogeny. The model follows Felsenstein (1973), who suggested estimating the covariances among

547

characters from population samples (from one or more species), and then using these to calculate the

548

Mahalanobis distance among the populations. This distance can then be used in the likelihood

549

calculation. Let x = mi − m j be the vector of differences among the characters in populations i and

550

j. Then D2 = xT x is the square of the Euclidean distance between mi and m j . If population samples
21

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

551

are available, we may obtain the covariance estimate, Ĉ. The square of the Mahalanobis distance is

552

then defined as M 2 = xT Ĉx. Note that the exponent of the node likelihood (Eq. 9) is proportional to

553

the Mahalanobis distance, thus by plugging the Mahalanobis distances into the likelihood calculation

554
555

we can accommodate the covariance among characters (Felsenstein, 1973). Our approach here,
n √ o
(s)
using the transform Z = M × diag 1/ ĉ × AT , is equivalent to the Malahanobis method

556

proposed by Felsenstein (1973), because M 2 = z(s)T z(s) .

557

The assumption of constant correlations among lineages appears reasonable for closely related

558

species, but may need to be relaxed when analysing more distantly related clades. For example,

559

different covariance matrices can be estimated for different populations. Then the

560

population-specific covariances could be used to calculate the likelihood for the terminal branches

561

corresponding to the given populations. We could then use a stochastic process to model the changes

562

in correlations across branches in the phylogeny and use this to sample the ancestral correlations

563

using MCMC. However, this approach would be computationally very expensive. Revell and

564

Harmon (2008) and Caetano and Harmon (2017) discuss further approaches to deal with variation of

565

the correlation matrix along the phylogeny. In any case, assuming a constant correlation among

566

lineages appears to be much better than assuming within-lineage independence among the

567

characters. Here, for our Carnivora analysis, the best model with correlations is over 120

568

log-likelihood units better than the best independent model, and the posterior probability for the

569

independent model is essentially zero (Table 3).

570

Rate Variation Among Characters and Measurement Error

571

Felsenstein (1973) has shown that for a quantitative polygenic character with no dominance and

572

under no selection, the rate of change for the character within a lineage is rk ∝ c/Ne,k , where c is the

573

within-population variance of the character and Ne,k is the effective population size within the

574

lineage. The population variance is c = 2 ∑ni=1 pi (1 − pi )a2i , where n is the number of loci controlling

575

the character, pi and 1 − pi are the allele frequencies at the (two-allele) i-th locus, and ai is the

576

contribution of each allele to the character value. Such a character will, asymptotically, be normally

577

distributed as the number of loci increases (Fisher, 1919). Thus, different characters will have

578

different within-population variances depending on the number of loci involved and the contribution
22

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

579

580

of each loci to the value of the given character.
This among-characer variation can be modelled. However, this does not appear to be a

581

worthwhile effort if character variances can be estimated from population samples. Let the relative

582

rate of evolution for the j-th character be g j . Then, the length of the k-th branch in the phylogeny for

583

the j-th character is g j vk if the branch is an internal branch, and g j (vk + c) if it is an external branch,

584

where g j c is then the population variance for the character (which, as shown above, is proportional

585

to the evolutionary rate). If we assume that the rates, g j , follow a discretised gamma distribution (or

586

any other suitable distribution, e.g., Schraiber et al., 2013), then it is possible to integrate the among

587

character rates out during calculation of the character likelihood as described in Yang (1994).

588

However, because g j c (the character variance) can be estimated directly from a population sample

589

and used to re-scale the characters, it turns out that the expectation of the re-scaled branch lengths is

590

g j (vk + c)/(g j c) = vk /c + 1 if the branch is an external branch, and vk /c if it is an internal branch.

591

That is, the character rate, g j , drops out and the re-scaled branches are the same for all characters.

592

Therefore, there is no need for a model of rate variation among characters. In practice, the estimates

593

of the character variances contain sampling errors that will affect the asymptotic behaviour of the

594

estimates (Fig. 6). Note that there is an important relationship between the among character rate

595

variation and the within-lineage covariances of Eq. (9), thus we can always write
√
√
√
√
C = vk diag( g1 , . . . , g p ) × R × diag( g1 , . . . , g p ).

596

597

The population variance of a trait will be similar across lineages if the number of loci is large or

598

if the allele frequencies are similar across the populations (Felsenstein, 1973). However, if the

599

number of alleles controlling the trait is small and if the allele frequencies are very different across

600

populations, then c may vary among populations (Felsenstein, 1973). Let c(i) be the population

601

variance in species i. We can set c(i) to be proportional to the morphological rate of the external

602

branch for the given species (because ri ∝ c(i) /Ne,i ). In this way, variation in c among species would

603

become incorporated within the relaxed-clock model of rate variation among lineages. If a

604

population sample for the i-th species is used to scale the characters to have unit variance, then we

605

fix c(i) = 1 and set c( j) to be proportional to the ratio 1/ri .

606
607

Quantitative characters may be subject to measurement errors (Ives et al., 2007). For example,
landmark measurements may be subject to errors by the way a user identifies a landmark point, and

23

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

608

landmark measurements may vary even when measured by the same user. In our carnivoran data, all

609

specimens were measured by one of the co-authors. Thus, in our case, the measurement error is

610

confounded with the population variance. This is unimportant as the confounded parameter is then

611

used to correctly rescale the alignment for all characters. The effect of measurement error when

612

measurements are obtained by different operators is a matter that will require further study and

613

perhaps explicit modelling within our Bayesian framework (see Ives et al., 2007 for discussions).

614

Limitations of the Brownian Diffusion Model

615

The Brownian diffusion model has a few undesirable features: the displacement (change) of a

616

character is independent of its current state, there is no stationary distribution, and the variance in

617

character change tends to infinity with time. These may be unrealistic for analysis of real data. For

618

example, cranium landmarks are not expected to drift to arbitrarily large values for distantly related

619

species. Alternative models include the Ornstein-Uhlenbeck model (OU, Lande, 1976; Hansen,

620

1997; Butler and King, 2004) or the Lévy processes (Landis et al., 2013). The former is an extension

621

of the Brownian diffusion that stabilizes the displacement towards an optimum value (and thus has a

622

stationary distribution and finite variance) while the latter is the sum of a directional drift, a

623

Brownian diffusion, and a saltational jump in the character space. Parins-Fukuchi (2018b,a) has

624

studied inference of phylogeny under the Brownian diffusion model for simulated and real data

625

(including morphometric data for extant and extinct fossils) and found that the Brownian model

626

performed well. Implementation of the OU model for Bayesian inference of topology and

627

divergence times in a phylogeny appears worthwhile and a matter for future work.

628

Partitioning the Morphological Alignment

629

The geometric morphometrics analyses carried out with the Carnivora data suggest that different

630

partitioning schemes with morphological data sets should be explored. For instance, the results from

631

the PCA (Fig. S4) indicate two regions within the carnivoran skulls that might follow different

632

patterns of evolution: (i) from the maxillar to the lateral and (ii) from the lateral to the occipital.

633

Previous research has shown different modules of correlated continuous characters are expected to
24

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

634

evolve at different rates (Goswami et al., 2014; Felice and Goswami, 2018), suggesting the use of an

635

appropriate partitioning scheme could improve the estimation of divergence times (Lee, 2016).

636

Therefore, it would be interesting to explore the evolution of the cranium shape in this phylogeny

637

when partitioning the data set into these two modules. Although this was not the aim of this study,

638

we believe that partitioning morphological alignments according to modules identified using

639

geometric morphometrics could improve estimates of rates and divergence times. This is particularly

640

important for the morphological data because the evolutionary clock appears to be seriously

641

violated, with some species showing very large rate variation (for example, Smilodon).

642

For example, Ho (2014) discusses how patterns of molecular rate variation may change for

643

different regions of the genome. If these patterns of molecular rate variation are reflected on the

644

morphological rates, then it may be worthwhile exploring whether partitioning morphological data

645

would allow us to estimate these patterns. Methods for partitioning molecular data according to rate

646

variation have been developed (Duchêne et al., 2014; Foster and Ho, 2017; Angelis et al., 2018), and

647

these could in principle be combined with methods to detect morphological modules (partitions)

648

based on morphological and/or developmental rates (e.g., Felice and Goswami, 2018). Note that if

649

characters are scaled to have the same variance, then the overall rate for different character partitions

650

will be the same. However, the pattern of rate variation among lineages (branches) and between

651

partitions will be different. By incorporating morphological partitions with different patterns of rate

652

variation among lineages, it should be possible to improve the precision of time estimates.

653

Conclusions

654

The development of the total-evidence dating approach using discrete characters (Pyron, 2011;

655

Ronquist et al., 2012) has allowed us to incorporate fossil data within an explicit modelling

656

framework. Incorporation of continuous characters in the analysis is the natural extension of this

657

framework. Recently, Parins-Fukuchi (2018b,a) used Felsenstein (1973) implementation of the

658

Brownian model of character evolution to study in detail the performance of phylogenetic inference

659

under the model on simulated and real data, assuming character independence and with emphasis on

660

the ability of the model to place fossil taxa on the phylogeny. Our work here extends the Bayesian

661

analysis of continuous characters by explicitly accounting for character correlation and population
25

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

662

variance among the characters, and by the use of Bayesian selection of morphological rate model.

663

Our results and those by Parins-Fukuchi (2018b,a) indicate the analysis of continuous characters is

664

promising for the estimation of topology and divergence times in phylogenies. Perhaps the main

665

advantage of using continuous characters is the easiness with which correlations can be incorporated

666

in the analysis. In the Mk model, character correlation can be incorporated by expanding the model’s

667

transition matrix to accommodate all the possible combinations of character transitions given the

668

correlations (Pagel, 1994), with the resulting transition matrices becoming very large (Felsenstein,

669

2005). For example, to analyse p = 100 correlated binary characters, we would require a 2100 × 2100

670

transition matrix. The number of parameters to be estimated in this case, 8 × 1059 , is larger than the

671

number of atoms in the sun. In contrast, in the continuous case we would only need to estimate

672

(p2 − p)/2 = 4, 950 correlations. Given that correlated character evolution is the rule rather than the

673

exception, it appears that models that explicitly incorporate correlations are urgently required. The

674

way forward appears to be the use of continuous characters, or the use of the threshold model for

675

discrete characters, which explicitly incorporates a continuous process in the background

676

(Felsenstein, 2005, 2012). If the discrete characters are ordered and can be assumed to have a

677

continuous basis, then correlation can be introduced in the continuous variable (called liability),

678

before it is discretized, as in the implementation of the auto-discrete-gamma model (Yang, 1995).

679

SUPPLEMENTARY M ATERIAL

680

Data available from the Dryad Digital Repository: http://dx.doi.org/10.5061/dryad/[NNNN].

681

FUNDING

682

This work was supported by a Queen Mary University of London studentship to S.A.C and by

683

Biotechnology and Biological Sciences Research Council (BBSRC) grants BB/N000609/1 and

684

BB/J009709/1 awarded to Z.Y. M.d.R. wishes to thank the National Evolutionary Synthesis Center

685

(NESCent, National Science Foundation #EF-0905606) for its support during his research on

686

morphological evolution.
26

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

687

ACKNOWLEDGEMENTS

688

We would like to thank Jeff Thorne, Michael Landis, Simon Ho, Adam Leaché, Andrew Knapp and

689

an anonymous reviewer for constructive comments and ideas. This study used Queen Mary’s

690

Apocrita high-performance computer cluster (King et al., 2017).

691

References

692

Adams, D. C. and E. Otárola-Castillo. 2013. geomorph: an R package for the collection and analysis

693

694
695

696

of geometric morphometric shape data. Methods Ecol. Evol. 4:393–399.
Angelis, K., S. Álvarez-Carretero, M. Dos Reis, and Z. Yang. 2018. An evaluation of different
partitioning strategies for Bayesian estimation of species divergence times. Syst. Biol. 67:61–77.
Arcila, D., R. A. Pyron, J. C. Tyler, G. Ortí, and R. Betancur-R. 2015. An evaluation of fossil

697

tip-dating versus node-age calibrations in tetraodontiform fishes (Teleostei: Percomorphaceae).

698

Mol. Phylogenet. Evol. 82:131–145.

699
700

701

Benton, M. J. and P. C. J. Donoghue. 2007. Paleontological evidence to date the tree of life. Mol.
Biol. Evol. 24:889–891.
Benton, M. J., P. C. J. Donoghue, R. J. Asher, M. Friedman, T. J. Near, and J. Vinther. 2015.

702

Constraints on the timescale of animal evolutionary history. Palaeontol. Electron.

703

18.1.1FC:1–106.

704
705

Butler, M. A. and A. A. King. 2004. Phylogenetic comparative analysis: a modeling approach for
adaptive evolution. Am. Nat. 164:683–695.

706

Caetano, D. S. and L. J. Harmon. 2017. ratematrix: An R package for studying evolutionary

707

integration among several traits on phylogenetic trees. Methods Ecol. Evol. 8:1920–1927.

708

Clavel, J., L. Aristide, and H. Morlon. 2018. A penalized likelihood framework for high-dimensional

709

phylogenetic comparative methods and an application to New-World monkeys brain evolution.

710

Syst. Biol. 0:1–25.

27

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

711
712

713
714

715

Donoghue, P. C. J. and M. J. Benton. 2007. Rocks and clocks: calibrating the Tree of Life using
fossils and molecules. Trends. Ecol. Evol. 22:424–431.
dos Reis, M., P. C. J. Donoghue, and Z. Yang. 2016. Bayesian molecular clock dating of species
divergences in the genomics era. Nat. Rev. Genet. 17:71–80.
dos Reis, M., G. F. Gunnell, J. Barba-Montoya, A. Wilkins, Z. Yang, and A. D. Yoder. 2018. Using

716

phylogenomic data to explore the effects of relaxed clocks and calibration strategies on divergence

717

time estimation: primates as a test case. Syst. Biol. 67:594–615.

718

dos Reis, M., J. Inoue, M. Hasegawa, R. J. Asher, P. C. J. Donoghue, and Z. Yang. 2012.

719

Phylogenomic datasets provide both precision and accuracy in estimating the timescale of

720

placental mammal phylogeny. Proc. Biol. Sci. 279:3491–3500.

721
722

723
724

725
726

727
728

729
730

731
732

dos Reis, M., T. Zhu, and Z. Yang. 2014. The impact of the rate prior on Bayesian estimation of
divergence times with multiple Loci. Syst. Biol. 63:555–565.
Drummond, A. J., S. Y. W. Ho, M. J. Phillips, and A. Rambaut. 2006. Relaxed phylogenetics and
dating with confidence. PLoS Biol. 4:e88.
Duchêne, S., M. Molak, and S. Y. W. Ho. 2014. ClockstaR: choosing the number of relaxed-clock
models in molecular phylogenetic analysis. Bioinformatics 30:1017–1019.
Felice, R. N. and A. Goswami. 2018. Developmental origins of mosaic evolution in the avian
cranium. Proc. Natl. Acad. Sci. U. S. A. 115:555–560.
Felsenstein, J. 1973. Maximum-likelihood estimation of evolutionary trees from continuous
characters. Am. J. Hum. Genet. 25:471–492.
Felsenstein, J. 1981. Evolutionary Trees from Gene Frequencies and Quantitative Characters:
Finding Maximum Likelihood Estimates. Evolution 35:1229–1242.

733

Felsenstein, J. 1988. Phylogenies and quantitative characters. Ann. Rev. Ecol. Syst. 19:445–471.

734

Felsenstein, J. 1993. PHYLIP (Phylogeny Inference Package) Version 3.5c. Distributed by the

735

author. Department of Genetics, University of Washington, Seattle.

28

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

736
737

738
739

740
741

742
743

744
745

746
747

748

Felsenstein, J. 2005. Using the quantitative genetic threshold model for inferences between and
within species. Philos. Trans. R. Soc. Lond. B. Biol .Sci. 360:1427–1434.
Felsenstein, J. 2012. A comparative method for both discrete and continuous characters using the
threshold model. Am. Nat. 179:145–156.
Finarelli, J. A. and A. Goswami. 2009. The evolution of orbit orientation and encephalization in the
Carnivora (Mammalia). J. Anat. 214:671–678.
Fisher, R. A. 1919. XV. The correlation between relatives on the supposition of Mendelian
inheritance. Trans. R. Soc. Edinburgh 52:399–433.
Foster, C. S. and S. Y. Ho. 2017. Strategies for partitioning clock models in phylogenomic dating:
application to the angiosperm evolutionary timescale. Genome Biol. Evol. 9:2752–2763.
Freckleton, R. P. 2012. Fast likelihood calculations for comparative analyses. Methods Ecol. Evol.
3:940–947.
Gavryushkina, A., T. A. Heath, D. T. Ksepka, T. Stadler, D. Welch, and A. J. Drummond. 2017.

749

Bayesian total-evidence dating reveals the recent crown radiation of penguins. Syst. Biol.

750

66:57–73.

751
752

753

Gavryushkina, A., D. Welch, T. Stadler, and A. J. Drummond. 2014. Bayesian inference of sampled
ancestor trees for epidemiology and fossil calibration. PLoS Comput. Biol. 10:e1003919.
Goolsby, E. W. 2016. Likelihood-based parameter estimation for high-dimensional phylogenetic

754

comparative models: overcoming the limitations of "distance-based" methods. Syst. Biol.

755

65:852–870.

756

Goswami, A., N. Milne, and S. Wroe. 2011. Biting through constraints: cranial morphology,

757

disparity and convergence across living and fossil carnivorous mammals. Proc. Biol. Sci.

758

278:1831–1839.

759

Goswami, A., J. B. Smaers, C. Soligo, and P. D. Polly. 2014. The macroevolutionary consequences

760

of phenotypic integration: from development to deep time. Philos. Trans. R. Soc. Lond. B. Biol.

761

Sci. 369:20130254.

29

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

762

Gower, J. C. 1975. Generalized procrustes analysis. Psychometrika 40:33–51.

763

Grimm, G. W., P. Kapli, B. Bomfleur, S. McLoughlin, and S. S. Renner. 2015. Using more than the

764

765
766

767
768

769
770

771
772

773
774

775
776

777
778

779
780

781
782

783
784

785

oldest fossils: dating osmundaceae with three Bayesian clock approaches. Syst. Biol. 64:396–405.
Hansen, T. F. 1997. Stabilizing selection and the comparative analysis of adaptation. Evolution
51:1341–1351.
Hasegawa, M., H. Kishino, and T. Yano. 1985. Dating of the human-ape splitting by a molecular
clock of mitochondrial DNA. J .Mol. Evol. 22:160–174.
Hasegawa, M., T. Yano, and H. Kishino. 1984. A new molecular clock of mitochondrial DNA and
the evolution of hominoids. Proc. Japan Acad. Ser. B. 60:95–98.
Heath, T. A., J. P. Huelsenbeck, and T. Stadler. 2014. The fossilized birth-death process for coherent
calibration of divergence-time estimates. Proc. Natl. Acad. Sci. U. S. A. 111:E2957–66.
Ho, S. Y. 2014. The changing face of the molecular evolutionary clock. Trends. Ecol. Evol.
29:496–503.
Ives, A. R., P. E. Midford, and T. Garland. 2007. Within-species variation and measurement error in
phylogenetic comparative methods. Syst. Biol. 56:252–270.
King, T., S. Butcher, and L. Zalewski. 2017. Apocrita - High Performance Computing Cluster for
Queen Mary University of London .
Lande, R. 1976. Natural selection and random genetic drift in phenotypic evolution. Evolution
30:314–334.
Landis, M. J. and J. G. Schraiber. 2017. Pulsed evolution shaped modern vertebrate body sizes. Proc.
Natl. Acad. Sci. U. S. A. 114:13224–13229.
Landis, M. J., J. G. Schraiber, and M. Liang. 2013. Phylogenetic analysis using Lévy processes:
finding jumps in the evolution of continuous traits. Syst. Biol. 62:193–204.
Larson-Johnson, K. 2016. Phylogenetic investigation of the complex evolutionary history of

786

dispersal mode and diversification rates across living and fossil Fagales. New Phytol.

787

209:418–435.
30

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

788

Leaché, A. D., B. L. Banbury, J. Felsenstein, A. N. M. de Oca, and A. Stamatakis. 2015. Short tree,

789

long tree, right tree, wrong tree: new acquisition bias corrections for inferring SNP phylogenies.

790

Syst. Biol. 64:1032–1047.

791
792

Lee, M. S. Y. 2016. Multiple morphological clocks and total-evidence tip-dating in mammals. Biol.
Lett. 12:20160033.

793

Lee, M. S. Y., P. M. Oliver, and M. N. Hutchinson. 2009. Phylogenetic uncertainty and molecular

794

clock calibrations: A case study of legless lizards (Pygopodidae, Gekkota). Mol. Phylogenet.

795

Evol. 50:661–666.

796
797

798
799

800
801

802
803

804
805

806

Lemey, P., A. Rambaut, J. J. Welch, and M. A. Suchard. 2010. Phylogeography takes a relaxed
random walk in continuous space and time. Mol. Biol. Evol. 27:1877–1885.
Lewis, P. O. 2001. A likelihood approach to estimating phylogeny from discrete morphological
character data. Syst. Biol. 50:913–925.
Löytynoja, A. and N. Goldman. 2005. An algorithm for progressive multiple alignment of sequences
with insertions. Proc. Natl. Acad. Sci. U. S. A. 102:10557–10562.
Löytynoja, A. and N. Goldman. 2008. Phylogeny-aware gap placement prevents errors in sequence
alignment and evolutionary analysis. Science 320:1632–1635.
Magallón, S. 2010. Using fossils to break long branches in molecular dating: a comparison of
relaxed clocks applied to the origin of angiosperms. Syst. Biol. 59:384–399.
Martín-Serra, A., B. Figueirido, and P. Palmqvist. 2014. A three-dimensional analysis of the

807

morphological evolution and locomotor behaviour of the carnivoran hind limb. BMC Evol. Biol.

808

14:129.

809
810

811
812

813
814

Matzke, N. J. and A. Wright. 2016. Inferring node dates from tip dates in fossil Canidae: the
importance of tree priors. Biol. Lett. 12:20160328.
Meyer, K. and M. Kirkpatrick. 2010. Better estimates of genetic covariance matrices by "bending"
using penalized maximum likelihood. Genetics 185:1097–1110.
Nylander, J. A. A., F. Ronquist, J. P. Huelsenbeck, and J. L. Nieves-Aldrey. 2004. Bayesian
phylogenetic analysis of combined data. Syst. Biol. 53:47–67.
31

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

815
816

817
818

819
820

821
822

823
824

825
826

827
828

O’Reilly, J. E., M. dos Reis, and P. C. J. Donoghue. 2015. Dating tips for divergence-time
estimation. Trends. Genet. 31:637–650.
Pagel, M. 1994. Detecting correlated evolution on phylogenies: a general method for the
comparative analysis of discrete characters. Proc. R. Soc. Lond. B 255:37–45.
Paradis, E., J. Claude, and K. Strimmer. 2004. APE: analyses of phylogenetics and evolution in R
language. Bioinformatics 20:289–90.
Parins-Fukuchi, C. 2018a. Bayesian placement of fossils on phylogenies using quantitative
morphometric data. Evolution 72:1801–1814.
Parins-Fukuchi, C. 2018b. Use of continuous traits can improve morphological phylogenetics. Syst.
Biol. 67:328–339.
Pyron, R. A. 2011. Divergence time estimation using fossils as terminal taxa and the origins of
Lissamphibia. Syst. Biol. 60:466–481.
Rannala, B. and Z. Yang. 2007. Inferring speciation times under an episodic molecular clock. Syst.
Biol. 56:453–466.

829

Reeder, T. W., T. M. Townsend, D. G. Mulcahy, B. P. Noonan, P. L. J. Wood, J. W. J. Sites, and J. J.

830

Wiens. 2015. Integrated analyses resolve conflicts over squamate reptile phylogeny and reveal

831

unexpected placements for fossil taxa. PLoS ONE 10:e0118199.

832
833

834
835

836
837

838

Revell, L. J. and L. J. Harmon. 2008. Testing quantitative genetic hypotheses about the evolutionary
rate matrix for continuous characters. Evol. Ecol. Res. 10:311–331.
Ripley, B. D. 1987. Stochastic simulation. Wiley Series in Probability and Statistics John Wiley &
Sons, Inc.
Rohlf, F. J. and D. Slice. 1990. Extensions of the Procrustes method for the optimal superimposition
of landmarks. Syst. Zool. 39:40–59.
Ronquist, F., S. Klopfstein, L. Vilhelmsen, S. Schulmeister, D. L. Murray, and A. P. Rasnitsyn. 2012.

839

A total-evidence approach to dating with fossils, applied to the early radiation of the

840

Hymenoptera. Syst. Biol. 61:973–999.
32

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

841
842

843

Ronquist, F., N. Lartillot, and M. J. Phillips. 2016. Closing the gap between rocks and clocks using
total-evidence dating. Phil. Trans. R. Soc. Lond. B. Biol. Sci. 371:20150136.
Schäfer, J. and K. Strimmer. 2005. A shrinkage approach to large-scale covariance matrix estimation

844

and implications for functional genomics. Stat. Appl. Genet. Mol. Biol. 4:Article32.

845

Schlager, S. 2017. Morpho and Rvcg - Shape Analysis in R: R-Packages for geometric

846

morphometrics, shape analysis and surface manipulations. Pages 217–256 in Statistical shape and

847

deformation analysis (G. Zheng, S. Li, and G. Szekely, eds.). Elsevier.

848
849

850
851

852
853

854
855

856
857

858
859

860
861

862
863

864
865

Schrago, C. G., B. Mello, and A. E. R. Soares. 2013. Combining fossil and molecular data to date
the diversification of New World Primates. J. Evol. Biol. 26:2438–2446.
Schraiber, J. G., Y. Mostovoy, T. Y. Hsu, and R. B. Brem. 2013. Inferring evolutionary histories of
pathway regulation from transcriptional profiling data. PLoS Comput. Biol. 9:e1003255.
Slater, G. J. 2013. Phylogenetic evidence for a shift in the mode of mammalian body size evolution
at the Cretaceous-Palaeogene boundary. Methods Ecol. Evol. 4:734–744.
Slater, G. J., L. J. Harmon, and M. E. Alfaro. 2012. Integrating fossils with molecular phylogenies
improves inference of trait evolution. Evolution 66:3931–3944.
Stadler, T. and Z. Yang. 2013. Dating phylogenies with sequentially sampled tips. Syst. Biol.
62:674–688.
Stamatakis, A. 2014. RAxML version 8: a tool for phylogenetic analysis and post-analysis of large
phylogenies. Bioinformatics 30:1312–1313.
Tavaré, S., C. R. Marshall, O. Will, C. Soligo, and R. D. Martin. 2002. Using the fossil record to
estimate the age of the last common ancestor of extant primates. Nature 416:726–729.
Thorne, J. L., H. Kishino, and I. S. Painter. 1998. Estimating the rate of evolution of the rate of
molecular evolution. Mol. Biol. Evol. 15:1647–1657.
Winterton, S. L. and J. L. Ware. 2015. Phylogeny, divergence times and biogeography of window
flies (Scenopinidae) and the therevoid clade (Diptera: Asiloidea). Syst. Entomol. 40:491–519.

33

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

866

Wood, H. M., N. J. Matzke, R. G. Gillespie, and C. E. Griswold. 2013. Treating fossils as terminal

867

taxa in divergence time estimation reveals ancient vicariance patterns in the palpimanoid spiders.

868

Syst. Biol. 62:264–284.

869

Wright, A. M., G. T. Lloyd, and D. M. Hillis. 2016. Modeling character change heterogeneity in

870

phylogenetic analyses of morphology through the use of priors. Syst. Biol. 65:602–611.

871

Xie, W., P. O. Lewis, Y. Fan, L. Kuo, and M.-H. Chen. 2011. Improving marginal likelihood

872

873
874

875
876

877
878

879
880

881
882

estimation for Bayesian phylogenetic model selection. Syst. Biol. 60:150–60.
Yang, Z. 1994. Maximum likelihood phylogenetic estimation from DNA sequences with variable
rates over sites: approximate methods. J. Mol. Evol. 39:306–14.
Yang, Z. 1995. A space-time process model for the evolution of DNA sequences. Genetics
139:993–1005.
Yang, Z. 2007. PAML 4: Phylogenetic analysis by maximum likelihood. Mol. Biol. Evol.
24:1586–1591.
Yang, Z. and B. Rannala. 2006. Bayesian estimation of species divergence times under a molecular
clock using multiple fossil calibrations with soft bounds. Mol. Biol. Evol. 23:212–226.
Zhang, C., T. Stadler, S. Klopfstein, T. A. Heath, and F. Ronquist. 2016. Total-evidence dating under
the fossilized birth-death process. Syst. Biol. 65:228–249.

34

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Table 1: Summary of the 19 carnivoran species studied in this analysis. This table includes the
voucher specimen, the specimen age and age ranges, and the reference for the specimen age and the
age ranges. Note that, for the extant species, the specimen age is set to 0 as it refers to the present
time.

a

Taxona

Voucher specimen

Specimen age (mid-point
ageb ), Ma

Referencec

Hesperocyon sp. †

NMNH 459576

35.5500 (37.2000-33.9000)

Enhydrocyon
pahinsintewakpa †
Paraenhydrocyon
josephi †
Tomarctus hippophaga †
Aelurodon ferox †
Epicyon haydeni †
Smilodon fatalis †
Hyaenictitherium
wongii †

AMNH 27579

28.5500 (30.800-26.3000)

National Museum of Natural
History collection
Wang 1994, pp. 89-90

YPM 12702

25.6150 (30.8000-20.4300)

Wang 1994, p. 135 & p. 141

AMNH 61156
AMNH 61757
LACM 131855
LACMHC 1360
China G L-49

14.7850 (15.9700-13.6000)
13.1350 (15.9700-10.3000)
11.9500 (13.6000-10.3000)
0.0285 (0.0440-0.0130)
6.6500 (8.0000-5.3000)

Canis dirus †
Ursus americanus
americanus (O)
Ailurus fulgens (O)
Nandinia binotata (O)
Paradoxurus
hermaphroditus
phillipinensis (O)
Cuon alpinus primaevus
Speothos venaticus
Canis lupus lycaon
Cerdocyon thous aquilis
Otocyon megalotis
Vulpes vulpes pusilla

LACMHC 2300-4
FMNH 106356

0.0285 (0.0440-0.0130)
0

Wang et al. 1999, pp. 157-158
Wang et al. 1999, pp. 182-183
Wang et al. 1999, pp. 252-254
La Brea Tar Pits collection
Werdelin 1988, p. 259; Werdelin
& Solounias 1991, p. 33; Tseng
& Wang 2007, p. 708 (Table 2)
La Brea Tar Pits collection
-

FMNH 60762
FMNH 149362
FMNH 33548

0
0
0

-

FMNH 38515
FMNH 87861
FMNH 153800
FMNH 68889
AMNH 179143
FMNH 112415

0
0
0
0
0
0

-

The first nine species are extinct species (indicated by †) and the next ten are extant species. Those with the label “(O)” are outgroups.

b

Mid-point age calculated from the maximum and minimum ages of the voucher specimen according to the formation from which it was retrieved. See column with header “Reference” for the literature
where the corresponding specimen and the formation from where it was collected are described.
c
Age reference corresponding only to the fossil specimens (extinct species). This can refer to either a paper, book chapter, or the database for the museum collection.

35

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Table 2: Priors on evolutionary rates and root age for the Carnivora analysis.
Dataa

Prior on rates

Prior on root ageb

Divergence times mit-3CP
mit-12CP
mit-(12+3)CP
morpho
morpho+mit-(12+3)CP

r ∼ Γ(2, 100)
r ∼ Γ(2, 1040)
r ∼ Γ(2, 100)
r ∼ Γ(2, 5)
r ∼ Γ(2, 10)

t ∼ U(37.30, 66.00)
t ∼ U(37.30, 66.00)
t ∼ U(37.30, 66.00)
t ∼ U(37.30, 66.00)
t ∼ U(37.30, 66.00)

Bayes factors

r ∼ Γ(2, 2)
r ∼ Γ(2, 20)
r ∼ Γ(2, 2)
r ∼ Γ(2, 5)

t ∼ U(0.999, 1.001)
t ∼ U(0.999, 1.001)
t ∼ U(0.999, 1.001)
t ∼ U(37.30, 66.00)

Analysis

mit-3CP
mit-12CP
mit-(12+3)CP
morpho

a

mit-3CP: mitochondrial third codon positions; mit-12CP: mitochondrial first and second codon positions; mit-(12+3)CP: mitochondrial data with
first and second codon positions in one partiton and third codon positions in another partition; morpho: morphological data; morpho+mit-(12+3)CP:
morphological and molecular data in three partitions.
b
Note that in MCMCtree, uniform fossil calibraitons have soft bounds, that is, there is a small probability (p = 2.5% by default) that the time may lay
outside each of the calibration bounds.

Table 3: Bayesian selection of clock and correlation model for the Carnivora data.
Dataa

Modelb

log L ±S.E

mit-3CP

GBM
ILN
STR

−22, 011.37 ± 0.05 0.74
−22, 012.41 ± 0.05 0.26
−22, 019.57 ± 0.04 0.00

mit-12CP

GBM
ILN
STR

−25, 651.40 ± 0.04 0.47
−25, 651.28 ± 0.04 0.53
−25, 657.82 ± 0.03 0.00

mit-(12+3)CP GBM
ILN
STR

−47, 658.83 ± 0.05 0.24
−47, 657.71 ± 0.05 0.75
−47, 694.37 ± 0.03 0.00

Morpho

GBM - (R = R∗ )
GBM - (R = I)
ILN - (R = R∗ )
ILN - (R = I)
STR - (R = R∗ )
STR - (R = I)

Pr

−4, 097.41 ± 0.04
−4, 221.13 ± 0.04
−4, 085.03 ± 0.02
−4, 207.59 ± 0.02
−4, 158.38 ± 0.01
−4, 280.18 ± 0.01

a

0.00
0.00
1.00
0.00
0.00
0.00

mit-12CP: 1 partition with the first and second codon positions (12CP) of the 12 concatenated mitochondrial genes (12-mit genes); mit-3CP: 1 partition
with the third codon positions (3CP) of the 12-mit genes; mit-(12+3)CP: the two mitochondrial partitions analysed jointly; Morpho: 1 partition with the
morphological alignment of 87 characters for the carnivoran data set.
b
STR: strict clock model, GBM: autocorrelated-rates model, ILN: independent-rates model, R = I: no correlation model (i.e., R = I in Eq. 5), R = R∗ :
correlation model (i.e., R = R∗ in Eq. 5). Note that, in all cases, c = 1, that is, population noise is explicitly accounted for in the models.

36

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Table 4: Posterior estimates of times (root and canid nodes) and rates for the Carnivora data under the
ILN rates model.
Modela

Morphological data

Time estimates (95%
HPD interval)b

Rate estimates (95% HPD
interval)c

Log-normal shape
parameter (95% HPD
interval)

Coefficient
of rate
variationd

troot = 54.6 (42.7, 65.8)

r̄morpho = 0.488 (0.284, 0.838)

2
= 1.15 (0.540, 2.10)
σmorpho

CVmorpho = 1.47

r̄morpho = 0.492 (0.287, 0.844)

2
= 1.10 (0.485, 2.10)
σmorpho

CVmorpho = 1.42

r̄morpho = 0.491 (0.288, 0.849)

2
= 1.10 (0.482, 2.08)
σmorpho

CVmorpho = 1.42

r̄mit12 = 0.0044 (0.0028, 0.0065)

2
= 0.1673 (0.0353, 0.483)
σmit12

CVmit12 = 0.43

tcanid = 21.7 (15.3, 31.7)

r̄mit3 = 0.0319 (0.0207, 0.0451)

2
σmit3

CVmit3 = 0.35

troot = 52.0 (41.7, 64.6)

r̄morpho = 0.452 (0.268, 0.766)

2
σmorpho
= 1.017 (0.468, 1.94)

CVmorpho = 1.33

tcanid = 25.1 (18.7, 32.7)

r̄mit12 = 0.0037 (0.0026, 0.0052)

2
σmit12
= 0.159 (0.0326, 0.456)

CVmit12 = 0.42

r̄mit3 = 0.0273 (0.0193, 0.0382)

2
σmit3

CVmit3 = 0.40

(R = R∗ , c = 1)
tcanid = 23.8 (13.2, 36.2)

Morphological data

troot = 52.4 (41.2, 65.3)

(R = I, c = 1)
tcanid = 25.4 (14.6,37.4)

Morphological data

troot = 52.1 (41.5, 64.9)

(R = I, c = 0)
tcanid = 26.3 (15.5, 38.1)

Molecular data

Joint (Molecular and

troot = 45.5 (36.4, 63.5)

= 0.1131 (0.0262, 0.321)

Morphological,
R = R∗ , c = 1)

= 0.147 (0.0320, 0.425)

a R = R∗ : means the shrinkage estimate of the correlation matrix is used. R = I: means the correlations are ignored, that
is, the data are assumed to be independent and the correlation matrix is the identity matrix. c = 1 and c = 0: means the
population noise is corrected for or ignored, respectively, in the analysis.
bt
canid refers to the age of the divergence of the extant Canis-Vulpes group.
c Here, r̄ refers to the posterior estimate of the mean of the rate among branches.
d The coefficient of variation of the log-normal distribution of rates is CV = pexp(σ 2 ) − 1.

37

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Figure 1: A phylogeny of two extant species (A and B) and one extinct species (F†). The age of the
extinct fossil, tF , provides a minimum age bound on the divergence of A and B, tAB . The fossil age can
be used as a lower limit on a prior probability distribution, f (tAB ), in a Bayesian analysis. Deciding on
the shape of the distribution and on how far its tail should stretch back in time is somewhat subjective
(Donoghue and Benton, 2007). Here we show an example of a misspecified prior for tAB , with the
probability mass close to the age of the fossil, but too far from the true age of the node.

Figure 2: A phylogeny of 8 species used to simulate morphological data. The time unit is 100 myr
and the divergence times are: t9 = 1.0 (root), t10 = 0.8, t11 = 0.3, t12 = 0.1, t13 = 0.2, t14 = 0.7, and
t15 = 0.5; meaning 100 Ma, 80 Ma, 30 Ma, and so on. The ages of the fossils are tF = 0.1, tG = 0.3
and tH = 0.7. Fossil species are indicated with a dagger (†).
38

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Figure 3: Procrustes alignment of 29 cranium landmarks for 19 carnivoran species. The alignment
was obtained with the Morpho package in R. Landmark coordinates for 21 foxes (Vulpes vulpes) and
18 other carnivoran species are shown as dark grey crosses and black dots, respectively. The mean of
the landmark coordinates are shown as diamonds and are numbered: 1, 2, Basioccipital-BasisphenoidBulla suture - (left, right); 3, Palatine - Maxilla - ventral suture; 4, 5, Jugal - Squamosal ventral suture
- (left, right); 6, 7, Bulla - anterior extreme - (left, right); 8, 9, Bulla - posterior lateral extreme (left, right); 10, 11, Premaxilla - anterior extreme - (left, right); 12, 13, Jugal-Maxilla (Orbit crest)
suture - (left, right); 14, 15, Jugal-Maxilla (base of zygomatic arch) suture - (left, right); 16, Nasals
- Frontal suture; 17, 19, Anterior lateral M1 - (left, right); 18, 20, Posterior lateral M2 - (left, right);
21, 22, Canine - mesial extreme - (left, right); 23, 24, Postorbital process tip - (left, right); 25, 26,
Paraoccipital process tip - (left, right); 27, Parietals - Occipital suture; and 28, 29, Occipital condyle
- extreme - (left, right).

39

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Figure 4: Summary of Bayesian inference with continuous landmark data. Step 1: Collect landmarks
from the bones of the extinct and extant species and obtain matrix X. Step 2: Collect landmarks from
the bones of a population sample of one of the species sampled in step 1 and obtain matrix Y. Step 3:
Align the landmarks in X using the Procrustes method (for example using Morpho :: procSym in R) to
obtain aligned matrix M. Step 4: Align landmarks from population sample in matrix Y to mean shape
of alignment M (for example, with Morpho :: align2procSym) and obtain aligned population matrix
P. Step 5: Use P to estimate population variance, ĉ, and shrinkage correlation matrix R∗ . Step 6: Use
ĉ to correct M for population noise and R∗ to correct for within-lineage correlation among characters.
This gives the corrected alignment Z. Step 8: Use Z in CONTML to estimate the morphological
branches using a fixed tree topology (species tree). They are used to estimate the morphological
rate and decide on the prior on rates. Step 8: Use the program MCMCtree to estimate divergence
times and morphological rates of evolution. The mcmc3r package in R can be used to prepare the
morphological alignment (i.e., to correct for within-lineage correlation and noise) and to generate the
appropriate control files for MCMCtree.

40

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Figure 5: Effect of the number of characters and fossil age on posterior estimates of the root age and
morphological rate for simulated morphological characters. The posterior mean and 95% quantile
estimates of t9 and r are averaged over R = 1, 000 replicates. Quantitative characters were simulated
under the phylogeny of Figure 2, and the age of fossil H, tH , was varied to study the effect of the
fossil age on the estimates. The true root age, t9 = 1.0, and the true morphological rate, r = 1.0, are
represented as horizontal dotted lines. The dashed lines give the corresponding upper and lower 95%
CI limits.

41

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Figure 6: Effect of population noise on estimates of the age of the root and the morphological rate
for simulated morphological characters. The posterior mean and 95% quantile estimates of t9 and r
are averaged over the R = 1, 000 replicates. The p = 1, 000 quantitative characters were simulated
under the phylogeny of Figure 2. (A, A’): the population noise is ignored during Bayesian inference,
(B, B’): the population noise is corrected using the vector of estimated population variances, ĉ; (C,
C’): the population noise is corrected using the vector of true population variances, c. The true root
age, t9 = 1.0, and the true morphological rate, r = 1.0, are represented as horizontal dotted lines. The
dashed lines give the corresponding upper and lower 95% CI limits.

42

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Figure 7: Effect of within-lineage correlation among characters on estimates of the root age and the
morphological rate for simulated morphological characters. The posterior mean and 95% quantile estimates of t9 and r are averaged over the R = 1, 000 replicates. The p = 1, 000 quantitative characters
were simulated under the phylogeny of Figure 2 with population noise c = 0.25. (A, A’): both population noise and within-lineage character correlation were ignored during Bayesian inference, (B, B’):
within-lineage character correlation was not corrected for in the data sets but population noise was
accounted for, (C, C’): both population noise and within-lineage character correlation were corrected
for in the data sets, (D,D’): both population noise and within-lineage character correlation were corrected for the true values in the data sets. The true root age, t9 = 1.0, and the true morphological rate,
r = 1.0, are represented as horizontal dotted lines. The dashed lines give the corresponding upper and
lower 95% CI limits. Note that due to the strange pattern in C’, we extended the simulation analysis
to include additional correlation values: ρ = 0.25, 0.35, 0.7, and 0.8.

43

bioRxiv preprint doi: https://doi.org/10.1101/441105; this version posted February 7, 2019. The copyright holder for this preprint (which
was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made
available under aCC-BY-NC-ND 4.0 International license.

Figure 8:

Divergence times for the 19 carnivoran species estimated with MCMCtree using morphological-only, molecular-only, and joint (mor-

phological and molecular) data sets: (A) morphological-only data set accounting for population noise and within-lineage character correlation, (B) joint
data set with the morphological data set in (A), (C) morphology-only data set without correcting for within-lineage character correlation and ignoring
population noise despite having scaled the morphological matrix, (D) morphology-only data set without correcting for within-lineage character correlation nor population noise, and (E) molecule-only data set. Horizontal bars are the HPD of node ages. Calibration for the root: U(37.3, 66.0). Cr.:
Cretaceous, Up.: Upper/Late, Pli.: Pliocene, Plei.: Pleistocene, Hol.: Holocene,
44 Qu.: Quaternary. The posterior estimates for the root age (troot ) and
the corresponding 95% CIs are highlighted for each data set, the former connected through a bold dashed line and the latter through two corresponding
dotted lines.

