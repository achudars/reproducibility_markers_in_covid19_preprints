bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

Establishment of morphological atlas of Caenorhabditis elegans embryo with cellular resolution using
deep-learning-based 4D segmentation
Jianfeng Cao1,§ , Guoye Guan2,§ , Ming-Kin Wong3 , Lu-Yan Chan3 ,
Chao Tang2,4,5∗ , Zhongying Zhao3,6∗ & Hong Yan1∗

1

Department of Electrical Engineering, City University of Hong Kong, Hong Kong, China

2

Center for Quantitative Biology, Peking University, Beijing, China

3

Department of Biology, Hong Kong Baptist University, Hong Kong, China

4

Peking-Tsinghua Center for Life Sciences, Peking University, Beijing, China

5

School of Physics, Peking University, Beijing, China

6

State Key Laboratory of Environmental and Biological Analysis, Hong Kong Baptist

University, Hong Kong, China

∗

Corresponding authors: tangc@pku.edu.cn, zyzhao@hkbu.edu.hk, h.yan@cityu.edu.hk

§

These authors contributed equally to this work.

Cell lineage consists of cell division timing, cell migration and cell fate, which are
highly reproducible during the development of some nematode species, including C.
elegans. Due to the lack of high spatiotemporal resolution of imaging technique and
1

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

reliable shape-reconstruction algorithm, cell morphology have not been systematically characterized in depth over development for any metazoan. This significantly
inhibits the study of space-related problems in developmental biology, including cell
segregation, cell-cell contact and cell shape change over development. Here we develop an automated pipeline, CShaper, to help address these issues. By quantifying
morphological parameters of densely packed cells in developing C. elegans emrbyo
through segmentation of fluorescene-labelled membrance, we generate a time-lapse
framework of cellular shape and migration for C. elegans embryos from 4- to 350cell stage, including a full migration trajectory, morphological dynamics of 226 cells
and 877 reproducible cell-cell contacts. In combination with automated cell tracing,
cell-fate associated cell shape change becomes within reach. Our work provides a
quantitative resource for C. elegans early development, which is expected to facilitate
the research such as signaling transduction and cell biology of division.

1

Introduction

2

Embryogenesis in metazoans is a spatio-temporal biological process formed by a series

3

of multicellular structure evolution including proliferation and morphogenesis. As “eu-

4

tely” C. elegans has invariant and reproducible cell lineage consisting of division tim-

5

ing, migration trajectory and fate specification for each cell1 , it has been wildly used as

2

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

6

an animal model for developmental biology research2 . Thanks to advanced imaging e-

7

quipment with single-cell resolution as well as automatic cell-tracing softwares3–5 , a few

8

researchers have made great effort to quantitatively reconstruct its developmental atlas

9

in several dimensions of developmental properties, including cell division timing6 , gene

10

expression and morphogenesis7, 8 , cell-cell contact mapping and signaling9, 10 . Despite al-

11

l this, little is known about cell morphology experimentally and systematically, due to

12

lack of high-resolution cell membrane signaling marker and reliable imaging-based algo-

13

rithm for cell segmentation, in particular for late stage which has hundreds of cells11, 12 .

14

Cell morphology (e.g. cell shape, cell volume, cell-cell contact) is also a set of critical

15

developmental properties and information for metazoan embryogenesis, which is tight-

16

ly correlated to cell-cycle control13–15 , spindle formation16 , cell-fate symmetry break-

17

ing and differentiation17, 18 , intercellular signal transmission10, 12, 19, 20 , cytomechanics and

18

morphogenesis21–24 , etc.

19

Recent studies also emphasized the necessity of 3-dimensional cellular segmenta-

20

tion aside from the nucleus25, 26 . With large quantities of volumetric data involved in the

21

embryogenesis of C. elegans, visual inspection on these images is time-consuming and

22

error-prone. Computer-assisted analysis accommodates the difficulty in large-scale image

23

segmentation, paving the way to efficient and accurate researches. Compared to manual

24

annotation, automated image analysis has better objective quantification, consistency and
3

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

25

reproducibility. Confocal microscopy is popularly used in 3D imaging, which allows op-

26

tical section in tissue or even cells at different depth. Whereas large quantities of works

27

have been proposed to segment nuclei or cells in 2D27–30 , cell’s morphological features

28

varies from those in 3D. Without information between slices, simply stacking 2D seg-

29

mentations into 3D volume may yield misalignment in the depth direction. Some recent

30

methods have addressed cell tracing based on nucleus information31 , however, they can

31

hardly characterize cell geometry information (e.g. cell volume, cell surface area, cell

32

topology, cell-cell neighbour relationship). The performance of 3D cell segmentation suf-

33

fers from three factors. First, unlike the nuclei, which are thick and separated ellipsoid

34

components, cell membranes are thin planar structures, forming complicated networks

35

by contacting with each other. Second, compared to plant tissue, highly dynamic cellular

36

morphology in C. elegans limits the application of diverse techniques based on deformable

37

model. Furthermore, as shown in Fig. S1A, laser attenuation makes the segmentation more

38

challenging in deeper slices. Theoretically, large exposure times can improve the image

39

quality. Poisonous laser rays, however, could harm or even kill cells in time-lapse imaging

40

process.

41

In the last few decades, Several attempts have been made to leverage the segmenta-

42

tion performance on microscopy. Classical techniques are based on pre-defined model and

43

image intensity features. Among these, active contours and level sets are two of the most
4

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

44

compelling methods in segmenting microscopy. Active contour deals with segmentation

45

as a energy minimization process where the image forces pull the contour toward the ob-

46

ject boundary and internal forces resist the deformation. Different evolution equations,

47

mediating the internal and external forces, are designed to control the deformation process

48

precisely32–35 . To diminish the difficulty in finding desirable forces representation, level set

49

is used to embed the boundary curve as a real-valued solution of an equation, which makes

50

it straightforward to follow topology changes, such as splits and holes. By using coupling

51

constrains in level set evolution, Nath et al. proposed a computationally efficient method

52

to segment hundreds of cells simultaneously27 . Kiss et al. used level set to segment plant

53

tissues at multiple scales, which reduced the error at blurry surface effectively36 . Instead

54

of processing multiple slices in 3D simultaneously, Sharp et al. described the possibility

55

of inferring 3D shape features indirectly from 2D images in a statistical way37 . In practice,

56

however, the performance of level set is limited by considerable computational complexity

57

and incomplete cell boundary. Methods driven by energy functions could be problematic

58

due to the presence of artifacts and lack of strong edge information. Xing et al. provides

59

a compressive review about classical cell segmentation techniques38 . Data-dependent and

60

parameterized pre-processing stage is always needed in these methods, otherwise the sys-

61

tem would be exposed to under-or-over segmentation errors.

62

Recently, deep learning based methods provide a promising tool for recognition
5

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

63

tasks, such as denoising39–42 , tumor segmentation43, 44 and image synthesis45–48 . Compared

64

to classical methods, convolutional neural network (CNN) shows remarkable improve-

65

ment on biological image analysis by mining subtle texture and shape changes. Since

66

U-net was proposed by Ronneberger et al.49 , this kind of encoder-and-decoder structure

67

has extensively promoted learning-based segmentations on medical images50 . For fluores-

68

cent images, the ability of deep learning in discriminating and filtering useful information

69

is further verified48, 51 . To mitigate the complexity in cellular networks, the segmentation

70

is usually decomposed into multiple intermediate tasks, such as nucleus detection and

71

membrane segmentation?, 52, 53 . 3D convolution attracts increasing attention because of its

72

advantage in combining multi-directional information. However, 3D deep network relies

73

heavily on computation resource and training data. Some works are proposed to alleviate

74

the computational complexity in 3D54–57 .

75

In this work, we propose a complete pipeline CShaper for analyzing cellular shapes

76

in C. elegans. Deep learning is utilized to accommodate the complications associated in

77

volumetric C. elegans embryo. First, instead of segmenting cells as a binary classification

78

task directly, CShaper generates the discrete distance map from the membrane stack image

79

with a distance regularized neural network DMapNet. Second, Delaunay triangulation is

80

employed to construct a weighted graph based on the binary segmentation extracted from

81

the DMapNet. Local minima are clustered as different seeds for watershed segmentations.
6

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

82

Last, nucleus images are used to filter out hollow regions among cells. Automatic seeding

83

procedure precludes substantial computations involved in most current works due to the

84

over-segmentation problem. After adjusting position variations in wide-type emrbyos, we

85

establish a spatio-temporal morphogenesis reference for C. elegans embryogenesis during

86

4- to 350-cell stage. Both individual evaluation and experimental verification on previous

87

conclusions demonstrate the unprecedented performance of CShaper.

88

Results

89

By measuring the consistency between segmentations of prevalent methods and manual

90

annotations, CShaper outperforms regarding both accuracy and robustness. Besides, based

91

on the segmentations, cell volume and cell surface area, which usually get involved in cell-

92

cycle control and cell-fate specification13–18 , were firstly investigated and found to have

93

high reproducibility among individuals.

94

Dataset In C. elegans embryo, nucleus and membrane were stained in vivo with mCherry

95

marker on nucleus and GFP marker on cell membrane, respectively. 4D (space + time)

96

nucleus and membrane stacks from two channels were collected by Leisa SP8 confocal

97

microscopy at 1.5-min interval. All images with a resolution 512 × 712 × 70 (voxel size

98

0.09 × 0.09 × 0.43µm) were resized into isotropic volume images with a resolution 205 ×

7

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

99

100

285 × 134 (voxel size 0.22 × 0.22 × 0.22µm) before analysis. Different wide-type embryos
are used in different stages as listed in Supplementary Table. S1.

101

Manual annotations are needed to train the DMapNet and compare different meth-

102

ods. In plant tissue, cells are encased within cell walls that physically adhere to their

103

neighbors, yielding better image quality and uniform size. In the animal embryo, howev-

104

er, irregular cells are separated by thin membrane, making it much challenging to segment

105

each cell accurately. Besides, since only 2D slice can be shown on computer screen, full

106

annotation of volumetric data is very tedious. Therefore, the gold standard is produced

107

by semi-automatic software with the results revised by experts. Membrane stacks are

108

pre-segmented by 3DMMS

109

slice-by-slice. Nucleus image is also imposed to prevent invalid gaps between cells. Please

110

note that annotations are composed by cell-wise regions, which can be transformed into

111

membrane mask with morphological operations. Most annotations have less than 100 cells

112

to prevent annotation quality deteriorating with the image quality and segmentation error

113

of 3DMMS. Although DMapNet is trained on frames within 150-cell stage, experiments

114

show that it is able to process the embryo in 350-cell stage with high quality owning to the

115

multi-scale input features. All datasets companied with annotations or segmentations will

116

be publicly available.

58

first, and then checked by two experts with ITK-SNAP

8

59

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

117

Comparison with other method Here a through comparison among CShaper and other

118

sate-of-the-art methods is discussed. To be a fair comparison, watershed algorithm is

119

also used as a postprocessing procedure in 3D U-net and FusionNet where only binary

120

membrane segmentation is available. However, different from CShaper, the seeds are

121

collected from the nucleus locations generated by AceTree, which theoretically produces

122

more accurate estimation on real nucleus images. In order to compare the CShaper without

123

distance learning strategy, the CShaper was changed to a naive binary segmentation by

124

replacing the last layer of DMapNet (see Methods) with two channel filters, while other

125

parameters kept the same as that in CShaper.

126

Experimental results are reported in Fig. 1. It shows that CShaper achieves much

127

higher accuracy on three different wide types at various time points (Fig. 1A), which

128

validates the accuracy and generality of our approach. Such improvement benefits from:

129

1). CShaper allows segmentation on weak boundaries because of the distance constrained

130

learning strategy (Supplementary Fig. S1); 2). In RACE and FusionNet, segmentation-

131

s are implemented slice-by-slice. Although slices are combined into stack statistically

132

during the post-processing stage, few inter-slice information, if any, in raw images are uti-

133

lized to establish a promising result; 3). In contrast to naive binary segmentation methods,

134

DMapNet reaches a compromise at the membrane boundary by constructing a relatively s-

135

mooth transition between the membrane and the background. This encourages the network
9

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

136

to learn more morphological features around the membrane.

10

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

A

r

C

B

D

Raw image

3DUnet

Ground truth

FusionNet

RACE

CShaper

Figure 1: Analysis on the segmentation results. (A) Comparison on the Dice ratio of the
segmentations from 3D U-Net, FusionNet, RACE, CShaper and naive binary. All values
are calculated based on seven manual annotations of three wide types, respectively. (C)
The distribution of cell volume consistency ρc with respect to time tc in four embryos. (D)
The distribution of lost nucleus with respect to time in four embryos. (D) Comparison of
the segmentations from RACE, 3DUnet, FusionNet and CShaper.
11

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

137

As Fig. 1D shows, RACE and FusionNet suffer severe leakage at the button layers of

138

the embryo, where the membrane signal is too weak to be discriminated because of laser

139

attenuation. 3DUnet provides better feature extraction by applying convolution between

140

slices. However, partial membrane, especially at the boundary of the embryo, is still

141

too weak to be recognized, which deteriorates the lost cells in the periphery. Under the

142

distance map constraint, CShaper learns to depict weak or lost membrane as annotated in

143

the training data.

144

Robustness on extensive datasets To measure the performance of CShaper on more

145

datasets, whose annotations are not available, we quantitatively measured the volume con-

146

sistency, as well as the lost nucleus, of serial segmentations. CShaper segments each

147

embryo independently, frame by frame, without capturing typical temporal patterns across

148

time. Successive imaged cells, theoretically, should have temporally consistent volume, or

149

with limited variance when considering biological dynamics. Therefore, we can examine

150

the performance of CShaper on extensive time-lapse stacks by analyzing series informa-

151

tion. Besides the membrane images, their corresponding nucleus stacks were processed by

152

AceTree, which can be used to identify cell’s name and the lifespan of each nucleus. We

153

defined volume consistency and ratio of lost nuclei to estimate the error of segmentations

154

in four wide-type embryos with 200 frames in each, which are used for following spatio-

155

temporal reference reconstruction. A index matrix Vtc|t∈[1,2,3,...200],c∈C was constructed
12

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

156

such that “0” represents the existence of cell c at time t, otherwise the element is kept as

157

N aN (invalid value), where C is the collection of cell names. We assembled cell’s volume

158

of all segmentations of one wide-type embryo into the matrix V. Then for each cell c, the

159

volume consistency ρc is defined as the ratio of the standard deviation and mean applied

160

to volume series Vt,c|t=1,2,...,200 . Note that all invalid values N aN were not taken into

161

consideration. The start time point of cell c is also labelled as tc in order to discriminate

162

the error at different developmental stages. Larger ρc means the segmentation of cell c has

163

better temporal consistency, yielding higher performance. The distribution of consistency

164

coefficients (tc , ρc ) of the four wide-type embryos is plotted in Fig. 1B. In these segmen-

165

tations, most cells have relative small volume variation through the development, although

166

temporal information are not applied to CShaper in the segmentation procedures intention-

167

ally. With the number of cells increasing over time, the cell volume becomes smaller and

168

the signal-to-noise ratio decreases dramatically, which makes it more challenging to be

169

segmented precisely. Simultaneously, because nuclei are not involved in the segmentation

170

stage, nucleus information processed by AceTree can be used to justify the accuracy. In

171

Fig. 1C, we show the ratio of lost nucleus (see Supplementary note 1) at different time

172

points. Few cells before 200-cells stage are lost in the four embryos. With the number

173

of cells increasing and density of fluorescence shrinking, the number of cells that are lost

174

becomes larger when entering the eighth round of cell divisions. However the lost cells

13

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

175

in the entire embryos only occupy a small proportion (around 11.9% at 350-cells). There-

176

fore, we can safely conclude that CShaper has superior ability on segmenting extensive

177

time-lapse embryo images.

178

Establishment of spatio-temporal morphogenesis reference Using experimental meth-

179

ods and quality-control standards described before6, 60 , 4 wild-type embryos within 350-

180

cell stage were used to construct the morphogenesis reference of early C. elegans embryo.

181

All the 17 embryos (4 embryos with both nucleus and membrane markers and the other 13

182

embryos with only nucleus marker) were first linearly normalized to minimize their posi-

183

tional variation according to a proposed computational pipeline60 ; secondly, translation in

184

yz plane and rotation around x axis were successively performed on the 4 embryos with

185

membrane marker, to ensure the compressed contact faces were parallel to xz plane; third-

186

ly, translation in xz plane and rotation around y axis were successively performed on the

187

4 embryos, so that their projection to xz plane could be embedded by a centralized ellipse

188

with minimum area; after that, the 4 embryos were rescaled to the same length in x, y, z

189

directions; at last, the other 13 embryos were normalized to the nucleus-position averages

190

of the 4 embryos using methods proposed previously60 (Supplementary Fig. S2).

191

Morphological developmental properties at single-cell level Using the cell-segmentation

192

algorithm designed above, a total of 226 cells ( ≈ 70%) among AB4-128, MS1-MS16,

14

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

193

E1-E8, C1-C8, D1-D4, P3 and P4 were recorded with complete lifespans and segmented

194

without any error in all the 4 wild-type embryos, generating 4-dimensional morphological

195

dynamic information at single-cell level with high confidence, such as cell shape (e.g. cell

196

volume, cell surface area, topology) and cell-cell contact (e.g. contact duration, contact

197

area, neighbour relationship) (Fig. 2, Supplementary Fig. S3)(Table. S2).

198

To test the data quality and further refine the information useful to biological study,

199

here we focus on three low-dimensional but valuable developmental properties : cell vol-

200

ume, cell surface area and cell-cell contact. Cell volume and cell surface area, which

201

usually get involved in cell-cycle control and cell-fate specification13–18 , were firstly inves-

202

tigated and found to have high reproducibility among individuals (Fig. 2 A,B). Cell-fate

203

induction (e.g. Wnt signaling19, 20 and Notch signaling10, 61 ) during embryo development

204

intimately depends on continuous, sufficient and direct physical contact between specif-

205

ic cells for interaction between receptors and ligands and consequent effective signaling

206

transmission. Based on the contact relationship acquired from raw experimental images

207

and automatic segmentation, we filtered the most reliable and valid contact between two

208

specific cells by adding three empirical criteria10 , 1) with contact area larger than 1/36 of at

209

least one cell’s surface area (sufficiency, Scontact /Ssurface > 1/36); 2) with contact duration

210

no shorter than 3 minutes, i.e. consecutive two time points (continuity, Tcontact ≥ 3 min)

211

; 3) be reproducible in all the 4 wild-type embryos (reproducibility, Nreplicate = Nembryo ).
15

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

212

At last, totally 877 contact pairs of two specific cells are identified (Fig. 2C). Cells with

213

missing information are listed in Supplementary Table. S3. Please note that the criteria

214

are set arbitrarily and can be readjusted for different research purposes.

Figure 2: Reproducibility, precision, validity of cell volume, cell surface area, and cell-cell
contact. All the cells involved are completely recorded and segmented without any error
during their lifespans (Table 1). (A) Highly reproducible volume of cells in the 4 wild-type
embryos. Inset, variation coefficients of cell volume. (B) Highly reproducible surface area
of cells in the 4 wild-type embryos. Inset, variation coefficients of cell surface area. (C)
Selection filter of sufficient, continuous and reproducible cell-cell contact pairs according
to a set of arbitrary criteria.

215

Discussion

216

Cell morphology is critical and useful developmental property involved with different bio-

217

logical process. In this paper, a complete pipeline CShaper for analyzing spatio-temporal

218

morphological features of C. elegans embryo at single-cell level is proposed. The CShaper

219

benefits from the well-defined distance learning task. By learning to capture multiple

16

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

220

discrete distances, DMapNet extracts the membrane mask by considering shape infor-

221

mation, instead of just intensity features. Remarkable performance is examined by both

222

intrinsic geometric constrains and previous notable discoveries. Based on these accurate

223

segmentations, we merged the embryos and quantitatively generated a spatio-temporal

224

morphogenesis reference for 4- to 350-cell stage of C. elegans embryogenesis, including

225

single-cell properties such as cell shape (e.g. cell volume, cell surface area, topology),

226

cell-cell contact (e.g. contact duration, contact area, neighbour relationship), cell posi-

227

tional variability, etc. In all, 226 cells with complete lifespans and dynamic morphology

228

trajectory were produced. Furthermore, a total of 877 contact pairs between two specific

229

cells were identified with high reproducibility, continuous contact duration and sufficient

230

contact area, which could be a solid foundation for searching potential signaling pathways

231

between cells. Our work provides a quantitative and statistical framework for C. elegans

232

morphogenesis, which is a powerful resource to push forward multiple biological research

233

fields like signaling transmission, fate specification and asymmetric segregation. Next, we

234

discuss the coincidence of CShaper with three well-known experimental discoveries and

235

inspect its valuable applications on different datasets.

236

Verifications on previous studies To further validate the C. elegans morphogenesis ref-

237

erence with single-cell developmental properties (e.g. cell volume, cell position, cell-cell

238

contact), here we use our new quantitative data to repeat and verify three separate sets of
17

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

239

experimental conclusions about C. elegans embryonic development10, 13, 61–63 .

240

Firstly, Arata et al. found the power law relationship between cell cycle duration and

241

cell volume in the early C. elegans development, that is, AB and MS cells adopt the same

242

power exponent (≈-0.27) while C and P cells adopt another different power exponent (≈-

243

0.41)13 . Under log-log scale coordinates system, we also performed linear fitting between

244

cell cycle duration and cell volume and found that the two exponents obtained (AB and

245

MS, -0.2990 ; C and P, -0.4244) are very close to the values proposed before (Fig. 3A, B).

246

Secondly, Li et al. uncovered the “low-high-low” dynamic pattern of cell positional

247

variability during 4- to 350-cell stage of C. elegans embryogenesis62 . Using the same eval-

248

uation method on positional variability (RMSD) proposed before, we used our normalized

249

cell positions (nucleus positions) to calculate their spatial variation and reconstructed a

250

similar curve with a turning point occurring when cell number reaches around ninety (Fig.

251

3C).

252

Thirdly, several intercellular signaling based on accurate cell-cell contact have been

253

identified to play important roles in asymmetric segregation, spindle formation and cell-

254

fate induction10, 19, 20, 61, 63 . Here, we compared the known cell-cell signaling pairs with our

255

cell-cell contact dataset (877 pairs in total). The majority of known contact pairs past

18

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

256

through our filter criteria with continuous contact duration as well as sufficient contact

257

area, except C −→ ABar and MS −→ ABalp (Table. 1). The contact between C and

258

ABar can be found in all the 4 wild-type embryos with at least two consecutive time point

259

(≈3 minutes), however, the relative contact area is smaller than the arbitrary filter criterion

260

(Scontact /Ssurface > 1/36) in one of the embryos (Fig. 2C), revealing that the threshold

261

for identifying valid cell-cell contact should be reestimated and readjusted on the basis of

262

the actual biological scenes (e.g. surface density of ligands or receptors), nevertheless,

263

the original contact information from image segmentation is objective and can be used for

264

different research purposes. For the other contact pair MS −→ ABalp, one of the cells

265

ABalp are missing (i.e. fail to be segmented) due to its location near the top of embryo

266

and consequent dim fluorescent signal.

19

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

Figure 3: Verification of our newly proposed morphogenesis reference using experimental
results from References13, 62 . (A) Power law relationship between cell cycle duration and
cell volume in AB and MS cells, with power exponent ≈-0.2990. Inset, illustration in
log-log scale coordinates system. (B) Power law relationship between cell cycle duration
and cell volume in C and P cells, with power exponent ≈-0.4244. Inset, illustration in
log-log scale coordinates system. (C) “Low-high-low” dynamic pattern of cell positional
variability during 4- to 350-cell stage.

20

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

21

Table 1: Verification of our newly proposed morphogenesis reference using experimental results from references.
Validity
Contact
Relative
Relative
&
Duration Contact Area Contact Area
Cell-Cell Contact Pair
Remark
Ref.
Reproducibility
(min)
Surface (%)
Surface (%)
P2 −→ EMS
4/4
7.04
9.61±2.30
12.31±2.15
Wnt Signaling
Thorpe et al19
MS −→ ABal
4/4
7.04
15.70±2.60
15.03±2.66
Latrophilin Signaling
Langenhan et al63
C −→ ABar
3/4#
7.04
2.37±2.57
2.60±2.79 Wnt/β-catenin Signaling
Walston et al20
P2 −→ ABp
4/4
5.63
13.38±1.99
20.47±2.01
Notch Signaling (1st )
Priess et al61
MS −→ ABalp
/*
/
/
/
Notch Signaling (2nd )
Chen et al10 , Priess et al61
nd
MS −→ ABara
4/4
5.63
9.28±1.19
12.98±2.14
Notch Signaling (2 )
Chen et al10 , Priess et al61
ABalapa −→ ABplaaa
4/4
5.63
14.22±3.86
11.13±3.26
Notch Signaling (3rd )
Chen et al10 , Priess et al61
rd
ABalapp −→ ABplaaa
4/4
5.63
13.06±3.91
10.66±2.65
Notch Signaling (3 )
Chen et al10 , Priess et al61
MSapp −→ ABplpapp
4/4
5.63
12.58±3.69
13.92±3.86
Notch Signaling (4th )
Chen et al10 , Priess et al61
MSapppp −→ ABplpppp
4/4
5.63
7.58±0.21
9.19±2.61
Notch Signaling (5th )
Chen et al10 , Priess et al61
# Without complete reproducibility in the 4 wild-type embryos under designed filter criteria.
* Including missing cell (ABalp).

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

267

Application on different datasets To evaluate the performance of CShaper on different

268

kinds of images, the plant tissue images used by Fernandez et al64 were segmented with

269

our method. In the work, Arabidopsis thaliana stem cells were processed with MARS65 ,

270

which provides reasonable discrimination on inner parts of the tissue by fusing multi-angle

271

acquisitions. Different from MARS, CShaper processes the stem in a more challenging

272

way, segmenting single-direction membrane stack without the fusion stage. Because of

273

the large shape difference between animal and plant cells, we retrained DMapNet with

274

two segmentation results from the MARS. Negative segmentations were filtered when its

275

volume deviates the average level too much. The comparison result is listed in Supple-

276

mentary Fig. S4. Both MARS and CShaper show promising segmentations of cells at

277

shallow layers. However, CShaper shows stronger results on inner parts with extreme-

278

ly low intensity. Although DMapNet was trained with defective reference as shown in

279

Supplementary Fig. S4B, C and D, CShaper escaped these irregular errors during the

280

inference stage.

281

Constrains of CShaper CShaper provides new insights into the study of C. elegans em-

282

bryogenesis at single-cell level, both in spatial and temporal aspects. First, to promote the

283

accuracy of automatic C. elegans embryo segmentation, especially at later developmental

284

stage, some constrains of CShaper need to be emphasized here. First, as the cell shape

285

changes with time continuously, the temporal features between consecutive frames are
22

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

286

supposed to elevate the segmentation performance. LSTM, originally designed for natu-

287

ral language process (NLP), is an obvious candidate to capture temporal features across

288

time26 . However, CShaper doesn’t adopt LSTM-based model, such as convLSTM66 , be-

289

cause of the considerable computational resources involved in 3D convolution. We also

290

find that the segmentation errors of CShaper concentrate at the top of the embryo, where

291

the membrane signal intensity decreases critically because of the laser attenuation. In

292

the framework of CShaper, potential strategies could be used to normalize the quality

293

of top half embryo based on the button one. For example, Generative Adversarial Net-

294

works (GAN) can be employed to transform low-quality images into the target with higher

295

resolution40, 45 .

296

Methods

297

CShaper consists of three phases. The first step is to extract the membrane mask by deep

298

learning based DMapNet. After that, Delaunay triangulation is used to cluster local mini-

299

mum for the followed watershed segmentation. The negative segmentations and potential

300

gaps among cells are filtered with the nucleus channel. The final cell shape lineage is con-

301

structed based on the series information provided by the nucleus lineage. The framework

302

of CShaper is shown in Fig. 4.

23

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

Cell shape lineage

Cell nucleus lineage
Nucleus image

P3

...

...

P2
C
P1

Membrane image

...

Filter and
name regions

...

...

E
EMS

...

MS
P0

ABal

ABp

Raw image

DMapNet

ABar

AB

Membrane processing
Distance map

Watershed
segmentation

ABal

Region
combination
ABa

ABar

Figure 4: The framework of CShaper. Serial nucleus and membrane stacks are imaged
simultaneously. For membrane image, CShaper is applied to segment the embryo at singlecell level automatically. Nucleus stack is processed by AceTree, which tracks nucleus
through the entire development process. Finally, CShaper embedded cellular shape into
the nucleus lineage.

24

.. .

Automatic
segmentation

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

303

Distance Constrained Learning The noise and physical imaging limitation degrade the

304

quality of automatic segmentations. This problem prevails in embryo segmentation since

305

the membrane enclosing a cell can be hardly imaged completely. DMapNet adopts a

306

distance constrained learning to address the problem in segmenting noisy embryo images.

307

By implicitly learning the distance map, the DMapNet is able to discriminate weak or even

308

lost membrane signal.

309

310

311

With the membrane labelled as front label 1, the binary membrane annotation M B
was prepared as discrete distance map M D with



 minM B (i,j,k)=1 ((x − i)2 + (y − j)2 + (z − k)2 ) if M B (x, y, z) = 0
D
M (x, y, z) =



0
if M B (x, y, z) = 1
(1)
M D = max(M D ) − M D

(2)

312

In Eq. (2), we reversed the distance map to keep it monotonically decreasing from

313

the membrane to the background. To relieve the burden on learning the distance where

314

pixel was too away from the membrane to have recognizable signal, M D was clipped to

315

prevent long-range spatial dependencies. Then M D was further discretized nonlinearly

316

into M dmap , the learning target, with smaller intervals around the membrane mask. The

317

cross-entropy loss was used to evaluate the learning progress. However, different from

318

traditional multi-classification, DMapNet should ideally provide a class distribution such
25

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

319

that the predicted class closer to the real class has higher probability than that is further

320

away. For example, the penalty of predicting l = 1 as l = 2 should be smaller than that of

321

the prediction l = 15. Therefore, the cross-entropy loss is weighted by the class distance

322

as
l=

N X
K
X

ξk wi,k (ti,k log pi,k + (1 − ti,k ) log(1 − pi,k ))

(3)

i=1 k=1
323

where ξk is the weight for each interval, wi,k is the class distance weight for each pixel i,

324

ti,k is the k-th element of the one-hot target vector at pixel i, and pi,k is the k-th channel

325

of the network output at pixel i. N and K are the number of pixels and distance intervals,

326

respectively. The K-th interval denotes the mask at the center of the membrane, while

327

0-th class represents the background far away from the membrane. Larger weight wk on

328

classes closer to the membrane helps the network put more attention on cell boundary. The

329

class distance weight wi,k is calculated as
wi,k

|k − Didmap |
)
= exp(
K

(4)

330

where Didmap is the real class at pixel i.

331

Network structure The structure of DMapNet is shown in Supplementary Fig. S5. Tak-

332

ing the fully convolutional network as the backbone, DMapNet is constructed by consid-

333

ering some specific problems in fluorescent images. In order to reduce 3D computational

334

complexity, DMapNet utilizes inter-slice information by using 3 × 3 × 1 and 1 × 1 × 3 con26

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

335

volution successively. The dilation convolution, from the output of inner-slice convolution

336

to its input, is added to enlarge the receptive filed. The residual block is composed of two

337

convolutional layers67 . Parametric Rectified Linear Units (PReLU)68 are used as the acti-

338

vation layer. To help the higher layers retain the information from pixel, the input is scaled

339

down and concatenated with the feature map, which also helps to train the network on cells

340

in different sizes51 . This is essential for segmenting cells when annotations corresponding

341

to late development stage are not reliable. Feature maps at lower resolution are upsampled

342

and concatenated together to generate the probability map. The membrane image volume

343

is split into multiple overlapped slice series ID×W ×H , which are processed by DMapNet

344

prop
individually. The final prediction of whole volume MK×(D−8)×W
×H is achieved by pack-

345

ing these predictions sequentially as discussed in Distance Constrained Learning. Then the

346

discrete distance map can be derived by M pred (z, x, y) = maxc=[1,...K] M prob (c, z, x, y).

347

Automatic seeds clustering based on Delaunay triangulation Till now, we have just

348

obtained the discrete distance map M pred from the DMapNet, as shown in Fig. 4. Wa-

349

tershed segmentation is well suited for separating individual cells from the map, where

350

black cell interiors are surrounded by bright boundaries. The learned map M pred , includ-

351

ing multiple discrete distance intervals, approximates the distance transformation on the

352

latent binary membrane mask. With the holistic information embedded in the ordered

353

intervals, cell boundaries can be extracted. However, watershed algorithm cannot be ap27

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

354

plied on M pred directly because of redundant local minima and low distance resolution. In

355

this part, Delaunay triangulation is employed to detect seeds for watershed segmentation

356

automatically.

357

First, by selecting the K-th interval as the foreground mask MKpred , a reversed

358

EDT was applied to MKpred , yielding I edt . All local H-minima in I edt are noted as S =

359

{si }i=1,..,S , where S is number of local minima. In order to filter si s that belong to the

360

same cell or background, a weighted graph G is constructed. Edges E = {E1 , E2 } in G

361

come from two sources: one is the Delaunay triangulation on S, noted as E1 ; another one

362

is the edges E2 among all local minima locating on the boundary of the volume. Weight

363

of the edge eij is defined as

W(eij ) =








X

Mpred
K (x, y, z) eij ∈ E1

(x,y,z)∈eij

(5)







0 eij ∈ E2

364

where (x, y, z) ∈ eij represents all points on the edge eij . The edge is moved from

365

E if its weight is greater than the OTSU69 threshold on W. Finally, vertexes M were

366

clustered based on their connectivity. All si s in one cluster are regarded as one seed in the

367

watershed segmentation stage. In the seeding procedure, a seed could possibly locate in a

368

hollow gap between cells, giving rise to fake cell regions. Thus, nucleus stack was used

369

to modify these errors. Owing to the impressive performance of DMapNet and automatic

370

seeding, only intensity normalization was needed for nucleus image. Regions were set as
28

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

371

background when the cumulated intensity in the region is smaller than a threshold.

References

1. Sulston, J. E., Schierenberg, E., White, J. G. & Thomson, J. The embryonic cell
lineage of the nematode Caenorhabditis elegans. Developmental Biology 100, 64–
119 (1983).
2. Corsi, A. K., Wightman, B. & Chalfie, M. A transparent window into biology: a
primer on Caenorhabditis elegans. Genetics 200, 387–407 (2015).
3. Bao, Z. et al. Automated cell lineage tracing in Caenorhabditis elegans. Proceedings
of the National Academy of Sciences 103, 2707–2712 (2006).
4. Boyle, T. J., Bao, Z., Murray, J. I., Araya, C. L. & Waterston, R. H. Acetree: a tool
for visual analysis of Caenorhabditis elegans embryogenesis. BMC Bioinformatics 7,
275 (2006).
5. Murray, J. I., Bao, Z., Boyle, T. J. & Waterston, R. H. The lineaging of fluorescentlylabeled Caenorhabditis elegans embryos with StarryNite and AceTree. Nature Protocols 1, 1468 (2006).

29

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

6. Ho, V. W. S. et al. Systems-level quantification of division timing reveals a common
genetic architecture controlling asynchrony and fate asymmetry. Molecular Systems
Biology 11, 814 (2015).
7. Murray, J. I. et al. Multidimensional regulation of gene expression in the C. elegans
embryo. Genome Research 22, 1282–1294 (2012).
8. Moore, J. L., Du, Z. & Bao, Z. Systematic quantification of developmental phenotypes
at single-cell resolution during embryogenesis. Development 140, 3266–3274 (2013).
9. Hench, J., Henriksson, J., Lüppert, M. & Bürglin, T. R. Spatio-temporal reference
model of Caenorhabditis elegans embryogenesis with cell contact maps. Developmental Biology 333, 1–13 (2009).
10. Chen, L. et al. Establishment of signaling interactions with cellular resolution for
every cell cycle of embryogenesis. Genetics 209, 37–49 (2018).
11. Azuma, Y. & Onami, S. Biologically constrained optimization based cell membrane
segmentation in C. elegans embryos. BMC Bioinformatics 18, 307 (2017).
12. Wang, Z., Wang, D., Li, H. & Bao, Z. Cell neighbor determination in the metazoan
embryo system. In Proceedings of the 8th ACM International Conference on Bioinformatics, Computational Biology, and Health Informatics, 305–312 (ACM, 2017).

30

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

13. Arata, Y., Takagi, H., Sako, Y. & Sawa, H. Power law relationship between cell
cycle duration and cell volume in the early embryonic development of Caenorhabditis
elegans. Frontiers in Physiology 5, 529 (2015).
14. Fickentscher, R., Struntz, P. & Weiss, M. Setting the clock for fail-safe early embryogenesis. Physical Review Letters 117, 188101 (2016).
15. Fickentscher, R., Krauss, S. W. & Weiss, M. Anti-correlation of cell volumes and
cell-cycle times during the embryogenesis of a simple model organism. New Journal
of Physics 20, 113001 (2018).
16. Galli, M. & Morgan, D. O. Cell size determines the strength of the spindle assembly
checkpoint during embryonic development. Developmental Cell 36, 344–352 (2016).
17. Gönczy, P. & Rose, L. S. Asymmetric cell division and axis formation in the embryo.
WormBook Otc 15, 1–20 (2005).
18. Rose, L. & Gönczy, P. Polarity establishment, asymmetric division and segregation of
fate determinants in early C. elegans embryos. WormBook Dec 30, 1–43 (2005).
19. Thorpe, C. J., Schlesinger, A., Carter, J. C. & Bowerman, B. Wnt signaling polarizes
an early C. elegans blastomere to distinguish endoderm from mesoderm. Cell 90,
695–705 (1997).

31

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

20. Walston, T. et al. Multiple Wnt signaling pathways converge to orient the mitotic
spindle in early C. elegans embryos. Developmental cell 7, 831–841 (2004).
21. Pilot, F. & Lecuit, T. Compartmentalized morphogenesis in epithelia: from cell to
tissue shape. Developmental Dynamics: an Official Publication of the American Association of Anatomists 232, 685–694 (2005).
22. Lecuit, T. & Lenne, P.-F. Cell surface mechanics and the control of cell shape, tissue
patterns and morphogenesis. Nature Reviews Molecular Cell Biology 8, 633 (2007).
23. Gómez-Gálvez, P. et al. Scutoids are a geometrical solution to three-dimensional
packing of epithelia. Nature Communications 9, 2960 (2018).
24. Xu, M., Wu, Y., Shroff, H., Wu, M. & Mani, M. A scheme for 3-dimensional morphological reconstruction and force inference in the early C. elegans embryo. PLOS
ONE 13, e0199151 (2018).
25. Erick, M. et al. Deep learning for cellular image analysis. Nature Methods (2019).
26. Belthangady, C. & Royer, L. A. Applications, promises, and pitfalls of deep learning
for fluorescence image reconstruction. Nature Methods 1 (2019).

32

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

27. Nath, S. K., Palaniappan, K. & Bunyak, F. Cell segmentation using coupled level sets
and graph-vertex coloring. In International Conference on Medical Image Computing
and Computer-Assisted Intervention, 101–108 (Springer, 2006).
28. Tareef, A. et al. Multi-pass fast watershed for accurate segmentation of overlapping
cervical cells. IEEE Transactions on Medical Imaging 37, 2044–2059 (2018).
29. Koyuncu, C. F., Akhan, E., Ersahin, T., Cetin-Atalay, R. & Gunduz-Demir, C. Iterative h-minima-based marker-controlled watershed for cell nucleus segmentation.
Cytometry Part A 89, 338–349 (2016).
30. Koyuncu, C. F., Cetin-Atalay, R. & Gunduz-Demir, C. Object-oriented segmentation
of cell nuclei in fluorescence microscopy images. Cytometry Part A 93, 1019–1028
(2018).
31. Cooper, S., Barr, A. R., Glen, R. & Bakal, C. NucliTrack: an integrated nuclei tracking
application. Bioinformatics 33, 3320–3322 (2017).
32. Li, F., Zhou, X., Zhao, H. & Wong, S. T. Cell segmentation using front vector flow
guided active contours. In International Conference on Medical Image Computing
and Computer-Assisted Intervention, 609–616 (Springer, 2009).

33

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

33. Seroussi, I., Veikherman, D., Ofer, N., Yehudai-Resheff, S. & Keren, K. Segmentation
and tracking of live cells in phase-contrast images using directional gradient vector
flow for snakes. Journal of Microscopy 247, 137–146 (2012).
34. Molnar, C. et al. Accurate morphology preserving segmentation of overlapping cells
based on active contours. Scientific Reports 6, 32412 (2016).
35. Dimopoulos, S., Mayer, C. E., Rudolf, F. & Stelling, J. Accurate cell segmentation in
microscopy images using membrane patterns. Bioinformatics 30, 2644–2651 (2014).
36. Kiss, A. et al. Segmentation of 3D images of plant tissues at multiple scales using the
level set method. Plant Methods 13, 114 (2017).
37. Sharp, T. A., Merkel, M., Manning, M. L. & Liu, A. J. Inferring statistical properties
of 3D cell geometry from 2D slices. PlOS ONE 14, 1–18 (2019).
38. Xing, F. & Yang, L. Robust nucleus/cell detection and segmentation in digital pathology and microscopy images: a comprehensive review. IEEE Reviews in Biomedical
Engineering 9, 234–263 (2016).
39. Weigert, M. et al. Content-aware image restoration: pushing the limits of fluorescence
microscopy. Nature Methods 15, 1090 (2018).

34

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

40. Weigert, M., Royer, L., Jug, F. & Myers, G. Isotropic reconstruction of 3D fluorescence microscopy images using convolutional neural networks. In International
Conference on Medical Image Computing and Computer-Assisted Intervention, 126–
134 (Springer, 2017).
41. Lee, S., Han, S., Salama, P., Dunn, K. W. & Delp, E. J. Three dimensional blind image deconvolution for fluorescence microscopy using generative adversarial networks.
arXiv preprint arXiv:1904.09974 (2019).
42. Zhang, H. et al. High-throughput, high-resolution deep learning microscopy based
on registration-free generative adversarial network. Biomedical Optics Express 10,
1044–1063 (2019).
43. Huo, Y. et al. Synseg-net: Synthetic segmentation without target modality ground
truth. IEEE Transactions on Medical Imaging 38, 1016–1025 (2018).
44. Karimi, D. et al. Accurate and robust deep learning-based segmentation of the prostate
clinical target volume in ultrasound images. Medical Image Analysis 57, 186–196
(2019).
45. Ounkomol, C., Seshamani, S., Maleckar, M. M., Collman, F. & Johnson, G. R. Labelfree prediction of three-dimensional fluorescence images from transmitted-light microscopy. Nature Methods 15, 917–920 (2018).
35

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

46. Boyd, N., Jonas, E., Babcock, H. P. & Recht, B. DeepLoco: Fast 3D localization
microscopy using neural networks. bioRxiv preprint bioRxiv: 267096 (2018).
47. Han, L., Murphy, R. F. & Ramanan, D. Learning generative models of tissue organization with supervised gans. In 2018 IEEE Winter Conference on Applications of
Computer Vision (WACV), 682–690 (IEEE, 2018).
48. Christiansen, E. M. et al. In silico labeling: Predicting fluorescent labels in unlabeled
images. Cell 173, 792–803 (2018).
49. Ronneberger, O., Fischer, P. & Brox, T. U-net: Convolutional networks for biomedical
image segmentation. In International Conference on Medical Image Computing and
Computer-assisted Intervention, 234–241 (Springer, 2015).
50. Shen, D., Wu, G. & Suk, H.-I. Deep learning in medical image analysis. Annual
Review of Biomedical Engineering 19, 221–248 (2017).
51. Raza, S. E. A. et al. Micro-net: A unified model for segmentation of various objects
in microscopy images. Medical Image Analysis 52, 160–173 (2019).
52. Murata, T., Hotta, K., Imanishi, A., Matsuda, M. & Terai, K. Segmentation of cell
membrane and nucleus using branches with different roles in deep neural network.
In 11th International Conference on Bio-Inspired Systems and Signal Processing,

36

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

BIOSIGNALS 2018-Part of 11th International Joint Conference on Biomedical Engineering Systems and Technologies, BIOSTEC 2018, 256–261 (2018).
53. Eschweiler, D. et al. CNN-based preprocessing to optimize watershed-based cell
segmentation in 3D confocal microscopy images. arXiv preprint arXiv:1810.06933
(2018).
54. Gonda, F., Wei, D., Parag, T. & Pfister, H. Parallel separable 3D convolution for video
and volumetric data understanding. arXiv preprint arXiv:1809.04096 (2018).
55. Ye, R., Liu, F. & Zhang, L. 3D depthwise convolution: Reducing model parameters
in 3D vision tasks. arXiv preprint arXiv:1808.01556 (2018).
56. Ni, T., Xie, L., Zheng, H., Fishman, E. K. & Yuille, A. L. Elastic boundary projection
for 3D medical imaging segmentation. arXiv preprint arXiv:1812.00518 (2018).
57. Brügger, R., Baumgartner, C. F. & Konukoglu, E. A partially reversible U-Net for
memory-efficient volumetric image segmentation. arXiv preprint arXiv:1906.06148
(2019).
58. Cao, J., Wong, M.-K., Zhao, Z. & Yan, H. 3DMMS: robust 3D membrane morphological segmentation of C. elegans embryo. BMC Bioinformatics 20, 176 (2019).

37

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

59. Yushkevich, P. A., Gao, Y. & Gerig, G. ITK-SNAP: An interactive tool for semiautomatic segmentation of multi-modality biomedical images. In 2016 38th Annual
International Conference of the IEEE Engineering in Medicine and Biology Society
(EMBC), 3342–3345 (IEEE, 2016).
60. Guan, G. et al. System-level quantification and phenotyping of early embryonic morphogenesis of Caenorhabditis elegans. bioRxiv preprint bioRxiv: 776062 (2019).
61. Priess, J. R. Notch signaling in the C. elegans embryo. WormBook Jun 25, 1–16
(2005).
62. Li, X. et al. Systems properties and spatiotemporal regulation of cell position variability during embryogenesis. Cell reports 26, 313–321 (2019).
63. Langenhan, T. et al. Latrophilin signaling links anterior-posterior tissue polarity and
oriented cell divisions in the C. elegans embryo. Developmental Cell 17, 494–504
(2009).
64. Willis, L. et al. Cell size and growth regulation in the Arabidopsis thaliana apical
stem cell niche. Proceedings of the National Academy of Sciences 113, E8238–E8246
(2016).
65. Fernandez, R. et al. Imaging plant growth in 4D: robust tissue reconstruction and
lineaging at cell resolution. Nature Methods 7, 547–553 (2010).
38

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

66. Xingjian, S. et al. Convolutional LSTM network: A machine learning approach for
precipitation nowcasting. In Advances in Veural Information Processing Systems,
802–810 (2015).
67. Wang, G., Li, W., Ourselin, S. & Vercauteren, T. Automatic brain tumor segmentation
using cascaded anisotropic convolutional neural networks. In International MICCAI
Brainlesion Workshop, 178–190 (Springer, 2017).
68. Zhang, Y.-D., Pan, C., Chen, X. & Wang, F. Abnormal breast identification by
nine-layer convolutional neural network with parametric rectified linear unit and rankbased stochastic pooling. Journal of Computational Science 27, 57–68 (2018).
69. Otsu, N. A threshold selection method from gray-level histograms. IEEE Transactions
on Systems, Man, and Cybernetics 9, 62–66 (1979).

Acknowledgements The strains were provided by the C. elegans Genetic Center (CGC), which
is funded by National Institutes of Health, Office of Research Infrastructure Programs, Grant
P40 OD010440. This work was supported by the Hong Kong Research Grants Council (HKBU12100118, HKBU12100917, HKBU12123716), the HKBU Interdisciplinary Research Cluster
Fund, the Ministry of Science and Technology of China (2015CB910300), the National Natural
Science Foundation of China (91430217), Hong Kong Research Grants Council (Project C100715G) and City University of Hong Kong (Project 9610460).

39

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

Author Contributions H.Y., Z.Z., C.T. conceived and coordinated the study. J.C. designed the
cell-segmentation algorithm ; G.G. analysed the segmentation results. M.W., L.C. performed imaging and embryo curation. Z.Z. provided reagents and experimental methods. J.C., G.G. wrote the
manuscript ; H.Y., Z.Z., C.T. revised the manuscript. All the authors reviewed the results and
approved the final version of the manuscript.

Competing Interests The authors declare that they have no competing financial interests.

Correspondence Correspondence and requests for materials should be addressed to Chao Tang,
Zhongying Zhao, Hong Yan. (email: tangc@pku.edu.cn, zyzhao@hkbu.edu.hk, h.yan@cityu.edu.hk).

40

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

Supplementary

A

B

C

Figure S1: Comparison of CShaper and naive binary segmentations. (A) Raw image. (B)
and (C) are segmentations of naive binary and CShaper, respectively.

41

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

Figure S2: Spatio-temporal reference of wild-type C. elegans embryonic morphogenesis.
Take the 8-cell stage for example and illustration. x, y, z axes represent anterior-posterior
(A-P), left-right (L-R), dorsal-ventral (D-V) axes respectively. Each color represents one
specific cell identity, noted in legend. (A) 3D structure, y projection and x projection
of cell morphology in 4 wild-type embryo samples. (B) Distribution of nucleus position
in 17 wild-type embryo samples. Each point represents a cell’s nucleus position in one
embryo sample. (C) Spatial deviation and cell-cell contact
of sphere
PNmapping. 2 Radius
1
represents spatial deviation ∆rSTD defined by ∆rSTD = [( i=1 |ri − r̄| )/N ] 2 ; gray lines
represent reproducible and effective contact between cells, under arbitrary filter criteria
(Scontact /Ssurface > 1/36; Tcontact ≥ 3min; Nreplicate = Nembryo ).

42

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

Figure S3: 4-dimensional morphological evolution during C. elegans embryogenesis. Take
ABp and its daughters ABpl, ABpr as example and illustration. x, y, z axes represent
anterior-posterior (A-P), left-right (L-R), dorsal-ventral (D-V) axes respectively. Green,
ABa ; red, ABpl ; blue, ABpr. Evolution dynamics is shown in rows which represent
different developmental timing noted on left (Tabel. S2). The first column is nucleusposition distribution from 17 wild-type embryo samples. The second to fifth columns are
reconstructed cell morphology from the 4 wild-type embryo samples.

43

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

A

H

B

C

D

E

F

G

I

J

K

Figure S4: The application of CShaper on plant tissue. (A, H) are segmentations of
MARS and CShaper shown in 3D. (B-D, (E-G) and (I-K) are three orthogonal sections of
MARS’s segmentation, raw image and CShaper’s segmentation, respectively.

44

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

16 ×128 ×128 ×16

16 ×128 ×128 ×112

16 ×128 ×128 ×16

22 ×128 ×128 ×16

24 ×

8
×12
128

16 ×

64 ×

64

32

16 ×128 ×128 × 64

2

2×
0×3

20 × 64 × 64 × 32

/4

Residual block

Upsampling

3× 3× 1 Conv

1×1× 3 Conv+

Norm

Norm+PReLU
3× 3× 1 Conv

d

PReLU
3× 3× 1 Conv

Norm
Concatenation

PReLU

Figure S5: Network structure of DMapNet. Multiple neighboring slices are processed by
three residual blocks at three different levels consecutively. Feature maps at high levels are
resized into the same size as the input image with linear interpolation. In order to remedy
the lost information, raw images are downsampled and concatenated into the feature maps.
The complete distance map of one volume is achieved by combining multiple predictions.

45

28

=

22 ×

16 ×128 ×128 × 32

20 × 64 × 64 × 32

/2

Downsampling

×1
128

46

Dataset

Name of Wild-Type Embryo

With Annotation

Usage

Training

170704plc1p2{27}, 181215plc1p1{27}

Yes

Training DMapNet

Testing

170704plc1p2 {7}, 181210plc1p3{7},
190314plc1p3 {7}

Yes

Comparing methods

No

Extensive evaluation and
spatio-temporal reconstruction

170704plc1p2 {200}, 181210plc1p1 {200},
181210plc1p2 {200}, 181210plc1p3 {200}
Note: Number in the bracket {*} represents the frames in the wide type.
Reference construction

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

Table S1: Datasets (with membrane marker) description

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

47

Table S2: Time segmentation on developmental process from 4- to 350-cell stage.
First Moment
Last Moment
First Moment
Last Moment
Division Event
Division Event
(min)
(min)
(min)
(min)
AB2
E1
/
0.00±0.00 {01}
4.88±0.86 {04}
22.29±1.82 {10}
E2
AB4
1.53±0.26 {02}
15.45±1.49 {07}
23.74±1.87 {12}
62.21±4.53 {25}
E4
AB8
17.67±1.30 {08}
32.25±2.83 {15}
65.69±5.01 {26} 106.92±5.34 {39}
E8
113.14±5.66 {41} 175.11±6.86 {52}
AB16
35.21±3.22 {18}
56.47±3.80 {23}
E16
AB32
60.92±4.11 {24}
84.84±5.15 {32}
191.30±6.79 {54}
/
C1
AB64
92.25±5.15 {34} 118.51±5.60 {44}
8.85±1.21 {06}
25.92±2.60 {13}
C2
AB128
134.41±6.13 {46} 159.97±4.64 {50}
27.37±2.61 {14}
49.85±3.47 {21}
C4
51.91±3.65 {22}
81.15±4.85 {31}
AB256
190.98±4.70 {53}
/
C8
EMS
/
3.43±0.82 {03}
88.20±5.55 {33} 115.85±6.12 {43}
C16
143.16±7.27 {47}
/
P2
/
7.40±1.22 {05}
D1
MS1
4.88±0.86 {04}
21.18±1.71 {09}
34.38±2.90 {16}
68.21±5.97 {28}
D2
MS2
22.63±1.76 {11}
42.00±3.12 {19}
69.66±5.98 {29} 112.53±6.83 {40}
D4
MS4
43.96±3.43 {20}
67.75±4.55 {76}
115.77±7.34 {42} 155.45±7.15 {49}
MS8
72.20±4.91 {30}
97.58±5.76 {35}
D8
163.81±7.13 {51}
/
P3
MS16
104.74±6.14 {38} 130.54±6.05 {45}
8.85±1.21 {06}
32.93±2.88 {16}
P4
MS32
153.27±6.10 {48}
/
34.38±2.90 {17}
99.90±6.89 {36}
Z2/Z3
101.35±6.90 {37}
/
Note: Number in the bracket{*} represents the order of the 54 division events (frames).

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

48

Table S3: Cells with missing information during 4- to 350-cell stage in the 4 embryos expressing membrane marker
(30.7%).
‘ABalp’
‘ABalpp’
‘ABaraa’
‘ABplap’
‘ABplpp’
‘ABalpap’
‘ABpraaa’
‘ABpraap’
‘ABprpap’
‘ABalapap’
‘ABaraaaa’
‘ABarappa’
‘ABarpaaa’
‘ABarpaap’
‘ABarppaa’
‘ABarpppa’
‘ABplapaa’
‘ABprapaa’
‘ABprappp’
‘ABalaaaal’
‘ABalaaaar’
‘ABalaaapp’ ‘ABalaapaa’ ‘ABalaapap’ ‘ABalaappa’ ‘ABalapaaa’ ‘ABalapaap’
‘ABalapapa’
‘ABalappaa’ ‘ABalappap’ ‘ABalapppa’ ‘ABalpaaaa’ ‘ABalppaap’ ‘ABarapaaa’
‘ABarapapa’
AB Lineage
‘ABarappaa’ ‘ABarappap’ ‘ABarpaaaa’ ‘ABarpaaap’ ‘ABarpaapa’ ‘ABarpaapp’
‘ABarpapaa’
(81 / 254, 31.9 %)
‘ABarpapap’ ‘ABarpappa’ ‘ABarppaaa’ ‘ABarppaap’ ‘ABarppapa’ ‘ABarppapp’
‘ABarpppaa’
‘ABarppppa’ ‘ABarppppp’ ‘ABplaaaaa’ ‘ABplaaaap’ ‘ABplaaapa’ ‘ABplaapaa’
‘ABplaapap’
‘ABplapaaa’ ‘ABplapaap’ ‘ABplapapa’ ‘ABplapppa’ ‘ABplapppp’ ‘ABplpaaap’
‘ABplpappp’
‘ABplppapp’ ‘ABplpppaa’ ‘ABplpppap’ ‘ABplppppp’ ‘ABpraaaaa’ ‘ABpraaaap’
‘ABpraapaa’
‘ABpraapap’ ‘ABprapaaa’ ‘ABprapaap’ ‘ABprapapa’ ‘ABprapapp’ ‘ABprapppa’
‘ABprapppp’
‘ABprpaaap’ ‘ABprpappp’ ‘ABprppaaa’ ‘ABprppppp’
/
/
/
MS Lineage
‘MSap’
‘MSaap’
‘MSaaap’
‘MSaapp’
‘MSappa’
‘MSppap’
/
(6 / 31, 19.4 %)
E Lineage
‘Ealp’
‘Eara’
‘Earp’
‘Epla’
‘Epra’
/
/
(5 / 15, 33.3 %)
C Lineage
‘Ca’
‘Cp’
‘Cap’
‘Caap’
‘Capa’
‘Cpap’
/
(6 / 15, 40 %)
D Lineage
‘D’
‘Dap’
/
/
/
/
/
(2 / 7, 28.6 %)
Others
(‘EMS’, ‘P2’, ‘P3’, ‘P4’)
/
/
/
/
/
/
/
(0 / 4, 0 %)
Note: For AB2, EMS, P2 with incomplete lifespan recorded, only duration between 4-cell stage and 8-cell stage was considered
; for AB4-AB128, MS1-MS16, E1-E8, C1-C8, D1-D4, P3, P4 which have complete cell cycle in all the 17 wild-type embryos, all
the time points in their lives were taken into account ; for each cell, if the membrane signal is too dim at any time point and cause
failure in precise cell segmentation, the cell would be regarded invalid with missing information.

bioRxiv preprint doi: https://doi.org/10.1101/797688; this version posted October 8, 2019. The copyright holder for this preprint (which was not
certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is made available under
aCC-BY-NC-ND 4.0 International license.

Note 1: In CShaper, there are three discriminative situations where nucleus derived from
AceTree cannot be found:

1. The boundary between two cells (not sisters) is too week to be extracted by DMapNet, therefore, two cells are segmented as one cell during the watershed transformation;
2. Membrane signal is lost at boundary of the embryo, which leads to the leakage of
the background into the embryo;
3. In CShaper, we determine the accomplishment of division stage by checking the
signal intensity on the line between sister cells’ nuclei. However, when the intensity
drops at the middle of lifespan, the sister cells may be combined as their mother cell,
leading to missing cells.

We exclude these mistakes by combining the nucleus lineage from AceTree and segmentations from CShaper.

49

