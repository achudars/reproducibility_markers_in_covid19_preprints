bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

A hybrid PDE–ABM model for viral dynamics with
application to SARS–CoV–2 and influenza
Sadegh Marzban 1 , Renji Han 1 , Nóra Juhász 1 , and Gergely Röst1
1

Bolyai Institute, University of Szeged, H-6720 Szeged, Hungary

Corresponding Author: Sadegh Marzban
e-mail: sadegh.marzban@math.u-szeged.hu
Abstract
We propose a hybrid partial differential equation – agent-based (PDE–ABM) model to
describe the spatio-temporal viral dynamics in a cell population. The virus concentration
is considered as a continuous variable and virus movement is modelled by diffusion, while
changes in the states of cells (i.e. healthy, infected, dead) are represented by a stochastic
agent-based model. The two subsystems are intertwined: the probability of an agent
getting infected in the ABM depends on the local viral concentration, and the source
term of viral production in the PDE is determined by the cells that are infected.
We develop a computational tool that allows us to study the hybrid system and the generated spatial patterns in detail. We systematically compare the outputs with a classical
ODE system of viral dynamics, and find that the ODE model is a good approximation
only if the diffusion coefficient is large.
We demonstrate that the model is able to predict SARS–CoV–2 infection dynamics, and
replicate the output of in vitro experiments. Applying the model to influenza as well, we
can gain insight into why the outcomes of these two infections are different.
Keywords: hybrid model, spatiotemporal dynamics, agent based model, viral kinetics,
virus diffusion, infection, SARS–CoV–2, influenza

1.

Introduction

A widely used concept to mathematically describe in-host viral dynamics is to model the
main quantities by means of an ODE system. While this method proves to be extremely
useful in many applications, the richness of information it can provide is naturally limited
since it uses time as its single variable – in several research areas it is necessary to extend
the cornerstone ideas of this model in order to grasp and investigate important spatial
aspects as well. In the case of modelling the in-host spread of COVID-19 and influenza,
we can benefit from taking into account the major size difference between viruses and
cells of the body: as a result we have developed a hybrid partial differential equations
– agent based model (PDE–ABM) spatiotemporal system, where virus concentration is

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

modeled as a continuous variable, while for the case of epithelial cells we take a discrete
spatial approach. Our implementation of the latter model is based on a free and open
source software package, HAL (Hybrid Automata Library). The present article has two
main focuses: firstly, we explore the similarities and differences between the classical ODE
model and the hybrid PDE-ABM model by observing the temporal evolution of cells and
viral concentration in the respective systems. Secondly, we investigate the results that
are found beyond the limitations of the ODE model, i.e. we explore conclusions that can
be drawn exclusively from the more complex spatiotemporal PDE-ABM model. Finally,
for completeness we include well-posedness theorems regarding the two main systems.
Mathematical models are powerful tools in the hands of research teams across the globe
since the appearance of the COVID-19 disease caused by the novel SARS-CoV-2 coronavirus.
In the currently still ongoing and virtually unprecedented pandemic circumstances these
mathematical models are invaluable as they are able to optimize high-impact decisions and
make successful predictions based on computer simulations alone. This means that their
results are obtained at an ideally low cost in a complex situation where real-life and realtime experiments to obtain these same results would be either extremely risky or simply
not possible. A further advantage of these models is their wide range of applicability:
mathematical models can be used in large-scale problems as for example forecasting the
effect of mass vaccination programs or a nation-wise lockdown, but they can equally be
applied for small-scale phenomena such as analysing a drug’s mechanism of action or the
viral transmission between individual cells. The present article focuses on the latter: we
use a hybrid mathematical approach to study the in-host spread of SARS-CoV-2 infection
on a cellular level.
Throughout the investigation of the above mentioned hybrid model we need a simple and
already comprehensively understood model we can use as a reference system – for this
purpose we will consider a specific version of an ODE prototype model, the May-Nowak
system (for an extensive overview see [5]; while for concrete applications we refer to [3],
[4] and [16]). This classical model is given by


t > 0,

 Ht = −βHV,
It = βHV − δI, t > 0,


 V = pI − cV,
t > 0,
t

where the H = H(t), I = I(t) and V = V (t) functions respectively correspond to the
number of healthy cells, infected cells and virus particles, and they depend on time only.
This model plays a crucial part in our article in several ways: a) in the development process
of the more sophisticated hybrid model we use the ODE model to compare and match
the respective solutions, b) we exploit the fact that there is more information available on
the exact parameters of this classical model and use their converted version in the hybrid
system, and finally, c) we can demonstrate both the advantages and challenges offered by
the relatively new hybrid system in comparison to a well-known model.
The above ODE model can not capture the effects of spatial spread, and hence it undoubtedly ignores any occurring spatial phenomenon. In several biological applications

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

we simply can not afford to leave out such an important factor from the main model: the
most obvious example for this is virus diffusion itself, which makes it possible for viruses
to physically reach susceptible cells in the first place. One of the most powerful tools
that does capture these crucial spatial mechanisms is the rich analytical theory of partial
differential equations – PDE models are often used to investigate complex systems in viral
infection dynamics, see [1, 2, 3] just to mention a few examples.
Agent-based modeling is another (and in fact quite different) approach to describe complex
space-time dynamics in viral spread. The cornerstone idea of this method is to define a
discrete heterogeneous state space where the so-called agents or elements have collective
interactions with each other and they change their states correspondingly [6, 7]. The
ABM concept has several important applications within the field of virus dynamics; in
[10] the authors have used agent-based models to evaluate COVID-19 transmission risks,
[9] focuses on the spatiotemporal dynamics of influenza, while [8] approaches the topic of
viral infections from another viewpoint, here the authors investigate interactions between
innate and adaptive immunity.
As seen above, different frameworks – including agent-based models and PDE systems –
have been applied to construct viral dynamics models. An agent-based model is a great
tool to include randomness and natural variability into the system, while PDEs are faster
to evaluate numerically: by forming bridges between these two modeling strategies we
arrive to a hybrid system, the so-called hybrid PDE-ABM model, which unites the different
advantages of these methods (see [11]). Hybrid PDE-agent-based models have been under
intense investigation in several fields of biology. Butner et al. [12] presented a hybrid model
to study the role of biological factors (such as cellular differentiation pathways, endocrine
levels etc.) during the development of the mammary gland, where PDEs are used to model
biologically relevant molecular distributions and agents represent cells. In [13], Garbey et
al. studied a hybrid PDE-ABM model to analyze vascular adaptation. However, to our
knowledge, this hybrid approach has not yet been applied to explore the specific topic of
viral infections’ spatiotemporal dynamics. In fact, this is exactly what the main novelty of
the present article consists in: while both the PDE-ABM hybrid model as a mathematical
construction and the most urging current biological questions are already well-known, we
bring these separately existing concepts into one single framework and examine several
fundamental viral dynamic features in a new light. For the purpose of investigating the
viral spread of SARS-CoV-2 and influenza, our hybrid model is chosen and tailored by
carefully considering certain dimension-related aspects of the problem: virus particles are
several magnitude smaller than body cells ([25], [26], [27]), and as a consequence, it is
natural to capture virus concentration by a continuous function, while cells are modeled
in a straightforward way as discrete entities in space. In other words, we obtain our
hybrid model by merging a) a PDE representing virus concentration, and b) an agentbased model describing body cells and their three possible states (healthy, infected, and
dead). We complete the hybrid PDE-ABM model by formulating a meaningful connection
between the separate parts, i.e. by giving definition to all the considerable interactions and
feedback processes that take place between the model’s discrete and continuous parts, such
as for example cells responding to their environment’s virus concentration level. Then we

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

explore the emerging spatio-temporal dynamics in detail, and apply the model to SARS–
CoV–2 and influenza infections.

2.

Methods

The purpose of this section is to give a detailed description of the two main systems
we use to model virus spread. We begin by defining the hybrid PDE–ABM model and
introducing its variables, then we briefly outline a classical ODE model – the latter can
be viewed as a simpler mean-field model that approximates the more complex hybrid
framework by averaging over spatial variables. Once all the fundamental features of both
systems are defined, we continue this section by expressing the connection between the
corresponding model parameters, and conclude with the numerical implementation of the
hybrid system.

2.1

The hybrid PDE–ABM model

As described in the Introduction, the main hybrid system is constructed via forming
bridges between two important and rather different modeling techniques: we merge a
discrete agent based model and a continuous PDE, and we create a meaningful connection
between them by carefully designing their interactions with each other. We highlight the
fact the model we obtain this way is defined in both space and time.
We begin by setting the notation for the domain we construct our model upon: let Ω be
the mathematical representation of the part of lung tissue (or, in the case of an in vitro
investigation, the relevant area of the examination) we are considering – for consistency
reasons, we assume that Ω is an open set. Now we are ready to introduce the discrete
part of our hybrid system.
One of the most important modeling decisions in the first part of the model construction
is approaching epithelial cells as discrete agents. In more detail, we define a two dimensional ABM state space by introducing a lattice of k1 × k2 agents representing lung cells:
naturally, k1 , k2 ∈ N, and cells are identified via the (i, j) indices (corresponding to the
respective agent’s place in the grid), where (i, j) ∈ L = {(i, j)|1 ≤ i ≤ k1 , 1 ≤ j ≤ k2 }.
By introducing
S the Ωi,j notation for the open set occupied by the (i, j)-th cell, we obtain
that Ω̄ =
Ω̄i,j .
(i,j)∈L

Regarding the states of the ABM space’s agents, each agent can have three possible states
in our approach. This is formally grasped by following state function, which represents
the concept that a cell is either healthy, infected, or dead :


H, if the (i, j)-th cell is healthy at time t
si,j (t) = I, if the (i, j)-th cell is infected at time t


D, if the (i, j)-th cell is dead at time t.
In terms of state dynamics, we use the following assumptions:

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

• for simplicity, we do not account for cell division or cell birth taking place during
the time frame of the infection;
• the only reason for cell death is viral infection itself, i.e. death related to any other
natural cause is ignored;
• all healthy cells are susceptible target cells;
• once a cell gets infected, it is not possible for it to become healthy again;
• the healthy → infected state change: a healthy cell may become infected once the
virus has reached the given cell; moreover, infection is randomized and it occurs
with a probability of PI , where we highlight that PI increases linearly with the virus
concentration in the given cell (for more details see Section 2.3 on PI ’s relationship
to other parameters and Section 2.4 on implementation);
• the infected → dead state change: an infected cell dies with a probability of PD , but
similarly to infection, death too is approached from a stochastic viewpoint.
The stochastic element in the above state changes is of key importance. The inclusion of
natural randomness makes the complex PDE-ABM hybrid model not only more realistic
than the relatively simple ODE model, but also compared to a pure PDE system.
We note that apart from following the state changes of all cells on an individual level,
we also introduce three additional system variables as functions taking discrete (in fact,
natural) values: H(t), I(t) and D(t) respectively denote the total number of healthy,
infected, and dead cells in the two-dimensional ABM state space.
Now we are ready to consider the second part of our hybrid model. Let us begin by
observing that the size of an epithelial cell is relatively significant ([26], [27]) and hence
indeed it was a natural idea above to define cells as separate entities and follow their states
on an individual level (instead of exclusively considering the total number of healthy,
infected and dead cells as continuous functions for example). One of the cornerstone
observations in the second part of the model is that viruses, on the other hand, are several
magnitude smaller compared to epithelial cells [25] – we incorporate this simple but crucial
biological fact into our system by modeling virus concentration as a continuous function.
Hence, in the second part of the model we approach virus concentration V h = V h (t, x, y)
as a variable that is continuous in both space and time, and as such, we capture it by
means of a partial differential equation:
X
∂V h (t, x, y)
= DV ∆V h − µV · V h (t, x, y) +
gi,j (t, x, y),
∂t

t > 0, (x, y) ∈ Ω,

(1)

(i,j)∈L

where DV denotes the virus diffusion coefficient, µV is a constant ratio representing virus
removal, while gi,j stands for the viral source term (the latter is assumed to be continuous)
for the (i, j)-th cell. The above equation essentially grasps the basic concept that viruses
spread across the domain primarily via diffusion (convective flows are ignored in this

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

model), the immune system removes viruses in a constant ratio, while new virus particles
are generated by infected cells in a process described by the gi,j functions:

0,
if si,j (t) = H and (x, y) ∈ Ωi,j



f (t, x, y), if s (t) = I and (x, y) ∈ Ω
i,j
i,j
i,j
gi,j (t, x, y) =
(2)

0,
if
s
i,j (t) = D and (x, y) ∈ Ωi,j



0
if (x, y) ∈
/ Ωi,j
We point out that in the above formula we do not specify any particular exact fi,j (t, x, y)
form for the viral source term gi,j (t, x, y) for the case when si,j (t) = I and (x, y) ∈ Ωi,j
(i.e. when the (i, j)-th cell is infected). As noted in [21], very little is known about the
shape, duration and magnitude of viral burst, and hence, we allow any reasonable and
smooth fi,j (t, x, y) function here that meets the following two criteria. Firstly, any concrete
choice for gi,j needs to represent the general fact the (i, j)-th epithelial cell starts secreting
virions at some point after it becomes infected. Thus, naturally, gi,j takes positive values
at least in some subset of Ωi,j at some point after the event of infection (but of course, at
formulated above, outside of this given cell gi,j is zero). Secondly, the gi,j function needs
to be defined in a way so that the well-posedness of system (1) is guaranteed: specifically,
any concrete definition of the viral source term has to be Hölder continuous with Hölder
α
exponent α ∈ (0, 1), i.e. we assume gi,j (t, x, y) ∈ C 2 ,α ((0, ∞) × Ω̄) for any t > 0,(x, y) ∈ Ω̄
and any (i, j) ∈ L. The latter ensures the global existence of system (1)’s solution (see
Appendix A). As an example, we can consider a definition where we use the mollified
version of a constant rate release within the (i, j)-th cell. As for the details and changes
related to the construction of gi,j in the implementation process, see Section 2.4.
The PDE-ABM hybrid model can not be complete without explicitly taking into account
the meaningful interactions that each part-system has on the other, hence we briefly highlight these connections again. The continuous viral part effects the agent-based subsystem
through the healthy → infected state change described in the ABM section above. On
the other hand, the discrete ABM part makes a difference within the continuous viral
equation thanks to the gi,j source functions (representing the fact that once a cell gets
infected, at some point it starts spreading the virus).

2.2

The ODE model

In this subsection we consider a simpler viral dynamics system which will serve as a reference model for the hybrid framework in our epidemiological investigations. We consider
the following – only time-dependent – ODE system:

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.











dH(t)
= −βH(t)V (t),
dt
dI(t)
= βH(t)V (t) − δI(t),
dt
dV (t)
= pI(t) − cV (t),
dt
dD(t)
= δI(t),
dt

t > 0,
t > 0,

t > 0,




t > 0,



 H(0) = H ≥ 0, I(0) = I ≥ 0, V (0) = V ≥ 0, D(0) = D ≥ 0,
0
0
0
0

(3)

where the H(t), I(t), V (t), D(t) functions represent the number of healthy cells, the number of productively infected cells, the number of viruses released by infected cells and the
dead cells at time t, respectively; β denotes the healthy cells’ infection rate, δ stands for
the death rate of infected cells, p is the virus production rate, and c is the virus removal
rate. We emphasise the fact that unlike the hybrid PDE-ABM model, the above ODE
system is not defined in space.
Technically, the V (t) function can be defined to represent either the number of viruses or
the virus concentration itself depending on the specific application we are considering. In
Section 3’s simulation results V (t) stands for concentration.
Simply because of the physical meaning behind these functions, the respective initial
values are naturally set in the region Γ = {(u1 , u2 , u3 , u4 ) ∈ R4 : u1 , u2 , u3 , u4 ≥ 0}. For
the well-posedness and uniform boundedness of model (3) see Appendix B.
Setting the right-hand side of the equations in (3) equal to zero, we obtain that there
are at most two kinds of ecologically meaningful equilibria in R4+ : the extinct equilibrium e0 (0, 0, 0, 0) and the infection-free equilibrium e∗ (H0 , 0, 0, 0). The basic reproduction
number of system (3) is given by
pβH0
,
(4)
R0 =
cδ
for the derivation of this number and how it governs the threshold dynamics of the system,
see Appendix C.

2.3

The connection between the two main models and their parameters

In this subsection we examine the relationship between the two main models’ respective
parameters. Expressing these connections is not always a trivial task as the hybrid PDEABM framework exists in space, while the ODE model’s functions are defined as variables
only in time. In order to match the two different systems’ corresponding parameters, we
need to fix some basic features of the spatial domain: first of all, let A denote the complete
area of the state space; moreover, for simplicity let us assume that each cell has the area
of a unit space – for the latter we introduce the notation σ 2 . Finally, let τ denote the unit
step in time.
1. Parameters related to cell death: We emphasise that the two main models use
different approaches to quantify the chance of an infected cell’s death – on the one
hand, the (3) ODE model works with a δ death rate; on the other hand, the hybrid

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

system uses a PD probability. We can easily obtain a conversion between probability
and rate by following the exact meaning behind these parameters. When infected
cells die with a death rate δ, their natural decay can be described by the function
e−δt ; hence, the probability of an infected cell’s death between any two arbitrary
time points t1 and t2 is given by
e−δt1 − e−δt2
= 1 − e−δ(t2 −t1 ) .
e−δt1
Specifically, for a time interval of length τ the above formula means that an infected
cell dies within that given time frame with a probability of 1 − e−δτ .
Applying the Taylor expansion of the exponential function and combining it with
the fact that τ is small, we arrive to the 1 − e−δτ ≈ δτ approximation, i.e. we the
connection between δ and PD is given by
PD ≈ δ · τ.

(5)

2. Parameters related to new infections: In the (3) ODE model the first equation
corresponds to the infection of healthy cells: in other words, the β · V · H term
represents new infections per unit time, where β is the infection rate, V is the
total number of viruses, and H is the total number of healthy cells at a given time.
Respectively, in the PDE-ABM hybrid model we define the probability of a cell’s
infection in a way that this probability is directly proportional to the VΩi,j virus
concentration in the (i, j)-th cell (n.b. virus concentration per unit space), to the β
infection rate, to the A area of the domain and to the τ time unit:
PI ≈ β · A · VΩi,j · τ.

(6)

3. Parameters related to virus production: The (3) ODE model’s parameter
p corresponds to virus production rate per unit time. Respectively, in our spatial
hybrid model’s virus dynamical equation (1) the parameter gi,j represents the virus
production rate per unit time per unit space2 – in particular, gi,j = fi,j within
infected cells (see 2), hence, clearly, fi,j matches p.
4. Parameters related to virus removal: Analogously, the respective pair of the
hybrid model’s mV parameter is the ODE system’s c virus removal constant.
5. Parameters related to virus diffusion: We highlight that the hybrid model’s
diffusive constant DV does not have a corresponding parameter in the ODE system,
as the latter model is defined only in time and diffusivity is strictly related to spacial
dimensions.
We summarize the respective parameters’ relationship to each other in Table 1.

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

Table 1: Description of the hybrid PDE-ABM model’s parameters and their relationship
to the ODE system. Naturally, the notations [healthy cell], [infected cell] and [dead
cell] represent a healthy cell, an infected cell and a dead cell – as a unit – respectively.
Analogously, [virion]/σ 2 stands for the concentration unit.
Symbol

Parameter

Unit

Value corresponding
to the ODE model

Probability of infection

PI

β · A · VΩi,j · τ

for the (i, j)-th cell
PD

Probability of death of

δ·τ

an infected cell
fi,j

Virus production rate

[virion]
σ 2 ·τ

p

of an infected cell
DV

Virus diffusion

σ 2 τ −1

µV

Virus removal rate

τ −1

c

H0

The initial number of

[healthy cell]

H0

[infected cell]

I0

[virion]/σ 2

V0

[dead cell]

D0

healthy cells
The initial number of

I0

infected cells
V0h (x, y)

The initial value of
virus concentration

D0

The initial number of
dead cells

τ : time unit

σ: space unit

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

Figure 1: An ABM state space where most cells are healthy, while a small number of
randomly infected cells start spreading the virus in the domain.

2.4

Implementation

This section describes important technical details related to the hybrid PDE-ABM framework’s implementation. Our numerical computations are based on a free and open source
java software package, HAL (Hybrid Automata Library) [14]; our source code is publicly
accessible in the Github repository [15].
We simulate the PDE-ABM model’s behaviour in an Ω ⊂ R2 two-dimensional bounded
h
h
domain, hence the ∆V h Laplacian takes the form of Vxx
+ Vyy
, where (x, y) ∈ Ω. The
resolution of the state space is chosen to be 200 × 200, which means we work with a total
number of 40.000 cells (this choice is mainly due to the hybrid model’s computational
demands – we found that concerning the number of cells 40.000 is a reasonable value for
exploring virus dynamics on an ordinary computer).
In terms of spatial boundary conditions, we assume zero flux on the boundaries of the
hybrid model.
As for the initial conditions in our simulations, we consider the case where we have zero
virus concentration in the beginning, but we do have a small number of infected cells in
the domain to start with – the virus will spread from these infected cells and as a result,
more and more originally healthy cells become infected. As an initial setting, we assume
that 5% of domain’s cells are infected, and these infected cells are distributed randomly
in space. Figure 1 shows the initial state of our hybrid PDE-ABM model.
After giving a clear definition of the initial and boundary conditions in our implementation, we highlight another interesting technical detail: the internal realization of the
virus production functions. At the abstract definition of the hybrid PDE-ABM model we
assumed that the virus source term in (1) was continuous. This was important for certain theoretical reasons (see Appendix A), but as we move on to implementation-related
decisions and solutions, we make a simplifying step regarding this source function. We
take a discretized approach, namely, throughout the simulations, a given cell’s gi,j virus
production function (and in particular, fi,j ) is quantified assuming that infected cells
have a constant virus production rate; formally, gi,j (t, x, y) = a non-zero constant when
si,j (t) = I and (x, y) ∈ Ωi,j . We highlight that what really happens at the implementation

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

process is that in each time loop and for each cell (thus, for all (i, j) ∈ L) we solve equation
(7) to obtain the virus concentration in a given cell:
∂V h (t, x, y)
= DV ∆V h − µV · V h (t, x, y) + gi,j (t, x, y), t > 0, (x, y) ∈ Ωi,j .
(7)
∂t
We also emphasise that in order to make the model as realistic as possible, we take some
probabilistic considerations into account, and as a result we use a stochastic approach in
the implementation of both cell infection and cell death.
• Stochastic implementation of a healthy cell’s infection: In the PI = β · A · VΩi,j
expression (obtained in (6)) we assume that the infection rate β and the A area of
the domain are constant, but VΩi,j is changing in both space and time – once the virus
concentration is recalculated for a given cell, we then compare the correspondingly
I
random number, which is generated newly for each
updated PI value with an ri,j
I
, the cell in question gets infected.
cell. In case the cell’s PI value is greater than ri,j
D
num• Stochastic implementation of an infected cell’s death: Similarly, a random ri,j
ber is generated for each infected cell at each time-step, and the given cell’s death
is determined by comparing this random number with PD : naturally, the infected
D
cell dies if PD is greater than ri,j
.

All of the random numbers noted above are real numbers from standard uniform distribution on the interval (0,1) and they are obtained by means of Java’s random number
generator.
Figure 2 shows the flow diagram of the program we implemented to simulate the virus
spread and observe the spatial distributions of infected cells.

3.

Results

We present and explain our most significant computational results in this section. In
particular, we illustrate the advantages of the spatiotemporal hybrid system over the
classical ODE model, we show an example where we successfully recreate the actual
results of an in vitro experiment assessing SARS-CoV-2 propagation, moreover, by means
of the PDE–ABM system we explore and compare the spatial patterns of influenza and
COVID–19.

3.1

Comparing the hybrid PDE–ABM model and the ODE model
through their solutions

This section is principally dedicated to illustrating the impact of the PDE–ABM model’s
built-in extra information regarding spatial factors such as diffusion. In the following steps
we compare the numerical solutions of the (only time-dependent) ODE model and the
hybrid spatiotemporal PDE–ABM system. We emphasise the fact that in this subsection

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

Figure 2: The program flow diagram of the PDE-ABM model’s numerical simulation
based on HAL.

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

Figure 3: A sample solution of model (3) considering the parameters given in (8) with
H0 = 40000 − I0 , I0 = 20, V0 = 0 and D0 = 0 as initial values. Left Number of cells over
time. Right Virus concentration over time.
we consider a generic scenario that does not necessarily correspond to influenza or SARS–
CoV–2 specifically. Our main goal here is to outline a comparison itself between the
two main models making sure that their parameters represent the same virus infection
in identical circumstances – with the very important exception of virus diffusion, which
incorporates spatial effects.
As for the ODE model’s simulation, we consider the following parameter values:
β = 10−6 , δ = 8 × 10−3 , p = 4 × 10−2 , c = 2 × 10−2 .

(8)

Figure 3 depicts the solution of the ODE model (3) using the parameter values defined in
(8) and the initial conditions H0 = 40000 − I0 , I0 = 20, V0 = 0 and D0 = 0.
Once the ODE parameters are set, most of the corresponding hybrid parameter values are
automatically defined through the connections described in Table 1. We obtain
PI = 0.04 × VΩi,j , PD = 8 × 10−3 , fi,j = 4 × 10−2 , µV = 2 × 10−2 .

(9)

Naturally – due to the fact that the ODE model is defined only in time – the hybrid
system’s diffusion coefficient is an exceptional parameter missing from the list above. To
demonstrate the notable difference made by virus diffusion in the hybrid model’s numerical
solutions (and to compare the latter with the ODE model’s solution), we simulate our
spatial model with two different diffusion coefficients:
DV 1 = 0.2,

DV 2 = 20 · DV 1 = 4.

(10)

Figure 4 and Figure 5 show the different cell and virus dynamics emerging from scenarios
that are identical apart from their diffusion coefficients. Both graphs demonstrate cell
states on the left and virus spread on the right, captured in four different time points.
Infected cells (denoted by red squares) are apparently distributed randomly at the initial
state, virus spread in the domain is clearly originating from infected cells; moreover, the
two figures illustrate that a higher diffusion value results in a higher number of infected
cells.
Similarly, Figures 6 and 7 confirm that different diffusion coefficient values lead to significantly different results regarding the entire system: the inclusion of spatial effects and
the diffusion coefficient itself play a crucial role in virus dynamics.

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

A

B

C

D

Figure 4: Sample hybrid PDE-ABM results considering (9) and DV 1 = 0.2 at t = 0, 240,
480, and 720 (A - D). Infected, healthy, and dead cells (denoted by red, green, and black
squares, respectively) are shown on the left and virus spread is depicted on the right in
all four subfigures (A - D).

A

B

C

D

Figure 5: Sample hybrid PDE-ABM results considering (9) and DV 2 = 4 at t = 0, 240,
480, and 720 (A - D). Infected, healthy, and dead cells (denoted by red, green, and black
squares, respectively) are shown on the left and virus spread is depicted on the right in
all four subfigures (A - D).

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

Figure 6: A sample solution of the hybrid PDE-ABM model considering parameters specified in (9) and DV 1 = 0.2. Left Number of cells over time. Right Virus concentration
over time.

Figure 7: A sample solution of the hybrid PDE-ABM model considering parameters specified in (9) and DV 2 = 4. Left Number of cells over time. Right Virus concentration
over time.
A

B

C

D

Figure 8: Comparison between the ODE model and the hybrid PDE-ABM system with
two different diffusion values (as given in (10)). It is clearly seen that the outputs are very
similar for a high diffusion coefficient, as opposed to the case of low diffusion coefficient.
A Virus concentration over time. B Number of healthy cells over time. C Number of
infected cells over time. D Number of dead cells over time.

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

Finally, in Figure 8 we compare the solution of the ODE system with the respective
numerical solutions calculated for our spatial hybrid model considering the previously
described two different virus diffusion values. Figure 8 illustrates a special relationship
between the solutions of the two main systems: increasing the spatial model’s diffusion
coefficient apparently impacts the hybrid system’s solution in a way that it, roughly
speaking, gets closer to the ODE model’s numerical solution – this corresponds to the
fact that the ODE system represents a scenario where all particles can interact with any
other particle, i.e. in some sense the diffusion coefficient is infinite. In other words, the
lower the actual virus diffusion value is, the more important it is to consider a more
complex spatiotemporal system to model the respective virus spread.

3.2

Applications

In one way or another, all applications of the proposed PDE–ABM hybrid model naturally focus on exploiting or predicting spatial information regarding virus spread. The first
application detailed in Section (3.2.1) is dedicated to the latter; here we perform a simulation to obtain as much information as possible on the spatial dynamics of a COVID–19
infection and we compare our computer-generated predictions with actual results of in
vitro experiments. On the other hand, Section (3.2.2) is dedicated to observing some
important differences between influenza and COVID–19 – these are identified more easily
thanks to the additional spatial information that is integrated into the hybrid model.
3.2.1 Predicting the spatiotemporal spread of SARS–CoV–2 in human airway epithelial
cells
Perhaps one of the most straightforward applications is the prediction of spatial virus
propagation itself. In this first scenario we simulate the spatial spread of a SARS-CoV-2
infection over the course of seven days and we compare our results with real-life observations obtained by scientific experiments. Specifically, we consider Figure(4B) in [29],
where the authors examine the spread of fluorescent SARS-CoV-2 in human airway epithelial cells at the indicated days with or without peptide treatment – naturally, when
we compare our results, we focus on the graphs listed in the line that corresponds to our
scenario (i.e. investigating uninhibited virus propagation excluding any treatment).
Examining Figure(4B) in [29] and Figure 9 of the present article we observe that the
key events and features of virus spread match in a reassuring way: the first significant
and bigger sign of infection appears at day 4, a clearly visible peak is reached at day
6, while a slight decrease in the infection’s severity starts to show between day 6 and
day 7. At the same time we highlight that there is a natural limit to how accurately our
simulations can recreate the specific events depicted in [29]: firstly, to our best knowledge,
the exact values of virus death rate, infection rate and diffusion are not specified in [29].
Secondly, the authors have not disclosed the number of cells they worked with – this
means that the resolution of the corresponding ABM fields are different (theirs being
unknown). The latter is particularly important as it is most likely one of the reasons why
the computer-simulated results are less "sharp" compared to the experimental scenario’s

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

DAY 2

DAY 3

DAY 4

DAY 5

DAY 6

DAY 7

Figure 9: The simulated spatiotemporal dynamics of SARS–CoV–2 virus spread in human
airway epithelial cells – the results were obtained by our source code implementing the
hybrid PDE–ABM model. This sequence of pictures from our model output shows a
striking resemblance to Figure(4B) in [29], where the latter depicts real experimental
results assessing viral propagation.
images: roughly speaking, the generated results resemble ink spreading in water to some
extent, while the in-vitro results have an apparent grain-like structure. This matter can
possibly be the subject of future investigation.
3.2.2 Investigating and comparing the main properties of influenza and COVID-19
While Section 3.1 focused on comparing the ODE model’s and the hybrid system’s respective solutions in a generic scenario, the present – and in some sense, main – section’s goal
is to explore these solutions for two specific viruses, namely, influenza and SARS-CoV-2.
In order to investigate the propagation of an influenza or COVID-19 infection, we need to
set up both of our models with parameters that represent the features of the previously
mentioned viruses as accurately as possible. This is a nontrivial task not only because
SARS-CoV-2 is relatively new for scientists, but also because several other small, technical,
but important issues arise when we want to compare two different kinds of solutions.
The ODE model’s parameter setting is summed up in Table 2. The parameters representing influenza and COVID-19 are defined according to [16] and [18], respectively. We
highlight two practical considerations we used during the parameterization process. i)
Firstly, in order to make sure that the respective results of the ODE system and the hybrid model are comparable, we need to initialize them with the same number of healthy
cells. Due to the high computational load of the latter system, this number is naturally
limited – in our case we use H0 = 4 × 104 . However, this number is lower than the number
of healthy cells used in [16] and [18], which is problematic as it affects the value of R0 .
Hence, to counterbalance the impact of the different H0 value, we modify the value of β
correspondingly. ii) Secondly, the viral load for influenza in [16] is given in (T CID50 /ml)
units, while [18] specifies the viral load index for COVID-19 in (copies/ml). To overcome this, we apply the results of [20], we assume that a T CID50 unit corresponds to
2 × 103 viral copies and we change the β and p values in the influenza parameter setting
correspondingly.
As for the hybrid PDE-ABM model, the exact parameter values we use during the simulations are given in Table 3. With the exception of the diffusion coefficient, all of the
hybrid model’s parameter values have been calculated indirectly: we used the ODE parameters as a starting point and we combined these with the results detailed in Table 1 –

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

knowing the formal connection between the respective ODE and PDE-ABM parameters
we can easily obtain the hybrid parameters in question. Finally, we note that although
virus diffusion can vary due to several external parameters, we generally assume that the
diffusion coefficient for influenza and COVID-19 corresponds to the values given in [21],
and [22] respectively.
We highlight an important difference between the units of Table 1 (Section 2) and Table
3 (Section 3 / 3.2). While in the more theoretical Section 2 we conveniently used abstract
units such as σ 2 /τ , in the present section dedicated to applications all units become
concrete (e.g. µm2 /min). This raises two interesting technical questions – the first one
being the relationship between the real-life space unit µm and the abstract space unit σ
still internally used within the implementation. The reassuring answer is that even though
we can set an anatomically realistic choice such as σ = 14µm, the specific constant
we use here eventually falls out from the virus dynamic equation where the diffusion
coefficient multiplies the Laplacian; and hence, the equation itself remains unchanged. The
second question concerns the relationship between the 3-dimensional ml unit and the 2dimensional, internally used σ 2 (technically, we still solve equation (7) on the latter). This
issue can easily be resolved by means of a simple projection: using that 1ml = 1012 µm3 ,
we obtain that 1 ml corresponds to 108 µm2 i.e. 108 /142 σ 2 on the 2-dimensional lattice. As
the constant appearing at the conversion multiplies all terms in (7), the actual equation
we need to numerically solve stays identical.
Now we are ready to compare the two different models’ predictive performances. Firstly,
we consider the case of influenza. Figure 10 shows the respective numerical solutions
obtained by the ODE model and the hybrid system – we note that the solution given by
the ODE model is similar to the one described in [19]. We also refer back to an observation
we made in Section 3.1 regarding the diffusion coefficients: the lower this diffusion value
is, the further the hybrid and ODE models’ respective solutions are from each other.
Now, according to [21], our hybrid model’s diffusion coefficient for influenza is set to
0.19 µm2 min−1 , which is – in terms of virus diffusion in general – a relatively small value.
Therefore, there is an apparent difference between the two solutions we obtained with the
two different models. Finally, we highlight another important aspect in connection with
Figure 10. The authors of [16] and [17] suggest that in the upper respiratory tract about
30%-50% of the epithelial cells are destroyed at the peak of infection. This corresponds
to our simulated results in a reassuring way.
The second subject of our comparative investigations is COVID-19. Similarly to the
concept of the previous image, Figure 11 demonstrates the simulated results given by
the ODE model and the PDE-ABM hybrid system, but in this case the computations
were executed with the parameters representing COVID-19. As noted in Table 3, the
DV parameter for SARS-CoV-2 is set to 0.6 µm2 min−1 . This value is significantly higher
compared to influenza’s diffusion coefficient, and hence, as we expect, this time the ODE
model and the hybrid system generate solutions that are visibly closer to each other than
their respective solutions computed for influenza.
From this point in this section we examine influenza and SARS-CoV-2 propagation exclusively by means of the hybrid PDE-ABM system.

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

Table 2: Description of the (3) ODE model’s parameters. Naturally, the notations
[healthy cell], [infected cell] and [dead cell] represent a healthy cell, an infected cell and a
dead cell – as a unit – respectively.
Symbol
β

Parameter
Infection rate

Unit

Value for

Value for

influenza

COVID-19

0.94 × 10−7

1.01 × 10−7

2.66 × 10−3

7.2 × 10−4

[16] - [18]

[virus copy] · min−1 · 1.666 × 10−2

3.72 × 10−3

[16] - [18]

[16] - [18]

[virus copy]

−1

·

Ref

min−1
δ

The infected cell

min−1

death rate
p

The virus
production rate

c

The virus removal

[infected cell]

−1

min−1

2.08 × 10−3

1.67 × 10−3

[healthy cell]

40000 − 20

40000 − 20

[infected cell]

20

20

[virus copy] / ml

0

0

[dead cell]

0

0

rate
H0

The initial number
of healthy cells

I0

The initial number
of infected cells

V0

The initial value
of virus concentration

D0

The initial number
of dead cells

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

Table 3: Description of the hybrid PDE-ABM model’s parameters. Naturally, the
notations [healthy cell], [infected cell] and [dead cell] represent a healthy cell, an infected
cell and a dead cell – as a unit – respectively.
Symbol
PI

PD

Parameter

Unit

Value for

Value for

influenza

COVID-19

Probability

3.76 × 10−3

4.04 × 10−3

of infection

×VΩi,j

×VΩi,j

Probability of the

2.66 × 10−3

7.2 × 10−4

1.666 × 10−2

3.72 × 10−3

min−1

2.08 × 10−3

1.67 × 10−3

Ref

infected cell death
fi,j

Virus production from
an infected cell

µV

The virus

[virus copy] ·
ml

−1

· min−1

removal rate
DV

Virus diffusion

µm2 min−1

0.19

0.6

H0

The initial number of

[healthy cell]

40000 − 20

40000 − 20

[infected cell]

20

20

[virus copy] / ml

0

0

[dead cell]

0

0

healthy cells
I0

The initial number of
infected cells

V0h (x, y)

The initial value of
virus concentration

D0

The initial number of
dead cells

[21] - [22]

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

A

B

C

D

Figure 10: Comparison of the ODE model (solid lines) and the hybrid PDE-ABM model
(dashed lines) for influenza using the parameters in Tables 2 and 3. All figures depict a
change taking place over the course of seven days; specifically, A Viral load (copies/ml ),
B Number of healthy cells, C Number of infected cells, D Number of dead cells.

A

B

C

D

Figure 11: Comparison of the ODE model (solid lines) and the hybrid PDE-ABM model
(dashed lines) for SARS–CoV–2 using the parameters in Tables 2 and 3. All figures depict
a change taking place over the course of seven days; specifically, A Viral load (copies/ml ),
B Number of healthy cells, C Number of infected cells, D Number of dead cells.

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

Figure 12: The difference between influenza and SARS–CoV–2 infections. The viral load
(Left) and the number of infected cells (Right) simulated for influenza (dashed line) and
COVID-19 (solid line) using the hybrid PDE-ABM model.
In order to compare the dynamical features of SARS-CoV-2 and influenza, we firstly
simulate the viral load and the number of infected cells for both of these two viruses in
Figure 12 (the respective solutions for the two different viruses are shown together). We
highlight that in terms of the number of infected cells Figure 12 demonstrates that even
though the peak itself occurs sooner in influenza, the value taken at this peak is much
higher for COVID-19.
As a final step, we exploit the great advantage of having established a model that provides
information not only about the temporal behaviour of the total number of healthy, infected
and dead cells, but is also able to monitor an infection on an individual cellular level.
Figures 13 and 14 demonstrate the distributional patterns of influenza and SARS-CoV-2
propagation. Comparing Figure 13/(A) and (B) with Figure 14 it is particularly visible
that while influenza propagation shows spatial patterns that, roughly speaking, resemble
flocks or well-outlined explosions, there is no analogous phenomenon occurring in the case
of COVID-19: the latter is distributed among cells in a much more homogeneous manner
through all stages of infection.

4.

Discussion

In this paper we have applied two different models for investigating the dynamical aspects
of virus spread. The first model we considered was a hybrid PDE-ABM system, which
is essentially a result of merging a discrete state space representing epithelial cells with a
continuous reaction-diffusion equation grasping virus concentration. At the same time, we
have used the so-called May-Nowak system – a well-known version of the classical ODE
model – as a reference system. As for theoretical completeness, we provide a rigorous
analysis of both models in the Appendix, including a well-posedness result related to the
hybrid model and the study of the ODE model’s temporal dynamics.
The hybrid model’s computational implementation and the careful exploration of its results is in some sense the heart of our work – we highlight that our program code is based
on a free and open source Java library, HAL (Hybrid Automata Library), commonly used
for oncology modeling.
Compared to the ODE system, both the decisive advantages and the main difficulties

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

A

B

C

D

Figure 13: Simulated spatiotemporal numerical solutions captured A 20 hours, B 33
hours, C 53 hours, and D 67 hours after influenza infection. The computations were
performed by means of the hybrid PDE-ABM model. Infected, healthy, and dead cells
(denoted by red, green, and black squares, respectively) are shown on the left, while virus
spread is depicted on the right in all four subfigures (A - D).
A

B

C

D

Figure 14: Simulated spatiotemporal numerical solutions captured A 20 hours, B 33
hours, C 53 hours, and D 67 hours after SARS-CoV-2 infection. The computations were
performed by means of the hybrid PDE-ABM model. Infected, healthy, and dead cells
(denoted by red, green, and black squares, respectively) are shown on the left, while virus
spread is depicted on the right in all four subfigures (A - D).

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

of the hybrid model are naturally related to the PDE-ABM system’s added (and quite
high-level) complexity: the inclusion of spatial effects. On the one hand, the limiting
factors of this model include an increased computational demand and the fact that it is
virtually impossible to consider a really large number of cells on an ordinary computer
(we worked with a slice of tissue consisting of 4 · 104 cells). On the other hand however,
this hybrid model provides us with the invaluable spatial distribution of infection spread:
by running simulations for influenza and SARS-CoV-2 propagation, our spatiotemporal
PDE-ABM system demonstrated that COVID-19 spreads more homogeneously among
epithelial cells than influenza does. This simply would not have been possible using the
ODE model as the latter is defined only in time and it represents a scenario where all cells
can interact with all virus particles, or in other words, it implicitly assumes an infinite
diffusion coefficient in some sense. Real-life viruses however clearly have a finite diffusion
rate. This also means that if the specific virus in question has a relatively low diffusion
rate, then the ODE model’s predictions regarding infection dynamics will be less accurate:
the lower the diffusion coefficient, the more important it is to apply the more complex
and more suitable spatial hybrid model. This phenomenon can be observed in Figure 8:
a small diffusion value results in great differences between the respective solutions of the
PDE-ABM system and the (3) ODE model, while the solutions are indeed close to each
other for a larger diffusion value.
In terms of verifying the accuracy and correctness of our proposed model, we highlight the
results of Section (3.2.1) – we have relatively successfully recreated the real results of a
scientific in vitro experiment: our computer-simulated results matched the actual events
and features of infection spread on a satisfactory level. Regarding correctness, we refer
to Figure 10 as well: about 30 to 50% of the epithelial cells are destroyed in the upper
respiratory system at the peak of infection, which corresponds to the observations of [16]
and [17].
As for possible further improvements and applications of our hybrid spatial model, we
mention two main points. Firstly; fine-tuning features such as immune response processes, time delay between infection and virus production, and the phenomenon of cell
regeneration are ignored in our current study. These can be the subject of possible future work, although we note that the present model itself can also be considered to be
highly realistic in specific cases where some of the above mentioned elements are naturally
negligible (e.g. at the short early phase of an infection the immune system has typically
not responded yet, while the time frame is too short for cell regeneration to be relevant).
Secondly, we plan to apply the hybrid system for parameter fitting analogously as [16]
used the ODE model for a similar task for the case of influenza A. In more detail, the
authors of [16] calculated a best fit of the ODE model using experimental data on viral
load – they extracted viral kinetic parameters such as infection rate, virus production
rate, viral clearance rate, and the half-life of free infectious viruses. We simulated the
corresponding scenario with both systems and – as expected, considering the relatively
low diffusion value of influenza – there was an apparent difference between the respective
numerical solutions of the ODE model and the hybrid system. According to our results,
[16] somewhat underestimates the R0 value: as Figure 10 shows, in order to obtain a

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

solution with the PDE-ABM model that corresponds to the ODE solution (and hence, to
the real curve), it seems that the R0 value of the hybrid model needs to be higher than the
value estimated by [16] to fit the experimental data. This is another example of how the
assumption of homogeneous virus spread can be misleading – the kinetic values obtained
by Baccam et al. [16] could be adjusted towards their real biological value by means of the
hybrid PDE-ABM model. Thus, parameter estimation and fitting the stochastic hybrid
model to various virological data is something we also consider as valuable future work.
Finally, we conclude by emphasising that the complex spatiotemporal information the
hybrid model can provide on virus propagation is vital from the aspect of disease treatment
and our proposed model can be of great use when assessing potential COVID-19 treatment
strategies.
The hybrid PDE-ABM model is better suited for thorough and detailed virus spread assessment than the classical ODE system. Following virus propagation on an individual
cellular level and taking important spatial effects into account results in a much more
accurate and complete picture regarding the infection’s outcome. Even though the additional integrated details clearly come at a price in terms of computational demand,
this pays off very well in the form of information on spatial virus distribution and more
accurate predictions.

Acknowledgments
RH acknowledges the financial support from Youth Foundation of Zhejiang University of
Science and Technology (Grant No. 2021QN001, 2021QN046). SM and RH were supported
by Hungarian grant NKFIH KKP 129877. NJ was supported by EFOP-3.6.1-16-201600008 and TUDFO/47138-1/2019-ITM. GR was supported by NKFIH FK 124016 and
2020-2.1.1-ED-2020-0000.

Appendix A. The well-posedness and uniform boundedness of the PDE model
In this subsection, we shall establish the global existence and uniform boundedness of the
virus concentration function described by equation (1). We make the following suitable
assumption:
α

(H1 ) : gi,j (t, x, y) ∈ C 2 ,α ([0, ∞) × Ω̄) ∩ L∞ ((0, ∞) × Ω)
is nonnegative for each i and α ∈ (0, 1).
Theorem A.1 (Well-posedness and uniform boundedness) Let’s suppose that the parameters DV , µV are positive. Then for a non-negative initial value function V0h (x, y) ∈
C 0 (Ω̄) system (1) has a unique non-negative global solution V h (t, x, y) defined on [0, ∞) ×
Ω̄. Moreover, the solution V h (t, x, y) is uniformly bounded and satisfies lim sup max V h (t, x, y)
≤ max{ µBV , supΩ̄ V0h (x, y)}, where B is defined in (11).

t→∞

Ω

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

Proof. We use the lower-supper method for our proof. According to (H1 ), we define
X

gi,j (t, x, y)

(i,j)∈L

Let V (t, x, y) = sup V0h (x, y) −
Ω̄

B
µV



e−µV t +

L∞ ((0,∞)×Ω)

B
µV

:= B.

(11)

:= V ? (t) and V (t, x, y) = 0. Since

X
∂V (t, x, y)
gi,j (t, x, y)
− DV ∆V (t, x, y) + µV V (t, x, y) −
∂t
(i,j)∈L

?

(12)

dV (t)
≥
+ µV V ? (t) − B = 0
dt
and
X
∂V (t, x, y)
− DV ∆V (t, x, y) + µV V (t, x, y) −
gi,j (t, x, y)
∂t
(i,j)∈L
X
=−
gi,j (t, x, y) ≤ 0.

(13)

(i,j)∈L

= 0 ≥ 0 = ∂V
and the initial condition satisfies
Clearly the boundary condition satisfies ∂V
∂ν
∂ν
V (0, x, y) = sup V0h (x, y) ≥ 0 = V (0, x, y). Thus (V (t, x, y), V (t, x, y)) is a pair of coupled
Ω̄

supper solution and lower solution
of system (1). From (H1 ), we get that the function
P
h
h
f (t, x, y, V ) = −µV V +
gi,j (t, x, y) is Hölder continuous with exponent α with
(i,j)∈L

respect to t and x, y, and fV h (t, x, y, V h ) = −µV ∈ C(QT ×[m, M ]), where QT = (0, T ]×Ω,
m = min V (t, x, y) and M = max V (t, x, y). In view of [24, Theorem 2.4.6], system (1)
Q̄T

Q̄T

has a unique solution defined on (0, T ] × Ω satisfying
0 ≤ V h (t, x, y) ≤ V ? (t).

(14)

By the arbitrariness of T , the solution of system (1) exists globally in time. Clearly, from
the definition of V ? (t), we know that V ? (t) ≤ max{ µBV , supΩ̄ V0h (x, y)}. Then it follows
from (14) that lim sup max V h (t, x, y) ≤ max{ µBV , supΩ̄ V0h (x, y)}, which ends the proof of
the theorem.
In fact, since

t→∞

P

Ω

α

gi,j (t, x, y) ∈ C 2 ,α ([0, ∞) × Ω̄), it follows from the regularity the-

(i,j)∈L

ory of parabolic equations that system (1) has a unique classical solution V h (t, x, y) ∈
α
C 1+ 2 ,2+α ([0, ∞)×Ω̄). Here the sub-super solutions method is mainly employed to estimate
the upper bound of virus particles in the whole spatial domain Ω as time evolves.

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

Appendix B. The well-posedness and uniform boundedness of the ODE model
Theorem A.2 Let’s suppose (H0 , I0 , V0 , D0 ) ∈ Γ for our initial data. Then system (3)
has a unique solution (H, I, V, D) ∈ Γ, i.e. Γ is positively invariant. Furthermore, the
solution of system (3) satisfies
p(N − V0 )
,
c
t→∞
pβH0
0 ≤ lim sup I(t) ≤ (N − V0 ) min{1,
}, 0 ≤ D(t) ≤ N − V0 .
cδ
t→∞
0 ≤ H(t) ≤ H0 ,

0 ≤ lim sup V (t) ≤

(15)

where N = H0 + I0 + V0 + D0 .
Proof. Existence and Uniqueness. By the continuity of right side of Eq. (3), the
solutions of system (3) exist globally in (0, ∞). Since the terms on the right-hand side
of system (3) satisfy the local Lipschitz property respectively, the uniqueness of solutions
follows from the standard theory of differential equations. This completes the proof.
Positive Invariance and Uniform Boundedness. For H ≥ 0, I ≥ 0, V ≥ 0, D ≥ 0,
since
Ḣ(t)
V̇ (t)

H=0

= 0 ≥ 0,

V =0

= pI ≥ 0,

˙
I(t)

I=0

Ḋ(t)

= βHV ≥ 0,

D=0

= δI ≥ 0,

(16)

it follows from [23, Theorem 5.2.1] that the solution (H(t), I(t), V (t), D(t)) of system (3)
is nonnegative for all t ≥ 0 whenever H0 ≥ 0, I0 ≥ 0, V0 ≥ 0, D0 ≥ 0. Therefore Γ is
positively invariant with respect to system (3).
Since Ḣ(t) = −βH(t)V (t) ≤ 0, we get 0 ≤ H(t) ≤ H0 . Also from system (3), we obtain
d(H(t) + I(t) + D(t))
=0
dt

⇒ H(t) + I(t) + D(t) = N − V0 .

(17)

As H(t) ≥ 0, D(t) ≥ 0, we get I(t) ≤ N − V0 . From the third equation of system (3), we
have
dV (t)
≤ p(N − V0 ) − cV,
dt
which implies that
p(N − V0 )
lim sup V (t) ≤
.
(18)
c
t→∞
From (18), we know that for any ε > 0 there exists T (ε) > 0, s.t. when t ≥ T (ε),
0)
V (t) ≤ p(N −V
+ ε. Thus
c
dI(t)
p(N − V0 )
≤ βH0 (
+ ε) − δI.
dt
c

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

By the comparison principle of ordinary differential equations, we get
lim sup I(t) ≤
t→∞

pβH0 (N − V0 )
.
cδ

(19)

0
}. This completes the
Since I(t) ≤ N − V0 , we get lim sup I(t) ≤ (N − V0 ) min{1, pβH
cδ

proof.

t→∞

Appendix C. The threshold dynamics of the ODE model
The basic reproduction number R0 can be deduced by simple reasoning: a single infected
cell produces virus with rate p during its expected lifetime 1/δ, summing up to p/δ viruses.
Virus particles generate infected cells (in a healthy cell population) with rate βH0 , in an
expected time period 1/c. Overall we find the number of new infected cells originated
from the initial cell as given in (4). For a more formal derivation, one can also use the
next generation approach [28].
Theorem A.3 If R0 > 1, then the infection-free equilibrium e∗ is unstable, which means
an infection can be established. Furthermore, system (3) cannot undergo a Hopf bifurcation around e∗ .
Proof. The Jacobian matrix J∗ around the infection-free equilibrium e∗ is given by


0 0 −βH0 0


 0 −δ βH0 0 
.
(20)
J∗ = 
 0 p
−c
0 


0 δ
0
0
Thus the characteristic equation can be calculated as
λ2 [λ2 + (c + δ)λ + cδ − pβH0 ] = 0,
(21)
√
−(c+δ)± (c+δ)2 −4(cδ−pβH0 )
which has eigenvalues λ1,2 = 0, λ3,4 =
. Clearly, if R0 > 1,
2
then the characteristic Eq. (21) has a positive real eigenvalue, which indicates that e∗ is
unstable. In addition, it is easy to see that there are no pairs of purely imaginary roots in
characteristic Eq.(21) for any variational parameter, which implies that a Hopf bifurcation
can not occur. This completes the proof.

References
[1] O. Stancevic, C.N. Angstmann, J.M. Murray, B.I.Henry, Turing patterns from dynamics of early HIV infection, Bull. Math. Biol. 75 (2013) 774-795.

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

[2] X. Lai, X. Zou, A reaction diffusion system modeling virus dynamics and CTLs response with chemotaxis, Disc. Const. Dyn. Sys. 21 (2016) 2567-2585.
[3] N. Bellomo, K.J. Painter, Y. Tao, M. Winkler, Occurence vs. absence of taxi-driven
instabilities in a May-Nowak model for virus infection, SIAM. J. Appl. Math. 79 (2019)
1990-2010.
[4] J. Yang, X. Wang, F. Zhang, A Differential Equation Model of HIV Infection of CD
T-Cells with Delay, Discrete Dynamics in Nature and Society (2008).
[5] M. Nowak, R. M. May, Virus dynamics: mathematical principles of immunology and
virology, Oxford University Press, 2000.
[6] C. Macall, M. North, Tutorial on agent-based modelling and simulation, J. Simulat. 4
(2010) 151-162.
[7] Z. Wang, J.D. Butner, R. Kerketta et al., Simulating cancer growth with multiscale
agent-based modelling, Semin. Cancer Biol. 30 (2015) 70-78.
[8] V.A. Folcik, G.C. An, C.G. Orosz, The basic immune simulator: an agent-based model
to study the interactions between innate and adaptive immunity, Theor. Biol. Med.
Model 4 (39) (2007) 1-18.
[9] O.M. Cliff, N. Harding, M. Piraveenan et al., Investigating spatiotemporal dynamics
and synchrony of influenza epidemics in Australia: An agent-based modelling approach, Simula. Modelling Pract. Theor. 87 (2018) 412-431.
[10] E. Cuevas, An agent-based model to evaluate the COVID-19 transmission risks, Computers in Biology and Medicine 121 (2020) 103827.
[11] T.S. Deisboeck, Z. Wang, P. Macklin et al., Multiscale cancer modelling, Annu. Rev.
Biomed. Eng. 13 (2011) 127-155.
[12] J.D. Butner, Y.L. Chuang, E. Simbawa et al., A hybrid agent-based model of the
developing mammary terminal end bud, J. Theor. Biol. 407 (2016) 259-270.
[13] M. Garbey, S. Casarin, S.A. Berceli, A versatile hybrid agent-based, particle and
partial differential equations method to analyze vascular adaptation, Biomechanics
and Modeling in Mechanobiology 18 (2019) 29-44.
[14] R.R. Bravo, E. Baratchart, J. West, et al., Hybrid Automata Library: A flexible
platform for hybrid modeling with real-time visualization. PLoS Comput. Biol. 16(3)
(2020) e1007635.
[15] S. Marzban, R. Han, N. Juhász, G. Röst, Hybrid PDE-ABM model for viral dynamics,
https://github.com/sadeghmarzban/Hybrid-PDE-ABM-for-viral-dynamics, 2021.

bioRxiv preprint doi: https://doi.org/10.1101/2021.05.07.443053; this version posted May 7, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted bioRxiv a license to display the preprint in perpetuity. It is
made available under aCC-BY-NC-ND 4.0 International license.

[16] P. Baccam, C. Beauchemin, C.A. Macken et al., Kinetics of Influenza A Virus Infection in Humans, Journal of Virology, 80 (2006) 7590-7599.
[17] G.A. Bocharov, A. A. Romanyukha, Mathematical model of antiviral immune response III. Influenza A virus infection, J. Theor. Biol. 167 (1994) 323-360.
[18] E.A. Hernandez-Vargas, J.X. Velasco-Hernandez, In-host Mathematical Modelling of
COVID-19 in Humans, Annu. Rev. Control 50 (2020) 448-456.
[19] E.A. Hernandez-Vargas, Modeling and Control of Infectious Diseases in the Host,
Academic Press, 2019.
[20] W. Yang, S. Elankumaran, L.C. Marr, Concentrations and size distributions of airborne influenza A viruses measured indoors at a health centre, a day-care centre and
on aeroplanes, J. Roy. Soc. Interface, 8(61) (2011) 1176-1184.
[21] C. Beauchemin, S. Forrest, F.T. Koster, Modeling Influenza Viral Dynamics in Tissue,
Springer, Berlin, Heidelberg, 2006
[22] T.J. Sego, J.O. Aponte-Serrano, G.J. Ferrari, et al., A modular framework for
multiscale, multicellular, spatiotemporal modeling of acute primary viral infection
and immune response in epithelial tissues and its application to drug therapy timing
and effectiveness, PLoS Comput. Biol. 16 (2020) e1008451.
[23] H.L. Smith, Monotone dynamical systems: an introduction to the theory of competitive and cooperative systems, American Mathematical Society, providence, Rhode
Island, 1995
[24] Q.Y. Ye, Z.Y. Li, M.X. Wang et al., Introduction to reaction-diffusion equations,
Science Press, Beijing, 2011 (in Chinese).
[25] Y.M. Bar-On, A. Flamholz, R. Phillips et al., SARS-CoV-2 (COVID-19) by the
numbers, eLife 9 (2020) e57309.
[26] M. Carcaterra, C. Cristina, Alveolar epithelial cell type II as main target of SARSCoV-2 virus and COVID-19 development via NF-Kb pathway deregulation: A physiopathological theory, Medical Hypotheses 146 (2021) 110412.
[27] R.J. Mason, Biology of alveolar type II cells, Respirology 11 (2006) S12-S15.
[28] P. van den Driessche, J. Watmough, Reproduction numbers and sub-threshold endemic equilibria for compartmental models of disease transmission, Math. Biol. 180
(2002) 29-48.
[29] V.K. Outlaw, F.T. Bovier, M.C. Mears, et al., Inhibition of Coronavirus Entry In
Vitro and Ex Vivo by a Lipid-Conjugated Peptide Derived from the SARS-CoV-2
Spike Glycoprotein HRC Domain, mBio. 11 (2020) e01935-20.

