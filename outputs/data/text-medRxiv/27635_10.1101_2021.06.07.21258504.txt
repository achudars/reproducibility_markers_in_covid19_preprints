medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Adaptive vaccination may be
needed to eliminate COVID-19:
Results from a runtime-alterable
strain-drift and waning-immunity model
Wayne M. Getz1,2,3 , Richard Salter3,4 , Ludovica Luisa Vissat1 ,
James S. Koopman5,6 , Carl P. Simon6,7
1

Dept. ESPM, UC Berkeley, CA 94720-3114, USA

2

School of Mathematical Sciences, University of KwaZulu-Natal, South Africa

3

Numerus, 850 Iron Point Rd., Folsom, CA 95630, USA

4

Computer Science Dept., Oberlin College, Oberlin, Ohio, OH 44074, USA

5

School of Public Health, University of Michigan, Ann Arbor, MI 48109, USA

6

Center for the Study of Complex Systems, University of Michigan, Ann Arbor,
MI 48109, USA
7

Gerald R. Ford School of Public Policy, University of Michigan, Ann Arbor,
MI 48109, USA
Corresponding Author: Wayne M. Getz, wgetz@berkeley.edu
Author Contributions: JSK and CPS initiated the project, provided feedback on early drafts and participated in discussions. WMG designed and formulated the SEIVD-IBM model, drafted the manuscript, ran simulations, and
produced the figures. RS designed and built the J-RAMP platform and wrote
the code and informational text. LLV checked all the mathematical equations
and code. Both RS and LLV contributed to the structure of the manuscript.
All authors contributed to editing and adding text as needed.
Competing Interest Statements: none
Classification. Major: Biological Sciences; Minor: Biophysics and Computational Biology
Keywords: SARS-CoV-2, SEIR models, multivalent vaccines, escape mutations, strain/variant proliferation

1

NOTE: This preprint reports new research that has not been certified by peer review and should not be used to guide clinical practice.

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

1

2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22

Getz et al.

Abstract
We developed an elaborated susceptible-infected-recovered (SIR) individualbased model (IBM) with pathogen strain drift, waning and cross immunity,
implemented as a novel Java Runtime-Alterable-Model Platform (J-RAMP).
This platform allows parameter values, process formulations, and scriptable
runtime drivers to be easily added at the start of simulation. It includes facility
for integration into the R statistical and other data analysis platforms. We selected a set of parameter values and process descriptions relevant to the current
COVID-19 pandemic. These include pathogen-specific shedding, environmental persistence, host transmission and mortality, within-host pathogen mutation
and replication, adaptive social distancing, and time dependent vaccine rate and
strain valency specifications. Our simulations illustrate that if waning immunity outpaces vaccination rates, then vaccination rollouts may fail to contain the
most transmissible strains. Our study highlights the need for adaptive vaccination rollouts, which depend on reliable real-time monitoring and surveillance of
strain proliferation and reinfection data needed to ensure that vaccines target
emerging strains and constrain escape mutations. Together with such data, our
platform has the potential to inform the design of vaccination programs that
eliminate rather than exacerbate local outbreaks. Finally, our RAMP concept
promotes the development of highly flexible models that can be easily shared
among researchers and policymakers not only addressing healthcare crises, but
other types of environmental crises as well.

23
24
25
26
27
28
29
30
31
32
33
34
35

Significance Statement: Effective COVID-19 vaccine development has been
unprecedented, but vaccinations are being delivered at contrasting rates across
the globe. Here, using an innovative epidemiological Java runtime alterable
modeling platform (J-RAMP), we demonstrate that seemingly reasonable vaccination programs may exacerbate rather than mitigate regional outbreaks when
immune waning outpaces vaccinations and reinfection promotes escape mutations. Our simulations suggest that adaptive vaccination programs, requiring
adequate strain and serology monitoring and surveillance, are needed to eliminate outbreaks. Our platform provides policymakers with an easy-to-use tool
for designing effective vaccination programs. Our RAMP concept points the
way to the development of highly flexible models that are easily shared among
researchers and policymakers in all areas of systems analysis.

2

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

36

37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57

58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81

Getz et al.

Introduction
Vaccines have either eliminated, or all but eliminated, diphtheria, measles, polio,
rubella, smallpox, and tetanus within developed countries, such as the USA [1].
The global COVID-19 pandemic has amply illustrated the overwhelming economic importance that vaccines can play in bringing an epidemic under control [2]. Unlike the above mentioned diseases and more inline with influenza,
however, the SARS-CoV-2 pathogen may re-emerge due both to waning immunity and proliferation of mutant strains or variants with increased transmissibility that escape both naturally-acquired and vaccine-induced immunity [3–8].
To investigate how effective vaccination programs may be in preventing future
large-scale outbreaks of COVID-19 [9, 10], we built a Java Runtime-AlterableModel Platform (J-RAMP) of an SEIVD (Susceptible, Exposed, Infectious,
V=Immune & Vaccinated, Dead) individual-based model (IBM) [11–14] that
includes the following processes (Fig. 1; see Materials and Methods, as well as
Appendix A for details):
• pathogen strain-specific shedding [15], environmental persistence [16], withinhost replication [17] and mortality rates [18] (some prefer the term variant
rather than strain)
• immunological waning with strain cross immunity [6]
• pathogen strain drift during transmission and within-host replication [19]
• an adaptive contact rate [20]
• a time-dependent, uni- or multivalent vaccine rollout [21, 22]
Our SEIVD-IBM J-RAMP, is an example of our novel runtime alterable-model
platform (RAMP) concept, which includes panels, windows and sliders that allow users to specify and manipulate model parameter values in real time. It also
allows users to modify process function descriptions, even during the course of
a simulation, while protecting the integrity of the underlying code. Thus our
SEIVD-IBM J-RAMP has epidemiological applications well beyond COVID-19,
including diseases such as influenza [23], Ebola [24, 25], and any other directly
transmitted disease [26]. To illustrate its application, we used our J-RAMP to
explore the relative efficacy of uni- and multivalent vaccines applied at various
time-dependent rates, where choice of valency may switch in response to realtime monitoring and surveillance data. Such adaptive vaccination programs
may be required to combat the evolutionary arms race between vaccine efficacy
and the evolution of new pathogen strains [19, 22, 27]. We demonstrate the
possible consequences of vaccinating too few individuals in the context of the
emergence of more transmissible strains, as well as the comparative efficacy of
non-adaptive versus adaptive vaccines responsive in realtime to current strain
valency. We simulate plausible COVID-19 outbreaks over a three year period
in which vaccination rollout commences at the start of year two and continues
until the end of the year three.
Our study is meant to highlight issues related to vaccination rollout rates
[10] and strain valency that may turn out to provide insufficient coverage of
the population or being outrun by waning immunity in vaccinated hosts or
those that have survived COVID-19. We undertake these simulations with the
knowledge that though a typical set of parameters may cover most outbreaks

3

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

119

of COVID-19 in various regions around the world, regional differences in the
contact behavior of individuals, with additional contact rate time dependency
in each locality due to social distancing regulations and behavior, have led to
markedly different outbreak patterns across regions [28–30]. Thus the results
presented here are meant to inform us of potential pitfalls and dangers in rolling
out inadequate vaccination programs and extracting general principles, where
possible, as well as illustrate an approach to its local application rather than
prescribe a universal program: adaptive programs need to operate in response
to local surveillance data and contact rate conditions.
The local nature of contact rate patterns is well established as an important
driver of outbreak patterns [29]. The definition of a contact where transmission
may occur is rather challenging though. Effective or “close” contact may be
defined, as in [31], in terms of direct physical contact or close conversation, or it
may involve concepts of a threshold distance and time period [32]. Taken a step
further, it may relate to infectious dose levels and the relationship between dose
and severity of the infection of individuals [33]. This effective contact rate issue,
however, is side-stepped by fitting models to local incidence data to obtain a
concatenated contact-and-transmission rate parameter value that best fits local
outbreak patterns, as discussed in depth elsewhere [29].
Our results also suggest that adaptive vaccination programs that closely
monitor the emergence of new strains and adapt vaccine valency to match predominating strains are much more likely to eliminate local epidemics than nonadaptive policies, though our simulation results are greatly influenced by assumptions regarding rates of waning immunity and strain cross-immunity characteristics. Accurate forecasting of the future course of an epidemic in terms of
strain composition and vaccination program efficacy require data on the rates at
which immunity wanes, how such immunity depends on particular strains, and
the levels of cross immunity among strains [4, 6] that are more comprehensive
than currently available. It also requires better data on within-host replication
and mutation rates. Thus, in truth, we present our model and results fully
aware that answers to questions relating the design of optimal region-specific
vaccination programs await more reliable data on immunity processes, strain
mutation rates [34], and the transmission potential and virulence of dominant
strains [35]. We hope, however, that our results and subsequent investigations
using our model provide the kinds of quantitative analyses that can help formulate highly effective local or country level vaccination programs that avoid
many of the pitfalls revealed by our analysis, as well as encourage the adoption
of rapidly adaptive vaccination programs.

120

Results

82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118

121
122
123

Before reading this results section, the reader may want to either read the Methods and Material section or, at least, acquaint themselves with the parameters
listed in Table 1.

4

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

124

125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170

Getz et al.

Single-strain simulations
Our first simulation, which we regard as a “baseline run” has J = 0 (i.e.,
only one strain is possible), assumes a constant contact rate (κ(t) = κ0 for
all t; which implies no social distancing or effective contact reducing actions
taken) in a homogeneously, well-mixed population of ten thousand individuals
(N0 = 10, 000), with an immune waning half-life of one year (thalf = 365), and no
vaccination rollout. The resulting simulation depicts a classic outbreak pattern
(Fig. 2) in which incidence rises to a peak of about 250 cases around 96 days
after “patient zero” has been introduced, and then burns out around day 166
days because an insufficient number of susceptible individuals are now available
to keep the epidemic going. In the upper left-hand panel of our SEIVD-IBM
J-RAMP dashboard in Fig. 2, we see that around 3/4 of individuals have been
infected at the point where the epidemic burns out (V (166) = 7700, which is
77% of N0 ): this suggests that herd immunity may well be in the ball park of
75-80% (as supported by additional runs presented next), although this would
be an underestimate if more transmissible strains come to prevail.
Repeated runs of this first simulation with different runtime seeds (viz., 10
runs with runtime seeds ranging from 0 to 9, where each seed generates its own,
essentially unique, but repeated sequence of pseudo random numbers; Fig. 2
is for the case runtime seed = 0) produces the following means and standard
deviations as a percentage of the population size (of S, V and D), as well as the
length of the epidemic (days) (see Fig. C.1, Appendix C): Sfnl = 21.9 ± 0.6%,
Vfnl = 76.4 ± 0.6%, Dfnl = 1.6 ± 0.1%, and tfnl = 167 ± 9 days. These results
are almost the same when the initial population size is increased threefold to
N0 = 30, 000 individuals, the primary difference being a small expected decrease
in variability (around 1/3rd smaller) and slightly longer epidemic period (18%
longer) (see Fig. C.1 for details). To obtain full plots of the incidence, prevalence,
and daily-death trajectories from many runs of our SEIV-IBM, we exploited
the R-platform integrability of our J-RAMP to generate mean and standard
deviation plots of incidence, prevalence, and daily mortality, as described in
Appendix B (and Fig. C.2).
Our second single-strain (J = 0) simulation (Fig. 3A) illustrates that, for
the selected set of parameter values, if the rate of waning is tripled from that of
our first (i.e., thalf is reduced from 365 days to 120 days) then herd immunity
is still reached. Our third single-strain simulation, however, shows that herd
immunity is eluded for the selected set of parameter values when this waning
rate is quadrupled to thalf = 90 days. Specifically, in Fig. 3B we see that
the population enters a periodic outbreak mode because previously infected
individuals are sufficiently susceptible after several months post-initial infection
to be reinfected and thus keep the epidemic going.
In our fourth and fifth single-strain simulations (Fig. 3C & D), we replaced
the constant contact rate κ0 with an adaptive contact rate k(t), as specified in
Eq. A.10—this implies that the “effective” contact rate κ(t) drops from κ(t) =
κ0 = 4 to κ(t) = κ0 /2 = 2 when the prevalence rises for 0 to I(t)/N (t) = phalf
.
I
For the case phalf
=
0.05
(Fig.
3C),
our
fourth
single-strain
simulation
indicates
I
that prevalence peaks at roughly 400 individuals (i.e., just around 0.4% of the
population) around day 85 (Fig. 3C), drops to around 50 between days 210

5

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

191

and 240, and then rises back to over 200 by the end of one year. For the case
phalf
= 0.05 (Fig. 3D), our fifth single-strain simulation rises to a prevalence of
I
just under 100/10,000=0.01% that appears to persist with stochastic noise from
day 100 onwards.
We carried out two additional single-strain simulations, this time for three
years, and applied a vaccination rollout program with vaccinated individuals
drawn at random in the second and third year at rates v = 0.001 and v = 0.002
(0.1% and 0.2% of the population vaccinated each day; Fig. 4A & B), respectively. Additionally, we drew individuals from a pool consisting of those not currently infectious or previously vaccinated. In these runs, we set the half-waning
parameter to thalf = 365 days, and the half-contact-rate-reduction parameter to
phalf
= 0.002. Our population size was now N0 = 100, 000. In the case where
I
we vaccinated 0.1% of individuals per day (v = 0.001), the vaccination rate was
insufficient to overcome the rate at which infected individuals become reinfected
due to waning immunity. In contrast, if we vaccinated 0.2% of individuals per
day (v = 0.002), the vaccination rate was now sufficiently high to bring the
epidemic under control. In this latter case, however, if we no longer allowed
individuals who had previously been infected to be part of the vaccination pool
(i.e. we confined vaccinations to the S class only), this vaccination rate was
now insufficient to extinguish the outbreak and a resurgence occurred around
the end of the second year (Fig. 4C).

192

Multistrain simulations

171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190

193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216

In all our multistrain simulations we set the half-contact-rate-reduction param= 0.005. This latter value, as previously mentioned, produces a
eter to phalf
I
cumulative number of cases of around 10% in the first year in a population of
size N0 = 100, 000 (Appendix C, Fig. C.3), which is in the ballpark of 8.5% for
the US outbreak during its first year.
In our first set of multistrain simulations, we set J = 4 (i.e., permitting
16 strains) and compared the situations where cross immunity is absent (c = 0;
Fig. 5A) to where it has the intermediate value c = 0.5 (Fig. 5B). The remaining
parameters were the same for all strains and used the same basic epidemiological
parameters, as in our previous single-strain simulations, although mutation rates
were now added to enable new strains to proliferate (see caption to Fig. 5 for
details on parameter values).
In the no cross immunity (Fig. 5A) case, we see that the initial surge is
driven by strain 0 ≡ (0, 0, 0, 0) (see discussion in Appendix A for use of binary
representation), which is first replaced by strain 8 ≡ (1, 0, 0, 0) around the end
of year 1, which in turn is somewhat displaced by strains 7 ≡ (0, 1, 1, 1) and
6 ≡ (0, 1, 1, 0), with strain 1 ≡ (0, 0, 0, 1) coming to dominate at the start of year
3, only to be finally challenged by strain 3 ≡ (0, 0, 1, 1) towards the end of year
3. In the nearest-neighbor cross immunity case (Fig. 5B), given the retarding
effect of cross immunity on the proliferation of strains that differ in only one
allele from the initial dominating strain 0 ≡ (0, 0, 0, 0), this initial strain was
displaced by strains 3 ≡ (0, 0, 1, 1) and 11 ≡ (1, 0, 1, 1) around the end of year
1. These latter 2 strains were then displaced by strain 7 ≡ (0, 1, 1, 0) during the
first half of year 3, with strain 13 ≡ (1, 1, 0, 1) dominating at the end of year 3

6

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

229

somewhat supported at a lower level by strain 14 ≡ (1, 1, 1, 0). We also noticed
a moderate resurgence of strain 0 ≡ (0, 0, 0, 0) in the middle of year 3.
In a second set of multistrain simulations, we set J = 7 for a total of 128
possible strains. Unlike the previous set of multistrain simulations, we now
provided a strain specific set of transmission parameters β̄j by selecting these at
random on the interval [0, 0.3], apart from a dominant sequence of transmission
values that steps in increments of 0.25 from 0.3 in strain 0 to 0.475 in strain
127 along the sequence mentioned in the caption to Fig. 6 and documented in
Fig. C.4. The remaining parameters are the same as for the simulation depicted
in Fig. 5B (i.e., the cross-immunity parameter c = 0.5). Unlike the case, J = 4,
only two strains now played any prominent role in the outbreak in the nonvaccination scenario (Fig. 6A): strain 0 ≡ (0, 0, 0, 0, 0, 0, 0) for the first year and
strain 127 ≡ (1, 1, 1, 1, 1, 1, 1), the most transmissible, for the remaining 2 years.

230

Vaccination rollout simulations

217
218
219
220
221
222
223
224
225
226
227
228

231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262

Following our no-vaccination simulation of our 128-strain case (Case A; Fig. 6A),
we explored three different vaccination rollout programs applied in years 2 and
3 with the following vaccination rates and vaccine strain valencies: Case B, rate
v = 0.002 (i.e., 0.2% vaccinated per day), strain valency 0 (Fig. 6B); Case C, rate
v = 0.002, strain valency 127 (Fig. 6C); and Case D, v = 0.01, strain valency
(0,7,31,127) (Fig. 6D). Each of these vaccination programs begin with the initial
strain 0 ≡ (0, 0, 0, 0, 0, 0, 0) being replaced by strain 127 ≡ (1, 1, 1, 1, 1, 1, 1)
towards the end of year 1 or start of year 2.
Alarmingly, the first vaccination rollout scenario (Case B) made the epidemic worse rather than better when compared with the no vaccination scenario
(number of deaths were 1366 versus 1122; compare Figs. 6A and B) because the
vaccination rollout with its strain 0 valence vaccine, though delaying the emergence of strain 127, led to an increased prevalence of this most transmissible
strain (β127 = 0.475 versus β0 = 0.300). Using a strain 127 valence vaccination (Case C) had some effect in reducing the 3-year death total back to
1109, but the efficacy of this rollout was thwarted by the emergence of strain
48 ≡ (0, 1, 1, 0, 0, 0, 0) (β48 = 0.295, Fig. 6C).
Given the inability of these two monovalent vaccination rollout programs in
years 2 and 3 to control the outbreak, we simulated the much more aggressive
rollout program of a quadravalent (0,7,31,127) vaccine applied at a rate of 1%
per day (Fig. 6, v = 0.01; a five-fold increase over the previous two monovalent
programs) in a system with increased levels of cross immunity (cascading versus simple) and including revaccination of previously vaccinated individuals to
combat the effects of waning immunity. Even this aggressive vaccination rollout
program failed, although it did knock the incidence way down at the start of the
rollout. The efficacy of this rollout, however, was thwarted by the rise of strain
23 ≡ (0, 0, 1, 0, 1, 1, 1) (β23 = 0.214) during the mid to latter part of the second
year, which was then supplanted by strain 3 ≡ (0, 0, 0, 0, 0, 1, 1) (β3 = 0.350),
which dominated the third year (Fig. 6D).
Unsurprisingly, the success of any vaccination program depends on the waning and cross-immunity characteristics hosts to the various strains. Thus, in regard to the vaccination programs represented by cases B and C (Fig. 6, we sim-

7

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

286

ulated the rollout of a bivalent vaccine with strain valency (0,127) implemented
at the same vaccination rate of v = 0.002, but in a system with much more
robust immunity characteristics: a waning half-life increased from thalf = 365
to 1825 days (a five-fold increase) and a cascading cross immunity system with
c increased from 0.5 to 0.9. In this case, the outbreak was rapidly eliminated
after 257 days (i.e., from start at day 365 to extirpation at day 622).
Given the failure of our first three 128 strain vaccination rollouts (cases B
to D in Fig. 6) to eliminate the simulated epidemics, we investigated whether
rollout programs that adapted vaccine valencies to track in real time the emergence of dominant strains might be more effective. Thus, we used a JS scripting
window to write a JavaScript driver (as described in Appendix B; see Fig. B.4)
that adapted (i.e., switched as necessary) the valency of the vaccine every 90
days after the start of the vaccination rollout to match the top two strains
prevalent at time of switching, or only the top strain if no other strain exceeded
a prevalence of 10 individuals. The results of these two simulations, one for the
nearest-neighbor cross-immunity case (Eq. 1) and one for the cascading crossimmunity case (Eq. A.7), are provided in Fig. 7. They should be compared with
the non-vaccination case depicted in Fig. 6A and the non adaptive vaccination
rollout depicted in Fig. 6D. In contrast with the latter both of these adaptive
vaccination rollouts eliminated the epidemic, the first within half a year (Case
A) and the second within 1.4 years (Case B) from the start of vaccination rollout. This occurred despite these adaptive vaccination programs having the same
vaccination rates, the same strategies for selecting non-infected individuals at
random, and employing vaccines with lower strain valency

287

Discussion

263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285

288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307

The amount of structure and data needed in complex biological systems’ models, depends on the questions that these models have been formulated to address [25,36]. In this paper, we steered away from making specific predictions—
because universal solutions are not always locally applicable. Rather, we focused
on questions relating to the potential efficacy of different vaccination rollouts
(both vaccination rates and valencies of vaccines) in the context of strain emergence and the potential for vaccination programs to go awry. To make specific
predictions requires localized data, particularly as it may relate to social distancing behavior or other factors that affect contact rates over time [29, 37, 38].
Additionally, we cannot expect models to make strain-specific informative predictions, unless they have been designed to do so and are supported by location
specific data regarding the relative transmissibility of strains and other strain
specific data. In the absence of such data, models become a tool for anticipating pitfalls and avoiding unintended consequences of well-intentioned actions.
Equally important, however, is the implementation of our model as a RAMP
(runtime alterable model platform), because this greatly facilitates the use of
our model by ourselves and others in testing out different hypothesis about the
process generating observed population level strain transmission dynamics.
The illustrative simulations we present demonstrate that if vaccination rollout rates and vaccine valencies are applied in blanket manner—that is, without

8

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355

Getz et al.

monitoring strain emergence and obtaining some assessment of the epidemiological characteristics of those strains (e.g., relative transmissibility, virulence,
waning and cross immunity characteristics)—then the possibility exists for a
vaccination program to do more harm than good. This of course, is not to say
that vaccination programs should ever be avoided; only that once a vaccination
program is embarked upon, it should be implemented at a sufficiently vigorous
rate to ensure that it is not outrun by relatively fast waning immunity rates,
as well as increasingly transmissible and escape mutations. Additionally, when
escape mutations emerge, generally associated with reinfection cases [8], then
the valency of vaccines should be switched rapidly enough to thwart escape
mutations, rather than aiding such mutations by thwarting less transmissible
competing strains instead.
At this time, the primary value of our SEIVD-IBM J-RAMP is in testing various vaccination strategies as they relate to strain emergence [39] and identifying
pitfalls related to the unintended promotion of more transmissible or virulent
strains. Strain emergence has both a local and global component. Particular strains may first be identified as occurring in specific geographical regions,
as in the strains that appear to have originated in the UK (B.1.7.7 variant),
South Africa (variants B.1.1.54, B.1.1.56 and the C.1 lineage) and Brazil (P.1
lineage) [40]. Thus more geographically focused application of our J-RAMP
may require more specific strain related information. Such information would
then be used to get estimates of the relative values of transmissibility βj , virulence αj , and even of shedding (ζ̄jm ) and environmental persistence (η̄j ). But
equally important in evaluating the impacts of vaccination strategies on local
outbreaks is obtaining strain-specific cross-immunity data (for characterization
of the elements cj` of the cross immunity matrix C), waning rates (which we
have not made strain specific, but our model could be generalized to include
strain specific values thalf
), and the relative within host competition values (i.e.,
j
λj , which we have set all equal to 1 at this time in the absence of data to the
contrary). Models are sorely needed to explore multistrain dynamics, particularly the epidemiological properties with regard to shedding, environmental
persistence, transmission, mutation, and within-host replication rates, which
acting together determine the relative success of different strains and their actual impact on the severity of epidemics and the nature of vaccination programs
needed to suppress them.
The process of making our model both location and strain specific could be
undertaken using methods designed to enhance the relevancy of models, such
as Appropriate Complexity Modeling (ACM: [25, 36]). Further, in some cases it
may be useful to add spatial or age-structure information to our SEIVD model
IBMs or include a contact network [41], which itself may contain spatial or refined class category (e.g. age or work category) information. In addition, our
current implementation represents strain differences in terms of J loci with two
alleles (denoted by 0 and 1 respectively) at each locus. A more realistic representation of the genetic basis of strain differences may involve a more involved
genetic representation in which several alleles are possible at each locus.
Although cross-immunity and immune waning are entangled in our immunity modifier functions (i.e., φij ; see Eq. A.11), cross-neutralization data can
be used to estimate the cross and waning immunity parameters using appro-

9

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

395

priate methods [42, 43]. Such data are becoming more widely available through
the application of rapid PCR methods [3, 44, 45]. Strain or variant cross neutralizing studies bring up a much neglected issue, which is the effect of dose
(number of pathogens involved in the initial infection, also know as viral load)
on the severity of the infection. This differs from the questions of the number
of doses—usually one or two—constituting and vaccine regimen versus the viral
load (or antigen load, or virus-like particle load when only antigens or parts of
viruses are administered) in each dose [4]. In the context of vaccination, both
these issues and the technology used to produce the vaccine [22] may well have
an impact on waning immunity half-lives and cross-immunity values. Thus,
the parameter values used in the model should ultimately be vaccine specific.
Further, when it comes to determining waning and cross immunity parameter values, our model does not distinguish between individuals that have been
infected with a particular strain or vaccinated with a valency related to that
strain.
In the coming year, as we obtain more information on the nature of immunity
to SARS-CoV-2, it will become more apparent to us whether or not COVID-19
will settle into global endemicity [46, 47]. If this is the case, then constant vigilance and a well designed vaccination program with respect to vaccinating the
young and implementing booster vaccinations with appropriate strain valency
will become the order of the day. The J-RAMP presented here, with appropriate elaborations that will become evident through its future application, such as
being able to compute the best time to administer booster shots of the same or
different strain valencies to individuals, should play a decisive role in the rational design of effective and efficient COVID-19 vaccination programs worldwide.
This is made apparent from the simulations we present here that, depending on
the immunological characteristics of hosts and mutational rates of SARS-Cov2, it may be harder than currently anticipated to extinguish COVID-19 in the
next few years through non-adaptive vaccination programs. Thus, we should
endeavor to adapt the strain valency of our vaccines as rapidly as possible to
the predominating SARS-Cov-2 strains, identified from ongoing monitoring and
surveillance programs.
Finally, the concept of runtime-alterable, modeling platforms (RAMPs),
with driver script and other coding platform integration, in our case developed in Java with R platform integration and a JavaScript simulation driver
window, provides the first example of a new concept in model implementation
that facilitates model sharing and easy modification by users other than the
original developers. We believe such platforms can come to play an important
role not only in disease modeling, but in all fields of research that rely on models
for comprehensive analyses of the behavior of systems of interest.

396

Materials and Methods

397

Our SEIVD-IBM in a nutshell

356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394

398
399
400

We constructed an individual-based model (IBM) of a susceptible-exposedinfectious-recovered (i.e., an SEIVD model, where removed R are split into
V=immune/vaccinated, and D=dead) epidemiological process [11, 12] in a ho10

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448

Getz et al.

mogeneous population with a random encounter contact rate parameter κ0 > 0.
Our formulation includes a host immunological waning process [6, 46]. It also
includes the emergence of pathogen strains due to a mutational process that
impacts both transmission of mutant strains from the infectee and genetic
drift [3, 5, 48] of strains within the infector, with rates impacted by cross immunity effects. We allowed for variation in pathogen strain transmissibility
(i.e., in the β > 0 parameter of the frequency dependent transmission function
βSI/N [49, 50]) and pathogen virulence as represented by the disease-induced
host mortality rate in the sense of Anderson and May [51] (and often represented
by a parameter α ≥ 0 [49]).
The detailed formulation of our model and its algorithmic implementation
is provided in Appendix A. In a nutshell we:
1. defined a set of 2J pathogen strains (user selected value for J ranging from
0 to 8; pathogen index j = 0, ..., 2J −1) with a genetic-relatedness topology
of a J-dimensional unit cube—i.e., each pathogen has J-loci that can take
on one of two allelic values at each locus with immediate neighboring
strains differing from each other by exactly one allelic value (0 or 1) at
only one of the J loci
2. defined a population of N0 hosts as belonging at time t to either an epidemiologically naı̈ve set of susceptible individuals S of size NS (t), a set
A of NA (t) identified agents Ai (i = 1, ..., NA (t)) whose epidemiological
histories are known, or a set D of ND (t) individuals that have died from
the disease
3. allow pathogen strain-specific transmission “force” (β̄j > 0) and virulence
(αj ≥ 0) parameters to vary in value among one another within a defined
range β̄j ∈ [βmin , βmax ] and αj ∈ [αmin , αmax ]
4. kept track of the total prevalence NI as the sum of the prevalences of the
P2J −1
individual strains NIj , j = 0, ..., 2J − 1—i.e. NI = j=0 NIj
5. introduced a random contact rate function κ(t) with a constant parameter κ0 that is Poisson distributed on [t, t + 1), t = 0, 1, · · · , multiplied
by an adaptive response function that reduces the contact rate with increasing disease prevalence, such that the κ(t) is reduced to κ0 /2 when
—see Eq. A.10 in Appendix A
the NI (t)/ (N0 − ND ) = phalf
I
6. update the epidemiological state of the agents Ai with respect to each
of the strains j = 0, ..., 2J − 1 where the state with respect to particular
strain j at time t is represented by
(a) 0: has never been infected with this strain
(b) Ej (t, τij ): infected at time τij ≤ t with this strain, but not yet infectious for an expected period of σE units of time
(c) Ij (t, τij ): infectious at time t with this strain, for an expected period
of σI units of time, having been most recently infected (reinfections
with the same strain may occur) with this strain at time τij < t
(d) Vj (t, τij ): has now recovered from its most recent infection at time
τij with this strain and has some level of waning immunity to it
where we assume that agent Ai can be infected at time t with at most one
dominant strain (denoted by the index j), although it will have different
levels of waning immunity to all of the strains to which it has been infected
in the past
11

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472

473

474
475
476
477
478
479
480
481
482
483
484
485
486
487

Getz et al.

7. included waning immunity functions ωij (t) (symbol is omega: Eq. A.6)
used to compute the level of immunity that agent Ai has to its most
recent infection by strain j
8. included cross immunity constraints (a J 2 -matrix C) that apply both to
the infector transmitting the pathogen and the infectee being invaded (inv)
by the pathogen, both of which reduce the likelihood of infection and strain
drift by strain j compared with closely related strains `
inf
9. computed an infection probability πih,j`
that agent Ai infected with strain
j infects agent Ah with strain ` in terms of a concatenation of infector
viral shedding (ζi` ), viral persistence in the environment (ε` ), and viral
transmission (βh` ) processes (Fig. 1)
inv
10. computed an invasion probability πh``
0 that an agent Ah infected with
strain ` becomes infectious with strain `0 as its major strain, in terms
of the multiplicative effects of viral mutation (µ) and viral replication
(λ` ) processes ongoing within an infectee Ah during this infectees exposed
(E`0 τh`0 ) and infectious (I`0 τh`0 ) stages (Fig. 1)
11. computed the overall probability πih,j`0 that that an infector Ai infected
with major strain j results in an infectee Ah expressing `0 as its major
strain
12. implemented a discrete time individual-based stochastic SEIVD (here V
represents individuals that have either recovered from infection or have
been vaccinated, D represents cumulative dead) multistrain model that
includes specifiable time-dependent univalent and multivalent vaccination
applications

Our J-RAMP implementation
Models of systems process can be coded as singular implementations model formulations using: i) highly efficiently compilable computer languages (e.g., C++,
FORTRAN, Java) ; or ii) less efficiently, but more easily coded, scriptable (e.g.,
JavaScript, Python, Perl) computer languages. More conveniently and expeditiously, they can be coded up, as discussed in [52], using a systems modeling
platform, such as Matlab’s SIMULINK, Mathematica, Stella, AnyLogic, Numerus, or Berkeley Madonna. Advantages of the latter include more rapid and
accurate model development, though simulations may be slowed down by platform overhead. Between these extremes, we propose a more general approach
to specific classes of systems’ models, where the basic system structure is fixed,
but implementation of some elements can be easily and safely altered so that
optional implementations are presented at runtime. We call such a design runtime alterable-model platforms. (RAMPs); and here we present a Java RAMP
implementation of the SEIVD-IBM described in the previous subsection.

12

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511

Getz et al.

The characteristics we envision for a model platform to be a RAMP are:
1. RAMPs include a set of model parameters (constants) whose values can
be selected or specified (sometimes within a predefined range of values)
at simulation runtime using a switch, nob, slider, or text-entry window
accessed via a platform graphical interface or dashboard (e.g., see Fig. 2
and Table 1 which apply to our SEIVD-IBM J-RAMP).
2. RAMPs include a specific set of runtime alternative modules, (RAMs),
where the original can be redefined in a graphical interface window, and
the unaltered original and the alternative routines are stored as a (preferably open-ended) numbered set. The original or any one of the alternatives
can be selected for use at runtime (for a list of functions in our RAMP
see Table 2).
3. RAMP implementations also provide an API for both remote and onboard scripting. This API enables control of all user aspects of the simulation, including the parameter set, run management, RAM options, and
data retrieval. Script logic can alter parameter settings and RAM options
as the simulation progresses. A Nashorn-based Javascript interpreter enhanced with API methods is provided.
4. The API can be accessed remotely using operating system facilities by
external applications running concurrently with the simulator. Of particular interest is the ability to control the simulation from the R statistical
platform. An R routine can be formulated to both manage the simulation
run and to retrieve and process the resulting data. The RAMP simulation
becomes a “virtual package” to the controlling R logic. See Appendix B.

520

We implemented our RAMP using Java and made ample use of all of the features described above. Use of the RAM facility permitted experimentation with
the several versions of cross immunity presented in this paper. A Javascript program was used to control an adaptive vaccination strategy. A small R package
serving as a driver was used in an R program that ran the simulation multiple
times, extracted results into R data structures, and produced graphs showing
statistical mean and standard deviation. More details on the graphical structure
and implementation of our SEIVD-IBM are both implied in the presentation of
results below, and in additional details provided in Appendix B.

521

COVID-19 model assumptions and parameter values

512
513
514
515
516
517
518
519

522
523
524
525
526
527
528
529
530
531
532
533

The first variable that needs to be determined is the unit of time we use for
our simulations because all process rate parameters are scaled by its selection.
Since the time resolution of empirical COVID-19 incidence and mortality data is
daily, we selected our unit of time t to be days. Additionally, based on various
sources including a metapopulation study of COVID-19 parameter estimates
[53], we set the latent and infectious periods to be 4 and 7 days respectively.
Basic SEIR epidemiological models do not separate out the processes of contact
and transmission-per-contact, so we had some leeway on what values to choose
for contact rates and transmission rates per contact because it is the value of
the product of these that is important in determining the reproductive value,
commonly referred to as “R0 ” for COVID-19. Hussein et al.’s [53] meta analysis
of COVID-19 zeroed in on R0 = 3.14 as a mean value across a range of studies
13

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570

571
572
573
574
575
576

Getz et al.

(95% confidence interval [2.69, 3.59]) though these authors suggested that the
most recent studies they looked at suggested that R0 was more likely between
2 and 3.
Assuming no seasonal effects (i.e., δ = 0 in Eq. 3), in our single-strain runs
we kept R0 ≈ 3 by setting κ = 4 (effective contacts per day, which nominally
involves being with 6 feet of one another at least 15 mins) thereby requiring
β = 0.3, because in the notation of the continuous time model introduced in
Eq. A.29, we have an inverse latent period of γ ≡ 1/σE = 1/4 and an inverse
infectious period of ρ ≡ 1/σI = 1/7 (Table 1) for Eq. A.29 to yield R0 =
4×0.3
1/4+1/7 = 3.05
In our multistrain runs, we did allow for the emergence of strains that were
more transmissible than this single-strain value (in these runs new strains were
in the range [0,0.475] (see table depicted in Fig. C.4). Also, although the incubation period is typically thought to have a median of 5 days, it can be much
faster [54].
In reality, the contact rate κ is not constant, but is time varying. It is influenced by the social distancing behavior of individuals who may be responding
to fears of contracting the disease, or regulations imposed by local authorities
to reduce effective contact rates. To account for this, we formulated an adaptive contact rate function κ(t) (Eq. A.10) in terms of a function that declines
adaptively from a non-epidemic (baseline maximum) value κ0 to κ0 /2 when the
prevalence (the percentage of the population infectious at time t) increases to
NI (t)
half
. In the illustrative simulations presented here, we explore the
N (t)−ND (t) = pI
= 0.002
on the size of the shape of epidemic, but set phalf
effect of varying phalf
I
I
(i.e., a prevalence level of 0.2%) as a baseline value, because in our simulations
this baseline value, along with the parameter values selected above, results in a
cumulative number of cases to just over 11% in a population of N = 100, 000
(Appendix C, Fig. C.3). This puts our illustrative baseline case in the ballpark
of the US outbreak which Worldometer reported to have a cumulative case level
of 8.5% (≈ 284.5 × 106 /332.9 × 106 ) after one year, but this is likely to be a
substantial underestimate of the actual number of cases [55].
To keep things simple in applying our model to a multistrain setting, we
assumed that the immune effects on infector shedding and mutation and replication within the infectee through a cross-immunity processes, can be tweaked
through a single constant c ∈ [0, 1) (making the elements cj` of the matrix
C strain-dependent will obviously require considerable supporting data). One
scenario is to assume cross immunity only applies to nearest neighbors, i.e.:

 1 if ` = j
c if ` differs from j by one allele
Nearest-neighbor C:
cj` =
(1)

0 otherwise
For other formulations, such as “Cascading C” or including escape mutations
in the mix see Eqs. A.7 and A.9 in Appendix A.
Additionally, we expect this type of evidence to become increasing available
with whole genome sequence of pathogen strains [56] collected during host shedding. For simplicity’s sake, however, we assume that infectee with major strain
j will shed minor strains in the immediate neighborhood of j at comparative
14

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

577

578
579
580
581
582

rate ζ ∈ [0, 1) and be major

 1
ζ
ζj` =

0

Getz et al.

strain-independent: i.e., we assume
if ` = j
if ` differs from j by one allele
otherwise

(2)

Third, again in the absence of evidence to the contrary, we assume that
seasonal fluctuations are strain independent. In this case, for strain-independent
constants δ ∈ [0, 1) and θ ∈ [−π, π] that set seasonal fluctuations related to
environmental persistence, Eq. A.13 in the Appendix A simplifies for a single
constant η̄ to:



2πt
+θ
∀`
(3)
η` (t) = η̄ 1 + δ sin
365

587

In our multistrain simulations, for purposes of illustration, we set both the
shedding parameter ζ in Eq. 2 above and µ in Eq. A.16 to be 0.001. Obviously, it
would be of considerable interest to know how the values of these two parameters
impact strain proliferation, but this is left to future studies when data are
available to guide simulations of realistic scenarios.

588

Running the model

583
584
585
586

590

The model can be accessed at Github where instructions are available for launching and using our SEIVAgent application.

591

Acknowledgements and Funding Sources

592

This work was funded in part by NSF Grant 2032264 (PI: WMG).

589

15

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

593

594
595

596
597
598
599

600
601
602

603
604
605

606
607
608

609
610

611
612
613
614
615

616
617
618

619
620
621
622

623
624
625

626
627
628

629
630
631

Getz et al.

References
[1] Anderson RM. The impact of vaccination on the epidemiology of infectious
diseases. In: The Vaccine Book. Elsevier; 2016. p. 3–31.
[2] Kohli M, Maschio M, Becker D, Weinstein MC. The potential public health
and economic value of a hypothetical COVID-19 vaccine in the United
States: Use of cost-effectiveness modeling to inform vaccination prioritization. Vaccine. 2021;39(7):1157–1164.
[3] Eguia RT, Crawford KH, Stevens-Ayers T, Kelnhofer-Millevolte L,
Greninger AL, Englund JA, et al. A human coronavirus evolves antigenically to escape antibody immunity. PLoS pathogens. 2021;17(4):e1009453.
[4] Jeyanathan M, Afkhami S, Smaill F, Miller MS, Lichty BD, Xing Z. Immunological considerations for COVID-19 vaccine strategies. Nature Reviews Immunology. 2020;20(10):615–632.
[5] Koopman JS, Simon CP, Getz WM, Salter R. Modeling the population
effects of epitope specific escape mutations in SARS-CoV-2 to guide vaccination strategies. medRxiv. 2021;.
[6] Sariol A, Perlman S. Lessons for COVID-19 immunity from other coronavirus infections. Immunity. 2020;.
[7] Tai W, Wang Y, Fett CA, Zhao G, Li F, Perlman S, et al. Recombinant
receptor-binding domains of multiple Middle East respiratory syndrome
coronaviruses (MERS-CoVs) induce cross-neutralizing antibodies against
divergent human and camel MERS-CoVs and antibody escape mutants.
Journal of virology. 2017;91(1).
[8] Harvey WT, Carabelli AM, Jackson B, Gupta RK, Thomson EC, Harrison
EM, et al. SARS-CoV-2 variants, spike mutations and immune escape.
Nature Reviews Microbiology. 2021;p. 1–16.
[9] Saad-Roy CM, Levin SA, Metcalf CJE, Grenfell BT. Trajectory of individual immunity and vaccination required for SARS-CoV-2 community
immunity: A conceptual investigation. Journal of the Royal Society Interface. 2021;18(175):20200683.
[10] Saad-Roy CM, Wagner CE, Baker RE, Morris SE, Farrar J, Graham AL,
et al. Immune life history, vaccination, and the dynamics of SARS-CoV-2
over the next 5 years. Science. 2020;370(6518):811–818.
[11] Willem L, Verelst F, Bilcke J, Hens N, Beutels P. Lessons from a decade of
individual-based models for infectious disease transmission: a systematic
review (2006-2015). BMC infectious diseases. 2017;17(1):612.
[12] Chowell G, Sattenspiel L, Bansal S, Viboud C. Mathematical models to
characterize early epidemic growth: A review. Physics of life reviews.
2016;18:66–97.

16

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

632
633
634

635
636
637
638

639
640
641
642

643
644
645
646
647

648
649

650
651
652

653
654

655
656
657

658
659
660
661

662
663
664

665
666
667

668
669
670
671

Getz et al.

[13] Keskinocak P, Oruc BE, Baxter A, Asplund J, Serban N. The impact of
social distancing on COVID19 spread: State of Georgia case study. Plos
one. 2020;15(10):e0239798.
[14] Abueg M, Hinch R, Wu N, Liu L, Probert W, Wu A, et al. Modeling
the effect of exposure notification and non-pharmaceutical interventions
on COVID-19 transmission in Washington state. NPJ digital medicine.
2021;4(1):1–10.
[15] Chen PZ, Bobrovitz N, Premji Z, Koopmans M, Fisman DN, Gu FX. Heterogeneity in transmissibility and shedding SARS-CoV-2 via droplets and
aerosols. eLife. 2021 apr;10:e65774. Available from: https://doi.org/
10.7554/eLife.65774.
[16] van Doremalen N, Bushmaker T, Morris DH, Holbrook MG, Gamble
A, Williamson BN, et al. Aerosol and Surface Stability of SARS-CoV2 as Compared with SARS-CoV-1. New England Journal of Medicine.
2020;382(16):1564–1567. Available from: https://doi.org/10.1056/
NEJMc2004973.
[17] Maginnis MS. Virus–receptor interactions: the key to cellular invasion.
Journal of molecular biology. 2018;430(17):2590–2611.
[18] Challen R, Brooks-Pollock E, Read JM, Dyson L, Tsaneva-Atanasova K,
Danon L. Risk of mortality in patients infected with SARS-CoV-2 variant
of concern 202012/1: matched cohort study. bmj. 2021;372.
[19] Alizon S, Luciani F, Regoes RR. Epidemiological and clinical consequences
of within-host evolution. Trends in microbiology. 2011;19(1):24–32.
[20] Fenichel EP, Castillo-Chavez C, Ceddia MG, Chowell G, Parra PAG, Hickling GJ, et al. Adaptive human behavior in epidemiological models. Proceedings of the National Academy of Sciences. 2011;108(15):6306–6311.
[21] Gozzi N, Bajardi P, Perra N. The importance of non-pharmaceutical interventions during the COVID-19 vaccine rollout. medRxiv. 2021;Available from:
https://www.medrxiv.org/content/early/2021/01/09/
2021.01.09.21249480.
[22] Kumar A, Dowling WE, Román RG, Chaudhari A, Gurry C, Le TT, et al.
Status Report on COVID-19 Vaccines Development. Current Infectious
Disease Reports. 2021;23(6):1–12.
[23] Chretien JP, George D, Shaman J, Chitale RA, McKenzie FE. Influenza forecasting in human populations: a scoping review. PloS one.
2014;9(4):e94130.
[24] Getz WM, Gonzalez JP, Salter R, Bangura J, Carlson C, Coomber M,
et al. Tactics and strategies for managing Ebola outbreaks and the salience
of immunization. Computational and mathematical methods in medicine.
2015;2015.

17

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

672
673
674

675
676

677
678
679

680
681
682
683

684
685
686

687
688
689

690
691
692

693
694
695

696
697
698
699

700
701
702

703
704

705
706
707

708
709
710

Getz et al.

[25] Getz WM, Salter R, Mgbara W. Adequacy of SEIR models when epidemics
have spatial structure: Ebola in Sierra Leone. Philosophical Transactions
of the Royal Society B. 2019;374(1775):20180282.
[26] Drake JM. Limits to forecasting precision for outbreaks of directly transmitted diseases. PLoS Med. 2005;3(1):e3.
[27] Jefferies JM, Clarke SC, Webb JS, Kraaijeveld AR. Risk of red queen
dynamics in pneumococcal vaccine strategy. Trends in microbiology.
2011;19(8):377–381.
[28] Thomas LJ, Huang P, Yin F, Luo XI, Almquist ZW, Hipp JR, et al. Spatial heterogeneity can lead to substantial local variations in COVID-19
timing and severity. Proceedings of the National Academy of Sciences.
2020;117(39):24180–24187.
[29] Getz WM, Salter R, Luisa Vissat L, Horvitz N. A versatile web app for
identifying the drivers of COVID-19 epidemics. Journal of Translational
Medicine. 2021;19(1):1–20.
[30] Da Silva RM, Mendes CF, Manchein C. Scrutinizing the heterogeneous
spreading of COVID-19 outbreak in large territorial countries. Physical
Biology. 2021;18(2):025002.
[31] Zhang J, Litvinova M, Liang Y, Wang Y, Wang W, Zhao S, et al. Changes in
contact patterns shape the dynamics of the COVID-19 outbreak in China.
Science. 2020;.
[32] Udwadia ZF, Raju RS. How to protect the protectors: 10 lessons to learn
for doctors fighting the COVID-19 coronavirus. Medical Journal, Armed
Forces India. 2020;.
[33] Van Damme W, Dahake R, van de Pas R, Vanham G, Assefa Y. COVID-19:
Does the infectious inoculum dose-response relationship contribute to understanding heterogeneity in disease severity and transmission dynamics?
Medical hypotheses. 2021;146:110431.
[34] Zhao Z, Li H, Wu X, Zhong Y, Zhang K, Zhang YP, et al. Moderate
mutation rate in the SARS coronavirus genome and its implications. BMC
evolutionary biology. 2004;4(1):1–9.
[35] Geoghegan JL, Holmes EC. The phylogenomics of evolving virus virulence.
Nature Reviews Genetics. 2018;19(12):756–769.
[36] Larsen LG, Eppinga MB, Passalacqua P, Getz WM, Rose KA, Liang
M. Appropriate complexity landscape modeling. Earth-science reviews.
2016;160:111–130.
[37] Yang P, Yang G, Qi J, Sheng B, Yang Y, Zhang S, et al. The effect of multiple interventions to balance healthcare demand for controlling COVID-19
outbreaks: a modelling study. Scientific reports. 2021;11(1):1–13.

18

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

711
712
713
714

715
716
717
718

719
720

721
722

723
724

725
726
727

728
729
730

731
732
733
734

735
736
737

738
739
740
741

742
743
744

745
746
747

748
749

Getz et al.

[38] Baker RE, Park SW, Yang W, Vecchi GA, Metcalf CJE, Grenfell BT.
The impact of COVID-19 nonpharmaceutical interventions on the future
dynamics of endemic infections. Proceedings of the National Academy of
Sciences. 2020;117(48):30547–30553.
[39] Greaney AJ, Starr TN, Gilchuk P, Zost SJ, Binshtein E, Loes AN,
et al. Complete mapping of mutations to the SARS-CoV-2 spike receptorbinding domain that escape antibody recognition. Cell host & microbe.
2021;29(1):44–57.
[40] Brüssow H. COVID-19: emergence and mutational diversification of SARSCoV-2. Microbial Biotechnology. 2021;14(3):756–768.
[41] Keeling MJ, Eames KT. Networks and epidemic models. Journal of the
Royal Society Interface. 2005;2(4):295–307.
[42] Roberts GO, Rosenthal JS, et al. General state space Markov chains and
MCMC algorithms. Probability Surveys. 2004;1:20–71.
[43] Lele SR, Dennis B, Lutscher F. Data cloning: easy maximum likelihood estimation for complex ecological models using Bayesian Markov chain Monte
Carlo methods. Ecology letters. 2007;10(7):551–563.
[44] Suthar MS, Zimmerman MG, Kauffman RC, Mantus G, Linderman SL,
Hudson WH, et al. Rapid generation of neutralizing antibody responses in
COVID-19 patients. Cell Reports Medicine. 2020;1(3):100040.
[45] Muruato AE, Fontes-Garfias CR, Ren P, Garcia-Blanco MA, Menachery VD, Xie X, et al. A high-throughput neutralizing antibody assay
for COVID-19 diagnosis and vaccine evaluation. Nature communications.
2020;11(1):1–6.
[46] Lavine JS, Bjornstad ON, Antia R. Immunological characteristics govern
the transition of COVID-19 to endemicity. Science. 2021;371(6530):741–
745.
[47] Tkachenko AV, Maslov S, Elbanna A, Wong GN, Weiner ZJ, Goldenfeld
N. Time-dependent heterogeneity leads to transient suppression of the
COVID-19 epidemic, not herd immunity. Proceedings of the National
Academy of Sciences. 2021;118(17).
[48] Koyama T, Weeraratne D, Snowdon JL, Parida L. Emergence of drift variants that may affect COVID-19 vaccine development and antibody treatment. Pathogens. 2020;9(5):324.
[49] Getz WM, Lloyd-Smith JO. Basic methods for modeling the invasion and
spread of contagious diseases. DIMACS Series in Discrete Mathematics
and Theoretical Computer Science. 2006;71:87.
[50] McCallum H, Barlow N, Hone J. How should pathogen transmission be
modelled? Trends in ecology &amp; evolution. 2001;16(6):295–300.

19

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

750
751

752
753
754

755
756
757

758
759
760

761
762
763

764
765
766
767

768
769
770

771
772
773

774
775
776

777
778
779

780
781
782
783

784
785

Getz et al.

[51] Anderson RM, May RM, et al. Coevolution of hosts and parasites. Parasitology. 1982;85(Pt 2):411–426.
[52] Getz WM, Salter R, Lyons AJ, Sippl-Swezey N. Panmictic and clonal
evolution on a single patchy resource produces polymorphic foraging guilds.
PloS one. 2015;10(8):e0133732.
[53] Hussein M, Toraih E, Elshazli R, Fawzy M, Houghton A, Tatum D, et al.
Meta-analysis on serial intervals and reproductive rates for SARS-CoV-2.
Annals of surgery. 2021;273(3):416–423.
[54] Grimm V, Mengel F, Schmidt M. Extensions of the SEIR model for the
analysis of tailored social distancing and tracing approaches to cope with
COVID-19. Scientific Reports. 2021;11(1):1–16.
[55] Wu SL, Mertens AN, Crider YS, Nguyen A, Pokpongkiat NN, Djajadi S,
et al. Substantial underestimation of SARS-CoV-2 infection in the United
States. Nature communications. 2020;11(1):1–10.
[56] Munnink BBO, Nieuwenhuijse DF, Stein M, O’Toole Á, Haverkate M,
Mollers M, et al. Rapid SARS-CoV-2 whole-genome sequencing and analysis for informed public health decision-making in the Netherlands. Nature
medicine. 2020;26(9):1405–1410.
[57] Kramer A, Schwebke I, Kampf G. How long do nosocomial pathogens persist on inanimate surfaces? A systematic review. BMC infectious diseases.
2006;6(1):1–8.
[58] Liu X, Huang J, Li C, Zhao Y, Wang D, Huang Z, et al. The role of
seasonality in the spread of COVID-19 pandemic. Environmental research.
2021;195:110874.
[59] Valtonen A, Molleman F, Chapman CA, Carey JR, Ayres MP, Roininen
H. Tropical phenology: Bi-annual rhythms and interannual variation in an
Afrotropical butterfly assemblage. Ecosphere. 2013;4(3):1–28.
[60] Getz WM, Salter R, Muellerklein O, Yoon HS, Tallam K. Modeling epidemics: A primer and Numerus Model Builder implementation. Epidemics.
2018;25:9–19.
[61] Lythgoe KA, Hall M, Ferretti L, de Cesare M, MacIntyre-Cockett G,
Trebes A, et al. SARS-CoV-2 within-host diversity and transmission.
Science. 2021;372(6539). Available from: https://science.sciencemag.
org/content/372/6539/eabg0821.
[62] Jones JH. Notes on R0. Califonia: Department of Anthropological Sciences.
2007;323.

20

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

786

Getz et al.

Figures and Tables

Figure 1: An overview of the processes included in our SEIVD-IBM model. The
inf
probability πih,jl
of Ah being infected primarily with pathogen ` in terms of receiving
an effective dose from agent Ai , (η) is computed in terms of a concatenation of shedding
rates (ζi` ), environmental persistence rates (ε` ), and host transmission (βh` ) processes
(Eq. A.15) and includes both waning and cross immunity factors. The probability
inv
0
πh``
0 that the dominant strain emerging in host Ah is strain ` given initial infection
with strain ` is computed in terms of within-host mutation and within-host replication
process (Eq. A.16) and also includes both waning and cross immunity factors. These
two probabilities are then used to compute the overall probability πih,j`0 (Eq. A.17)
that infector i, infected with major strain j, infects infectee h with major strain `0 . The
quantity Reff (t0 ) is the expected number of individuals each infectious agent is expected
to infect around time t0 ∈ [t + σE , t + σE + σI ], where R0 = Reff (0) is estimated for
our model using Eq. A.29. Equation references for the other mathematical functions
provided in this figure are given in Table 2.

21

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure 2: A. The dashboard of our Java Runtime-Alterable-Model Platform (JRAMP) SEIVD (S=susceptibles, E=exposed, I=infectious, V=immune, D=dead)
individual-based model (IBM) and simulations obtained using the parameters values
depicted in the slider windows (also see Table 1). The top left window of this dashboard contains information on the final state of the population (in this case S = 2135
and D = 165 in a population of N0 = 10, 000), the bottom left bar graph of dashboard
panel is the final values of E, I, V and D at epidemic cessation at time t = 166 (days)
or the simulation run time, whichever comes first. Dashboard also shows a graph of
incidence and cumulative deaths (purple and black: selected using colored buttons
below the graph). The bottom ribbon of the dash board has a series of radio buttons
that respectively open a Log, a JavaScript (JS), and a Scripting (S) window, Line and
Bar graph windows (for multistrain runs), as well as windows for controlling vaccination strategies (V), listing realtime agent information (A), pathogen parameter values
(P), monitoring probability computations (Intern), coding and controlling runtime alternative operations (Op), and three runtime buttons (Reset, Step, Run). B. Graphs
of prevalence (cut out from main panel when only the red button is on) and C. daily
deaths (crimson button) are pasted below the dashboard.
22

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure 3: Plots of prevalence (I: red) and dead (D: black) individuals for simulations
using the parameter values given in Table 1 with N = 10, 000. The waning immunity
half-life values are thalf = 90, 120 or 180, as labeled. In the top two panels the contact
= 0.05 or
rate is constant, while in the bottom two panels it is adaptive with phalf
I
0.01 as labeled (Eq. A.10). Note that the adaptive case approaches the constant case
→ ∞ and that the vertical axis in the four panels each have different scale,
as phalf
I
though the horizontal time axes is the same in all four case (365 days).

Figure 4: Incidence (∆I+ : purple) is plotted over 3 years for the baseline run (parameters given in Table 1 with N = 100, 000, phalf
= 0.002, and thalf = 365) for the cases
I
where vaccination rates v(t) (indicated by blue lines) are applied during the second
and third years only to individuals not previously vaccinated selected at random (A.
v(t) = 0.001, B. v(t) = 0.002) and to individuals not previously vaccinated and who
also have not previously been infected with SARS-CoV-2 (C. v(t) = 0.002).

23

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure 5: The total daily incidence (∆I+: purple) and strain-specific prevalence
(I: red) individuals for a 16-strain epidemic (stain number and binary equivalent as
labeled above each strain plot) burning through a population of size N = 100, 000
are plotted over a 3-year period for the cases where cross-immunity is absent (A.
c = 0.0) or intermediate among nearest neighbors differing by one allele (B. c = 0.5).
The remaining parameters are listed in Table 1 and for all strains include the same
host transmission (β̄ = 0.3) and virulence (pα = 0.02), waning half-life (thalf = 365),
minor strain shedding (ζ = 0.001) and within host mutation (µ = 0.001) parameter
values. Note that each panel has its own vertical scale and that the horizontal scales
are set by the J-RAMP and are 0-1100 days for the incidence curves and 0-1250 days
for the prevalence curves, although all curves are drawn to 1100 days. Dominant or
codominant strains are labeled in red (number and equivalent allele representation),
while minor strains are labeled in light grey.

24

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure 6: Daily incidence (deep purple curves) and prevalence of individual strains
(red curves; with strain number and binary equivalent labels plotted in order of emergence over time) that exceed a maximum prevalence of 12 individuals at any time are
plotted over a three year period (t ∈ [0, 1100] days), firstly, for three cases (A.-C.
in a system with nearest-neighbor only cross-immunity (labeled “simple”, see Eq. 1)
and, secondly, in two cases (D. and F.) in a system with cascading cross-immunity
(Eq. A.7). In the first three cases we have: A., no vaccination (blue labels); an B. &
C., a vaccination rate of v = 0.002 applied in years 2 and 3 (t ∈ [365, 110]) to individuals who have not previously been vaccinated, respectively for the cases of univalent
vaccines (strain 0, green labels and strain 127, brown labels). In the fourth case, D.,
a quadravalent vaccine (strain 0, 7, 31 & 127; plum labels) is applied at a vaccination
rate of v = 0.01 (i.e., 1%) at random, irrespective whether or not individuals selected
have been previously vaccinated (or ill with COVID-19). In the fifth case, E (“robust
immunity case”), a bivalent vaccine (strains 0 & 127; orange labels) is applied, as in
cases B. & C., at a vaccination rate of v = 0.002 (i.e., 1%) at random to individuals
selected that have been previously vaccinated. In this latter case, however immune
waning has been reduced by a factor of 5 (thalf = 1825 days) with cascading cross
immunity increased from c = 0.5 to c = 0.9. The dashboards for all these cases, and
miniature prevalence plots of all 128 strains for each of these four cases can be found in
Figs. C.5-C.9 in the Appendix. The parameter values are the same as in Fig. 5B, apart
from the immune parameters being greatly strengthen in the “robust immunity case”
E., and in all cases strain specific transmission parameter values βj (j = 0, ..., 127) that
were randomly assigned values between 0 and 0.3, except for the increasingly dominant
strain sequence β0 = 0.3 (0 ≡ (0, 0, 0, 0, 0, 0, 0)), β1 = 0.325 (1 ≡ (0, 0, 0, 0, 0, 0, 1)),
β3 = 0.35 (≡ (0, 0, 0, 0, 0, 1, 1)),..., β127 = 0.475 (127 ≡ (1, 1, 1, 1, 1, 1, 1)) (particular
values of βj are provided for the different strains depicted here; see Table in Fig. C.4
for all values of βj , j = 0, ..., 127). Note that the vertical axis are all on the same scale
height for incidence, but are individually scaled for prevalence, while the time axis are
all on the same scale for the prevalence curves which differs from the incidence curves,
which among themselves are all on the same time scale.

25

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure 7: The daily incidences (vertical axis: number of individuals) are plotted over
time (horizontal axis: number of days; plots have been squashed to ensure they are all
on the same time scale) for two cases: A. adaptive vaccination for nearest-neighbor
only cross immunity (Eq. 1) and B. adaptive vaccination for cascading cross immunity
case (Eq. A.7), and should be compared with the non-vaccination case depicted in
Fig. 6A and the non-adaptive vaccination case depicted in Fig. 6D. As in this latter
non-adaptive case, vaccination is performed on non-infectious individuals, selected at
random (i.e., re-vaccinations can occur) at a rate of 1% per day, but now the dominant
strain is targeted, as well as a second strain if its prevalence exceeds 10 cases, with
vaccine valency switches every 90 days. The realized adaptive vaccine valencies for
these two runs are indicated by colored bars on the horizontal time axis (red, valency
is (0,127); brown, valency is (127); orange, valency is (23); green, valency is (102)).

26

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Table 1: Parameter values used to simulate single and multistrain outbreaks
Parameter

Symbol

Value

Source/Comment

single-strain simulations
Time unit
Nominal pop size
Basic contact rate
Transmission
Latent Period
Infectious period

t
N0
κ0
β
σE
σI

daily
4
10 to 105
4 per day
0.3
4 days
7 days

Goldilocks value∗
Goldilocks value‡
effective contacts†
ensures R0 ≈ 3+
median time in E¶
median time in I§

Immunity half-life
thalf
1/4 to 1 year
per run specs.k
∗∗
Disease-induced mort.
pα
2% of cases
mortality rate is α#
Adaptive contact param.∗†
phalf
0, 0.002, 0.05
reduces κ from κ0
I
Seasonal fluctuation param.
δ
0
seasons ignored∗+
Multi strain simulations (single-strain parameter values for all strains if not mentioned below)
Mutation rate∗‡
µ
0.001∗#
See Eq. A.16
J
Strain number
j = 0, ..., 2 − 1
J is 1 to 8
i.e., 2 to 1024 strains
Cross immunity
cjm
0 & 0.5
See Eq. 1
Pathogen shedding
ζ̄jm
0.001∗#
See Eq. A.12
Environmental persistence
η̄j
1 for all j
See Eq. A.13
Transmission
β̄j
[0,0.475]
per run specs.
Within-host replication rate
λj
1 for all j
See Eq. A.16
Disease-induced mort.∗∗
pαj
[0,0.05]
per run specs.
∗ Weekly

unit produced excessive variation (see SOI)

‡ Trade-off

between excessive demographic stochasticity and simulation run time
long and close to make transmission possible (also see Eq. A.29)
+ See Eq. A.29
¶ Reciprocal of γ in continuous time computation of R per Eq. A.29
0
§ Reciprocal of ρ in continuous time computation of R per Eq. A.29
0
k See Eq. A.6: note w(t) switches from 1 to 0 as immunity goes from complete to absent

† Sufficiently

# This

is “virulence” parameter of continuous-time SEIR models
α << 1 then pαj = 1 − e−α ≈ α
∗† See Eq. A.10. Mostly 0.002 is used. Setting phalf = 0 implements κ(t) = κ ,
0
I
though κ(t) → κ0 as phalf
→∞
I
∗+ Implies values of k and θ in Eq. A.13 are irrelevant
∗‡ Strain independent—strain dependence requires more elaborate model
∗∗ If

∗# Quantifies
∗∗∗ If

the pass-on rate of mutations rather than the mutational rate of a locus or gene
αj << 1 then pαj = 1 − e−αj ≈ αj

27

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Table 2: Variables, indices and functions used in the model
Symbols
Variables
NS (t), NA (t), ND (t)
J, j, m, ` and `0
NI (t), NIj (t)
Ai , Ah
Functions
ωij (t)
κ(t)
φij (t)
ζij (t)
η` (t)
βh` (t)
inf
(t)
πih,j`
inv
πh``
0 (t)
πih,j`0 (t)

Variables and indices

Equation

size of sets S, A and D
Eq. A.1
J
strain entropy and indices (0, ..., 2 − 1)
Eq. A.2
number of infectious: total and strain j at time t
specific agents i, h = 1, ..., NA (t) in set A
Eq. A.4
waning immunity of Ai w.r.t. strain j
adaptive contact rate
immunity modifier
shedding rate of strain j by infector Ai
environmental persistence
strain transmission to infectee Ah
probability Ai infects Ah
probability `0 is major strain when ` invades
probability `0 is major strain in Ah
when j is major strain in Ai

Eq. A.6
Eq. A.10
Eq. A.11
Eq. A.12
Eq. A.13
Eq. A.14
Eq. A.15
Eq. A.16
Eq. A.17

28

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

1

APPENDICES

2

A

Getz et al.

Model Construction

5

Here we formulate an individual-based or agent-based (ABM) SEIR epidemiological model to include host immunological waning and pathogen genetic drift
with variation across strain transmissibility and virulence. [1]

6

Assumptions, definitions, and states

3
4

7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40

The population consists of a well-mixed pool of N0 individuals that is homogeneous except for the fact that some are uninfected (denoted S), some currently
infected (E: exposed and not yet infectious; I infectious and asymptomatic or
symptomatic) or have been infected and are now either dead (D) or recovered/vaccinated with some level of immunity (V) to one or more of 2J pathogen
strains. This immunity wanes over time and its current level, augmented by
specified levels of strain cross-immunity, factored into an agent specific timedependent strain-resistance function that impacts the shedding of mutant strains
by infectors and the within-host replication rates of mutant strains in infectees.
At the start of the epidemic, all individuals are assumed to encounter, on
average, κ0 > 0 other individuals during each time period [t, t + 1], but this
“effective contacts” rate adaptively decreases with increasing prevalence of the
disease due to the implementation of non-pharmaceutical interventions (social
distancing, hand washing, mask wearing, and other hygienic precautions). In
our selection of epidemiological parameter values, a unit of time is taken to be a
24-hour day. Other scalings of time would then require appropriately adjusted
epidemiological parameter values. Refined versions of the model could include
age-related parameter values and contact rates, as well as contact tracing, quarantining, and isolation of infected individuals; but these will not be considered
here.
Initially, at model time t = 0, all individuals are considered SARS-CoV2 naı̈ve susceptible apart from one individual who is considered to have just
entered the infectious stage, infected by a pathogen designated as pathogen
strain 0 (wildtype). Throughout the model simulation, the N0 agents in the
population are partitioned into three disjoint sets: the set of SARS-CoV-2 naı̈ve
individuals, S(t), containing NS (t) (the susceptibles); the set of identified agents,
A(t), containing NA (t) individuals who are either currently infected (time t)
with a particular strain of SARS-CoV-2, or have some level of waning immunity
to one or more strains of SARS-CoV-2; and the set of dead individuals D(t),
currently of size ND (t). Only the individuals in A(t) are uniquely identified as
they become infected for the first time and make the transition from set S(t) to
set A(t), where they are sequentially labeled using the index i = 1, ..., NA (t).
The single infected individual at time zero will be designated Agent 1 (also
known as patient zero and denoted by A1 ). Thus at time t it follows that
NS (t) + NA (t) + ND (t) = N0 (a constant)

41
42

(A.1)

We note that individuals in set A(t) can be in a disease state E or I with
respect to pathogen j, but simultaneously can be in multiple immune states if
29

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

57

they have been infected with more than one pathogen strain in the past. We also
note that the distinction between symptomatic and asymptomatic individuals
in state I will not be considered here; and only need be incorporated if testing,
quarantining, and treatment processes are included in the model.
The total number of pathogen strains is set by a parameter J > 0, where each
pathogen is represented by a J-bit binary number. Thus, there are 2J possible
strains indexed by j = 0, 1, 2, . . . , 2J − 1 where j is the decimal equivalent that
corresponds to a given binary string. The initial strain, j = 0 is the binary
string of J zeros.
Sets of stochastic epidemic events (i.e., transitions from classes S to E, E to
I, I to V or D) are implemented at consecutive integer points in time (one set
of events for each point in time). Events will only be considered on individuals
that have been infected by at least one of the pathogens at some time after t = 0
(this means that initially the epidemic computation proceeds rather rapidly, but
becomes more computationally intensive for each time step as time proceeds).

58

Pathogen set

43
44
45
46
47
48
49
50
51
52
53
54
55
56

59
60
61
62
63
64
65
66
67
68
69
70
71

At the start of the simulation (t = 0), the set of potential pathogens indexed
by j = 0, ..., 2J − 1 is generated along with its associated environmental persistence (η̄j ), transmission (β̄j ), within host replication (λj ) and disease-induced
mortality rate (probability of dying from the disease pαj ) parameters. These
may be specified or drawn from underlying distributions (e.g., the uniform distributions β ∼ Uniform[βmin , βmax ] and so on). Also, our model includes two
2J × 2J matrices of constants that are associated with pathogen mutations during strain shedding (elements ζjm ) and cross-immunity (elements cjm ) processes
and thus involve but are conditioned on either the major strain that an infector
is harboring or on immunological state of the agents involved. These are the
shedding and cross-immunity matrices with elements j, m = 1, ..., 2J − 1, Thus
we generate the following list of parameters associated with our 2J pathogen
strains:
Pathogen list =
(A.2)


J
J
η̄j , β̄j , λj , pαj ; ζjm and cjm for m = 0, ..., 2 − 1 j = 0, ..., 2 − 1

72

73
74
75
76
77

78
79

80
81
82

Agent states
In accordance with the above set of assumptions, each agent has the following
basic disease states at time t, where disease states in agent Ai are referenced by
the time τj > 0 at which the most recent infection with strain j has occurred
(an individual may be re-infected after immunity to the strain has waned to
relatively low levels):
1. S(t): An individual who at time t has not been infected with any strain
of the pathogen up to time t. All these individuals belong to set S(t)
2. Ej (t, τij ): An agent Ai who was infected with strain j at time τij , but has
not yet become infectious (this is an individual in the latent stage that
lasts for σE units of time). All these individuals belong to set A(t)

30

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

83
84
85

86
87
88
89
90

91
92
93
94

95
96

Getz et al.

3. Ij (t, τij ): An agent Ai who is currently infectious with strain j, after being
infected with strain j at time τij (this is the infectious stage that lasts for
σI units of time). All these individuals belong to set I(t) ⊆ A(t)
4. Vj (t, τij ): An agent Ai who was infectious with strain j, having been
infected with strain j at time τij , but is now non-infectious with regard to
this strain—that is, recovered with some immunity to strain j, as well as
some cross immunity to strains closely related to j. All these individuals
belong to set A(t)
5. D(t): An individual at time t who has died after being exposed to and
become infectious with some strain of the pathogen. In a refined version
of the model, a record will be kept of the time of death and the strain that
caused death. All these individuals belong to set D(t).
Since an agent Ai may be infected over time by more than one strain j, its
complete epidemiological state is represented by a list
Ai (t) = {state w.r.t. pathogen 0, · · · , state w.r.t. pathogen 2J − 1}

(A.3)

If a living agent does not fall into any of the categories 2 – 4 with respect to
pathogen j, we denote its epidemiological state at position j as ∅ (the empty
set). Consequently, if an agent A is susceptible at time t (i.e., an element of
S(t)), then we write
A0 (t) = {∅, . . . , ∅} ∈ S
97
98
99

However, while such individuals are omitted from the A list (hence we did not
subscript the agent A above), they may be recognized as “virtual members”
with this implicit state. Some other examples are:
• If Ai (t) is infected, but not yet infectious, with pathogen strain j at time
t but has not been infected with any other pathogen in its past history,
then
Ai (t) = {∅, · · · , ∅, Ej (t, τj ), ∅, · · · , ∅}
• On the other hand if Ai recovered from an infection with pathogen 0 at
time τ0 , and is now in infectious with pathogen j at time t, having become
infected with this pathogen at time τj then we write
Ai (t) = {V0 (t, τ0 ), ∅, · · · , ∅, Ij (t, τj ), ∅, · · · , ∅}

101

As we shall see, an agent history may contain at most one instance of either Ej
or Ij , while possibly containing multiple instances of Vj .

102

Agent and index sets

100

103
104
105
106

At the start of each time period, we update the set of identified agents A by
adding susceptibles that became infected with pathogens during the previous
time period and removing agents that died during the previous time period.
Thus if IA is the index set for non-empty elements of A, with new indices added

31

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

107
108

Getz et al.

for newly infected susceptibles and indices removed for individuals that died,
then by definition:
A(t + 1) = {Ai (t + 1)|i ∈ IA (t + 1)}

109
110
111
112
113
114
115
116
117

118

(A.4)

where the number of indices in the updated set IA (t + 1) is NA (t + 1) and the
updated number of dead is ND (t + 1) at time t + 1.
For mathematical convenience all susceptibles S will also be referred to as
A0 :, i.e., there are NS (t) individuals referenced by A0 at time t. It will be useful
to partition the set A(t) itself into three subsets at time t by identifying the sets
E(t) and I(t) which respectively contain all agents that are currently in a state
Ej (t) or a state Ij (t) at time t for some j = 0, ..., 2J −1. We note the intersection
of these two sets is empty—i.e., E(t) ∩ I(t) = ∅—as will become apparent below
from the transmission process rules set up below. We will use the notation

AS (t) = A(t) \ E(t) ∪ I(t)
(A.5)
to denote the set of agents in A(t) but not in E(t) or I(t).
We also identify the set of infectious agents with infectious strain j. If Aj
denotes an agent whose epidemiological state contains an entry Ij (t, ), then
Ij (t) = {Aji1 (t), Aji2 (t), . . . , AjiN (t)},
Ij

where the number of such agents is denoted by NIj (t), and its index set by
IIj (t) = {i1j , . . . , iNIj (t) }.
119

Epidemiological processes

120

Immunity

121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138

In compartmental SIRS and SEIRS models, a concept of waning immunity and
its impact on epidemics is associated with the rates at which individuals in class
R revert back to class S. In agent-based SIRS and SEIRS models, we have the
opportunity to consider the immunological history of individuals and, hence,
can take a more refined approach to the complex process of how pathogens in
an infector Ai are passed on the an infectee Ah . Here we model this as a probability generated from a concatenation of rates that include pathogen shedding
by Ai , the survival of pathogens in the environment, whether contained in feces,
urine, sweat, mucosal secretions or water droplets excreted by an infector, and
a process whereby pathogens gain access to a host (entering through wounds,
mucosal membranes or other membranes in the pulmonary or alimentary systems). We then characterize pathogen within-host strain replication rates in
terms of pathogen mutational and reproductive processes. The final outcome
in our model is either host recovery with some immunity or host death. We
also consider the induction of host immunity through vaccination and make the
assumption that waning immunity is the same, whether it stems from natural
infection or vaccination. Of course, these may be modelled in different ways
should data become available to make this distinction an important modeling

32

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

139

Getz et al.

consideration.

140
141
142
143
144
145
146
147

148
149
150
151
152
153
154
155
156
157

Waning immunity. Recall that we use A0 to denote an anonymous (generic)
member of S and that Ai for i > 0 refers to a specific individual with an
associated state list/vector. If some specific Ai is in immune state Vj having
been infected with this strain at time τij , we assume that the level of relative
susceptibility of agent Ai to reinfection by strain j is given by (noting that the
existence of the value τij implies that infection of individual i by strain j at
time τij ensures that the Vj is no longer “null”)

0
if Vj is null



1
σ if t ≥ τij + σI + σE
(A.6)
ωij (t, τij ) =
1 + (t − τij − σI − σE )/thalf

j


1
if t < τij + σI + σE
We note the following: 1.) the first case implies that τij has yet to be defined; 2.)
the second case is equivalent to the statement that τij ≥ 0 now exists for strain
j, since this occurs at time t = τij (through the invocation of state Ej (t, τij ));
3.) ωij (t, τ ) ranges from 1 (i.e. full “on”) at t = τ + σI + σE and decays to
0 as t > τ + σI + σE → ∞; 4.) agent i cannot be reinfected with its current
major strain or with any other strain while it is currently itself in any state Ej
or Ij for any j = 0, ..., 2J − 1; 5.) the larger the value of σ the steeper or more
abrupt the switch is from full immunity (equal to 1) at time τ through 1/2 at
time thalf
to approach 0 as t → ∞ (we set σ = 4 as providing an intermediate
j
level of abruptness).

158
159
160
161
162

163
164
165
166
167
168

169
170

Cross immunity with escape mutations. A somewhat more general implementation of cross-immunity may be based on the number of alleles by which strains
j and ` differ. If they differ in k positions, then the level of cross immunity can
be set to ck . In this case

1 if ` = j
Cascading C:
cj` =
(A.7)
ck if ` differs from j by k alleles
In addition to this, one may also designate certain changes in certain alleles as
“escape mutants” with respect to the progenitor strain. For the purposes of
this paper, escape mutations are defined as those whose level of cross-immunity
with the strains from which they arise is 0 (in reality some small level of cross
immunity may remain). Under these assumptions, a generalization of Eq. A.7
would be

1 if ` = j


 k
c if ` differs from j by k alleles
Escape mutation:
cj` =
(A.8)
and ` is not an escape mutation



0 if ` is an escape mutation
In particular, for the case J = 7, if strain (1, x, x, x, x, x, x) is an escape
mutation with respect to some level of immunity to strains (0, x, x, x, x, x, x),

33

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

171

172
173
174
175
176
177
178

179
180
181
182
183

184
185
186
187

188

189
190
191
192
193
194
195
196
197
198
199
200
201
202

then Eq. A.8 becomes

 1 if ` = j
0 if j ≤ 63 and ` > 63
cj` =
 k
c otherwise, where ` differs from j by k alleles

• Dominant strain vaccination at time τvac . An individual S or Ai vaccioff
nated with the dominant strain, say j, at time τvac ∈ [ton
v , tv ] serves to
add the disease state Vj (t, τvac ) to that individual’s list. If the individual
is already in state Vj (t, τ 0 ) at time t > τvac , then its status is updated so
that at time t > τvac it is now Vj (t, τvac ) rather than Vj (t, τ 0 )
• Multistrain vaccination at time tvac . An individual S or A vaccinated with
off
a multi strain concoction at time τ ∈ [ton
v , tv ], say with strain j1 , . . . , jν ,
will have their disease status updated with regard to all these strains, as
in the dominant strain case.
Infectious contacts
Infectious individuals are assumed to make κ̂ effective contacts each time period;
where effective contacts are those that are sufficiently close and of a sufficiently
long duration to constitute a “risk of transmission.” This rate is either a constant κ0 , or in stochastic implementations drawn from a Poisson distribution
with mean κ0 , or in adaptive formulations (e.g., under social distancing behaviour) is a function of the severity of the ongoing outbreak. We also assume at
κ̂(t)NA (t)
S (t)
and N
time t that under a random contact process, proportion Nκ̂(t)N
0 −ND (t)
0 −ND (t)
of these contacts will respectively be with susceptible and with uniquely identi(t)−NE (t)−NI (t))
fied agents, although only κ̂(t)(NAN
of those will be susceptible to
0 −ND (t)
infection with a new strain or reinfection with the same strain.
In the adaptive case, we assume κ(t) decreases from κ0 as the proportion
of infectious individuals, NI (t)/(N0 − ND (t)), increases such that κ(t) = κ0 /2
when NI (t)/(N0 − ND (t)) = phalf
. For convenience of implementation, however,
I
we define the following “switching” (as apposed to hyperbolic) function
κ(t) =


1+ N

κ0

204

(A.9)

Vaccination. A vaccine may be designed to give immunity to one or more
particular identified strain j. Vaccination strategies include vaccinating at a
fixed rate v(t) (percent of individuals vaccinated at each time period) over a
off
fixed period that begins at ton
v and ends at tv and can focus on drawing only
on: i) individuals in the set S, ii) any non-infectious individual in S or A, or iii)
any non-infectious, not previously vaccinated individual in S or A. The vaccine
itself can be designed as follows:

(

203

Getz et al.

κ0
NI (t)
0 −ND (t)



phalf
I

2

when phalf
>0
I
when phalf
=0
I

(A.10)

even though, from a continuity point of view, the top part of this expression
implies that κ(t) → 0 at phalf
→ ∞.
I

34

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

205

206
207
208
209
210
211
212
213
214
215
216
217
218
219

Getz et al.

Probability of infection
inf
In deriving a probability πih,j`
of an agent Ah being infected with strain `
by and agent Ai who is infectious with major strain j, we concatenate (i.e.,
multiply together) several process, each of which involves nominal constants.
Thus, in all but one of these processes, the scaling of these constants can be
normalized and given a relative set of values across strains though one set of
constants though relative, will ultimately all be scaled by fitting the model to
real data. In our treatment below, constants associated with shedding and persistence will be scaled while those associated with within-host replication will be
kept unscaled to be ultimately fitted to data. In particular, the parameters β̄j
associated with pathogen transmission (i.e., from contact to the start of within
host replication—see Fig. 1) will be scaled by fitting to epidemiological data,
while the relative values for the different strains regarding pathogen shedding
and environmental persistence can be fitted to experimental data collect to set
values of these processes when considered on their own.

220
221
222
223
224
225
226
227
228
229
230

Pathogen shedding. We assume that shedding is affected by the immune state
of the infector Ai and thus posit the shedding rates below for this individual
when its major infectious strain is j. In general, we have a matrix of shedding
rates ζ̄j` before accounting for immunity and cross immunity that is specific to
agent Ai . Immunity and cross-immunity act to reduce shedding rates through
functions φij (t) ∈ [0, 1] that are computed in terms of Ai ’s waning functions
ωim with respect to strain m and a matrix of cross-immunity values cjm that
have been normalized so that cjj = 1 for j = 0, ..., 2J − 1 and cjm ∈ [0, 1] for
j, m = 0, ..., 2J − 1. Specifically, we define agent-specific immunity modifying
functions
J
2Y
−1

φij (t) =
1 − cmj ωim (t)
(A.11)
m=0

231

and assume that the shedding rates can be expressed as
ζij` (t) = ζ̄j` φi`

232
233
234
235
236
237
238
239
240
241
242
243
244

` = 0, ..., 2J − 1

(A.12)

Environmental persistence. The persistence of pathogens in the environment
are known to be impacted by humidity, temperature, airflow, and the surface
properties of fomites [57]. This, and other factors relating the effects of weather
on contact rates and efficacy, may result in overall pathogen transmission having
a seasonal component to it [58]. In particular, viral persistence indoors may
be much greater than outdoors, with a greater proportion of indoor contacts
taking place during cold or wet weather. Thus the most appropriate place
to introduce seasonal effects into epidemic processes is through contact rates
and environmental persistence cycling over time with a period of one year (or
even half-a-year if two comparatively spaced rainy seasons occur, as in some
in tropical locations [59]) and an amplitude obtained by fitting parameters to
data. Thus, in our model, we introduce constants η̄` , δ ∈ (0, 1), k (appropriately
scaled, depending on the units of time) and θ and assume that



2πt
+θ
` = 0, ..., 2J − 1
(A.13)
η` (t) = η̄` 1 + δ sin
k
35

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

245
246
247
248

Getz et al.

The case δ = 0 corresponds to constant values η` (t) = η̄` for all t, while if
δ = 1 we get the largest possible fluctuation between 0 and 2η̄` . The constant k
relates to the time units so we get one cycle per year, and θ shifts the cycle to
set the points in time at which the maximum and minimum values of η` (t) occur.

249
250
251
252
253
254
255

Strain transmission. In the context of a standardized dose (which will be
modified by multiplying the strain effective contact and transmission by both
pathogen shedding and environmental persistence functions), the differential
rates of strain transmission, which we denote by βh` , will depend on a constant
strain transmission rate parameter β̄` modified by a function that represents
the immune state of the infectee at time t: viz., recalling Eq. A.11
βh` (t) = β̄` φh` (t),

256
257
258

259

260
261
262
263
264
265
266
267
268
269
270
271
272
273
274

` = 0, ..., 2J − 1

(A.14)

Probability of infection. Using a competing rates formulation [60] to compute
the probability of infection as a concatenation of the process of infector shedding
(ζ), environmental persistence (η) and transmission rates (β), we obtain


ζij` (t)η` (t)βh` (t)
inf
πih,j`
(t) = P2J −1
1 − e−ζij` (t)η` (t)βh` (t) , ` = 0, ..., 2J −1
m=0 ζijm (t)ηm (t)βhm (t)
(A.15)
Within-host processes
If after receiving an initial infectious dose of pathogen, an individual is infected
primarily with strain `, then we expect this strain to dominate unless intrinsic
mutational processes are high (which is not the case for COVID-19) or the
individual has some immunity to this dominant strain. In the latter case the
situation is ripe for an “escape mutation,” that is one that evades the immune
system, to arise.
If we nominally set the relative rate at which an individual invaded by strain
` has an infection dominated by strain ` (i.e., ` in the terminology of [61] is
the major strain of the infection) to be (1 − µ), then the probability that one
of the other strains `0 6= ` (in the case of COVID we assume that µ > 0 is
very close to 0—e.g. of order 10−3 to 10−6 —while for viruses lacking error
correcting machinery it can be considerably larger and of the order 10−1 ). We
can partition the latter probability according to a set of comparative strain
within-host replication rates λ`0 , each moderated by its immune state function
1
φh`0 and a normalizing factor P
to obtain
∀m6=` λm φhm
(
0
1−
µ
 for ` = `
inv
πh``0 (t) =
(A.16)
µ P λ`0 φλh`m0φhm
for `0 6= `
∀m6=l

275

276
277

Pathogen progression equations
Probability that infector Ai with major strain j will result in infectee Ah express
`0 as its major strain is
πih,j`0 (t) =

J
2X
−1

inf
inv
πih,j`
(t)πh``
0 (t),

` = 0, ..., 2J − 1

(A.17)

`=0

36

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

278

279
280
281

282
283
284
285
286

287
288
289

290

291

292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311

312

Getz et al.

single-strain case
In the single-strain case (J = 0), the waning immunity equation Eq. A.6 reduces
to (dropping the redundant index j = 0, and noting that the existence of a value
τi implies Ai has been infected at time τi in the past)

0
if Ai has never been infected



1
σ if t ≥ τi + σI + σE
ωi (t) =
1 + (t − τi − σI − σE )/thalf



1
if t < τi + σI + σE
(A.18)
(recall we set σ = 4) and the modifying immunity functions φij (Eq. A.11)
collapse to 1, which implies that the pathogen shedding functions ζ̄i` (Eq. A.12)
collapse to 1. Without loss of generality, we can also assume a single-strain value
of η = 1 in Eq. A.13, which implies that the probability of infection (Eq. A.15)
reduces to
inf
(A.19)
πih
(t) = 1 − e−β̄(1−ωh (t))
Further, since in the single-strain case there are no mutations to consider, it
inv
follows from Eq. A.16 that πh``
0 (t) = 1 for all h and we finally have that πih (t) =
inf
−β̄(1−ωh (t))
πih (t) = 1 − e
(Eq. A.17) for all h.

Simulation algorithm
1. Parameters selected at the start of a simulation
(a) N0 : Number of individuals in the population. Assumed to be fixed
over time (i.e., the population is closed), but partitioned into sets S,
A and D with respectively NS (t), NA (t) and ND (t) individuals in
each set and satisfying Eq. A.1.
(b) J: The log2 of the number of possible strains indexed by j = 0, · · · , 2J −
1
(c) β̄j : Strain dependent transmission parameters (the process between
contact and the start of strain replication and nominally equivalent
to transmission in SEIR models—see Fig. 1) for pathogen strain j
(d) thalf
: The time it takes for immunity to strain j to have waned by
j
half.
(e) σEj : The time it takes from initial infection for an infected individual
to become more likely to become infectious than remain infected
without being infectious.
(f) σIj : The additional time it takes beyond σEj for an infectious individual to more likely transition beyond being infectious than remain
infectious.
(g) pαj : The proportion of individuals leaving the infectious category
that die, which implies that 1 − pαj is the proportion that become
immune.
2. Initialization
37

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

313
314
315

316

317
318

319
320
321
322

323
324
325
326
327
328
329
330

Getz et al.

(a) Set up pathogen list (see Eq. A.2)
(b) Initialize the simulation by setting t = 0 and creating the agent list
A(0) one infectious and N0 − 1 susceptible agents.
3. Time t: vaccination loop.
(a) Carry out the vaccination process before going into the rest of the
loops with the updated S and A sets after the vaccinations.
4. Time t: contact loop. Set up contacts for the current round of encounters at time t (i.e., the inner agent-driven contact loop within the
outer time-driven loop) and tag for outer loop update of disease status, as
follows:
(a) Numbers in various sets and associated index sets. Identify the number of individuals NS (t), NA (t) and ND (t) in sets S, A and D at
time t respectively, as well as the number of exposed (but not yet
infectious) agents NE (t), infectious agents NI (t) and identified noninfected agents NAS (t) = NA (t) − NI (t) − NE (t). Break down the
infectious agents tally into the number of agents NIj infectious with
strain j = 0, 1, ..., 2J − 1. We will also need the index sets IAS and
IIj (t), j = 0, ..., 2J − 1 at time t.
(b) Infectious contacts with each group. The rate at which any individual
contacts other individuals per unit time is given by the contact rate
parameter κ > 0. Assuming random contact events over one unit
of time, the actual number of individuals that agent Ai contacts at
time t is then given by
κ̂i (t) ∼ POISSON[mean = κ(t)]

331

Of these, proportions
NS (t)
N0 − ND (t)

(A.20)

NA (t) − NI (t) − NE (t)
N0 − ND (t)

(A.21)

πiS =
332

and
πiA =

333
334
335

are expected to come from susceptibles in the sets S(t) and AS (t)
(see Eq. A.5) respectively. Thus the actual number of contacts in set
S(t), AS (t), and E(t) ∪ I(t) are


N̂iS (t), N̂iAS (t), N̂iE (t) + N̂iI (t)
=
(A.22)
Multinomial [κ̂i ; πiS , πiA , 1 − πiS − πiA ]

336
337
338
339

We note that only N̂iS (t) and N̂iAS (t) are of interest because individual in states E and I cannot be reinfected. Also, we make the
assumption below that the first infection that an individual in set A
contracts in this contact loop, is the one that counts (i.e., there will
38

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

340
341
342
343
344
345

346
347
348
349
350
351

Getz et al.

be no simultaneously infections with multiple strains). Finally, since
contacting individuals is tantamount to sampling with replacement,
the number of unique contacts (i.e., all multiple contacts are counted
as a single contact) that agent Ai has with individuals in the set S is
N̂iS (t) reduced by excluding multiple contacts (which under a random
contact model is a negative exponential correction) to obtain
io
n
h
S
(A.23)
NiS∗ (t) = min N̂iS (t), Binomial κ̂i (t), e−κ̂i (t)/N̂i (t)
Thus if κ̂i (t) << N̂iS (t), NiS∗ (t) is expected to be very close to the
upper value κ̂i (t). On the other hand, if κ̂i (t) ≈ N̂iS (t), then NiS∗ (t) is
expected to be around κ̂i (t)/e ≈ 0.37κ̂i (t). Additionally, after dealing
with each agent i reduce in the size of NS (t) to take account of those
agents that had been infected by agent Ai and had now entered the
ranks of the set A.
(c) Identify all infectious agents and their pathogens strains. Among all
agents in the set A(t) (Eq. A.4), identify those that have an infectious
strain Ij for some j = 0, · · · , 2J − 1. Thus, if the number of infectious
agents with infectious strain j is NIj (t) then consider the set
Ij (t) = {Aji1 (t), Aji2 (t), . . . , AjNI (t)}
j

with index set
IIj (t) = {i1j , · · · , iNIj (t) }
352
353
354
355
356
357
358
359
360
361
362
363
364

Initially, most of these sets will be empty, but will fill in over time.
(d) Susceptible contacts. The probability that an agent Ai with a strain
j major infection infects a susceptible (nominally denoted by individuals of type A0 ) who then becomes infectious with dominant strain `0
is given by the probability πi0,j`0 computed in Eq. A.17, which itself
relies on expressions Eq. A.10-A.16. The actual number of individuals in the set S will make effective contact with one more infectious
individuals is NiS∗ (t) obtained using Eq. A.23. Thus, from a multinomial drawing, we can now generate the number of newly exposed
E+
individuals, N0`
0 (t + 1) (the “+” is used to denote these are newly
added and the “0” that they are coming from the set S), with major
strain `0 at time t + 1, have been infected by agent Ai with major
pathogen strain j on the time interval [t, t + 1):
E+
E+
(N̂00
(t), · · · , N̂02
∼
(A.24)
J −1 (t))
 S∗

Multinomial Ni (t); πi0,j0 (t), · · · , πi0,j 2J −1 (t)

365
366
367
368
369
370

These individuals will be used to update list of currently infected
individuals in the sets AEj , j = 0, ..., 2J − 1 at time t+1, which is
computed in the outer loop computation, as presented below. We also
note that the probabilities in the above multinomial add to less than
1, so that at the end of the drawing a proportion of the individuals
NiS∗ (t) remain uninfected.
39

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

371
372
373
374
375
376
377
378
379

380
381
382
383
384
385
386

387

388
389
390

Getz et al.

(e) Agent contacts. The number of agents N̂iAS (t) ∈ IA\(E∪I) that come
into contact with agent Ai over the interval (t, t + 1) is given by
Eq. A.22. This number is drawn from the set IA\(E∪I) with replacement and the following multinomial computation is used to determine
how to update agent Ah at time t + 1 when coming into contact with
agent Ai on the interval (t, t + 1) using the probabilities of transmission given in Eq. A.17. Specifically, agent Ah will become infected
with major strain `0 at time t + 1 is determined by the multinomial
drawing


Ah ∈ AEj for some j ∼ Multinomial 1; πih,j0 (t), · · · , πih,j 2J −1 (t)
(A.25)
We note here that since the agents Ah , h ∈ IA\(E∪I) are drawn with
replacement as the computation proceeds and the agents Ai , i ∈ I are
cycled through, if a previously drawn Ah is drawn again, but has already
been infected in the current round then we ignore the latest event, but keep
the previous infection event intact. To obviate bias in this procedure, we
need cycle through the agents Ai , i ∈ I at random rather than in numerical
order.
5. Time t: disease progression loop.
(a) Individuals in AE at time t. An individual Ai ∈ AE at time t and in
state Ej (t, τi ), j = 0, ..., 2J − 1, becomes either an individual in state
Ej (t + 1, τi ) with probability
1

πEj (t) =
1+
391
392
393
394
395

398
399
400

401
402
403
404

4

(A.26)

(b) Individuals in AI at time t. An individual Ai ∈ AI at time t and in
state Ij (t, τi ), j = 0, ..., 2J − 1, becomes either an individual in state
Ij (t + 1, τi ) with probability
1
1+

397

t−τi
σ Ej


or transfers to state Ij (t + 1, τi ) with probability 1 − πEj (t) thereby
entering class AI at time t + 1.

πIj (t) =

396





t−τi
σEj +σIj

4

(A.27)


or leaves the set Ij (t + 1, τi ) with probability 1 − πIj (t) . In this
latter case, the individual either dies with probability pαj or enters
the state Vj (t + 1, τi ) at time t + 1 with probability 1 − pαj The total
number of individuals dying over the interval [t, t + 1) is noted as
having a value ∆ND (t).
6. Time t + 1: outer loop update. The outer loop records all the events
that took place in the contact and disease progression loops and updates
the agents state at the next time step. It also updates all other states as
follows.
40

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

(a) Individuals in AS at time t. For the NS (t) individuals in AS at time
E+
t, we have N0j
(t) enter set AEj (t + 1) and we update
NS (t + 1) = NS (t) −

2J−1
X

E+
N0j
(t)

j=0
405
406
407
408
409
410
411
412
413
414
415
416
417
418

where Eq. A.23 ensures that NS (t + 1) ≥ 0
(b) Individuals in AS that are infected again over [t, t + 1). These individuals can become reinfected as calculated in the contact loop.
Those that become reinfected with strain j, j = 0, ..., 2J − 1 enter
state Ej (t + 1, t + 1) at time t + 1.
(c) Updating the immunity of individuals in AS . Every individual within
AS at time t must have its immunity status updated so that for
j = 0, ..., 2J − 1, if Ai is in state Vj (t, τij ) at time t then it transfers
to state Vj (t + 1, τij ) at time t + 1, even if reinfected, as in b.) above.
E
(d) Transfer from S to A. The N̂0j
(t) computed in Eq. A.24 become
newly listed members of the set A by entering state Ej (t + 1, t + 1),
j = 0, ..., 2J − 1. This involves updating the equations for NS (t) and
NA (t), including taking account of the number of individuals ∆ND (t)
that died from the disease in the immediate time period, i.e.:

NS (t + 1)

=

NS (t) −

J
2X
−1

E
N̂0j
(t)

j=0

NA (t + 1)

=

NA (t) +

J
2X
−1

E
N̂0j
(t) − ∆ND (t)

(A.28)

j=0

ND (t + 1)
419
420
421
422
423
424
425

=

ND (t) + ∆ND (t)

(e) Along with input parameter values tvac on ≥ 0, tvac off and pv ∈
[0, 0.1], we also need to specify the valency of the vaccination by
selecting 1 to 4 numbers that take on values 0, ..., 2J − 1 (if more
valencies are needed than 4, then the platform needs to be modified
accordingly). We also need specify whether Nselect will just be individuals in the set S(t) (Nselect = NS ) or will be any individual other
than those in the set AI (t) (Nselect = NS + NA − NI ).

432

In Algorithm 1 we summarise the steps of the simulation algorithm, as
described in this section. On the right we report the name and numbering
of the subsections while in the for loops we list the various steps respecting
the item letters. Note that technical steps not explicitly described in
the text (e.g. store updates, store set progression) do not present letters
or numbers. The time set is defined with T while to describe temporal
progression of set S, A and D we use the symbols S, A, D respectively.

433

Estimation of R0 .

426
427
428
429
430
431

434
435

In a continuous time, SEIR model, when κ is folded into an all encompassing frequency-dependent transmission rate parameter βκ = βκ > 0 (i.e.,
41

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Algorithm 1: Summary of simulation algorithm
input N0 , J, β̄j , thalf
, σEj , σIj , pαj , j = 0, ..., 2J − 1
// 1)
j
parameters

{ η̄j , β̄j , λj , pαj ; ζjm and cjm for m = 0, ..., 2J − 1
// 2a) pathogen
J
j = 0, ..., 2 − 1}
// list
t = 0, NI (0) = 1, NS (0) = N0 − 1
// 2b) initialization
for t in T do
if NI > 0 then
for agent in S ∪ (A \ I) do
// 3) vaccination loop
3a) Vaccination process
Update NS and NA
for agent in I do
// 4) contact loop
4a) Numbers in various sets and associated index sets
4b) Infectious contacts with each group
4c) Identify all infectious agents and their pathogens strains
4d) Susceptible contacts
4e) Agent contacts
Store updates
for agent in E do
// 5a) disease progression loop
5a) Individuals in AE at time t
Store updates
for agent in I do
// 5b) disease progression loop
5b) Individuals in AI at time t
Store updates
Updates from loops 4), 5a) and 5b)
6a) Individuals in AS at time t // 6) updates in outer loop
6b) Individuals in AS that are infected again over [t, t + 1)
6c) Updating the immunity of individuals in AS
6d) Transfer from S to A
6e) Specify the valency of the vaccination
S[t] ← S(t)
// store set progression
A[t] ← A(t)
D[t] ← D(t)
return S, A, D

42

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

total is transmission given by βSI
N [49, 50]), γ > 0 is the transition rate
from E to I and ρ > 0 is recovery rate from I to R, then R0 corresponds
to [62]
βκ
R0 =
(A.29)
γ+ρ

436
437
438

439

B

J-RAMP Details

440

General description

466

An open and expressive design of the model platform aids in and encourages
exploration and experimentation. The J-RAMP design augments a desktop
simulation platform with several novel features that increase flexibility and
expressiveness, and promote experimentation and interoperability with other
platforms. These include an API (“application programming interface”) fully
supporting remote operation and direct retrieval of data for external processing
on other platforms, such as Python, Javascript or the R statistical platform.
The API can also be accessed by an onboard scripting interface that uses the
Nashorn Javascript engine.
Additionally, using a novel design, elements of the internal algorithm are
exposed for possible reprogramming in a secure fashion that will not damage
the overall system. These runtime alternative modules (RAMs) may also be
controlled from the API to facilitate selective algorithm redefinition during the
run of the simulation.
Use of the J-RAMP features require some experience with scripting and/or
Java coding, however the resulting modifications to the algorithm can be of great
significance. The RAM platform is implemented to support program redefinition
with no risk to damaging the underlying code base. It should be accessible to
anyone with moderate scripting experience.
A major goal of the J-RAMP project is to prepackage these functionalities so
that they can be readily deployed as part of simulation system design. This goal
has been partially realized with respect to the RAM platform: annotations can
be added to the simulator’s source code that direct the automatic generation of
Java code to integrate into the simulations’ source and provide the functionality.
The following discussion assumes some familiarity with script or program
development.

467

Runtime alternative modules

441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465

468
469
470
471
472
473
474
475
476

Figure B.1 shows the RAM redefinition frame. The available RAMs appear as
radio buttons along the bottom of the frame. Each RAM is a set of options
for defining a relatively short Java method implementing some key aspect of
the simulation algorithm. For example, included in this simulation are the
implementation for cross immunity given in Eq. 1; the implementation for β
given in Eq. A.14; and the implementation for φ given in Eq. A.11; etc. Each
RAM initially contains only a single option, Option 0, the default, internally
defined implementation. Option 0 cannot be edited and appears for reference
purposes only.

43

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure B.1: RAM frame shows the implementation of the nearest-neighbor crossimmunity formulation C of Eq. 1 as the default. In the red-bordered insets are the
cascading cross-immunity without and with escape mutations, as formulate in Eqs. A.7
and A.9 respectively. Note the radio-buttons are set to 0 in the main figure and to 1
and 2 in the insets. Also note the “+” button which allows for an unlimited number of
alternatives to be set up using consecutive integer numbers for the new radio-buttons
that appear and pertain to the selection of each alternative. Note at the bottom the
list of functions that can be altered at runtime. The “load default” button on the
upper left hand side allows the user, when starting a new alternative, to insert the
default code (which is immutable in radio-button 0) as a starting point. The frame also
documents a list of terms in the upper panel that can be used to build any function.

477
478
479
480
481
482
483
484
485

Additional options may be added to each RAM containing code redefining
the method. Two editor panes and one console pane are stacked in the frame
and display the code and output of the RAM. These panes show the content
associated with the currently selected RAM and option. The top editor pane
contains the code for the method being redefined. The second editor pane contains definitions of any new help functions required by the definition in the top
pane. The console pane contains messages and output that are useful during the
development of the option. For convenience, a “Load Default” button initializes
the editor to an editable version of the Option 0 default to use as a starting

44

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

486
487
488
489
490
491

492
493
494
495
496

Getz et al.

point.
Figure B.1 shows the Option 0 default definition for the cross immunity
matrix function, as described by Eq. 1. Clicking the “+” button produced two
new options, which appear in the insets. These option implement the alternative
cascading cross immunity schemes presented in Eqs. A.7 and A.9. Option 2 code
appears below:
double crossImmune(int j, int k) {
if (l == j) return 1;
if (j < pathSize()/2 && l > pathSize()/2) return 0;
return Math.pow(Params.cImmune(), Tools.hdist(j, l));
}

523

Note that we have substituted the function pathSize for a hard-coded value
of 63. pathSize returns the number of pathogens, allowing us to use this
formulation for any choice of entropy. Documentation for pathSize is at the
top of the window in the list of available help functions and parameters. There
is also more extensive documentation in a separate user guide (see Fig. B.2).
The platform duplicates a mini-development environment for building alternative definitions. Once code has been entered the “Compile” button checks
the legality of the code and makes it available for use at runtime. Legally compiled code will produce a “Compilation Successful” message. Errors will appear
with line numbers if they occur. Once the code is legal, the “Test” button can
be used with actual parameters entered into the small text fields to determine
correctness of the code. It is also possible to include print and println statements in the code during development to further check correctness. Output
from print statements will appear in the bottom console window. The entire
RAM set can be saved and will reappear during subsequent launches of the
simulator platform.
To use an alternate RAM definition at runtime simply select the desired
option. (Selected options will be restored from a saved RAM set during subsequent launches.) The system will compile any uncompiled code the first time it
is accessed. If an error occurs during a runtime compilation an alert will notify
the user that the system is returning to the default definition of that RAM. At
no time is the internal logic of the program overridden.
Finally, RAM option selection is part of the API described in the next section. This means that a script may run a simulation selecting different options
at different points in time, using logic that considers the state of the model. For
example, such an adaptive protocol might be appropriate for determining the
contact rate κ.

524

Application programming interface

497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522

525
526
527
528

The API is a simple bytecode1 called BPL (Blackbox Programming Language)
that addresses all available user interactions with the simulator. Instructions
fall into three categories: parameter assignment and retrieval; simulator operation; and data retrieval. A complete list of instructions is shown in Fig. B.3.
1 a bytecode is computer source code that is processed immediately by a program, usually
referred to as an interpreter or virtual machine.

45

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure B.2: A description from our User Guide of the immunity waning function ω.

529
530
531
532
533

Instructions are comprised of opcodes (e.g., reset, step, get) followed by 0
or more arguments. Every BPL operation returns a result, even if empty, for
synchronization purposes. A string consisting of a sequence of opcodes and
arguments may be submitted to the BPL interpreter, an example of which is
shown in the notes in Fig. B.3.

534
535
536
537
538
539
540
541

Parameter assignment and retrieval. Every user-configurable element (including random number generator seeds) is addressed from BPL using a unique
three-letter “airport code” (see Table. B1). Additionally, pathogens are addressed by their id number (0 to 2J − 1) and agent states using identifiers S, E,
I, V, DI+ and DD (the latter two represent ∆I and ∆D, respectively). RAM
options are addressed in setOption and getOption using the name of the RAM
(e.g., “crossImmune”). Get and set operations can be used on each of these with

46

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

542

Getz et al.

the exception of ENT (strain entropy), which is read-only.

543
544
545
546
547
548
549
550

Simulator operation. Simulation runs begin by executing the BPL reset
instruction, followed by step, run for or run. The BPL interpreter operates
synchronously with the simulator by waiting to process subsequent commands
during a simulation run. Operational instructions can be interspersed with parameter set/get or data retrieval to use in runtime decision-making. Note that
the reset operation restores the simulator to its state at the time of the last
reset, so that no parameter changes made during a run are persistent.

551
552
553
554
555

Data retrieval Operations to obtain the current population in each state, and
to retrieve the runtime population history of each state and pathogen are also
included. These can be easily transformed into R data frames, for example, for
further analysis.

556

574

Scripting can be deployed using either one of the two on-board script interpreter interfaces, or remotely from another platform using drivers provided with
the simulator. The remote drivers use TCP/IP sockets. Sockets are integral to
Internet communication, and so are found on any system supporting the Internet. In this case the simulator acts as a server fielding API requests from the
remote drivers.
On our main dashboard, we provide two scripting windows that are opened
using the “S On” and “JS On” buttons (see button second and third from left at
bottom of Fig. 2A). The former allows the user to write simulation driver scripts
directly as command strings. (The commands listed in Fig. B.3 are accessed
by pressing the “Command Reference” button in the “S On” window.) This
window is used primarily to test and monitor scripts intended to be deployed on
a remote platform. The JS window contains a Nashorn Javascript interpreter
enhanced to accept and execute BPL operations. Scripts can developed, saved,
and used to drive the simulator from this interpreter. For example, Fig. B.4, lists
the code used to implement the adaptive vaccination programs. The SEIV object
referenced in this code contains methods corresponding to the BPL operations
detailed in Fig. B.3.

575

R Integration

557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573

576
577
578
579
580
581
582
583
584
585

As previously mentioned, the API supports remote control of the simulator from
independent platforms using the operating system’s socket interface2 . Of particular interest is integration with the R statistical programming environment. An
R-package called “seiv” acts as a driver by synchronously issuing BPL command
strings and waiting for results. Consequently, a simulation can be driven entirely
from within the R platform, treating the simulator as a “virtual package”.
Fig. B.5 shows the code used to run the simulator multiple times with different random number generator seeds. Following each run, the time history of
the population in the I, DI+ and DD states is extracted directly to an R data
frame (without the need to save, for example, in a comma-separated list). At
2 By using internet sockets, the simulator and R platform could conceivably run on different
systems.

47

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure B.3: The list of Blackbox Programming Language (BPL) commands that can
be used to write a simulation driver script, using the three-letter “airport codes” listed
in Table A1 to access the parameters and variables in our coded algorithm. This list
of commands can be accessed using the “Command Reference” button at the bottom
of the Scripting Window.

586
587

the end of the run sequence the data frame is used to build the plots shown in
Fig. C.2.

48

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure B.4: The JS scripting window accessed by selecting the “JS On” button in the
main dashboard (see button second from left at bottom of Fig. 2A). The script shown
here was used to execute the adaptive vaccination strategy discussed in the main text.

Table B1: Airport codes for parameter and variables used in the model algorithm
Name
% mortality
env. persist.
median latent period
population size
mutation rate
cross immunity
seas. trans. peturb
seas. trans. period
strain entropy
enable vaccination
strain valency type
vaccinate susc. only
vaccinate non-vacc.

588
589
590
591

Math

Code

Name

Epidemic codes
MOR transmission
PST
within-host replication
MLP
median infectious period
POP
contact rate
MUR abruptness of waning
CIM
waning half-life
STP
seas. trans. shift
PER
adap. contact param.
ENT
shedding rate
Vaccination codes
VEN
vaccine on/off
VA#, #=1,..,4
selection composition
VSU
vaccinate non-infectious
VNV
pα
η
σE
N0
µ
c
δ
k
J

Math

Code

β
λ
σI
κ̄
σ

XMT
INV
MIP
CPT
AOW
WHA
STS
IPC
SHD

off
ton
v /tv

VOO
VCP
NVI

thalf
θ
phalf
I
ζ̄

R could be used in a more direct way by analyzing data at various points
throughout a single run and adjusting parameters programmatically, similar to
the adaptive vaccination strategy carried out in Javascript, only taking advantage of the R environment’s powerful toolkit.
49

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure B.5: Our SEIVD-IBM can be treated as an R-package called “seiv” and run
as such in conjunction with other packages, such as ggplot2 and reshape to conduct
multiple simulations and then carry out data and statistical analyses of the simulation
results. The code shown here was used to produce the plots illustrated in Fig. C.2.

592

593
594
595

Running the model
The model can be accessed at Github where instructions are available for its use.
Please note the information regarding security messages that you may receive,
which have to be dealt with before you can run our SEIVAgent application.

50

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

596

C

Getz et al.

Additional Figures

Figure C.1: The final sizes of the uninfected (S(tfnl ) individuals), infected (V (tfnl )
individuals) and dead (D(tfnl ) individuals) classes and the length of the epidemic (tfnl
days) are provided here, together with summary statistics, for 10 simulations (runtime
seed ranges from 0 to 9) in each case when the initial population sizes are N0 = 10, 000
and N0 = 30000 individuals respectively. The parameter values used are otherwise the
same as those use to produce the simulation depicted in Fig. 2 in the main text.

51

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure C.2: Plots of the mean (red) ± 1 standard deviation green and blue, the latter
truncated at 0) of prevalence, incidence, and daily deaths for 100 runs (runtime seeds
= 0,...,99) using the same parameter set used to produce the individual run (runtime
seed = 0) depicted in Fig. 2 in the main text (also see Fig. C.1). These figures
where produced by running our SEIVD-IBM J-RAMP as an R-package as described
in Appendix B, with the code documented in Fig. B.5.

52

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure C.3: If, together with our basic set of parameters (Table 1), we set phalf
= 0.005
I
then the total number of individuals that have been infected (disease class V ) at the
end of one year is 10027/100, 000 ≈ 10%.

53

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure C.4: This is the set of strain transmission parameter values βj , j = 0, ..., 127
used in our 128 strain simulation. Note strains 0, 1, 3, 7, 15, 63, 127 (light blue cells)
are part of a dominating sequence of values increasing steadily in steps of 0.025 from
β0 = 0.30 to β127 = 0.475 along the one-step-neighborhood pathway represented by
the allele structures (0,0,0,0,0,0,0), (0,0,0,0,0,0,1), (0,0,0,0,0,1,1),...,(1,1,1,1,1,1,1). All
the remaining β values were generated at random on the interval [0, 0.3].

54

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure C.5: This is a baseline 3-year no vaccination run for our 128-strain vaccination
study with strain-specific transmission values depicted in Fig. C.4 and other parameter
values as indicated on the dashboard (also see Table 1). See Fig. 6 in main text for
enlarged plots of predominant strains.

55

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure C.6: This is vaccination in years 2 and 3 against strain 0 at the rate of
0.2% of the population per day in our 128-strain vaccination study with strain-specific
transmission values depicted in Fig. C.4 and other parameter values as indicated on the
dashboard (also see Table 1). See Fig. 6 in main text for enlarged plots of predominant
strains.

56

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure C.7: This is vaccination in years 2 and 3 against strain 127 at the rate of
0.2% of the population per day in our 128-strain vaccination study with strain-specific
transmission values depicted in Fig. C.4 and other parameter values as indicated on the
dashboard (also see Table 1). See Fig. 6 in main text for enlarged plots of predominant
strains.

57

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure C.8: This is a multivalent vaccination in years 2 and 3 against strains 0, 7, 31
and 127 at the rate of 1.0% of the population per day in our 128-strain vaccination
study with strain-specific transmission values depicted in Fig. C.4 and other parameter
values as indicated on the dashboard (also see Table 1), except that the cross immunity
matrix C is now defined by Eq. A.7. See Fig. 6 in main text for enlarged plots of
predominant strains.

58

medRxiv preprint doi: https://doi.org/10.1101/2021.06.07.21258504; this version posted June 16, 2021. The copyright holder for this preprint
(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity.
All rights reserved. No reuse allowed without permission.

Submitted on June 15, 2021

Getz et al.

Figure C.9: This is a bivalent vaccination in years 2 and 3 against strains 0 and 127
at the rate of 0.2% of the population per day in our 128-strain vaccination study with
strain-specific transmission values depicted in Fig. C.4 and other parameter values as
indicated on the dashboard (also see Table 1), except that the half-wining values has
been increased fivefold thalf = 1825 days the cross immunity matrix C is now defined
by Eq. A.7 with c = 0.9. See Fig. 6 in main text for enlarged plots of the predominant
strain 0.

59

