medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

A variational model for computing the effective
reproduction number of SARS-CoV-2
Luis Alvarez1 , Miguel Colom2 and Jean-Michel Morel2
1

CTIM. Departamento de Informática y Sistemas,
Universidad de Las Palmas de Gran Canaria. Spain
2

Université Paris-Saclay, ENS Paris-Saclay, CNRS,
Centre Borelli, F-94235, Cachan, France.
Abstract

We propose a variational model for computing the temporal effective reproduction
number, R(t), of SARS-CoV-2 from the daily count of incident cases and the serial interval.
The R(t) estimate is made through the minimization of a functional that enforces: (i) the
ability to reproduce the incidence curve from R(t) through a renewal equation, (ii) the
regularity of R(t) and (iii) the adjustment of the initial value to an initial estimate of R0
obtained from the initial exponential growth of the epidemic. The model does not assume
any statistical distribution for R(t) and does not require truncating the serial interval
when its distribution contains negative days. A comparative study of the solution is
carried out with the standard EpiEstim method. For a particular choice of the parameters
of the variational model, a good agreement is found between the estimate provided by
the variational model and an estimate obtained by EpiEstim shiftef backward more than
8 days. This backward shift suggests that our model finds values for R(t) that are more
than 8 days closer to present. We also examine how to extrapolate R(t) and the form of
the incidence curve i(t) in the short term. An implementation and comparison of both
methods, applied every day on each country, is available at www.ipol.im/ern.

Keywords: COVID-19, Effective Reproduction number; reproductive rate; R0; Rt; SARSCoV-2; Serial Interval.
Abbreviations:
EpiEstim : Software to compute the effective reproduction number proposed by Cori et al.
in the paper: A new framework and software to estimate time-varying reproduction numbers
during epidemics published in the American Journal of Epidemiology.
R(t) : Effective Reproduction Number. To differentiate between the continuous and discrete
cases, we use the notation R(t) in the continuous case and Rt in the discrete case.
i(t): incidence curve, the number of daily tested positive registered. To differentiate between
the continuous and discrete cases, we use the notation i(t) in the continuous case and it in the
discrete case.
Φ: serial interval.
NOTE: This preprint reports new research that has not been certified by peer review and should not be used to guide clinical practice.

1

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

A key epidemiological parameter to evaluate the time varying transmission rate of a disease
is the effective reproduction number R(t), defined as the expected number of secondary cases
produced by a primary case at each time t. The computation of an effective, or instantaneous,
reproduction number is much more problematic than its global estimate, R0, on a large period
where the pandemic runs free. In [6] for example, the reproduction number of the Spanish
influenza was estimated from daily case notification data using several variants of a SEIR model.
This estimate was based on a long period, was therefore not time dependent as it should be in
periods where lock-down strategies or other distancing measures are being applied. We refer
to [14] for a comparison of strategies to compute R0 and R(t).
The key ingredient of the estimation of R(t) is a renewal equation linking the incidence i(t)
to R(t). Here a caveat must be formulated. We shall reason as though i(t) denoted the total
number of new cases. But, in practice, the detected infected are only a portion of i(t). Hence
all formulas below rely on the assumption that the daily count of detected infected is actually
proportional to the (unavailable) daily count of real infected. This assumption is actually not
true, as it is strongly influenced by detection strategies. But if the detection policies evolve
slowly, the arguments and calculations below remain valid.
The renewal equation requires the knowledge of the serial interval function Φ(s), which
gives the probability distribution of the time between the onset of symptoms in a primary case
and the onset of symptoms in secondary cases. This formula linking i(t), R(t) and Φ(s) goes
back at least to Nishiura 2007 [12]. It writes
Z t
i(t − s)R(t − s)Φ(s)ds.
(1)
i(t) =
0

The only assumption underlying the reproduction formula (1) is that the serial interval depends
only on biological factors, which is reasonable. If we assume that R(t − s) is locally constant
and equal to R(t), that is R(t − s) = R(t) for s such that Φ(s) > 0, then the above expression
becomes
Z t
i(t) = R(t)
i(t − s)Φ(s)ds.
(2)
0

This expression has been used in the literature by several authors (see [4], [5]) to estimate R(t).
In its stochastic Poisson formulation, it is a widely used strategy to compute R(t) using (2) (see
[15], [10] or [7]). In that case, the formula is given in stochastic form, assuming i(t) follows a
Poisson model (see [7], [14] [15]). Then the second member of (2) is taken to be the expectation
of the Poisson model.
In [1] the problem of estimating R(t) by maximum likelihood estimation is complemented
by a piecewise regularity term for R(t), instead of using a Bayesian framework. This regularity
term in the variational model is complemented by a spatial regularity term to ensure that
neighboring French districts have similar values for R(t). One of the most widely used methods
to estimate R(t) is the one proposed by Cori
P et al. in [7]. The authors show that if the
expectation of i(t) is given by E[i(t)] = R(t) ts=1 i(t − s)Φ(s) and R(t) is assumed to follow a
gamma prior distribution Γ(a, b), then the following analytical expression can be obtained for
the posterior distribution of R(t):
P
a + ts=t−τ +1 is
Rt,τ =
,
(3)
P
P
b−1 + ts=t−τ +1 fk=1 is−k Φk
2

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

where Rt is assumed to be locally constant in a time window of size τ ending at time t. This
method is implemented in the EpiEstim R package.
In this paper we use the renewal equation (1) rather than the simplified version (2) used
by EpiEstim. One important difference between both formulations is that the estimation of
R(t) using the simplified model is shifted with respect to the estimation using the model (1).
The reason is that if we replace R(t − s) in equation (1) by a constant value, it would be more
accurate to replace R(t − s) by a shifted back value R(t − µ) than by R(t), as t is the end of
the integration interval. In other words, it would be more accurate to replace equation (2) by
Z t
i(t) = R(t − µ)
i(t − s)Φ(s)ds.
(4)
0

where µ is the center of mass of the serial distribution
Φ(s). So the assumption about the
P
expectation of i(t) should be E[i(t)] = R(t − µ) ts=1 i(t − s)Φ(s). Moreover, in the case of the
EpiEstim estimate, given by (3), an extra shift can be expected due the assumption that Rt
is locally constant in [t − τ + 1, t]. It follows that we can expect to observe a significant shift
between the Rt estimate using the original model (1) and the one obtained by EpiEstim. In
fact, our experiments here reveal a shift going up to 8-10 days. This shift suggests that our
estimate is closer to present than the one proposed by EpiEstim.
We now discuss what serial interval functions Φ are available for SARS-CoV-2. As we saw,
the serial interval in epidemiology refers to the time between successive observed cases in a
chain of transmission. Du et al. in [8] define this interval as follows:
The serial interval is defined as the time duration between a primary case (infector)
developing symptoms and secondary case (infectee) developing symptoms.
Hence, by a careful inquiry on many pairs of patients, where one is the probable cause of the
infection of the other, one may obtain the distribution of the serial interval in practice, as it
has been done by Du et al. in [8] on 468 cases. The authors of this paper recall that this
quantity cannot be inferred from daily case count data alone [16]. Moreover, the observed serial
distribution in [8] had a significant number of cases on negative days, meaning that the infectee
had developed symptoms up to 10 days before the infector.
In [9], the serial interval is defined as the length of time a person is contagious. It can be
estimated by tracking contacts (i.e., infector-infected pairs) and by counting the number of days
between the dates of onset of symptoms in the infecting and infected individuals respectively.
In this work, we have studied three serial intervals: the one obtained by Du et al. in [8]
using 468 cases, a serial interval obtained by Nishiura et al. in [13] using 28 cases which is
approximated by a log-normal distribution, and a serial interval obtained by Ma et al. in [11]
using 1155 cases. As proposed by the authors this serial interval has been approximated by a
shifted log-normal to take into account the cases in the negative days. In Fig. 1 we show the
profile of these serial intervals. Of course, more accurate estimates of the serial interval for the
SARS-CoV-2 can be expected in the future. In the online interface (www.ipol.im/ern) the
users can, optionally, upload their own distribution for the serial interval.

3

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

METHODS
A new variational model to compute Rt .
Equation (1) was originally formulated for serial interval functions Φ(s) satisfying Φ(s) = 0
for s ≤ 0, but this is definitely not true for the SARS-CoV-2. Hence, to avoid an artificial
truncation of the serial interval function, we adopt the obvious generalization of this equation
as
Z ∞
i(t − s)R(t − s)Φ(s)ds.
(5)
i(t) =
−∞

In that way, the integration is performed on the whole support of the serial interval Φ(s). In
practice, we deal with an incidence curve observed itself on a limited interval, up to present.
Hence, boundary conditions including days in the future will be requested to apply the above
formula to any point of the incidence curve. Our method requires the observation of:
• the incidence curve, namely the daily count of new detected cases of SARS-CoV-2 infections, denoted as it = i(t) on day t.
• an empirical probability distribution Φ = (Φf0 , · · · , Φf ) for the serial interval. We assume
that a patient can show symptoms up to f0 days before the person who contaminated
him/her shows symptoms himself/herself. So we have f0 = −4 for the Ma et al. serial
interval, f0 = 0 for Nishiura et al. and f0 = −10 for Du et al. The discrete support of Φ
is therefore contained in the interval [f0 , f ].
We shall use the straightforward discretization of Equation (5):
it = F (i, R, Φ, t) ≡

f
X

it−s Rt−s Φs

for t = 0, .., tc ,

(6)

s=f0

where Rt represents the discrete version of R(t), t = 0 is the time where the infection number
starts to grow and tc the current time. This equation is inserted in a variational model to
estimate Rt by minimizing the energy
!2
P
tc
M
tc
X
X
X
it − fs=f0 it−s Rt−s Φs
2
+
wt (Rt − Rt−1 ) +
βm (Rtm − R̄tm )2 , (7)
E({Rt }) =
p90 (i)
t=1
m=0
t=0
where p90 (i) is the 90th percentile of {it }t=0,..,tc used to normalize the energy with respect to
the size of it . The first term of E is a data adjustment term which forces the renewal equation
(6) to be satisfied as much as possible. The second term forces Rt to be a smooth curve;
wt ≥ 0 represents the weight of the regularization at each time t. The higher the value of wt
the smoother Rt . The last term of E forces Rtm to be close to an initial estimate given by R̄tm
for some particular times tm . Finally, βm is a weight that determines the confidence we have
in such initial estimate R̄tm . The larger βm , the greater this confidence. For instance, we can
use any “a priori” estimate of R0 as the prescribed value R̄t0 (with t0 = 0). Minimizing the
energy E leads to satisfy approximately the renewal equation (6) with a reasonably smooth Rt
and, optionally, prescribed initial values for some particular times tm . The parameters wt and
βm determine the importance assigned to these constraints in the estimation.
4

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

Minimizing E with respect to the sequence {Rt } yields a linear system of equations that is
easily solved. Yet, it requires the complement of adequate boundary conditions for Rt and it
on both ends of the observation interval.
Definition of the boundary conditions.
For Rt , we will always assume that Rt = R0 for t < 0 and Rt = Rtc for t > tc (the current
time). Concerning it , when t > tc we use a linear regression to extrapolate the values of it
beyond tc . To compute the regression line (i = m7 · t + n7 ) we use the last seven
P values of it .
For t < 0 we will assume that the cumulative number of infected detected It ≡ tk=0 ik follows
an exponential growth for t < 0, that is It = I0 eat , where a represents the initial exponential
growth rate of It at the beginning of the infection spread. In summary, the extension of it
beyond the observed interval [0, tc ] is defined by
(
I0 eat − I0 ea(t−1) if t < 0;
it =
(8)
m7 · t + n7
if t > tc .

Computation of the initial exponential growth a and R̄0
We now naturally estimate a by

a = median({log

It+1
It


: t = 0, .., 14}).

(9)

If we assume that It = I0 eat follows initially an exponential growth and that Rt is initially
constant, then using equation (6) we obtain that
−a

i0 = I0 (1 − e ) = I0 R0

f
X

(e−ka − e−(k+1)a )Φk .

(10)

k=f0

Hence, we can compute an approximation of R0 as
R̄0 = Pf

1 − e−a

−ka − e−(k+1)a )Φ
k
k=f0 (e

.

(11)

Note that this estimation strongly depends on the serial interval used. For instance, if we
assume that a = 0.250737 (the exponential growth rate obtained in [2] when the coronavirus
is in free circulation), we obtain that R̄0 = 2.700635 for the Nishiura et al. serial interval,
R̄0 = 3.084528 for the Ma et al. serial interval and R̄0 = 1.839132 for the Du et al. serial
interval.
We assumed here that we would compute Rt from the beginning of the epidemic’s spread to
the present day. Since the epidemic is likely to be with us for a long period of time, note that
it is also possible to use our model to start calculating Rt from any ulterior time t1 , in which
case the user can provide an initial value of Rt1 .

5

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

Normalization of the regularization weight wt
Let ŵ0 > 0 be a constant value which represents the most important parameter of the
energy. To define automatically wt we will take into account ŵ0 , the magnitude of i(t) and the
global variability of i(t). We observe that, for any t, the larger the value of i(t), the larger the
expected influence of i(t) in the first term of the energy (7). To balance this effect, we will
normalize wt by setting it proportional to the value:
Gσw ∗ i(t)
,
p90 (i)

(12)

where Gσw ∗i(t) represents the convolution of it with a Gaussian kernel of standard deviation σw
and p90 (i) is the 90th percentile of {it }t=0,..,tc . By default, we fix σw = 3 as standard deviation
of the Gaussian kernel. Another normalization factor is needed, the larger the variability of
i(t) the larger the weight of the regularization must be. We therefore measure the variability
of i(t) by
Ptc
ki0 kL1 [tc −T,tc ]
+1 |i(t) − i(t − 1)|
v(i) ≡
≈ t=tc −T
(13)
Ptc
kikL1 [tc −T,tc ]
i(t)
t=tc −T +1
where tc is the current time and we fix in the experiments T = 56 (8 weeks). We have
studied, up to December 28, 2020, the value of v(i) in 88 countries with a significant impact
of the epidemic and we have obtained that the median of v(i) in these countries is given by
p50 (v) = 0.203946, the 25th percentile is given by p25 (v) = 0.1381875 and the 75th percentile
is given by p75 (v) = 0.30428675. We denote by N v(i) the normalized variability measure given
by
v(i)
(14)
N v(i) =
p50 (v)
Finally, we define the normalized regularity weight wt by
wt = ŵ0 φ (N v(i))
where
φ(s) =





p25 (v)
p50 (v)




p75 (v)
p50 (v)

s

Gσw ∗ i(t)
p90 (i)

(15)

(v)
if
s < pp25
50 (v)
(v) p75 (v)
if s ∈ [ pp25
,
]
50 (v) p50 (v)
p75 (v)
if
s > p50 (v) .

In that way wt compensates for the size and variability of i(t). This strategy allows us to deal
with most countries using a single value for ŵ0 which represents the ”reference” regularization
weight. For each country, the term ŵ0 φ (N v(i)) can be considered as an automatic update of
ŵ0 which takes into account the variability of i(t). The introduction of φ(s) limits the variation
(v) p75 (v)
of wt when the value of N v(i) is outside the interval [ pp25
,
].
50 (v) p50 (v)
We notice that when ŵ0 is very small, minimizing the energy (7) can lead to obtain negative
values Rt for some t. In such cases, we increase iteratively the value of the regularization weights
at such points and at their neighbors and we compute again the minimum of (7). More precisely
for any tk such that Rtk < 0, we update wtk = 10wtk , wtk +1 = 10wtk +1 , wtk −1 = 10wtk −1 and
then recompute the minimum of the energy (7). This operation is performed until all Rt ’s
become positive. We observed experimentally that this objective is reached in a few iterations.
6

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

We highlight that, in general, in the usual range of practical interest values of ŵ0 , the first
estimation of Rt is positive, so we do not need to apply this procedure.
Filtering “administrative noise”
The raw data curve in is extraordinarily noisy, and the administrative noise has unfortunately little to do with the Poisson noise used in most aforementioned publications. Government
statistics are affected by changes of testing and polling policies, political decisions, and weekend reporting delays. Here is for example a list of explanations for the undue peaks (and
even negative counts) in official cases statistics in France (https://en.wikipedia.org/wiki/
COVID-19_pandemic_in_France):
• A new laboratory transmits data since May 4, retrospectively from March 16.
The new number of cases in the last 24 hours takes this into account.
• The increase in cases compared to data of the previous day is an aggregation
of additional data from 13th May, previously not taken into account.
• Some positive patients were counted twice, this is no longer the case, therefore
the decrease in cases compared to data of the previous day.
These recording delays and consecutive rash corrections make a peculiar feature of such time
series that we call administrative noise. They result in strong impulse noise, together with a
“week-end” 7-periodic noise. These noises clearly dominate the alleged Poisson noise inherent
in any counting procedure. In the web appendix, we include a discussion on different strategies
to deal with this administrative noise.
Summary of the algorithm computing Rt .
• Step 1: Pre-processing of the input data (detected infected) to reduce the administrative
noise and to take into account that, some countries are not providing new data during
the week-end.
• Step 2: Estimation of the time tinit where the accumulated data, It , starts to grow in an
exponential way. We use a very basic algorithm where we impose that It+1 > 1.1It in two
consecutive days. More formally, we set
tinit := min{t : It > 10 and It > 1.1It−1 and It−1 > 1.1It−2 }.
t>2

Once tinit is computed the previous data sequence is removed so that tinit becomes 0.
• Step 3: Compute the initial exponential growth rate a and an initial estimation of R0
using (9) and (11).
• Step 4: Computation of Rt by minimizing the energy (7). If any of the computed Rt is nonpositive we increase locally the regularization weight wt and we iterate the minimization
of (7). As indicated above, if the value ŵ0 is in the range of practical interest, the first
estimation of Rt is positive so this safety procedure is rarely applied. We always use as
prescribed value for R0 the estimation given by (11).
7

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

Short time extrapolation of Rt and it .
Since the variational method provides a point estimate of Rt up to the current time tc , by
extrapolating the value of Rt into the future, it is possible, using the renewal equation (6), to
obtain also an extrapolation of the number of infected it in the near future. To fix reasonable
future values of Rt we use a basic procedure based on Hermite interpolation polynomials and
a conservative estimation of the value of Rt at t = tc + Nd in the near future. The values
R1 ≈ R(tc + Nd ) and Nd can be provided manually by the user or can be automatically fixed by
the algorithm. By default, we fix Nd = 7 and R(tc + Nd ) equal to the median of the Rtc values
estimated in the last 7 days. The interest of this extrapolation is to show to policy makers
the future evolution of the incidence curve “if the reproduction conditions remain as they are
currently” (see the Web appendix for technical details).

RESULTS
All of the experiments made here can be reproduced with the online interface available at
www.ipol.im/ern. In the web appendix we include more details about the use of the online
interface. This online interface allows one to assess the performance of the method applied to
any country and any state in the USA, with the last date updated to the current date.
We shall pay particular attention to the comparison with EpiEstim, the method proposed
by Cori et al. in [7] that we have explained briefly in the introduction. It is one of the most
widespread methods to estimate R(t). In our comparative experiments, we use the following
parameters for the EpiEstim method: a 7-day time interval, that is τ = 7, and a = 1, b = 5 for
the prior Gamma distribution Γ(a, b). EpiEstim does not allow for a serial interval distribution
with positive values at 0 or on negative days, therefore to compute the EpiEstim estimate given
by (3), all the values Φs for s < 1 are accumulated in the value Φ1 .
We compared the results obtained by our variational method and the ones obtained by EpiEstim for four countries: France, the United Kingdom, Spain and the United States. We used
the incidence curves reported by the countries up to October 30, 2020 that we obtained from the
European Centre for Disease Prevention and Control service. For several weeks in this period,
France and Spain did not provide data in the weekends and gave instead a cumulative count of
three consecutive days on Mondays. To avoid the artificial noise generated, the accumulated
value of the three days divided by 3 was assigned to Saturday, Sunday and Monday.
For the parameters of the
√ variational model, we used the serial interval proposed by Ma et
al. in [11] and we set ŵ0 = 10 (the regularization weight).
In Fig. 2 the Rt estimate obtained by both methods are compared. We shifted back the
EpiEstim results by 9 days to fit the results obtained by the variational model. Surprisingly,
despite the fact that both methods are quite different, a good fit of both estimates in the four
countries was observed. To measure the displacement, t̃, between both estimates we fit both
curves by minimizing their RMSE,
s
Ptc
e
2
k=tc −T +1 (R(k − t) − R (k))
e
t̃ = arg min D(R, R , t) ≡
(16)
t∈[0,20]
T
where Re is the EpiEstim estimate and T = 120. Notice that, in the above expression, t is not,
8

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

in general, an integer value. So to evaluate R(k − t) we use linear interpolation. In table 1
we present the results for several countries. It is observed that the displacement between both
estimates is between 8 and 10 days and that the fit between both curves is quite good with a
distance between 0.019 and 0.092. The shift between 8 and 10 days is not surprising. Indeed,
as stated in equation (4), we can expect a first shift with a magnitude around the mean of the
serial interval (in the case of the used Ma et al. serial interval, the mean is 6.7). Moreover,
using a time window of 7-days adds an additional 3.5 days of delay, which gives a global shift
around 10 days with respect to the present. Hence the observed time shift comprised between
8 and 10 days is explainable.
In Fig. 3 we present the sequence of the daily number of detected infected, it , used in the
experiments as well as its expected value using the renewal equation F (i, R, Φ, t) defined if (6)
using the Rt estimate obtained by the variational model. It suggests that F (i, R, Φ, t) is an
excellent smooth approximation of it .
In Fig. 4 we show the results, in the case of France, of the automatic procedure to obtain
a 7-day extrapolation of the value of Rt and it . Once Rt is extrapolated, the subsequent
“conditional forecast” of it is obtained using the renewal equation F (i, R, Φ, t). To apply the
formula to obtain F (i, R, Φ, t), the required values of it beyond the current time are obtained
in an iterative way using the extrapolation procedure defined in (8).

DISCUSSION
In this paper we proposed a variational model given by the expression (7) for computing the
effective reproduction number Rt of SARS-CoV-2 using the daily registered infected and the
serial interval. The main advantages we found with this method are:
• It is based on a known epidemiological model (given by the renewal equation (1)) which
establishes how R(t) and the serial interval intervene in the evolution of the number of
incident cases. The method does not involve the “naive” simplification which assumes
R(t) to be locally constant. Our method does not assume that the observation noise is
Poisson, because it plainly isn’t.
• The method can use serial intervals with distributions containing negative days (as it is
the case for the SARS-CoV-2). Thus, it avoids an artificial truncation of the distribution.
• The method computes a point estimate of Rt up to the current date. It seems to provide
a more to date (by more than 8 days) estimate of Rt than EpiEstim, which is based on
the model (2) and a time interval estimation.
• The method does not assume any statistical distribution for Rt . The main assumptions
are that the Rt estimate should follow the renewal equation (1) but keeping Rt regular
enough. We include this regularity hypothesis in the model using standard techniques of
calculus of variations.
We have included an automatic procedure in the algorithm to deal with countries where no
data is provided during the week-end, and, optionally, a pre-processing step of the data using
classic filters.
9

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

While our method and the standard Cori et al. (EpiEstim) method are quite different, we
found experimentally that for a particular choice of the parameters of the variational method,
a good agreement can been obtained between the estimate of Rt provided by the variational
model and a back shifted estimate of Rt obtained by EpiEstim.
Since the point estimation of Rt is obtained up to the current date, it allows us to extrapolate
the value of Rt in the short term. In countries that introduce mild social distancing measures, it
is hard to obtain an accurate forecast because the situation of the epidemic can change rapidly
in any direction in a few days. Therefore, the extrapolation technique proposed in this paper
is just an example to show how a recent Rt estimation can be used to predict the number of
infected in the next days. Using Hermite interpolation polynomials we proposed two techniques
to extrapolate the value of Rt . In the first one, the user supplies a future target value for Rt and
the number of days needed to reach that value. This target value can depend on the actions
that a country is taking to control the epidemic. The second technique is automatic and it
provides an extrapolation in the very short term (one week). In this case we fix the expected
value of Rt in one week to be the median of the Rtc values obtained the last 7 days. This gives
policy makers an evaluation of the incidence curve if everything remains equal.
We finally notice how dependent any estimation or forecast of Rt is on governement policies,
both for gathering data and for recording them. The main hindrances to a precise estimate of
Rt are :
a) the constant changes of detection policies, which can go from a minimal count of serious
cases confirmed at hospitals to wide ranging random testing;
b) the incredible incapacity of administrations to record cases on a daily base, in the era of
internet and instant communication.
An online implementation of the method is available at www.ipol.im/ern where the users
can perform their own experiments using official registered data of infected or uploading their
own data of daily infected and/or the serial interval distribution.

References
[1] P. Abry, N. Pustelnik, S. Roux, P. Jensen, P. Flandrin, R. Gribonval, C.-G.
Lucas, E. Guichard, P. Borgnat, N. Garnier, and B. Audit, Spatial and temporal regularization to estimate COVID-19 reproduction number R(t): Promoting piecewise
smoothness via convex optimization. medRxiv, 2020.
[2] L. Alvarez, An empirical algorithm to forecast the evolution of the number of COVID-19
symptomatic patients after social distancing interventions. ArXiv (preprint), 2020.
[3] L. Alvarez, M. Colom, and J.-M. Morel, Removing weekly administrative noise
in the daily number of COVID-19 new cases and applications to the computation of Rt,
MedRxiv, (2020).
[4] T. Boulmezaoud, Un modèle de prédiction de l’épidémie Covid-19 et une stratégie zigzag pour la contrôler, (2020).

10

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

[5] T. Z. Boulmezaoud, L. Alvarez, M. Colom, and J.-M. Morel, A daily measure
of the SARS-CoV-2 daily reproduction number for all countries, IPOL Journal. Image
Processing On Line, submitted, (2020).
[6] G. Chowell, H. Nishiura, and L. M. Bettencourt, Comparative estimation of the
reproduction number for pandemic influenza from daily case notification data, Journal of
the Royal Society Interface, 4 (2007), pp. 155–166.
[7] A. Cori, N. M. Ferguson, C. Fraser, and S. Cauchemez, A new framework
and software to estimate time-varying reproduction numbers during epidemics, American
journal of epidemiology, 178 (2013), pp. 1505–1512.
[8] Z. Du, X. Xu, Y. Wu, L. Wang, B. J. Cowling, and L. A. Meyers, The serial
interval of COVID-19 from publicly reported confirmed cases, medRxiv, (2020).
[9] Groupe de modélisation de l’équipe ETE (Laboratoire MIVEGEC, CNRS,
IRD, Université de Montpellier), Estimation du nombre de reproduction temporel,
2020 (accessed May 30, 2020). https://bioinfo-shiny.ird.fr/Rt/.
[10] Q.-H. Liu, M. Ajelli, A. Aleta, S. Merler, Y. Moreno, and A. Vespignani,
Measurability of the epidemic reproduction number in data-driven contact networks, Proceedings of the National Academy of Sciences, 115 (2018), pp. 12680–12685.
[11] S. Ma, J. Zhang, M. Zeng, Q. Yun, W. Guo, Y. Zheng, S. Zhao, M. H. Wang,
and Z. Yang, Epidemiological parameters of coronavirus disease 2019: a pooled analysis
of publicly reported individual data of 1155 cases from seven countries, Medrxiv, (2020).
[12] H. Nishiura, Time variations in the transmissibility of pandemic influenza in Prussia,
Germany, from 1918–19, Theoretical Biology and Medical Modelling, 4 (2007), p. 20.
[13] H. Nishiura, N. M. Linton, and A. R. Akhmetzhanov, Serial interval of novel
coronavirus (COVID-19) infections, International journal of infectious diseases, (2020).
[14] T. Obadia, R. Haneef, and P.-Y. Boëlle, The r0 package: a toolbox to estimate reproduction numbers for epidemic outbreaks, BMC medical informatics and decision making,
12 (2012), p. 147.
[15] R. Thompson, J. Stockwin, R. D. van Gaalen, J. Polonsky, Z. Kamvar, P. Demarsh, E. Dahlqwist, S. Li, E. Miguel, T. Jombart, et al., Improved inference
of time-varying reproduction numbers during infectious disease outbreaks, Epidemics, 29
(2019), p. 100356.
[16] M. A. Vink, M. C. J. Bootsma, and J. Wallinga, Serial intervals of respiratory
infectious diseases: a systematic review and analysis, American journal of epidemiology,
180 (2014), pp. 865–875.

11

0.00150663
0.00421856
0.00150663
0.00150663
0
0.00401768
0.01024508
0.01687425
0.01506629
0.01506629
0.05423865
0.10305344
0.08768582
0.107272
0.07864604
0.107272
0.06388108
0.07051025
0.04881479
0.04308959
0.03435115
0.03435115
0.03033347
0.00843712
0.01305745
0.01305745
0.01506629
0.0081358
0.00632784
0
0.00241061

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
Nishiura et Ma et al. (shifted log-normal
approximation) perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

1.55E-07
1.89E-04
3.50E-03
1.60E-02
1.26E-04
3.77E-02
Serial intervals
3.57E-02
6.19E-02
8.15E-02
0.16679318
0.2
0.20594949
9.30E-02
0.17559687
9.62E-02
0.15
0.13004109
9.29E-02
8.54E-02
9.07E-02
0.1
6.18E-02
7.56E-02
4.17E-02
6.51E-02
0.05
5.49E-02
2.82E-02
1.91E-02
4.56E-02
0
1.31E-02
3.75E-02
-10 -8 -6 -4 -2 0 2 4 6 8 10 12 14 16 18 20
9.01E-03
3.05E-02
2.46E-02
6.27E-03
Du et al.
4.41E-03
1.98E-02
Nishiura et al. (log-normal approximation)
1.58E-02
3.12E-03
Ma et al. (shifted log-normal approximation)
2.23E-03
1.26E-02
1.61E-03
1.01E-02
1.17E-03
8.01E-03
8.58E-04
6.38E-03
Figure
1: Serial
intervals used in our experiments: the discrete one proposed by Du et al. in
6.34E-04
5.07E-03
[8]4.71E-04
(solid bars),
a log-normal approximation of the serial interval proposed by Nishiura et al.
4.03E-03
in3.53E-04
[13] (dashed
line) and a shifted log-normal approximation of the serial interval proposed by
3.21E-03
2.66E-04
Ma
et al. in2.56E-03
[11] (dotted line).
2.02E-04
2.04E-03
1.54E-04
1.63E-03
1.18E-04
1.30E-03
9.14E-05
1.04E-03
7.09E-05
8.36E-04
5.53E-05
6.71E-04
4.33E-05
5.40E-04
3.41E-05
4.35E-04
2.70E-05
3.51E-04
2.14E-05
2.84E-04
1.71E-05
2.30E-04
1.37E-05
1.86E-04
1.10E-05
1.51E-04
France United Kingdom
Spain
USA
8.85E-06
1.23E-04
7.16E-06
1.00E-04
shift (t̃)
8.60
8.46
9.18
8.33
e
5.82E-06
8.21E-05
D(R, R , t̃) 0.073807
0.091506
0.081461 0.019639
4.74E-06
6.71E-05
5.50E-05
Table 1: Shift
between the Rt estimates using EpiEstim and the variational method obtained
4.52E-05
by minimizing the distance D(R, Re , t).
3.72E-05
3.06E-05
2.52E-05
2.09E-05
1.73E-05
1.43E-05

12

4.5
4.25
4
3.75
3.5
3.25
3
2.75
2.5
2.25
2
1.75
1.5
1.25
1
0.75
0.5
0.25

28-Feb
6-Mar
13-Mar
20-Mar
27-Mar
3-Apr
10-Apr
17-Apr
24-Apr
1-May
8-May
15-May
22-May
29-May
5-Jun
12-Jun
19-Jun
26-Jun
3-Jul
10-Jul
17-Jul
24-Jul
31-Jul
7-Aug
14-Aug
21-Aug
28-Aug
4-Sep
11-Sep
18-Sep
25-Sep
2-Oct
9-Oct
16-Oct
23-Oct
30-Oct

28-Feb
6-Mar
13-Mar
20-Mar
27-Mar
3-Apr
10-Apr
17-Apr
24-Apr
1-May
8-May
15-May
22-May
29-May
5-Jun
12-Jun
19-Jun
26-Jun
3-Jul
10-Jul
17-Jul
24-Jul
31-Jul
7-Aug
14-Aug
21-Aug
28-Aug
4-Sep
11-Sep
18-Sep
25-Sep
2-Oct
9-Oct
16-Oct
23-Oct
30-Oct

4.25
4
3.75
3.5
3.25
3
2.75
2.5
2.25
2
1.75
1.5
1.25
1
0.75
0.5
0.25

France

Spain

13
28-Feb
6-Mar
13-Mar
20-Mar
27-Mar
3-Apr
10-Apr
17-Apr
24-Apr
1-May
8-May
15-May
22-May
29-May
5-Jun
12-Jun
19-Jun
26-Jun
3-Jul
10-Jul
17-Jul
24-Jul
31-Jul
7-Aug
14-Aug
21-Aug
28-Aug
4-Sep
11-Sep
18-Sep
25-Sep
2-Oct
9-Oct
16-Oct
23-Oct
30-Oct

28-Feb
6-Mar
13-Mar
20-Mar
27-Mar
3-Apr
10-Apr
17-Apr
24-Apr
1-May
8-May
15-May
22-May
29-May
5-Jun
12-Jun
19-Jun
26-Jun
3-Jul
10-Jul
17-Jul
24-Jul
31-Jul
7-Aug
14-Aug
21-Aug
28-Aug
4-Sep
11-Sep
18-Sep
25-Sep
2-Oct
9-Oct
16-Oct
23-Oct
30-Oct

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

4.25
4
3.75
3.5
3.25
3
2.75
2.5
2.25
2
1.75
1.5
1.25
1
0.75
0.5
0.25

United Kingdom

4.25
4
3.75
3.5
3.25
3
2.75
2.5
2.25
2
1.75
1.5
1.25
1
0.75
0.5
0.25

USA

Figure 2: we show the Rt estimate obtained by EpiEstim (dotted line) and the variational model
(solid line). The vertical line represents the 9-day shift applied to the EspiEstim estimate to
fit the results of the variational technique.

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

France

United Kingdom
27500

50000

25000

45000

22500

40000

20000

35000

17500

30000

15000

25000

12500

20000

10000

15000

7500

10000

5000

5000

2500

0

0
28-Feb
6-Mar
13-Mar
20-Mar
27-Mar
3-Apr
10-Apr
17-Apr
24-Apr
1-May
8-May
15-May
22-May
29-May
5-Jun
12-Jun
19-Jun
26-Jun
3-Jul
10-Jul
17-Jul
24-Jul
31-Jul
7-Aug
14-Aug
21-Aug
28-Aug
4-Sep
11-Sep
18-Sep
25-Sep
2-Oct
9-Oct
16-Oct
23-Oct
30-Oct

28-Feb
6-Mar
13-Mar
20-Mar
27-Mar
3-Apr
10-Apr
17-Apr
24-Apr
1-May
8-May
15-May
22-May
29-May
5-Jun
12-Jun
19-Jun
26-Jun
3-Jul
10-Jul
17-Jul
24-Jul
31-Jul
7-Aug
14-Aug
21-Aug
28-Aug
4-Sep
11-Sep
18-Sep
25-Sep
2-Oct
9-Oct
16-Oct
23-Oct
30-Oct

55000

USA

Spain
27500

90000
85000
80000
75000
70000
65000
60000
55000
50000
45000
40000
35000
30000
25000
20000
15000
10000
5000
0

22500
20000
17500
15000
12500
10000
7500
5000
2500
28-Feb
6-Mar
13-Mar
20-Mar
27-Mar
3-Apr
10-Apr
17-Apr
24-Apr
1-May
8-May
15-May
22-May
29-May
5-Jun
12-Jun
19-Jun
26-Jun
3-Jul
10-Jul
17-Jul
24-Jul
31-Jul
7-Aug
14-Aug
21-Aug
28-Aug
4-Sep
11-Sep
18-Sep
25-Sep
2-Oct
9-Oct
16-Oct
23-Oct
30-Oct

0

Rt Forecast (FRANCE)

28-Feb
6-Mar
13-Mar
20-Mar
27-Mar
3-Apr
10-Apr
17-Apr
24-Apr
1-May
8-May
15-May
22-May
29-May
5-Jun
12-Jun
19-Jun
26-Jun
3-Jul
10-Jul
17-Jul
24-Jul
31-Jul
7-Aug
14-Aug
21-Aug
28-Aug
4-Sep
11-Sep
18-Sep
25-Sep
2-Oct
9-Oct
16-Oct
23-Oct
30-Oct

25000

1.5
1.45
1.4
1.35

Figure 3: we show the registered daily number of new infected patients (dotted line) and its
expected value using the renewal equation F (i, R, Φ, t) defined in (6) (solid line) using the Rt
estimate obtained by the variational model.
1.3

1.25

1.2
1.15

1-Nov

2-Nov

3-Nov

4-Nov

5-Nov

6-Nov

3-Nov

4-Nov

5-Nov

6-Nov

31-Oct

2-Nov

30-Oct

29-Oct

28-Oct

27-Oct

26-Oct

25-Oct

24-Oct

23-Oct

22-Oct

21-Oct

20-Oct

19-Oct

1-Nov

Rt Forecast (FRANCE)

18-Oct

17-Oct

16-Oct

15-Oct

14-Oct

13-Oct

12-Oct

11-Oct

9-Oct

10-Oct

1.1

Tested Positive Forecast (FRANCE)

1.5
80000

1.45

70000

1.4
60000

1.35
50000

1.3

40000

1.25

30000

1.2

20000

1.15

10000

31-Oct

30-Oct

29-Oct

28-Oct

27-Oct

26-Oct

25-Oct

24-Oct

23-Oct

22-Oct

21-Oct

20-Oct

19-Oct

18-Oct

17-Oct

16-Oct

15-Oct

14-Oct

13-Oct

12-Oct

11-Oct

9-Oct

10-Oct

0

6-Nov

5-Nov

4-Nov

3-Nov

2-Nov

1-Nov

31-Oct

30-Oct

29-Oct

28-Oct

27-Oct

26-Oct

25-Oct

24-Oct

23-Oct

22-Oct

21-Oct

20-Oct

19-Oct

18-Oct

17-Oct

16-Oct

15-Oct

14-Oct

13-Oct

12-Oct

11-Oct

9-Oct

10-Oct

1.1

Tested Positive Forecast (FRANCE)
80000

Figure 4: In the case of France, we show a 7-day forecast of Rt and it using as expected value
of R(tc + 7) the median of the estimation of Rtc in the last 7 days. The vertical line indicates
the time when the forecast starts. On the left the plot the value of Rt and on the right we plot
the value of it (dotted line) and its forecast (solid line) from the renewal equation F (i, R, Φ, t).
70000
60000
50000
40000
30000
20000
10000

6-Nov

5-Nov

4-Nov

3-Nov

2-Nov

1-Nov

31-Oct

30-Oct

29-Oct

28-Oct

27-Oct

26-Oct

25-Oct

24-Oct

23-Oct

22-Oct

21-Oct

20-Oct

19-Oct

18-Oct

17-Oct

16-Oct

15-Oct

14-Oct

13-Oct

12-Oct

11-Oct

9-Oct

10-Oct

0

14

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

Web Appendix. Some technical issues about the variational method to compute Rt
Dealing with the lack of data
Some countries do not provide data on holidays or weekends and only provide the cumulative
total of cases on the next working day. To avoid the strong discontinuity in the data sequence
produced by the lack of data, we automatically correct the data sequence by assigning to all
affected days a constant value given by the mean of the number of cases during those days.
Weekly administrative noise
In [3], a method to reduce the weekly administrative noise is introduced. It is based on the
correction of the value of the number of infected according to the day of the week to obtain
a better fit between the number of infected and the one expected using the renewal equation
F (i, R, Φs , t). In practice the method is very simple: one just has to multiply the number of
infected by a factor which depends on the day of the week. See [3] for more details.
Some classic pre-processing filters
Several classic noise elimination filters are implemented in the online interface as optional
pre-processing steps of the incidence curve. Yet, in general, the application of these filters is
unnecessary as the variational model, together with the weekly administrative noise removal,
is sufficient to obtain good results.
The first proposed filter is the median filter. Given a windows radius rW we define the
median filter in a time t ≤ tc − rW as
M (t) = median({in : |n − t| ≤ rW and n ∈
/ We })
We also implemented a linear Gaussian convolution filter. The general expression to compute
the convolution with a symmetric kernel such as the Gaussian function is:
G ∗ i(t) = g0 · i(t) +

NG
X

gs · (i(t + s) + i(t − s)),

(17)

s=1

where the coefficients, gs , computed from the Gaussian function, satisfy:
g0 + 2

NG
X

gs = 1.

(18)

s=1

In the expression (17), when t + s > tc we use a linear extrapolation to compute the value of
i(t + s). To approximate i0 (tc ), the derivative of i(t) in the current time tc , we use a weighted
average of derivatives given by:
P G
g0 · (i(tc ) − i(tc − 1)) + N
0
s=1 gs · (i(tc − s) − i(tc − s − 1))
,
(19)
i (tc ) =
P G
g0 + N
s=1 gs
1

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

and then, for t + s > tc we define i(t + s) as
i(t + s) = i(tc ) + i0 (tc )(t + s − tc )

(20)

Finally we also used an optional moving average filter as a data pre-processing step.

Short time extrapolation of Rt and it
Extrapolating Rt .
To extrapolate the value of Rt we use a basic procedure based on Hermite interpolation polynomials and the knowledge of the expected value of Rt in a given day, tc + Nd , in the near future.
Assuming that the values Nd and R1 ≈ R(tc + Nd ) are given, we use the following Hermite
interpolation polynomial to extrapolate the value of Rt :

c
c

− 2)2 (2 t−t
)+
R1 + R0 (tc ) γN8 d (2 t−t

γNd
Nd

if
t ∈ (tc , tc + γNd ]


c
c

(R(tc ) − R1 ) 14 (2 t−t
− 2)2 (2 t−t
+ 1)
Nd
Nd
R̃(t) =
c
c

R1 + (R(tc ) − R1 ) 41 (2 t−t
− 2)2 (2 t−t
+ 1) if t ∈ (tc + γNd , tc + Nd ]

Nd
Nd




R1
t > t c + Nd ,
for any γ ∈ (0, 1], R̃ ∈ C 1 (tc , ∞) satisfies that R̃(tc ) = R(tc ), R̃0 (tc ) = R0 (tc ), R̃(tc + Nd ) = R1 ,
R̃0 (tc +Nd ) = 0. So, using this basic extrapolation procedure we get a smooth transition between
R(tc ) and R1 . By default, we initialize γ = 1 and then reduce the value of γ automatically to
avoid that R̃(t) has negative value using the following relation:
R̃(t) ≥ min{R1 , R(tc )} + R0 (tc )

4
γNd
27

∀t ∈ [tc , ∞)

therefore if R1 , R(tc ) > 0 and γ ∈ (0, 1] is small enough, then R̃(t) > 0 ∀t ∈ [tc , ∞).
The values of R1 and Nd can be fixed manually accordingly with the current and/or expected
social distancing measures. A default automatic procedure for these parameters is to fix Nd = 7
and R(tc + Nd ) equal to the median of the Rtc values estimated in the last 7 days. To do so,
we apply the variational model 7 times, removing each time the last value of the remaining
data sequence (that is, we update each time tc by tc − 1), then we compute the median of the
obtained Rtc values.

Extrapolation of the incidence curve it .
Once w Rt has been extrapolated for t = tc + 1, tc + 2, .., tc + dT (where dT is the number of
future days to extrapolate), we can compute by iteration it from tc + 1 to tc + dT using the
renewal equation F (i, R, Φ, t), the required values of it beyond the current time are obtained
using the extrapolation procedure defined in (8). Then to reduce the effect of the extrapolation
of it when t > tc , we apply a second time F (i, R, Φ, t) to the obtained extrapolated sequence
for t = tc − 9, ..., tc + dT . We start at tc − 9 to include an extra smooth of the first estimate of
F (i, R, Φ, t) when t approaches tc .
2

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

Measuring the variability of the Rt estimate.
Since we did not assume any statistical model on the distribution of the Rt values, no confidence
interval for this estimate is available. For certain choices of the variational model parameters,
the good agreement with the results obtained by EpiEstim gives us an idea, by comparison,
about the variability of our estimate. To measure the variability of the Rt estimate in the last
days we use the following procedure:
1. Compute {Rk (t)}t∈[0,tc −k] by minimizing (7) for k = 1, 2, 3, using the data sequence up to
tc − k.
2. Compute for each t ∈ [0, tc ] the variability of R(t) with respect to its value the three
preceding days given by R1 (t), R2 (t) and R3 (t) using the expression:
r
(R(t) − R1 (t))2 + (R(t) − R2 (t))2 + (R(t) − R3 (t))2
,
(21)
σ(t) =
3
to define Rk (t) in (tc − k, tc ] we use linear extrapolation.
To illustrate this variability, in the software available online at www.ipol.im/ern, we represent
the estimate of R(t) around an empirical interval of variability defined at each point as [R(t) −
2 · σ(t), R(t) + 2 · σ(t)].

Technical details of the EpiEstim estimate
As shown in [5], assuming, for Rt,τ , a Gamma distributed prior, Γ(a, b) with parameters a, b,
over a time window of length τ , the EpiEstim estimate of Rt can be expressed as
Rt,τ =

a
τ

b−1
τ

+ īt,τ
Pf
+ k=1 īt−k,τ Φk

(22)

where īt,τ is the moving average of it in a time window of length τ , that is
Pt
is
īt,τ = s=t−τ +1 ,
τ
therefore the EpiEstim estimation can be obtained by filtering the data using a moving average
and then applying equation (22). Moreover, if we assume that
Pt
s=t−τ +1 is
ab = Pt
,
(23)
Pf
s=t−τ +1
k=1 is−k Φk
we obtain (see [5]) that equation (22) becomes
Rt,τ = Pf

īt,τ

k=1 īt−k,τ Φk

(24)

which corresponds to the usual Rt estimate obtained directly from equation (2) (but preprocessing the input data first using a moving average).
3

medRxiv preprint doi: https://doi.org/10.1101/2020.08.01.20165142; this version posted December 31, 2020. The copyright holder for this
preprint (which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in
perpetuity.
It is made available under a CC-BY-NC-ND 4.0 International license .

Using the online interface in www.ipol.im/ern
Summary of algorithm parameters.
• it : input data with the daily registered infected curve.
• Serial interval used: by default we propose three options: the serial intervals obtained by
Ma et al., by Nishiura et al. and by Du et al.. The users can also upload their own serial
interval.
• Parameters in the energy (7):
– ŵ0 : regularization weight. The default value is ŵ0 = 100.7 .
– β0 : weight for the initial estimation of R0 computed using (11). The fixed value
is β0 = 105 . This parameter is not in the online interface because it has not any
significant influence in the last values of R(t).
• Optional Data Pre-filtering:
– rW : radius of the median filter window for data filtering. If the value of this parameter is zero no median filter is applied. The default value is 0.
– σ: standard deviation of the Gaussian linear filter for data filtering. If the value of
this parameter is zero no Gaussian filter is applied. The default value is 0.
– rM : radius of the moving average window filter. If the value of this parameter is
zero no moving average is applied. The default value is 0.
• Forecasting (in the case of user interactive forecasting):
– R1 : expected value of R(tc + Nd ) for forecasting.
– Nd : Number of days to reach the value R1 .
In the online interface our variational Rt estimate is compared with the one obtained by EpiEstim using a 7-day time window and a = 1 and b = 5 for the prior Gamma distribution. The
EpiEstim estimate is shifted backwards to fit our estimate. We also show a plot of the initial
sequence it and, for comparison, in the case a pre-filtering is applied to the data, we plot the
result of the filtered sequence. In the case where no pre-filtering is applied we plot the result
of the application of the formula (6) to the data sequence it with the estimated Rt . That is,
we plot:
f
X
ĩt =
it−s Rt−s Φs
for t = 0, .., tc ,
(25)
s=f0

We observe that due to the regularization included in the estimation of Rt , ĩt is an smoothed
version of it .
If the option ”Remove weekly administrative noise” is activated, we use the method proposed
in [3] to remove this administrative noise.

4

