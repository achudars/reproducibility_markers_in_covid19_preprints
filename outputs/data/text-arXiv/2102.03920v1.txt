Smart testing and critical care bed sharing for COVID-19 control

arXiv:2102.03920v1 [physics.soc-ph] 7 Feb 2021

Paulo J. S. Silva1 , Tiago Pereira2,3 , Claudia Sagastizábal1 , Luis Nonato2 , Marcelo Cordova4 , Claudio J. Struchiner5

1

Instituto de Matemática, Estatı́stica e Computação Cientı́fica, Universidade de Campinas, São Paulo, Brazil

2

Instituto de Ciências Matemáticas e Computação, Universidade de São Paulo, São Paulo, Brazil

3

Department of Mathematics, Imperial College London, London, UK

4

Departamento de Engenharia Elétrica, Universidade Federal de Santa Catarina, Florianópolis, Brazil

5

Fundação Getúlio Vargas, Rio de Janeiro, Brazil

During the early months of the current COVID-19 pandemic, social-distancing measures effectively slowed
disease transmission in many countries in Europe and Asia, but the same benefits have not been observed
in some developing countries such as Brazil. In part, this is due to a failure to organise systematic testing
campaigns at nationwide or even regional levels. To gain effective control of the pandemic, decision-makers in
developing countries, particularly those with large populations, must overcome difficulties posed by an unequal
distribution of wealth combined with low daily testing capacities. The economic infrastructure of the country,
often concentrated in a few cities, forces workers to travel from commuter cities and rural areas, which induces
strong nonlinear effects on disease transmission. In the present study, we develop a smart testing strategy to
identify geographic regions where COVID-19 testing could most effectively be deployed to limit further disease
transmission. The strategy uses readily available anonymised mobility and demographic data integrated with
intensive care unit (ICU) occupancy data and city-specific social-distancing measures. Taking into account the
heterogeneity of ICU bed occupancy in differing regions and the stages of disease evolution, we use a datadriven study of the Brazilian state of Sao Paulo as an example to show that smart testing strategies can rapidly
limit transmission while reducing the need for social-distancing measures, thus returning life to a so-called new
normal, even when testing capacity is limited.

1

Introduction

Brazil has struggled deeply to curb the transmission of COVID-19. The first case in Brazil was officially reported in
late February 2020, after which the number of daily deaths increased rapidly in April and May, plateaued for several
months, and then slowly declined in October before resurging in November and December [1–3]. Meanwhile, the
number of daily new cases has risen sharply, and more than 6 months into the crisis, the country has failed to control
transmission. A key reason for this failure is the lack of testing strategies and infrastructure. For example, the total
stock of RT-PCR test kits for the entire first month of the pandemic, March 2020, was 27,000 for a country with 210
million inhabitants [4]. At a similar stage of the pandemic, roughly the same number of tests were performed daily
in Germany, with a population of about 83 million. A similar pattern of daily cases and deaths has been observed in
other countries where the availability of intensive care unit (ICU) beds is limited and an efficient and organised testing
program has been slow to come into effect.

One major unresolved question is whether such a low testing capacity has any utility in helping to curb the
spread of COVID-19 and reduce the need for restrictive social-distancing measures. Another handicap faced in many
countries is the lack of reliable mechanisms for contact tracing. To be effective, tracing needs massive digital data
integration as well as measures to ensure the training and safety of personnel [5, 6]. The heterogeneous society typical
in developing countries adds another layer of complexity. In most countries, the requisite infrastructure is concentrated
around hub cities, far from commuter towns. In this situation, nonlinear effects resulting from the high degree of
population mobility makes the decision of optimal test distribution a real challenge [7, 8]. In their efforts to control
transmission, policymakers struggle to choose where, when, and how many test kits should be distributed when only
a limited number is available. In the present report, we describe a strategy based on readily obtainable data to assist
decision-makers in this process.

We designed a data-driven smart testing strategy capable of exploring population mobility patterns and ICU
bed allocation methods to plan the spatiotemporal distribution of test kits throughout Sao Paulo, a state in Brazil. We

2

integrate anonymised data from mobile devices, census records, and ICU bed usage across multiple areas of the state
into an optimisation framework in a complex network of cities. The approach generates a city-to-city interaction model
of COVID-19 transmission and uses testing to alleviate the intensity of social-distancing measures and to decrease the
pressure on the healthcare system through ICU bed occupancy. Smart testing explores the heterogeneous evolution of
viral transmission and can take advantage of mobility patterns in such a way that it efficiently controls spreading in
large populations, even when little to no testing is done in population hubs. Indeed, we show that the smart testing
strategy is far superior to hub-focused or on-demand testing at reducing the need for mitigation measures.

We provide an analysis for the state of Sao Paulo in Brazil, where all relevant data were collected. Sao Paulo
state has a population of 44 million, and as is common in developing countries, its inhabitants are heterogeneously
distributed with a major concentration in and around its capital, the city of Sao Paulo. We first assumed that no tests
were available and that spreading must be controlled solely by social distancing, thus requiring closure of nonessential
services to attain the desired reproduction number. Then, we compared three testing strategies by analysing how
each one could help to relax social-distancing measures while concurrently reducing the burden on the healthcare
system. Smart testing was the superior strategy among those considered. Finally, we analysed a scenario similar to
the experienced situation in many countries in which mitigation measures are abandoned after 5 months of control and
inhabitants live freely but following sanitary measures. We found that while smart testing alone may be insufficient
to completely safeguard the healthcare system, this could be achieved by introducing a policy of ICU bed sharing
between three regions of the state (Sao Paulo city, metropolitan area, and state interior) and by exploiting the different
rates at which the disease evolves in these regions. Thus, smart testing succeeds in maintaining an effective healthcare
system in a control-free society.

3

Results

Assuming that a positive test for COVID-19 alters an individual’s behaviour, testing programs affect the mobility
patterns of infected individuals who commute between home and work and thus generates nonlinear interactions
between regions of the state. Smart testing is capable of exploring the mobility network, heterogeneous stages of
disease spreading, and ICU occupancy to plan timely targeted tests in areas that will benefit the whole state. To enable
smart testing, we need data on: (i) epidemiological trajectories in each region, (ii) time series of ICU occupancy in
each area, (iii) a mobility matrix between regions of the state, (iv) number of daily tests that can be performed, and
(v) social-distancing criteria. Smart testing then solves an optimisation problem and the output of the algorithm is
a spatiotemporal distribution of tests in the state. Supplementary Note 1 provides a flow chart of the required data,
and more details on the input data and model are given in the Methods. While the data associated with items (i)-(iv)
can be collected easily, the input (v) is flexible and can be tailored in response to specific situations. Mathematically,
this translates into a certain objective function that mirrors the measures the government wishes to impose. Here, the
objective function study was defined as follows.

The main goal of mitigation measures is to prevent healthcare system collapse by decreasing the value of ri (t),
the effective reproduction number in the ith area, for all areas. This can be achieved by applying various mitigation
measures [9,10]. The setting casts ri (t) as a control variable in an optimal control framework that is then approximated
by an optimisation problem. We model each area of the state as an SEIQR model coupled via a mobility matrix (see
Methods for details), and a variant of the SEIQR model where the effects of quarantine are described as an effective
reproduction number is discussed in Supplementary Note 5.

With the given data, the platform calibrates a time series to predict the fraction of infected individuals who
will require an ICU bed for each day. Based on a probabilistically constrained approach with a confidence level of
90%, maximum ICU bed occupancy remains below the local capacity in all regions. The objective function combines
different terms to achieve a balance that provides the most relaxed mitigation measures after the minimisation process.

4

Typical terms are the mean deviation between ri (t) and r0 (basic reproductive number), a total variation term to avoid
too abrupt changes in the control, and terms promoting an alternation of strict measures in nearby cities (see Methods).

To assess the impact of testing strategies, we calibrate the model to the region of interest, as described in
Supplementary Note 2. Here, we provide a full analysis for the state of Sao Paulo, where we gathered all necessary
data (see Methods). In Supplementary Note 3, we also discuss the impact of a smart testing strategy in the early stages
of spreading in New York City (NY, USA).

Smart testing in the state of Sao Paulo

Sao Paulo is the largest and richest state of the Brazilian federation and declared full statewide social-distancing measures in late March, 2020. By the end of September, the government-driven testing infrastructure could perform daily
COVID-19 RT-PCR tests at the rate of 750 per million inhabitants, which is about 50% of the capacity of most European countries. Thus, whether such a low per capita testing rate can help to reduce transmission is unclear. The
healthcare system in Brazil is organised into local health administrative areas composed of several closely situated
cities that share an ICU bed administration system to facilitate allocation. For our study, Sao Paulo state was divided
into 22 local health care areas, and we estimated the flow of inhabitants travelling between them by using geolocalised
mobile phone data between cities. Combined with demographic information, these datasets enable interactions between areas to be described in the context of COVID-19 spreading. The location of the administrative areas in Sao
Paulo state are presented in Figure 1, along with snapshots of the actual epidemic trajectory and actual ICU occupancy
on the first day of our study, which spanned approximately 390 days between July 1, 2020 and July 31, 2021.

The disease evolution within the state is captured by the epidemiological model in Figure 1. At any given time,
inhabitants are considered to be in one of five states: susceptible (green), incubating (pink), infected (red), quarantined
(blue), and recovered (grey), and possible transitions between these states are also indicated in Figure 1. During
working hours, the flow of workers commuting into (or out of) the ith city can increase or decrease the effective

5

population compared with the city’s stable resident population. Other than those in quarantine, we assume individuals
continue with their daily commutes between cities. See Methods and references therein for further details.

Figure 1: Smart testing input data for the distribution of COVID-19 test kits for Sao Paulo state. (a) The geographical outline
of Sao Paulo state is shown with a complex network of scattered local hubs created by daily commuting between cities. Sao Paulo
city is shown as the red circle. The model integrates the mobility and demographic data shown in (a) together with the dynamics
of ICU bed occupancy (b) and the epidemic trajectory (c), for each local health administrative area shown in the maps. The
optimisation framework can curb disease spreading by coordinating social-distancing measures and test distribution. (d) Within
each city, inhabitants are considered to be in one of five states: susceptible (S, green), incubating (E, purple), infected (I, red),
quarantined (Q, blue), and recovered (R, grey). If the local health administrative area has been targeted for testing, inhabitants with
COVID-19 symptoms who seek healthcare are isolated, tested, and only allowed to leave quarantine if the test result is negative
or they regain health. (e) By optimising the distribution of tests together with targeted social-distancing measures, we succeed in
alleviating the burden on the healthcare system and at the same time allow relaxing of travel restrictions throughout the whole state.

The model assumes the basic reproductive number with sanitary measures is r0 = 1.8 (the value observed for

6

the second wave in Germany [11]). We provide full model details and the parameter values in Methods. Supplementary
Note 2 explains the calibration process. We assume that (i) individuals with COVID-19 symptoms seek healthcare and
receive the RT-PCR test (if that local health administration is currently testing); (ii) the success detection probability
of the test is 80% [11]); (iii) individuals seek healthcare within 3 days after they become infectious (τ = 3); (iv) tested
individuals await the test result in isolation and are allowed to leave quarantine only if the test result is negative or
they regain health, in which case they join the recovered compartment; and (v) the proportion of false positive tests
(uninfected individuals who tested positive) is negligible and has no impact on our results.

The model assumes the basic reproductive number with sanitary measures is r0 = 1.8 (this is the value for the
second wave in Germany [11]). We provide full model details and the parameter values in Methods. Supplementary
Note 2 explains the calibration process. It is considered that individuals with SARS symptoms seeking the healthcare
system take the RT-PCR type test if the local health area has been targeted for testing. We assume that the tests have
an efficiency of 80%, that is, 80% of infected individuals can be detected [12]. We also assume that individuals seek
health assistance τ = 3 days after they become infectious. Tested individuals wait for the result in isolation and are
only allowed to leave quarantine either if the result is negative or once healthy again (in both cases, they join the
recovered compartment). The size of the contingent of uninfected individuals who tested negative is negligible and
has no impact on our results.

Our key proposal is to coordinate social-distancing measures with the geographical and temporal distribution of
tests. The base case, taken as reference, considers the evolution of the viral transmission rate if no tests are performed
and the sole mitigation measure is social distancing [13].

i
In the absence of tests, we compute rno
test (t), the maximum value that the reproduction number attains while
i
keeping ICU occupancy below 90% of the capacity in the ith area. When rno
test (t) = r0 , the basal reproduction
i
number of the new normal, there are no travel restrictions. Next, we compute the reproduction number rtest
(t) of an

area under a testing protocol. If testing reduces the need for mitigation measures (i.e., relaxing mobility restrictions

7

without burdening the healthcare system), then
i
i
rtest
(t) > rno
test (t)

(1)

i
When the computed values of rtest
(t) remain close to r0 , this means that testing alone is sufficient to control transmis-

sion. However, this is still dependent to a large extent on the history of ICU occupancy and the time between infection
and receiving a positive test result. We will address this scenario later by analysing synergy between smart testing and
bed sharing.

To compare different strategies, we define the efficiency of a testing protocol as follows. Given the reproduci
(t) of the ith local health area under a testing protocol at time t, improvement (i.e., openning of
tion number rtest

nonessential services) due to testing can be measured in terms of an increase in the reproduction number, relative to
i
i
i
i
(t) − rno
the base case, without testing: (rtest
test (t))/rno test (t). These values are weighed by the population N of

the local health area with respect to N state , the state population, so that the efficiency
i



µ (t) =


i
rtest
(t)
Ni
−
1
i
N state
rno
test (t)

(2)

will be positive if testing improves mitigation measures in the ith area at time t. It might happen that µi (t) < 0 for
a particular day t. However, the goal of the smart testing strategy is to increase the reproduction number of the state
as a whole. Therefore, we introduce the efficiency q for the state. Suppose that K represents all regions and that the
testing protocol was conducted during D days, totalling M months. The overall efficiency of the testing protocol is
the mean of the individual efficiencies, averaged over the regions and months:
q=

D
1 XX i
µ (t) .
M
t=1

(3)

i∈I

In our calculations, each protocol is applied for M = 6 months and D is about 183. Since µi (t) was weighted by the
population, the overall efficiency q requires no further normalisation.

We assume that the state of Sao Paulo performs 750 tests per million inhabitants per day. Under this cap we
compare three scenarios: (i) smart testing; (ii) testing on demand; that is, the number of tests is proportional to the
percentage of infected individuals in the local population; and (iii) testing only in large urban hubs. The last two
8

configurations capture nonlinear effects induced by the concentration of the economic infrastructure in the large cities,
which forces a large portion of the population to commute to work daily.

Figure 2 summarises our results. Testing in all three scenarios leads to improvement; however, the efficiency q
of testing only in hubs and testing on demand are both 35%, whereas the efficiency of smart testing is vastly superior
at 65%.

Nonlinear collective effects of smart testing

Testing on demand places the greatest pressure on the hubs such as Sao Paulo city, where the majority of cases are
concentrated (Figure 2d-f), whereas smart testing exploits the mobility network and finds optimal solutions that require
virtually no testing in the hubs (Figure 2a-c). Instead, the smart strategy focuses on testing key areas while considering
ICU occupancy. Remarkably, this strategy leads to an efficiency in the main hub Sao Paulo city as high as when only
the hubs are tested. A notable effect of smart testing is that it synergistically generates a collective improvement in the
efficiency of testing for the whole state. This results from exploiting the mobility between local health areas and the
nonlinear effects emerging from the different stages of the evolution of the disease across the state. It is also striking
that the decisions taken with smart testing are not straightforwardly explained by mobility alone.

Sharing ICU beds and smart testing

We now focus on a pressing societal issue by analysing whether it is possible to reduce or eliminate social distancing
control measures, which often leads to the re-emergence of infectious diseases [14]. Here, we aim to control disease
spreading after relaxing social distancing by deploying smart testing and coordinated ICU bed sharing alone.

Starting from July 1, 2020, we impose mitigation measures for 140 days and then compare the epidemic trajec-

9

Figure 2: Effects of testing under different test distribution protocols in the state of Sao Paulo. The three protocols have a maximum
capacity of 750 daily tests per million inhabitants. Sao Paulo city is highlighted with thickened borders in all insets. The panels
show the efficiency µi (t) results for local health area (a, d, g), the number of tests per million inhabitants per month (b, e, h), and
the total number of tests sent to each area in a 6-month period (c, f, i) for the three protocols: smart testing protocol (a, b, c),
on-demand protocol (d, e, f), and hub-only protocol (g, h, i). The numbers on the left report the efficiency q for the entire state. The
green colour code indicates efficiency µi (t) in (a, d, g), tests per million in (b, e, h), and total tests performed in each area in (c, f,
i) in a period of six months. Note that testing on demand concentrates the tests in Sao Paulo city, while smart testing focuses on the
nearby neighbouring regions with little to no testing in Sao Paulo city. Even in this scenario, however, the efficiency in Sao Paulo
city is high. Indeed, efficiency is high throughout the state, indicating that exploiting the network structure with testing coordination
is beneficial for the entire state.

tories for the subsequent 250 days in two new normal scenarios; one in which all distancing restrictions are removed
(while considering sanitary measures), and one in which social-distancing restrictions are removed and control occurs
through smart testing alone. In the social-distancing alone scenario, full capacity of the healthcare system is reached
within 30 days and saturation is maintained for nearly 2 months thereafter.

10

For the smart testing alone scenario, we simulated the number of tests required to control spreading. For τ = 3,
testing alone cannot control spreading of the virus without overwhelming the healthcare system. See further details in
Supplementary Note 4.

Next, we consider τ = 1; that is, when infected individuals are identified and isolated 1 day after they become
infectious. Note that such early detection of cases would require adoption of new technologies [15]. In this scenario, a
daily cap of 5000 tests per million inhabitants suffices to control spreading, as shown in Supplementary Note 4. This
number is about 7-fold higher than the actual state testing capacity; nevertheless, this number of tests per day alone
would contain disease spreading, thus protecting the healthcare system.

For the state of Sao Paulo, however, there are some nuances that deserve a more detailed analysis. The city
of Sao Paulo and its metropolitan area is home to about 50% of the state’s population but harbours about 70% of the
state’s ICU beds. In this situation, pooling and sharing of ICU beds can be effective. Additionally, as in many other
countries, the disease evolution in Sao Paulo state has not been uniform. The first cases were detected in the city of
Sao Paulo in late March, almost 2 months before it began to spread to the rest of the state. As a result, by the time the
case rate was peaking in rural areas, the rate was stabilising in Sao Paulo city (see more information in Supplementary
Note 4).

Based on the low daily test capacity and the temporal lag between disease emergence in Sao Paulo city and
the interior regions, the smart testing strategy would suggest that testing in rural areas can begin later than in the
metropolitan area. Our experiments show that, even allowing for the lag in regional transmission, increasing the daily
test capacity up to 7-fold would still be insufficient to prevent the overload of the health system. Thus, a mechanism in
which ICU beds are shared between Sao Paulo city and hospitals in the state interior might offer a potential solution.
Indeed, we observe a significant improvement in the ICU usage when simulating a partnership between hospitals to
share ICU beds for exclusive use by patients with suspected or confirmed COVID-19 infection [16, 17].

The three macro regions of Sao Paulo state to be considered are: Sao Paulo city (population 11.9 million), Sao

11

Paulo metropolitan area (9.4 million), and the interior of the state (23 million), which account for 27%, 21%, and 52%
of the state’s population, respectively (Figure 3a). Under normal conditions, there are 4310 ICU beds in Sao Paulo
state, of which 80%, 11%, and 9% are located in Sao Paulo city, the metropolitan area, and the interior, respectively.
Considering this unequal distribution of total ICU beds available, we assume that (i) only ICU beds in Sao Paulo city
are shared with the other two regions, which reduces the ICU capacity for Sao Paulo city itself; and (ii) the mechanism
of ICU bed allocation from Sao Paulo city to the other two regions is based on demographic data. Thus, under the
ICU bed sharing agreement, 71.2%, 13.4%, and 15.4% of the total ICU beds are available for Sao Paulo city, the
metropolitan area, and the interior, respectively (Figure 3b, c).

In this ICU bed sharing scenario, smart testing with a low daily cap of 750 tests per million inhabitants suffices
reduce a peak in the ICU usage for the metropolitan area. For the interior area, having shared beds is more relevant
than testing, resulting in a 50% increase in the ICU capacity. Thus, combining smart testing and ICU bed sharing
to accommodate the heterogeneous infrastructure of the state is not only beneficial to prevent the overload of the
healthcare system but can control disease spreading without additional social-distancing measures.

The results reported in Figure 3 were obtained under the premise that susceptible individuals seek healthcare
assistance and are tested by RT-PCR τ = 1 day after experiencing symptoms. If, in contrast, there is a delay of τ = 3
days between symptom emergence and testing, our simulations show that testing and ICU bed sharing combined will
not be sufficient to halt disease spreading. In other words, if τ = 3, restricting travel becomes mandatory. This analysis
is in agreement with the efforts being made worldwide to urgently deploy rapid and reliable COVID-19 tests [18].

Discussion

Control of COVID-19 transmission in low- middle-income societies has been hampered by a scarcity of key resources,
including ICU beds, RT-PCR kits, and qualified testing facilities. Although the imminent arrival of effective SARS-

12

Figure 3: Sharing of ICU beds and smart testing can control the spread of COVID-19 without restricting travel. (a) The three
macro regions in the state of Sao Paulo are shown: Sao Paulo city (blue), metropolitan area (white), and rural/interior region (grey).
(b) The original distribution of the 4310 ICU beds in Sao Paulo state in each of the macro regions. (c) Redistribution of ICU beds
after sharing. (d-f) ICU bed occupancy in the three macro regions under the smart testing protocol (blue lines) and without smart
testing (grey dotted lines). The shaded rectangular areas represent the ICU bed capacity before and after implementation of bed
sharing: 12% loss in Sao Paulo city (d), 18% gain in the metropolitan area (e), and 70% gain in the interior (f). The reduction
is acceptable for Sao Paulo city, which remains far below maximum local ICU occupancy. The yellow areas show the shared ICU
bed use when the testing capacity is 750 daily tests per million inhabitants, and the red areas show the deficit in ICU beds in the
metropolitan area when no smart testing is implemented.

Cov-2 vaccines is expected to reduce transmission, it is unlikely that they will be distributed worldwide until the end
of 2021. In the meantime, vaccination distribution strategies will initially focus on reducing morbidity and mortality
of key subpopulations (healthcare workers and older adults) while maintaining the most critical essential services
(healthcare workers engaged in vaccine delivery, teachers, and school staff). Assuming these expectations are satisfied,
smart testing strategies of vulnerable populations remain our best hope to curb COVID-19 transmission and preserve
the economic health of these societies.

The World Health Organization first called for massive COVID-19 testing in March 2020, and in line with this,

13

we analysed the effect of smart testing in the state of Sao Paulo, Brazil. Our study explored how smart testing can
assist in reducing transmission despite challenges due to a low daily testing capacity, unequal healthcare infrastructure,
and the evolution of COVID-19 in different areas of the state. Under these adverse conditions, it is critical that we
determine how best to handle test distribution in terms not only of where to send kits but also how many and when. To
be most effective, these scarce testing resources must be properly deployed. As described in this study, we proposed a
smart testing strategy based on mathematical optimisation of test distribution and compared its effectiveness with that
of other mitigation protocols.

In all of the configurations considered, the contribution of testing to control of COVID-19 was significant. Interestingly, the smart testing option was far superior to the on-demand testing and hub-only testing scenarios, reaching
an efficiency of 65% compared with 35%. This level of improvement was obtained by considering travel patterns,
the state infrastructure, local heterogeneities in disease spreading, and stress imposed on different regional healthcare
systems. Our analysis highlights the importance of tests that can deliver results rapidly and also reveals that, even
with rapid and reliable testing, not all surges in infection could be controlled by increasing the number of daily tests
alone, and that an ICU bed sharing policy may be necessary, especially if daily testing capacity is low. The results and
conclusions of this study are robust across models.

By employing data integration and optimisation over a complex network, smart testing provides a striking
improvement in the quality of transmission mitigation measures, thereby allowing populations to more rapidly return
to pre-pandemic activities. The methodology is applicable to any country facing similar challenges of limited testing
capabilities and a highly mobile workforce. The approach can also be easily adapted to accommodate new waves
of spreading, and can incorporate more precise medical data on the mechanism of COVID-19 transmission as that
becomes available.

In countries such as Brazil, where control of the pandemic is in the hands of local state and city administrations
rather than the federal government, some relatively affluent cities invested heavily in testing as a means to curb local
transmission. This effort was in vain, however, and our analysis using smart testing delivers a strong message; namely,

14

it is better for all citizens if resources are shared with neighbours, and efforts to reduce transmission at individual and
local levels are not nearly as effective as collective strategies that concomitantly address all regions. The superiority of
smart testing is clear in multiple scenarios, such as financial investment in test kits, stress on the healthcare system, and
stress on the population due to restrictive social-distancing measures and travel limitations. It is notable that targeted
and orchestrated solutions such as smart testing represent a sharp contrast to the local-level solutions currently being
implemented in many countries.

Methods

An SEIQR model with mobility

We use the same notation as in [13]. Suppose there are k areas gathered in a set I, the time horizon being defined by
initial and final times T0 and T1 . The epidemiological state of an area is characterized by compartments, of Susceptible,
Exposed, Infected, Quarantined, and Recovered individuals, considered as percentages of the total population in each
area.

The coefficient α(t) ∈ [0, 1] weighs the portion of the considered time t that corresponds to the time spent
outside their home city, so α(t) = 1/3. Moreover, r(t) ∈ [0, r0 ]K ⊂ RK is the disease reproduction number, while
Tinc and Tinf are the incubation and infection periods. For each area i, given an initial condition at time T0 the disease
evolution during the night is described by the classical SEIQR model [13].

We model mobility by incorporating the impact of commuting. First, for those nodes with values ri (t) is smaller
than the natural reproduction number of the disease without intervention, it is reasonable to assume that inbound travel
will be discouraged, say by a factor ζ i ∈ [0, 1]. Letting N i represent for the total population of node i, this is reflected

15

by the entries of the effective mobility matrix and the effective population, defined by
pki (t) := ζ i ri (t)pki

and

Ni (t) :=

X

pki (t)N k

for i ∈ I ,

(4)

k∈I

respectively. We consider ζ i = 1, which is the worst case and captures the fact that symptoms might appear after the
individual becomes infectious [19]. Our simulations show that the results are stable in a range ζ ∈ [0.8, 1].

Commuting modifies the population circulation, thus, we consider the products
pij (t)Si (t)Ij (t) ,

(5)

where:
Ij (t) :=

1
Nj (t)

X

pkj (t)Ik (t)N k

for j ∈ I .

(6)

k∈I

Next, consider
Fi =

α(t) i
(1 − α(t)) X j
r (t)Si (t)Ii (t) +
r (t)pij (t)Si (t)Ij (t)
Tinf
Tinf

(7)

j∈I

Notice that Fi is a nonlinear function of the state variables. Putting all these parameters together gives the following
ordinary differential equations:
Ṡi (t)

= −Fi

Ėi (t)

= Fi −

İi (t)

=

Q̇i (t)

=

Ṙi (t)

=

(8)

1 i
E (t) .
Tinc
1
λi i
1 i
E−
I −
I
Tinc
Tinf
Tinf
λi i
1 i
I −
Q
Tinf
Tq
1 i
1 i
I +
Q .
Tinf
Tq

(9)
(10)
(11)
(12)

The evolution depends on λi (t), which determines the fraction of individuals identified as infectious when testing in
the ith area at time t, supposing they are quarantined for Tq days (we assume Tq = 3Tinf ).

In practice, all patients with SARS need to be isolated thus going to the compartment Q while they wait for
the test results. However, because of the initial conditions, at any given time S  I, and the amount of susceptible
individuals in the Q compartment is negligible when compared to the total susceptible population. Thus, we shall
16

model the entry of infected individuals only in the Q compartment. In Supplementary Note 6, we discuss a variant
of the model where the quarantine is captured as the time delay system of equations leading to effective reproduction
number. We show that the results are robust across these models.

Effects of testing on λ

To determine λi (t), we note that out of the Ssars individuals with COVID-19 symptoms who seek attention in the
health care system, only C individuals will be infected with COVID-19 (with our data,

C
Ssars

= 1/4). As a result, if

there are #T i (t) tests performed in the ith area at time t and τ is the time in days elapsed between becoming infectious
and seeking assistance, then the fraction of detected individuals is
λi (t) = ηe−τ /Tinf

σ i (t)
,
N i Ii (t)

where η = 0.8 is the efficiency of the tests and where we shortened σ i (t) =

(13)
C
i
Ssars #T (t).

Other test-related constraints

are
0 ≤ #T i (t) ≤ σeτ /Tinf N i Ii (t)
and the relations

P

i,t

#T i (t) = Ttot

and

(14)

i
, respectively limiting the total number of tests employed
#T i (t) ≤ Tcap

in the campaign, and setting the daily cap for each area.

Table with Parameters

Critical care beds occupancy

The solution procedure discretises the functional states (S, E, I, R, Q) and controls (r, #T ) into vectors. For the infected
individuals in particular, this means that I(t) is replaced by a vector with components Iit for i ∈ I the set of areas, and
t ∈ {T0 , T0 + 1, . . . , T1 }, covering the days in the study (T1 − T0 = 390 days in our runs).
17

Parameter

Definition

Value

Ref.

ζ

% of infected individuals who can commute

0.8-1

λ

% of infected individuals who go to quarantine

Tinf

Mean infectious time

2.9 days

[20]

Tinc

Mean incubation time

5.2 days

[20]

Tq

Mean quarantine time

3 Tinf

σ

% of SARS patients with COVID-19

1/4

[21]

η

Test efficiency

0.8

[22, 23]

τ

Time considered infectious before isolation

1 − 3 days

Eq. (13)

We set a probabilistic constraint for the use of ICU beds in each area, considering that the percentage of infected
population that needs intensive care at time t is uniform across the local health area. Based on the structure of the
considered uncertainty, the constraint can be cast into a deterministic equivalent reformulation. The procedure is
explained in details in [13], we just mention a few key points here.
vti
t
X

Bed usage is estimated from the ratio

, where the numerator, a known data, is the capacity constraint
Iik

k=t−ν

vti for the ith health area at time t. The denominator, an accumulation of sick individuals over ν days prior to t,
represents the group among which a fraction may need critical care attention. Following [24], the average number of
days infected individuals typically spend in the ICU is ν ∈ [7, 10] and we use ν = 7 in our model.

The ratio stochastic process is then approximated by a time series, whose parameters are calibrated using
historical records of intensive care unit beds and new infected individuals in the region. With our data, the best fit was
an autoregressive model of lag 2. Consequently, the ratio is approximated by
icut (ω) = c0 + c1 t +

2
X

φj icut−j + ωt , where ωt ∼ iid N (0, σω2 ) .

(15)

j=1

In this expression, the white noise ωt a random variable that is independent and identically distributed according

18

to a normal distribution with zero mean and variance given by σω2 . After calibration, the values for the parameters
c0 , c1 , φ1 , φ2 , σω are known and can be used to make explicit the following constraint
"
#
t
X
i
i
P icut (ω)
Ik ≤ vt ≥ 0.90 ,

(16)

k=t−ν

ensuring the local hospital capacity will not be exceeded, with 90% probability. The explicit deterministic equivalent
formulation of this chance constraint is an affine constraint on I, involving the inverse cumulative function of the
standard Gaussian distribution, we refer to [13] for the complete development.

Optimising on Complex Networks

Along the time horizon defined by the given initial and final times T0 and T1 , having K = 22 administrative health
districts under consideration, the epidemiological state of the region at time t is characterised by the vector function
x(t) = (S, E, I, Q, R)(t) ∈ [0, 1]5×K , for t ∈ [T0 , T1 ].

(17)

As mentioned, the discretisation of the SEIQR system of differential equations is performed using a central finite
differences scheme; see [13]. For Sao Paulo state specifically, this amounts to approximate the state function x(t)
by a large-scale vector; for instance the component S(t) is replaced by Sit for i ∈ I = {1, . . . , K = 22} and t ∈
{1, . . . , 390}, and similarly for the control ri (t) and other variables, including the number of tests performed in each
area, #T i (t). Accordingly, given the initial state x0 and the basal reproduction number r0 = 1.8, the mathematical
optimization problem to be solved is a large-scale nonlinear program in the form

390
X



min
ψt (rt )


 rti ∈[0,r0 ]

t=1










s.t.

(x, r)
x

satisfies the discretized SEIQR in Methods

(18)

satisfies constraints on testing and ICU beds .

The objective function ψt depends on rt = (rt1 , . . . , rtK ), and it can assess the control performance combining
X
several terms. In our simulations we used the simple expression ψtMaxCirc (rt ) =
wi (r0 −rti ) that ensures maximal
i∈I

19

circulation for given weights wi proportional to the areas’ population. Finally, following the public policy in Sao Paulo
state, changes in the controls rti of each city are only possible every 2 weeks.

Acknowledgements. This work was supported by CEMEAI, the Center for Research in Mathematics Applied
to Industry (FAPESP grants 2013/07375-0 and 2015/04451-2), by the Royal Society London, by the Brazilian National
Council for Scientific and Technological Development (CNPq; grants 301778/2017-5, 302836/2018-7, 304301/20191, 306090/2019-0, 403679/2020-6) and by the Serrapilheira Institute (Grant No. Serra-1709-16124).

Data Availability. All relevant data are available from the corresponding author upon request.
Code Availability. Input files or sets of input parameters as well as the codes are available in https://github.
com/pjssilva/Robot-dance.
Author contributions. PJSS developed the code and made calibration and the simulations. CS developed the ICU
analysis. TP, CS, PJSS performed the data analysis. TP, LGN and MC prepared the figures. PJSS, TP, CS, CJS designed the research and wrote the manuscript.
Competing interests. The authors declare no competing interests.

References
[1] Fundação SEADE - Boletim Coronavı́rus. https://www.seade.gov.br/coronavirus/.
[2] Coronavirus Resource Center. https://coronavirus.jhu.edu/.
[3] de Souza, W. M. et al. Epidemiological and clinical characteristics of the COVID-19 epidemic in Brazil. Nature
Human Behaviour 4, 856–865 (2020).
[4] Roser, M., Ritchie, H., Ortiz-Ospina, E. & Hasell, J. Coronavirus Pandemic (COVID-19). Our World in Data
(2020).

20

[5] Ferretti, L. et al. Quantifying SARS-CoV-2 transmission suggests epidemic control with digital contact tracing.
Science 368 (2020).
[6] Amaku, M. et al. Modelling the test, trace and quarantine strategy to control the covid-19 epidemic in the state
of são paulo, brazil. Infectious Disease Modelling (2020).
[7] Candido, D. S. et al. Evolution and epidemic spread of SARS-CoV-2 in Brazil. Science 369, 1255–1260 (2020).
[8] Chang, S. et al. Mobility network models of COVID-19 explain inequities and inform reopening. Nature 1–6
(2020).
[9] Chang, S. L., Harding, N., Zachreson, C., Cliff, O. M. & Prokopenko, M. Modelling transmission and control of
the COVID-19 pandemic in Australia. Nature Communications 11, 5710 (2020).
[10] Dehning, J. et al. Inferring change points in the spread of COVID-19 reveals the effectiveness of interventions.
Science 369 (2020).
[11] COVID-19 in Deutschland. https://www.rki.de/DE/Home/homepage node.html.
[12] Vandenberg, O., Martiny, D., Rochas, O., van Belkum, A. & Kozlakidis, Z. Considerations for diagnostic
COVID-19 tests. Nature Reviews Microbiology 1–13 (2020).
[13] Nonato, L. G., Peixoto, P., Pereira, T., Sagastizábal, C. & Silva, P. J. S. Robot Dance: A mathematical optimization platform for intervention against Covid-19 in a complex network. Tech. Rep., Optimization Online
(2020).
[14] López, L. & Rodó, X. The end of social confinement and COVID-19 re-emergence risk. Nature Human Behaviour 4, 746–755 (2020).
[15] Quer, G. et al. Wearable sensor data and self-reported symptoms for COVID-19 detection. Nature Medicine 1–5
(2020).
[16] Entenda como é feita a gestão de leitos de UTI em SP durante a pandemia. Governo do Estado de São Paulo
(2020).
21

[17] São Paulo estuda deixar de usar leitos privados. R7 (2020-06-30-0308:14:00-10800).
[18] Sheridan, C. Coronavirus testing finally gathers speed. Nature Biotechnology (2020).
[19] Lauer, S. A. et al. The Incubation Period of Coronavirus Disease 2019 (COVID-19) From Publicly Reported
Confirmed Cases: Estimation and Application. Ann Intern Med 172, 577–582 (2020).
[20] Wu, J. T., Leung, K. & Leung, G. M. Nowcasting and forecasting the potential domestic and international spread
of the 2019-nCoV outbreak originating in Wuhan, China: A modelling study. The Lancet 395, 689–697 (2020).
[21] Barbosa, A., Oliveira, K., Lira, S. & Vieira, T. Um modelo de planejamento e execução do combate da evolução
da COVID-19 à nı́vel municipal baseado em dados e prevenção. Tech. Rep., Universidade Federal de Alagoas
(2020).
[22] Sethuraman, N., Jeremiah, S. S. & Ryo, A. Interpreting Diagnostic Tests for SARS-CoV-2. JAMA 323, 2249
(2020).
[23] Liu, R. et al. Positive rate of RT-PCR detection of SARS-CoV-2 infection in 4880 cases from one hospital in
Wuhan, China, from Jan to Feb 2020. Clinica Chimica Acta 505, 172–175 (2020).
[24] Noronha, K. V. M. d. S. et al. Pandemia por COVID-19 no Brasil: análise da demanda e da oferta de leitos
hospitalares e equipamentos de ventilação assistida segundo diferentes cenários. Cadernos de Saúde Pública 36
(2020).

22

