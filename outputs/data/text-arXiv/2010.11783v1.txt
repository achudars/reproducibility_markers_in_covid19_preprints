Efficient Bayesian inference of fully stochastic epidemiological models with
applications to COVID-19
Yuting I. Li,1 Günther Turk,1, ∗ Paul B. Rohrbach,1, ∗ Patrick Pietzonka,1, ∗ Julian Kappler,1, ∗
Rajesh Singh,1, ∗ Jakub Dolezal,1, ∗ Timothy Ekeh,1 Lukas Kikuchi,1 Joseph D. Peterson,1
Austen Bolitho,1 Hideki Kobayashi,1 Michael E. Cates,1 R. Adhikari,1 and Robert L. Jack1, 2
1

arXiv:2010.11783v1 [stat.ME] 21 Oct 2020

Department of Applied Mathematics and Theoretical Physics,
University of Cambridge, Wilberforce Road, Cambridge CB3 0WA, United Kingdom
2
Department of Chemistry, University of Cambridge,
Lensfield Road, Cambridge CB2 1EW, United Kingdom
Epidemiological forecasts are beset by uncertainties in the generative model for the disease, and
the surveillance process through which data are acquired. We present a Bayesian inference methodology that quantifies these uncertainties, for epidemics that are modelled by (possibly) non-stationary,
continuous-time, Markov population processes. The efficiency of the method derives from a functional central limit theorem approximation of the likelihood, valid for large populations. We demonstrate the methodology by analysing the early stages of the COVID-19 pandemic in the UK, based
on age-structured data for the number of deaths. This includes maximum a posteriori estimates,
MCMC sampling of the posterior, computation of the model evidence, and the determination of parameter sensitivities via the Fisher information matrix. Our methodology is implemented in PyRoss,
an open-source platform for analysis of epidemiological compartment models.

I.

INTRODUCTION

The ongoing COVID-19 pandemic has demonstrated
the vital importance of epidemiological forecasting [1–6].
Given the large uncertainties in the mechanisms of viral transmission, and the difficulties in determination of
numbers of infections and deaths, a Bayesian approach
is natural [7–11]. This allows the range of likely outcomes to be quantified and characterised. The evidence
in favour of different epidemiological models can also be
assessed, in the light of data.
Compartment models are widely used as models of epidemiological dynamics [12–14]. Within these models, individuals are grouped into cohorts, for example according
to their age or location. The key assumption is that the
rates of contact between individuals depend only on their
cohorts. The resulting models have sufficient complexity
to be useful in forecasting, while remaining simple enough
that Bayesian analyses are tractable [8–10, 15].
Such analyses require three main ingredients: the definition of a model, the prior distributions of the inference
parameters, and an efficient method for the evaluation of
the posterior distribution [12, 16–20]. In this work, we
derive the model likelihood directly from the model definition, via a functional central limit theorem (CLT) [21–
25]. Hence, for any given model, the likelihood can be
derived by a generic and automated procedure. This enables rapid Bayesian fitting of models to data with fully
quantified uncertainties, as implemented in the PyRoss
package [26]. It also enables sampling from the posterior
by Markov chain Monte Carlo (MCMC), and the evaluation of model evidence [27–29], so that models may be

∗ Contributed

equally

compared by their posterior probabilities. The results
presented here build on an earlier technical report [10]
which discussed automated fitting of such models to data.
In any Bayesian calculation of this type, the choice of
likelihood function makes assumptions (either implicit or
explicit) about the role of random fluctuations in the disease propagation and the surveillance of the epidemic.
In the models that we consider, both the disease dynamics and the surveillance (data collection) processes
are encapsulated in a single compartment model. It follows that our Gaussian approximation for the likelihood
is accurate in the limit where the epidemic is spreading in a large well-mixed population [21–25] – in this
sense, it accounts for all sources of stochasticity within
the model. Another common approach is to consider a
deterministic generative model for the disease, and to
treat the data collection (surveillance) as a stochastic
process [7, 9, 15, 30]. These approaches have different
strengths and weaknesses, which are discussed below.
This article describes the Bayesian methodology that
we use, including definitions of the relevant models
(Sec. II) and the specification of the data and likelihood
(Sec. III). The inference methods are summarised in
Sec. IV. As proof of principle for our approach, we perform inference on a compartment model for the COVID19 epidemic in England and Wales, over the period 6March to 15-May 2020, using data for the number of
deaths. A more detailed picture of the epidemic would
be available by combining multiple data sources, but the
computation that we present is appropriate as an illustration of the general methodology. We compare several
variants of the model, which differ in their assumed contact structure; we also compare the model evidence [27–
29] for the different variants. The models are defined in
Sec. V, while Sec. VI shows the results. We conclude
with a discussion in Sec. VII. Some technical details and

2
supplementary results are provided in appendices.

II.

B.

COMPARTMENT MODELS
A.

Definition

Consider a compartment model where N individuals
are grouped into M cohorts, according to some attributes
(for example age and/or gender). Each cohort is divided
into L epidemiological classes, indexed by ` = 1, 2, . . . L.
We assume a single susceptible class, which is ` = 1.
Other classes may be either infectious or non-infectious:
the canonical example is an SIR model which corresponds
to L = 3, in which case the recovered (R) class is noninfectious.
In the general case, the total number of compartments
is M × L and the state of the system can be specified as
a vector
n = (n1 , n2 , . . . , nM ×L ) .

(1)

We use boldface notation throughout this work to indicate both vectors and matrices. Each element of n is a
non-negative integer, such that the number of individuals in class ` and cohort i is ni+M (`−1) . For example
n1 , . . . , nM are the number of susceptible individuals in
each cohort.
The disease propagation involves individuals moving
between the epidemiological classes, by a Markov population process [31]. (Models may also include immigration
or emigration steps where the total population changes.)
The parameters of the model are θ = (θ1 , θ2 , . . . ), indexed by a label a. The various stochastic transitions
are indexed by ξ = 1, 2, . . . . In transition ξ, the population n is updated by a vector rξ with integer elements,
that is
n → n + rξ

with rate

wξ (t, θ, n) .

(2)

For example, if transition ξ involves a single individual
moving from compartment α to compartment β then rξ
has −1 in the α-th place and +1 in the β-th place, with
all other elements being zero. Consistent with the Markovian assumption, the rate wξ (t, θ, n) depends on the current state, the parameters of the model, and the time t.
Two common types of transition are infection, and progression from one stage to another. For example, in the
simple SIR example (with M = 1) we write (n1 , n2 , n3 ) =
(S, I, R) with total population N = S +I +R. Taking infection and recovery parameters as θ = (β, γ), the infection transition has r1 = (−1, 1, 0) and rate w1 = βSI/N ,
while progression for I to R has r2 = (0, −1, 1) and
w2 = γI. The general formalism used here covers simple
SIR models as well as more complex ones, see for example
Sec. V.

Contact dynamics and the well-mixed
assumption

As illustrated by the SIR example, it is a general feature that progression transitions have rates that are linear in n, but infections are bilinear. As usual, we consider compartment models that assume a well-mixed population, in the the sense that the typical frequency of
meetings between individuals depends only on their cohort. These frequencies are described by the contact matrix [12–14, 32], which appears in the rates wξ for infectious transitions (for an example, see Sec. V below).
This well-mixed assumption neglects the detailed social structure of the population, for example that friends
and family members meet each other much more frequently than other individuals. Despite this (coarse) approximation, compartment models are valuable tools for
practical analysis of epidemics, and are useful for inference. Still, it must be borne in mind in the following
that these models are not microscopically resolved descriptions of individuals’ behavior, but rather approximate descriptions that capture the main features of disease dynamics, and its dependence on model parameters.
C.

Average dynamics and law of large numbers

We will be concerned with epidemics in large populations, with the well-mixed assumptions described above.
The relevant limit is controlled by a large parameter Ω.
In models where the total population N is fixed then
Ω = N . If the population is uncertain or subject to
change then Ω is taken as a suitable reference value, for
example the prior mean population at time t = 0. Now
define
1
(3)
x= n
Ω
whose elements indicate the fractions of individuals in
each compartment. Within the well-mixed assumption,
the rates wξ have a specific dependence on Ω:
wξ (t, θ, Ωx) = Ωωξ (t, θ, x)

(4)

where ωξ is the transition rate per individual (as opposed
to the rate for the population).
Given the parameters θ and an initial condition x(0),
models of this form obey a law of large numbers in the
limit of large population Ω → ∞. In this limit, almost
all stochastic trajectories x(t) lie close to a single deterministic trajectory, x(t) [33–36], which can be obtained
as the solution of an ordinary differential equation
dx X
=
rξ ωξ (t, θ, x) .
(5)
dt
ξ

The sum in this equation runs over all possible values of
ξ; we do not write the range explicitly in such cases, for
compactness of notation. Equ. (5) is straightforwardly
solved by numerical methods, so x can be computed.

3
D.

Central limit theorem

The likelihood that we use for Bayesian analysis rests
on a functional CLT [21–25] for fluctuations of the epidemiological state about the mean value x. This is derived for a fixed initial condition x(0). To analyse fluctuations, consider the (scaled) deviation of the epidemiological state x from its average
√
u(t) = Ω [x(t) − x(t)]
(6)
√
with u(0) = 0. (The factor of Ω is standard in CLTs, it
is chosen so that typical trajectories of the model have u
of order unity, as Ω → ∞.) By considering the increment
in u over a short time-interval and taking the limit of
large Ω, one finds [37, Sec 4.5.9] that u obeys a stochastic
differential equation
X
du = J (t, θ, x)udt +
σξ (t, θ, x)dWξ
(7)
ξ

where W1 , W2 , . . . are independent standard Brownian
motions (Wiener processes); our notation suppresses the
dependence of x and u on the time t, for compactness.
The elements of the square matrix J are
Jij (t, θ, x) =

X

rξ,i

ξ

∂
ωξ (t, θ, x)
∂xj

,

(8)

x=x

where rξ,i is the ith element of the vector rξ . Similarly,
q
(9)
σξ (t, θ, x) = rξ ωξ (t, θ, x) .
In the physics literature, the derivation of (7) uses the
van-Kampen expansion [36, 37]; the use of these methods
in population dynamics is due to Kurtz [33–35].
One sees that J and σξ depend on the deterministic
path x but not on the random variable u, so (7) is a
time-dependent Ornstein-Uhlenbeck process. The CLT
applies as Ω → ∞, it states that u has Gaussian fluctuations with mean zero, and a covariance that can be
derived from (7). This result applies to the covariance
at any fixed time, and to correlations between fluctuations at different times. The correlations are discussed in
Appendix A, for example (A6,A8).

We now describe how the observed data are incorporated in our methodology, after which we discuss the likelihood. A technical aspect of our approach is that the
initial condition of the system at time t = 0 must be
parameterised in terms of θ (or explicitly provided).

A.

In practical situations, observations of the epidemiological state are subject to uncertainty. Our methodology
includes all random aspects of the observation (surveillance) process directly into the model. This means that
measured data can be identified with the populations of
certain model compartments; the remainder of the compartments are not observed, and correspond to latent
variables. For example, the model of Sec. V (below) includes an observed compartment for deceased individuals, which should properly be interpreted as a compartment for deceased individuals who were diagnosed with
COVID-19. Other compartments – for example susceptible and infected – are latent variables, which are independent of diagnosis. The measurement process is
then modelled through the (stochastic) transition from
infected compartment to deceased compartment, whose
rate depends on the probability of correct diagnosis.
We assume that observations are made at an ordered
set of positive times, indexed by µ = 1, 2, . . . . Specifically, at time tµ , one observes a vector with mobs elements, which are linear combinations of the compartment
populations at that time. That is,
nobs (tµ ) = F n(tµ )

DATA AND LIKELIHOOD


Y = nobs (t1 ), nobs (t2 ), . . . .

P (data|θ)P (θ)
Z(data)

(12)

This vector corresponds to the data in (10).

Likelihood

The likelihood is denoted by

A central task in Bayesian inference is to compute the
posterior distribution of the parameters θ, given some observational data. The posterior probability density function (pdf) of the parameters is [16–18]
P (θ|data) =

(11)

where F is a matrix of size mobs × (M L), which we call
the filter matrix.
Now define a vector Y that contains all the observed
data, by collecting the individual observation vectors:

B.
III.

Data

(10)

where Z(data) is called the model evidence, which is fixed
by normalisation of the posterior.

L(θ) = P (Y |θ) .

(13)

Hence we require a computationally tractable estimate
of this probability. The formula that we use is based on
the CLT for the path x(t), as discussed in Sec. II D.
Given the parameters θ, the most likely observation is
Y , whose elements are
nobs (tµ ) = ΩF x(tµ ) ,

(14)

4
recall (3,11,12). Define also the (scaled) deviation of the
data from this value,
Y −Y
.
∆= √
Ω

(15)

As in (6), the scaling is such that elements of ∆ are
typically of order unity. In the specific case considered
here, the functional CLT states that the log-likelihood
obeys
log L(θ) ' −


1  T −1
∆ G ∆ + ln det(2πG/Ω)
2

(16)

where the approximate equality is accurate as Ω → ∞,
and G−1 denotes the inverse of a square covariance matrix G, whose form is dictated by the CLT of Sec. II D:
see Appendix A, in particular (A8). Given a compartment model with parameters θ and a filter matrix
F , computation of G requires numerical solution of a
(matrix-valued) ODE.
Compared to the likelihood (16), an alternative is to
use a deterministic model for the disease [8, 9, 11, 15, 30],
with all stochasticity coming from the surveillance (or
data collection) process. In this case the likelihood can
be computed by solving a vector-valued ODE similar to
(5), or a corresponding discrete-time equation. That
approach is computationally cheaper, but it neglects
stochasticity in disease transmission. Alternatively, one
might consider direct evaluation of the likelihood by
MCMC on the stochastic model [19, 38]. This route has
a very high computational cost compared with (16), although it is more accurate than the CLT description in
situations where compartment populations are low. In
this sense, the CLT result is a practical compromise.

IV.

INFERENCE METHODOLOGY

This Section briefly describes the inference methodology, as implemented in PyRoss [10, 26].

A.

Model estimation

The methodology has been implemented for a general
class of compartment models as defined above, including progression and infection transitions. Specifically, if
transition ξ involves progression from compartment α,
one has
wξ (t, θ, n) = γξ (t, θ)nα

(17)

with arbitrary dependence of γξ on the parameters θ and
the time t. For infection reactions, suppose that transition ξ involves a susceptible individual in cohort i being
infected by an individual in some infectious class. Denote
the population of susceptible individuals in cohort i by
Si and the population of individuals in cohort j of the

(k)

infectious class by Ij ; here k is a label for the relevant
infectious class. Then the generic infection rate is
M
X

(k)

Si Ij
wξ (t, θ, n) =
Kξ (t, θ)
Ω
j=1

,

(18)

where Kξ has arbitrary dependence on the parameters θ
and the time t. The form of K depends on the rates of
contacts between cohorts and on various epidemiological
parameters, a specific example is given in Sec. V below.
Once the model is specified, the inference methodology is automated. We outline the method, with details
in Appendix B and [10]. Given the data and some parameter values θ, the (non-normalised) posterior is computed
(up to the normalisation factor Z) by combining the prior
information with (16). This posterior is optimized over
θ using the covariance maximisation evolutionary strategy (CMA-ES) [39], yielding the maximum a posteriori
(MAP) parameters θ ∗ . We also compute the Hessian
matrix of the log-posterior using finite differences.
We consider the Fisher information matrix (FIM) [16],
which measures the information provided by the data
about the inferred parameters of the model. It is a matrix
with elements


∂2
Iab (θ) = −
log L(θ) ,
(19)
∂θa ∂θb
where the angled brackets denote an average over the
stochastic dynamics of the model, with fixed parameters
θ. Recalling (13), this means that one averages over all
possible values of Y according to the model dynamics,
instead of using the observed data. The sensitivity of
parameter a with respect to the (expected) data can then
be estimated as
p
sa = θa∗ Iaa (θ ∗ ) ,
(20)

for more detail see [40, 41]. The FIM is defined as an
average over the stochastic dynamics, but the Gaussian
structure of the likelihood (16) means that the FIM can
be estimated by a deterministic computation, see Appendix B 1.
To go beyond the MAP, we sample the posterior for
θ using MCMC, using the emcee package [42]. We compute the model evidence Z in (10) using thermodynamic
integration, see Appendix B 2. The evidence is useful for
Bayesian model comparison and model averaging [28], an
example of model comparison is given in Sec VI C below.
A given model has high evidence if it can fit the data
accurately with parameters that are consistent with the
prior and do not require fine-tuning. The fit to the data
can be assessed separately via the posterior average of
the log-likelihood Epost [log L], which helps to disentangle
the contributions to the evidence.
B.

Forecasts and nowcasts

Given samples from the posterior, several kinds of forecast and nowcast are possible. The time period over

5

FIG. 1: (a) Epidemiological classes of the example model, with rate constants indicated (the infection rate λi is defined in
Appendix C 1). Here ᾱi = 1 − αi and similarly f¯i = 1 − fi . The coloring distinguishes susceptible, infectious, and non-infectious
compartments. The transition I (1) → R represents rapid recovery of asymptomatic/paucisymptomatic cases, see main text.
(b,c,d) Contact matrices for the different model variants.

which data is used for inference is called the inference
window.
In a deterministic forecast or nowcast, we compute the
average path x(t) for a given set of parameters. This allows prediction of the population of unobserved (latent)
compartments. If this is performed for times t within the
inference window, we refer to it as a nowcast. The path
x(t) can also be computed outside this window, this is a
forecast. By sampling parameters from the posterior, the
range of behaviour can be computed. However, this computation only captures the role of parameter uncertainty,
it neglects the inherent stochasticity of the model.
In a conditional nowcast, we use the functional CLT
to derive a (Gaussian) distribution for the population
of the latent compartments, conditional on the observed
data. Samples from this distribution can be generated,
which allow the role of stochasticity to be assessed, see
Appendix B 3. We emphasise that the nowcast requires
sample paths that are conditional on the data, for times
within the inference window. Such conditional distributions cannot be sampled by direct simulation of the
model, but the functional CLT enables sampling (under
the assumption of large Ω).
Finally, we consider stochastic trajectories that extend
beyond the inference window, which we call a stochastic
forecast. In this case we first use a conditional nowcast
to sample the latent compartments at the end of the inference window, after which we simulate the stochastic
dynamics (by Gillespie [43] or tau-leaping methods [44]).
This yields trajectories of the full stochastic model, with
integer-valued populations. (Contrary to the conditional
nowcast, these sample paths are only conditional on data
from the past. Hence they can be sampled directly, due
to the Markov property.)

V.

COVID-19 IN ENGLAND AND WALES :
MODEL

To illustrate these methods, we analyse a well-mixed
compartment model for England and Wales, using data
published by the Office for National Statistics (ONS),
for numbers of deaths where COVID-19 was mentioned
on the death certificate [45]. We consider the period
6-March to 15-May 2020, which covers the imposition
of lockdown, and the associated peak in weekly deaths.
(The first recorded deaths took place in the week ending
6-March, the lockdown was imposed on 23-March, and
the peak in deaths was in late March and early April.)
In numerical data, time is measured in weeks, starting
from 6-March.
The model uses time-dependent contact structures to
model for a non-pharmaceutical interventions (NPIs),
which includes the lockdown as well as other behavioural
changes (mask wearing, additional hand washing, etc).
For consistency with the well-mixed assumption of the
model, our data excludes deaths taking place in care
homes, since these individuals likely have unusual contacts, which are primarily inside their own institutions.
More precisely, individuals in the model are defined
to exclude care-home residents, and we assume negligible transmission of infection from care homes to nonresidents. (Note, there is no such assumption on transmission in the opposite direction, from non-residents into
care homes.) We also assume (i) that all deaths in care
homes were for individuals aged 75+, and (ii) that the
care-home population is small in comparison to the total, so that the Ni are fixed at the total cohort populations, without being adjusted to exclude care-home residents. These assumptions simplify the model; they are
not perfectly accurate, but we argue that the associated
approximations are negligible compared with the (coarse)
well-mixed assumption discussed in Sec. II B, and the un-

6
certainties in the identification of COVID-related deaths.

A.

Definition and epidemiological parameters

We consider M = 16 age cohorts, which correspond to
5-year age bands from 0-4 to 70-74, and a single cohort
for all individuals of
P age 75+. The population of cohort
i is Ni and Ω =
i Ni . Given the short time period
considered here, we neglect vital dynamics (birth, aging
and death by causes other than COVID-19).
There are L = 8 epidemiological classes, illustrated in
Fig. 1. Susceptible individuals (S) move to the exposed
class E when they become infected. The exposed class
represents the latent period so these individuals are not
infectious; they progress with rate γE to an activated
class A, which is infectious but non-symptomatic. We
sometimes also denote this class by I (0) . From A, all individuals progress to class I (1) , with rate γA . Hence I (1)
includes cases that never develop symptoms, as well as
paucisymptomatic and severe cases. (Paucisymptomatic
cases are defined as those with very mild symptoms, following [46].) These situations are distinguished by their
progression from stage I (1) – the total progression rate
is γ1 , with an age-dependent fraction αi of individuals
(asymptomatic/paucisymptomatic cases) recovering into
class R; the remainder progress to a symptomatic infectious stage I (2) . There is progression from I (2) to I (3)
with rate γ2 . After this, the (total) progression rate from
I (3) is γ3 , of which an age-dependent fraction fi of individuals die (transition to D) while the remainder recover
to R. Hence fi corresponds to the case fatality ratio
(CFR), and the infection fatality ratio is (1 − αi )fi .
Individuals in R are immune, we assume no reinfection
within the period considered in this work. The inclusion
of several infectious stages allows flexibility in the model
as to the distribution of times between infection and recovery or death.
The infection process for cohort i depends on a contact
rate matrix C̃, the susceptibility to infection of that cohort βi , and on how infectious is the infected individual.
The rate for infection of individuals in cohort i by those
in infectious stage k is
wξ (t, θ, n) = βi Si

M
X
j=1

(k)

C̃ij (t)

νk Ij
Nj

Since we only consider data for numbers of deaths, it
is not possible to infer all epidemiological parameters.
For example, the data do not provide information about
absolute numbers of cases, nor on the relative numbers
of symptomatic and asymptomatic cases. For this reason, we fix the α and f parameters to estimated (agedependent) values based on [46]. These estimates are
discussed in Appendix C 2, they are subject to considerable uncertainty, but the resulting model is still flexible
enough to fit the data. All remaining parameters are inferred. The β parameters are age-dependent, all other
epidemiological parameters are assumed independent of
age. As noted above, the initial condition x(0) must be
determined from the inference parameters θ. Details of
this procedure, and full specification of all prior distributions are given in Appendix C 2.
B.

Model variants (contact matrices and NPIs)

We consider a Bayesian model comparison, based on
several variants of the model described above, which differ in their contact structure.
In the absence of any NPI, infective contacts are described by (bare) contact matrices C, such that Cij is the
mean number of contacts per day with individuals in cohort j, for an individual in cohort i. To account for NPIs
we assume that individuals in cohort i have their activities multiplied by a time-dependent factor ai (t) ≤ 1, so
that the mean number of contacts per day during the
NPI is changed to ai (t)Cij aj (t). In the absence of any
intervention then ai = 1. Note also, Cij is a number of
contacts, but the quantity C̃ij that appears in (21) is a
contact rate; hence we take
C̃ij = ηai (t)Cij aj (t)

where η is a basic rate of 1 (day)−1 . Our numerical implementation measures time in weeks, so η = 7 (week)−1 .
We consider three possibilities for the bare contact matrix C, see Fig. 1 and Appendix C 3. Two of the choices
are the matrices proposed by Prem et al [48] and Fumanelli et al [49], which are both based on the POLYMOD study [50]. The third is a simple proportional mixing assumption, which is that individuals meet each other
at random:

(21)

where Si is the population of the relevant susceptible
(k)
compartment, also Ij (t) is the population of the infectious stage for cohort j, and νk is the infectiousness of
stage k. There are separate transitions ξ for infection of
every cohort i, and for every infectious stage k. Comparing (18,21) shows that Kξ (t, θ) = βi C̃ij (t)νk Ω/Nj for
this transition. The choice of contact (rate) matrix is
discussed in Sec. V B, below. The (deterministic) equations that describe the average evolution of this model
are given in Appendix C 1.

(22)

Cij = c0

Nj
Ω

(23)

where c0 is a constant chosen to have a total number
of contacts comparable to that of [48]. We refer to the
resulting contract matrices (and the associated model
variants) as C F , C P , C M for the models of Fumanelli et
al [49], Prem et al [48], and proportional Mixing, respectively. We do not distinguish at all between different
types of contact (for example home, work, school), the
reasons for this are discussed in Sec. VI A, below.
We also consider two possibilities for the NPI parameters ai (t), as shown in Fig. 2. These were chosen to

7
(a)

relative activity

1.25

A.

home
work
transit stations
retail/recreation

1.00
0.75

grocery/pharmacy

0.50
0.25
0.00

0

5
time (weeks)

10

(b)

(c) 1

ai(t)

1

aFi + r(1 ° aFi )
aFi
0

aFi
0

5
t

10

0

5
t

10

FIG. 2: (a) Data for time spent in different activities,
published by Google (UK data) [47], smoothed with a 7day rolling average. (b) Time-dependence of step-like-NPI,
(c) NPI-with-easing, the easing factor is r.

mimic the patterns of activity in the UK, based on data
published by Google [47]. The first possibility is a steplike-NPI, with a linear decrease from ai = 1 to ai (t) = aF
i
over a time period Wlock , after which ai (t) remains constant at aF
i . The mid-point of the step-like decrease is at
time tlock , the parameters of the NPI are tlock , Wlock and
the various aF
i . The second possibility is an NPI-witheasing, it involves the same step-like decrease, followed
by a linear increase, such that the value at the end of
F
the period considered is aF
i + r(1 − ai ), where r is an
additional lockdown-easing parameter (larger values correspond to more contacts). Priors and further details are
given in Appendix C 2.

VI.

COVID-19 IN ENGLAND AND WALES:
RESULTS

We have applied the methodology of Sec. IV to the
models of Sec. V. The total number of inference parameters (for initial conditions, epidemiological parameters,
and contact structure) is either 46 or 47, depending on
the NPI. This number could be reduced by considering a
smaller number of age cohorts, but we retain them here
to illustrate that the methodology is applicable in models
of this complexity.
As a baseline, we perform inference using data for the
7-week period 6-March 2020 to 24-April 2020, with the
remaining 3 weeks of our data period used to assess the
resulting Bayesian forecast.

Step-like NPI

Fig. 3(a,b) show results for the C F model variant with
step-like NPI, and 7 weeks used for inference. We show
the cumulative number of deaths by cohort, for the deterministic trajectory x(t), obtained using the MAP parameter values. The model matches well the data. Note
the model results are averages so the cohort populations
are not integer-valued in general. Small populations (and
particularly those below 1) indicate that the assumptions
of the CLT are questionable, but in practice the likelihood is dominated by compartments with large populations, in which case (16) is still a reasonable approximation. (The data have no deaths in the 5-9 cohort, for this
time period.)
Fig. 3(c) shows deterministic forecasts with step-like
NPIs (recall Sec. IV B), based on the different contact
matrices. Parameters are sampled from the posterior (as
obtained by MCMC). The model variants behave almost
identically and fit the data used for inference. However,
the forecasts are not accurate. We attribute this primarily to lockdown easing – this is neglected within the
model shown (which has r = 0), so an accurate forecast
should not be expected. Forecasting is explored further
in Sec. VI C, including more realistic models with r > 0.
Fig. 4(a) shows inferred values of latent (unobserved)
compartments, using a deterministic nowcast with parameters from the posterior. As expected, they show a
rise and fall in the number of infected individuals, with
different stages having their peaks at different times. An
important set of (age-dependent) parameters are the βi ,
which determine the susceptibility to infection. Fig. 4(b)
shows inferred values of βi for the C F model, including
the range of posterior samples, and the posterior mean,
which are compared with the MAP estimate and the
prior. The inferred values of β are quite far from the prior
mean; these parameters are very uncertain a priori. (This
uncertainty is incorporated by using log-normal priors for
the βi with a standard deviation one half of the mean, see
Appendix C 2.) The main feature in the inferred result
is the large value of βi for the oldest cohort (75+). The
inferred values of other parameters are discussed in Appendix C 4, they are generally consistent with the prior
assumptions.
To rationalize the inferred β, it is easily verified that
for a model with the assumed contact structure, CFR
and α, the inferred value of β for the oldest cohort must
be larger than all other cohorts, in order to capture the
age-dependence of deaths in England and Wales, which
are very skewed towards the older age groups. There are
at least two reasons why inference might lead to such a
large β: either the assumed CFR (or α) has too weak
an age-dependence which is being compensated by an
age-dependent β; or the contacts of elderly individuals
are indeed more likely to result in infection, perhaps for
medical reasons, or because of increased time in highrisk environments (such as hospitals). This distinction
could be settled if accurate data for numbers of infec-

8
MAP model
104 (b)

103

103

102

102

101

101

100

100
0

2
4
time (weeks)

6

75+

50-54

25-29

0-4

0

6000
weekly deaths

cumulative deaths

data
104 (a)

(c)

4000

2000

0
2

5
time (weeks)

CF
CP
CM
data
inf window

4
6
8
time (weeks)

10

FIG. 3: (a,b) Comparison of data with MAP trajectory for cumulative deaths (C F model variant with step-like-NPI). (c) Deterministic forecast for step-like-NPI with various model variants. There are 20 trajectories for each model variant, with
parameters sampled from the posterior.

E
A
I(1)
I(2)
I(3)

105

104

103
0

(b)

2

4
time (weeks)

posterior mean
prior mean
MAP

Øi

0.4

0.2

0.0

0-4

20-24 40-44 60-64 75+
age

(c)

6

CF
CP
CM

0.4

Øi (MAP)

latent class population

(a)

0.2

0.0

0-4

20-24 40-44 60-64 75+
age

FIG. 4: Results with step-like-NPI (a) populations of latent
compartments (summed over age cohorts), 40 deterministic
trajectories, corresponding to parameter samples from the
posterior. (b) Inferred (posterior) βi from MCMC (using C F
variant), shading shows 5th to 95th percentiles. The MAP
and prior mean are also indicated. (c) Inferred (MAP) βi for
different model variants.

tions were included in the analysis, but it is not possible
with the data considered here. The results of [9] suggest
that susceptibility is age-dependent, but the dependence
is weaker than we infer, indicating that both effects are
in play.
Fig. 4(c) shows the (MAP) inferred β parameters for
the models with different contact matrices. While the
trend is similar, there are significant differences. Nevertheless, the behaviour of the inferred models is almost
identical, recall Fig. 3(c). The reason is that the behaviour of the model is dominated by the infection rates

of (21) – different contact matrices can still lead to similar model behaviour, because of the freedom to adjust
the βi . In this sense, our results can be interpreted as inference of an “infective contact matrix” whose elements
are βi Cij . It is notable from Fig. 1 that the C P contact
matrix includes some large differences between cohorts
with similar ages, particularly in contacts with the 75+
cohort. These can be traced back to the finite data set
of the original POLYMOD study [50]. For the C P model
variant, these large fluctuations lead to an inferred βi
with a complicated dependence on age, for cohorts in the
60+ group. In the C F variant, the dependence on age
is much smoother, both for contacts and for β. Compared to the contact matrices that are based on POLYMOD [48, 49], the C M variant has (much) more contacts
for older individuals, so the inferred β is lower in the
older cohorts.

B.

Fisher information matrix and model evidence

We now discuss the FIM (19) for the C F model variant
with step-like-NPI. Two items of particular interest are
parameters θa whose inferred values are very sensitive to
the data, and soft modes of the parameter space along
which the likelihood varies slowly. These modes indicate
aspects of the model that are mostly determined by the
prior.
The sensitivities of (20) provide useful information on
the first point. Fig. 5 shows results. The parameters
most sensitive to the data are the rates γE , γA and γ1 ,
the probability of the oldest age cohort to get infected
β75+ , and the time of lockdown tlock , consistent with the
discussion so far. These parameters have sa > 100, indicating that changes of order 1% in their values are sufficient to change the log-likelihood by an amount of order
unity.
Soft directions around the MAP parameters, in which
the model behaviour is expected to change very little, do
exist. They arise from small eigenvalues of the FIM, and
the corresponding eigenvectors. One example of such a

10

2

101
100

103

6000

102
101
100

νL γE γA γ1 γ2 γ3

0-4

25-29

50-54

75+

103
10

2

10

1

10

0

sensitivity for aFi

sensitivity sa

age

tlock

103
10

2

10

1

25-29

50-54

75+

age

FIG. 5: Fisher information matrix: sensitivities for model
parameters. Red lines show the value 100, as an (arbitrary)
indication of parameters that are very sensitive to the data.
Similar results for the parameters that determine the initial
condition are given in Appendix C 4.
°265

Epost [log L]

°320
°325

(b)

°270

<latexit sha1_base64="KlQneJNRyzwBBRLATWvjPgwp6Y0=">AAACDXicbVDLSsNAFJ3UV62vqEs3g1VwVRJRdFkQwYWLCvYBTQiT6aQdOpkJMxOhhPyAG3/FjQtF3Lp35984abPQ1gMXDufcy733hAmjSjvOt1VZWl5ZXauu1zY2t7Z37N29jhKpxKSNBROyFyJFGOWkralmpJdIguKQkW44vir87gORigp+rycJ8WM05DSiGGkjBfaRFyM9CsPsOg8yT8YwEUrnfY+JIcw8jBi8zf3ArjsNZwq4SNyS1EGJVmB/eQOB05hwjRlSqu86ifYzJDXFjOQ1L1UkQXiMhqRvKEcxUX42/SaHx0YZwEhIU1zDqfp7IkOxUpM4NJ3F7WreK8T/vH6qo0s/ozxJNeF4tihKGdQCFtHAAZUEazYxBGFJza0Qj5BEWJsAayYEd/7lRdI5bbjnDefurN6EZRxVcAAOwQlwwQVoghvQAm2AwSN4Bq/gzXqyXqx362PWWrHKmX3wB9bnD7vTm9o=</latexit>

log Z

°315

CF

CP

C M C F-ez

(b)

model
MAP
data
inf window

4000
2000

2

0-4

(a)

(a)

0

100

Wlock

weekly deaths

103

sensitivity for βi

sensitivity sa

9

°275
CF

CP

C M C F-ez

FIG. 6: (a) Model evidence for different model variants. The
notation C F -ez indicates the C F model variant and NPI-witheasing; all other results are for step-like-NPI. (b) Posterior
mean log-likelihood: this indicates the extent to which the
inferred models fit the data.

soft mode is discussed in Appendix C 4. The existence
of soft modes speaks in favour of a Bayesian approach,
in that prior information about the disease is used to
fix those parameters which are not determined by the
data. This makes best use of all information sources,
including expert-derived priors. (For experiments in the
physical sciences, one might hope for enough data that
the inferred parameters depend weakly on the prior, but
that is not possible in this context.)
We have also computed the evidence for these models,
see Fig. 6. The C F and C P contact matrices lead to similar log-evidences, with the C P variant higher by around
3 units (we use natural logarithms throughout). The
contact matrix with proportional mixing leads to logevidence that is smaller by around 8 units. We conclude
that this model can still fit the data with reasonable accuracy, but the inference computation is sensitive enough
to infer that the contact structure has some assortativity. Also shown is the posterior mean of the log-likelihood
Epost [log L], which has similar behaviour to the evidence.

4
6
8
time (weeks)

10

2

4
6
8
time (weeks)

10

FIG. 7: Deterministic and stochastic forecasts, NPI-witheasing, C F model variant. (a) deterministic (averaged) forecast, 40 trajectories with parameters from posterior; (b)
stochastic forecast conditional on data. Compared with
Fig. 3c, the effect of lockdown easing is to increase in deaths
at later times, which improves the agreement with data.

This indicates that the differences come primarily from
the quality of the fit.
Given the very naive assumptions of the proportional
mixing model, we argue that the difference of 8 units in
log-evidence should be regarded as a mild effect. Our
conclusion is that the inference computation is not extremely sensitive to prior assumptions on the contact
structure. Based on this result, it seems that more detailed modelling of contacts (for example separation by
work/home/school) will have relatively little impact on
the quality of inference, given the very large uncertainties
within the model about the values of βi .

C.

NPI-with-easing

We now consider NPI-with easing. Since the behaviour
with different contact matrices is very similar, we restrict
to the C F model variant.
Fig. 7(a) is a deterministic forecast analogous to
Fig. 3(c); it shows how the easing parameter r leads to increased uncertainty in the forecast, in a way that is more
consistent with the data. By contrast, Fig. 7(b) shows
a stochastic forecast as defined in Sec. IV B. This accounts for stochasticity in the epidemiological dynamics,
it automatically matches the data within the inference
window. The results of the two kinds of forecast are similar, indicating that the dominant source of uncertainty
is coming from the model parameters.
To explore the effects of lockdown easing in more detail, we consider the effect of increasing inference window, always comparing the model forecasts for the same
10-week period. Results are shown in Fig. 8. The agreement between inferred model and the data increases, as
expected – we find that this model can accurately fit the
data, with reasonable parameter values.
For the 7-week inference window, Fig. 9 shows that
the distribution of r is still close to the prior. This is
consistent with the result of Fig. 6, that the evidence

10

model
data
inf window

weekly deaths

6000
4000
2000
0
2

4
6
8
time (weeks)

10

2

4
6
8
time (weeks)

10

2

4
6
8
time (weeks)

10

2

4
6
8
time (weeks)

10

FIG. 8: Deterministic forecasts showing the effect of increasing the time period used for inference from 7 to 10 weeks. (C F
model variant, NPI-with-easing).
(b)

pdf

tinf = 10
tinf = 9
tinf = 8
tinf = 7
prior

0.0

0.2

0.4
r

deaths in the early period of the epidemic. Recalling that
the deceased population in the model includes only those
individuals who were diagnosed with COVID-19, such an
under-detection might be modelled (in this framework)
by a time-dependent CFR.

pdf

(a)

0.0

0.1
∫L

0.2

FIG. 9: Posterior distributions of the easing parameter r, and
the late-stage infectiousness factor νL , as the inference time
period tinf is increased. (C F model variant, pdfs are shown
as Gaussian kernel density estimates.)

of the variant with easing is comparable to the variants
with step-like-NPI. That is, the additional parameter r
leads to a mild improvement in the fit to the data, and
fine-tuning of its value is not required.
When considering longer time windows, we note that
deaths are lagging indicator of the number of cases, which
means that r is still not fully determined by the data.
That is, these results still depend significantly on the
prior (for details see Appendix C 2). Nevertheless, increasing the inference window causes the posterior distribution of r to shift towards larger values, leading to
improved agreement with the data. There are also significant differences in these posterior distributions, for
example if 9 or 10 weeks data are used for inference –
this limits the robustness of the forecasting and indicates
a possible tendency to over-fitting. We attribute this primarily to the simple linear easing assumed in our NPI.
Most other parameters depend weakly on the period used
for inference (see Appendix C 4).
In evaluating these results, we note that both the
model and the likelihood assume a well-mixed population. In practice, individuals’ have correlated behaviour,
which can be expected to enhance stochastic fluctuations.
For this reason, it is likely that the functional CLT underestimates the variance of the data, given the model. This
can lead to an over-fitting effect. There are also uncertainties in the data that are not accounted for in the likelihood, such as possible under-detection of COVID-related

VII.

DISCUSSION

We have described a methodology for inference and
forecasting in epidemiological compartment models,
where all stochastic aspects of disease propagation and
measurement are modelled on an equal footing, and the
likelihood is justified from first principles, and derived
directly from the model. This means that the likelihood can be computed directly from the model definition,
given appropriate data.
This methodology has been used to calibrate a model
for the COVID-19 pandemic in England and Wales, based
on death data. We have compared models with different
contact structures, showing that fine details of the contact matrix have very little effect on model behaviour
and forecasts. Indeed, the model with proportional mixing behaves very similarly to those with contact matrices
derived from the POLYMOD data set [48–50]. This may
be surprising at first glance, but the fact that the βi parameters are inferred separately for each cohort means
that the model has enough flexibility to infer how many
infective contacts are made by each group. More specifically, it is the infection rate constant K of (18) that
determines the model behaviour, so one sees from (21)
differences in contact matrices can be partially compensated by changes in β. (The compensation is only partial
because while βi controls the relative numbers of infections, the contact matrix also determines the assortativity of mixing.)
In contrast to the details of mixing among cohorts,
modelling assumptions about time-dependence of the
contact structure have a significant impact on forecasting, as one should expect. This is illustrated by the dependence of the behaviour on the easing factor r.
Within the time period considered, the model gives
forecasts that are reasonably accurate and robust. How-

11
Contributions by T.E., L.K., A.B., and J.D.P. enabled
flexible inference for compartment models, and H.K. contributed to the stochastic forecasts. The manuscript was
written by R.L.J. and R.A., with contributions from all
authors.

ever, we have identified a possible tendency to overfitting, some of which may be due to the well-mixing
assumption that is used in the likelihood. Another common approach uses negative binomial distributions in the
likelihood [8, 9, 15], this corresponds to a larger variance
for numbers of deaths (over-dispersion), compared to the
CLT. It would be interesting to consider inclusion of an
over-dispersion factor in the likelihood used here, as a
way of accounting for correlations in the contact structure.
In terms of model calibration, the main limitation of
this study is the fact that we do not use data for case
numbers, which means that the CFR cannot be inferred.
In the UK, the rates and policies for testing for COVID19 have had complex time-dependence, which means that
robust estimation of case numbers is challenging. Incorporation of a time-dependent testing capacity into this
framework is a direction of ongoing research. The extension of this framework to geographically-resolved models
is also under active investigation.

This Appendix derives the covariance matrix G that
appears in the likelihood (16). The result is based on
the CLT for u discussed in Sec. II D. We first compute
a covariance matrix G̃ for the state u, from which we
derive the covariance G of the data.
Note that J and σξ in (7) depend on the deterministic path x but not on the random variable u, so (7)
is a time-dependent Ornstein-Uhlenbeck process. This
enables derivation of three important results. The first
concerns the covariance matrix Σ for u(t), whose elements are

Acknowledgments

Σij (t) = hui (t)uj (t)i .

We thank Graeme Ackland, Daniela de Angelis, Paul
Birrell, Daan Frenkel, Sanmitra Ghosh, and Ken Rice for
helpful discussions. We also thank PyRoss contributors,
Fernando Caballero, Bilal Chughtai, Jules Guioth, and
Benjamin Remez; and JPM researchers William Bankes,
Erik Brorson, Andrew Ng, and William Peak. This work
was undertaken as a contribution to the Rapid Assistance in Modelling the Pandemic (RAMP) initiative, coordinated by the Royal Society. This work was funded
in part by the European Research Council under the
Horizon 2020 Programme, ERC grant 740269, and by
the Royal Society grant RP17002. The authors are also
grateful for financial support from the EPSRC doctoral
training programme (A.B., J.D., G.T.), the Leverhulme
Trust (P.B.R. and H.K.), the Cambridge Trust and Jardine foundation (Y.I.L.).

Author contributions

The integration of epidemiological modelling, the
Bayesian estimation of models against epidemiological
data, and the optimisation of NPIs in these fitted models was conceived by R.A., who also led the PyRoss
project, with additional guidance from M.E.C. Development of the model for England and Wales was led by
R.L.J.. The inference methodology was developed by
Y.I.L., G.T., P.B.R., and P.P., with specific contributions
including functional CLT (Y.I.L.); Fisher information
matrix (G.T.); evidence and MCMC (P.B.R.); and likelihood computation (P.P.). Also, J.K. developed stochastic simulation and forecasting; R.S. designed the numerical implementation of PyRoss and developed deterministic simulations; and J.D. developed the example model.

Appendix A: Derivation of G for likelihood

(A1)

Here and throughout, angled brackets h·i denote an average over the stochastic dynamics of the compartment
model. [Recall that u(0) = 0 so hu(t)i = 0 and also
Σij (0) = 0.] The equation of motion for Σ can be derived from (7) as
∂
Σ(t) = J (t, θ, xt )Σ(t) + Σ(t)J T (t, θ, xt )
∂t
+ B(t, θ, xt )

(A2)

where
B(t, θ, xt ) =

X

σξ (t, θ, xt )σξT (t, θ, xt )

(A3)

ξ

is a square matrix. Equ. (A2) can be solved (numerically)
for Σ.
Second, let h·iu(s) denote an average, conditional on
the value of u(s). Taking the first moment of (7) one
arrives at a linear equation for the average value of u,
hence for t ≥ s one has
X
hui (t)iu(s) =
Uij (s, t)uj (s)
(A4)
j

where the matrix U (s, t) is the time-evolution operator,
which solves the linear differential equation
X
∂
Uij (s, t) =
Jik (t, θ, xt )Ukj (s, t)
∂t

(A5)

k

with initial condition Uij (s, s) = δij . This equation is
readily solved (numerically) for U .
The third result can then be obtained by noting that
the covariance matrix for u between two times s, t can be

12
obtained (for t ≥ s) by composing the covariance Σ(s)
with the propagator U (s, t). That is,
X
huj (s)ui (t)i =
Σjk (s)Uik (s, t) .
(A6)
k

To exploit this last result, consider the vector obtained
by concatenating the full state of the system over observed time points, analogous to (12)

X = x(t1 ), x(t2 ), . . . .
(A7)

Its mean is clearly X = x(t1 ), x(t2 ), . . . . Now define a
√
˜ = (X − X) Ω,
(scaled) deviation from the mean as ∆
and denote the covariance of this vector by G̃. From
(A6), this symmetric matrix is formed of blocks that depend on Σ and U :


Σ(t1 )
Σ(t1 )U T (t1 , t2 ) . . .
U (t1 , t2 )Σ(t1 )
Σ(t2 )
... 


G̃ = U (t1 , t3 )Σ(t1 ) U (t2 , t3 )Σ(t2 ) . . .  . (A8)


..
..
..
.
.
.
Since (7) is an Ornstein-Uhlenbeck process, it can be
˜ is
shown additionally [34–36] that the distribution of ∆
asymptotically Gaussian, with the given covariance G̃.
Since the observed data are related linearly to X according to (11,12), one then obtains (16), with the covariance
of ∆ given by
G = F G̃F

T

.

(A9)

Since all elements of G̃ can be evaluated, this allows computation of the likelihood (16).
Appendix B: Implementation details for inference
1.

Fisher information matrix

For a multivariate normal distribution, such as the likelihood obtained in Section III, with the mean vector Ȳ (θ)
and the covariance matrix G(θ) the elements of the FIM
(19) are [51]


∂ Ȳ T −1 ∂ Ȳ
1
−1 ∂G −1 ∂G
Ia,b =
G
+ tr G
G
. (B1)
∂θa
∂θb
2
∂θa
∂θb
This form is advantageous since its computation only requires first order derivatives, which are estimated as finite
differences.
2.

Evidence computation

We use a thermodynamic integration method [52, 53]
to compute the log-evidence
Z
log Z = log
eA(θ) P (θ)dθ ,
(B2)
D

where A(θ) = log L(θ) is the log-likelihood, and the domain D is the support of the prior P (θ). Compared to
alternatives (for example nested sampling [54]), thermodynamic integration allows robust estimation of convergence, and its numerical uncertainties.
We summarise the method, which is based on an integration path from a tractable (and normalised) distribution
P̃ (θ) = eÃ(θ) P (θ)
to the posterior. To this end, define
Z
f (z) = log
ez[A(θ)−Ã(θ)] P̃ (θ)dθ .

(B3)

(B4)

D

so that f (0) = 0 and f (1) = log Z. Differentiating yields
Z
f 0 (z) = e−f (z) [A(θ) − Ã(θ)]ez[A(θ)−Ã(θ)] P̃ (θ)dθ .
D

(B5)
The right hand side is an expectation value Eπz [A − Ã]
with respect to the (normalised) intermediate distribution πz (θ) = e−f (z)+z[A(θ)−Ã(θ)] P̃ (θ). Given some Ã,
this expectation value can be estimated by MCMC. (Our
choice for Ã is discussed just below.) Then the logevidence can be expressed as
Z 1
log Z =
f 0 (z)dz .
(B6)
0

To estimate this integral, we take a sequence 0 = z0 <
z1 < · · · < zn = 1 and we use trapezoidal quadrature:
log Z ≈

n
X
f 0 (zi ) + f 0 (zi−1 )
.
(zi − zi−1 )
2
i=1

(B7)

For each quadrature point, f 0 (zi ) is estimated by an
MCMC computation of the expectation value (B5).
These are independent MCMC estimates, which facilitates analysis of numerical uncertainties.
To select a suitable Ã, the idea is that the closer is
P̃ to the posterior, the shorter is the integration path,
and the easier the computation. However, P̃ must be a
normalised distribution on D. A suitable choice for P̃
is therefore a truncated Gaussian approximation to the
posterior, around the MAP parameters θ ∗ . Let H be
the Hessian matrix of the (negative) log-posterior, whose
elements are
∂2
Hab = −
[log L(θ ∗ ) + log P (θ ∗ )] .
(B8)
∂θa ∂θb
Then the truncated Gaussian approximation of the posterior distribution is


1
∗ T
∗
P̃ (θ|Y ) ∝ exp − (θ − θ ) H(θ − θ ) .
(B9)
2
for θ ∈ D, and P̃ = 0 otherwise. Rejection sampling is used to to sample this distribution and to simultaneously obtain its normalisation constant, so that
)
Ã(θ) = log P̃P(θ|Y
can be computed, consistent with
(θ)
(B3). Hence (B7) can be computed.

13
Conditional nowcast

To sample latent compartments during the inference
period, we use the CLT for u discussed in Sec. II D.
It is convenient to assume that the latent populations
are to be inferred at the times tµ where data was collected. (This assumption is easily relaxed, at the expense of some heavier notation.) Hence, the populations
of the latent compartments are encoded in the vector X
of (A7). Given the model parameters, the distribution of
X obeys a CLT
log P (X|θ) ' −

i
1 h T −1
∆ G̃ ∆ + ln det(2π G̃) , (B10)
2

analogous to (16), with G̃ as in (A8). Since this distribution is (multivariate) Gaussian, and the data depend
linearly on X, it is straightforward to condition on the
data and obtain a Gaussian distribution for the latent
compartments, which can then be sampled.
Appendix C: Details and additional results for the
example model

mean
std/mean bounds/mean
(3.00 days)−1
0.1
(0.6,1.4)
−1
(2.50 days)
0.1
(0.6,1.4)
(3.00 days)−1
0.1
(0.6,1.4)
(7.25 days)−1
0.1
(0.6,1.4)
(7.25 days)−1
0.1
(0.6,1.4)
(see caption)
0.5
(0.1,10)
0.1
0.5
(0.1,10)
17 days
0.06
(0.06,1.8)
12 days
0.08
(0.008,1.7)
0.2
0.5
(0.01,10)
0.2
0.1
(0.05,0.5)

TABLE I: Priors for the compartment model, all parameters
are independent with normal or log-normal distributions, as
shown. The standard deviation (std) and bounds are quoted
relative to the prior mean. The prior mean for β depends
on the age cohort: βi = 0.2 for ages 50+ and βi = 0.04 for
ages less than 15, with linear interpolation in the intermediate
range. This age-dependence is based on [9], the overall scale
was chosen so that the prior mean model is broadly consistent
with exponential growth of cases in the first few weeks of the
epidemic.
10−1

ODEs for average dynamics

For the (stochastic) model defined in Sec V, the deterministic equations for the mean (5) can be written in
terms of the compartment populations. For this section
alone, let Si be the average population of susceptible individuals in cohort i, and similarly for all other classes.
Our notation omits the dependence of these populations
on time, for compactness. Using dots to indicate time
derivatives, (5) becomes

0.6

10−2

0.4

fi

1.

distribution
γE
Normal
γA
Normal
γ1
Normal
γ2
Normal
γ3
Normal
βi Log-normal
νL Log-normal
tlock
Normal
Wlock Normal
aF
Log-normal
i
r
Normal

αi

3.

10−3
10−4

0.2

0-4

20-24 40-44 60-64 75+
age

0.0

0-4

20-24 40-44 60-64 75+
age

FIG. 10: Age-dependent parameters for the CFR fi and the
fraction of asymptomatic/paucisymptomatic cases αi .

Ṡi = −λi (t)Si

Ėi = −γE Ei + λi (t)Si

2.

Ȧi = −γA Ai + γE Ei

(1)
(1)
I˙i = −γ1 Ii + γA Ai

(2)
I˙i
(3)
I˙i

=
=

Ṙi =
Ḋi =

(2)
(1)
−γ2 Ii + ᾱi γ1 Ii
(3)
(2)
−γ3 Ii + γ2 Ii
(1)
(3)
αi γ1 Ii + f¯i γ3 Ii
(3)
fi γ3 Ii ,

(C1)

where we do not indicate the dependence of the compartment populations on time (for compactness of notation),
while ᾱi = 1 − αi and f¯i = 1 − fi , also
λi (t) =

X
j

(0)

βi C̃ij (t)

(k)
3
X
νk Ij
k=0

Nj

.

(C2)

Recall that Ii should be identified as Ai and Nj is the
total population of cohort j.

Parameters, priors and initial conditions

This section gives additional details of parameters in
the model of Sec. V, and the priors used for inference.
The infectiousness parameters νk are defined relative to
the first infectious stage, so ν1 = 1. (This does not
lose any generality because the ν parameters only appear
through the combination βi νk .) In practice we parameterise ν in terms of a single inference parameter νL : we
take ν0 = ν1 = 1, with ν2 = ν3 = νL . The early stages
of a COVID-19 case are much more infectious than later
stages so νL < 1, see below. The γ and ν parameters
are assumed independent of age, while β, α, f, a are agedependent.
The fixed (age-dependent) CFR was estimated from
the data for 18-24 March in Table 4 of [46], by fitting an
exponential dependence for ages 40-90 and then extrapolating this function to younger age groups. This leads to
f = Ae(age)/ξ with A = 1.43 × 10−4 and ξ = 13.1 years.
The fraction of asymptomatic/paucisymptomatic cases is

xlin (0) = xS + κvθ∗

(C3)

where vθ∗ is the dominant eigenvector (which depends
on the epidemiological parameters), and κ is an inference
The normalisation of the eigenvector is
P parameter.
∗
∗
|
=
1
where
vθ,α
is the α-th element of the vec|v
α θ,α
∗
tor vθ ; this means that the value of κ is approximately
one half of the non-susceptible (infected + recovered +
deceased) fraction of the population, at t = 0.
In practice our initial condition is obtained by modifying xlin (0). First, the D (deceased) compartments
are initialised from the observation data, which overrides the value from the dominant eigenvector. Second,
the E, A, I (k) compartments for the oldest cohort are determined by a separate procedure (detailed in the next
paragraph), which allows extra flexibility in the inference. Finally, the S compartments (for all age cohorts)
are chosen to enforce the (fixed) total population of each
cohort. [Using (C3) automatically ensures the correct cohort populations, but modifying x(0) from xlin (0) means
that compensation is required, to enforce this constraint.]
The modified initial condition for the oldest cohort is

(a)

population (age 25-29)

taken from Table 2 of [46], using linear interpolation to
obtain values for the cohorts considered here. The relevant numbers are shown in Fig. 10. As discussed in the
main text, these numbers are subject to considerable uncertainty, but the resulting model is flexible enough to fit
the data used here. It would be valuable to incorporate
additional data, to constrain these variables, for example
through testing data, which can provide information on
the number of cases.
The priors for inferred epidemiological parameters are
summarised in Table I. The γ parameters are fixed by
the disease itself and can be constrained based on medical
data, see for example [55] for a discussion. We take Gaussian priors for these parameters with standard deviation
10% of the mean. Other parameters like βi , νL , ai , r are
associated with disease transmission, and are much less
well characterised, hence the use of less informative priors, which are log-normal with standard deviation 50%
of the mean. (For positive parameters with large uncertainty, the log-normal prior is much more heavy-tailed
than a Gaussian with the same standard deviation, while
still penalising very small values.) The lockdown parameters tlock and Wlock have a prior standard deviation of
1 day.
As noted in the main text, the initial condition x(0)
is determined from the parameters θ. A simple estimate is available by linearising the average dynamics (5)
about the state xS where all individuals are susceptible. The behavior of the resulting equation (at early
times) is dominated by the largest eigenvalue of the matrix J (0, θ, xS ), as obtained from (8). The corresponding
eigenvector dominates the evolution of the early stages of
the epidemic, up to transient effects of the initial condition, which are controlled by the smaller (sub-dominant)
eigenvalues. A suitable baseline estimate for the initial
condition is then

population (all cohorts)

14

105

104

103
0

2
4
6
time (weeks)

104

(b)

E
A
I(1)
I(2)
I(3)

103

102
0

2
4
6
time (weeks)

FIG. 11: Sampling of latent variables conditional on the data,
to illustrate the size of the fluctuations described by the functional CLT. (a) Total population in each epidemiological class,
as obtained from a conditional nowcast with 100 trajectories,
using with MAP parameters. The dots indicate the inferred
(MAP) initial condition. (C F model variant with step-likeNPI). (b) Population of latent compartments for a single cohort (age 25-29), the stochastic fluctuations more apparent at
this level.

based on a hypothesis that infections started in younger
age groups, before spreading into the elderly population. The inferred result is consistent with such a hypothesis. Since initial conditions are unknown a priori,
we take broad prior distributions, which are log-normal
with standard deviation one half of the mean. The prior
mean values were chosen based on preliminary computations, to obtain reasonable agreement with deaths in
the first few weeks. Denoting these mean values by
µ we take µκ = 5 × 10−4 and for the oldest cohort
(µE , µA , µI1 , µI2 , µI3 ) = (2000, 1200, 300, 60, 40), see also
Fig. 12 below.

3.

Contact matrices

The contact matrices for C P and C F model variants are
based on [48, 49], as we now explain. On general grounds,
one expects contacts to obey a reciprocal relation: the
matrix Q with elements
Qij = Ni Cij

(C4)

should be symmetric, Qij = Qji .
For C P , the contact matrix is taken from [48], by summing the contributions from home/work/school/other. It
is notable (see for example Fig. 1) that the data do not
satisfy (C4), this can be traced back to the reporting of
contacts by the participants of [50].
For C F , the data in [49] is provided as a (nonnormalised) estimate of Q, based on nQ single-year age
cohorts. As for C P , we sum the contributions from different environments to obtain a single matrix. Let Ai be
the set of single-year age cohorts corresponding to the
(5-year) cohort i, and denote the reported estimate of Q

15

FIG. 12: Posterior for parameters, C F model variant with step-like-NPI. (a) γ parameters, the violin plots are based on
kernel density estimates. (b) aF
i parameters, the shading is 5th to 95th percentile of the posterior. (c,d,e) prior and posterior
distributions of lockdown parameters tlock , Wlock and late-stage infectivity parameter νL . (f-k) prior and posterior distributions
of initial condition parameters, specifically the coefficient κ of the leading mode, and the individual compartment populations
for the oldest (75+) cohort.

by Q0 . Then we take

Cij =

4.

Ω
χNi

X X

Additional results

This Section shows additional results from the inference methodology.
Q0pq

(C5)

p∈Ai q∈Aj

The constant χ is included because Q0 is not normalised,
we take χ = 3M nQ so that the typical numbers of contacts are comparable with [48]. This scaling is somewhat
arbitrary but errors/uncertainties in this factor can be
compensated by rescaling the β parameters of the model.
The matrix Q0 is symmetric so the resulting contact matrices obey (C4).

We have emphasised that our Bayesian analysis accounts for all sources of uncertainty in the model, including parameter uncertainty, and the stochasticity inherent in the compartment model. As a direct measure
of this stochasticity, Fig. 11 shows a conditional nowcast,
as defined in Sec. IV B. We show results summed over
age cohorts, and for one representative cohort. These results illustrate the fluctuations that are captured by the
functional CLT. For the summed data, the fluctuations
are small, consistent with the relatively large numbers of
individuals. At the level of specific cohorts, the fluctuations are significant.

16
(a)

(b) 0.4
0.2

10

1

ṽaFIM

sensitivity sa

102

0.0
°0.2

100
∑

E0

A0

(1)

I0

(2)

I0

°0.4

(3)

I0

∞A

∞1

∞2

∞3 aF30°34

FIG. 13: (a) Sensitivities for the parameters determining initial conditions. (b) Soft mode of the FIM, showing the 5
largest ṽaFIM among the model parameters (we have excluded
in this case parameters relevant for initial conditions). This
mode illustrates that the model behaviour (and hence the
likelihood) is almost unchanged if one increases the parameters γ1 , γ2 and simultaneously reduces γA , γ3 . Other model
parameters have small contributions to this mode, as illustrated by the aF
i parameter, which is the next largest element
in magnitude.
(a)

0.5

(b)

0.4

3
2

aFi

Øi

75+

50-54

0.3
0.2

1
0

25-29

0.1
7

8

9

0.0

10

0-4

7

8

tinf

9

10

tinf

(c)

ṽaFIM =

(d)
∞E
∞A
∞1
∞2
∞3

3

note however that the parameters have significant correlations under the posterior, which are not apparent here
since we only show the marginals for individual variables.
(For example, the initial rate of epidemic growth depends
on a particular combination of the γ and β parameters;
this growth rate is tightly constrained by the data, even
if individual γ and β parameters remain uncertain.)
For the C F model variant with step-like-NPI, we evaluated the FIM at the MAP parameters. Hence (i) we gain
understanding of how sensitive our model is expected to
be to small parameter perturbations and (ii) we understand whether there are soft directions along which the
likelihood depends weakly on the parameters. The sensitivities for model parameters are discussed in Section
VI B, see Fig. 5. There are corresponding sensitivities for
the parameters that determine the initial condition, see
Fig. 13(a). The parameter κ is sensitive to the data, as
expected since it determines the size of the epidemic at
early times.
The soft modes of the likelihood are determined by the
eigenvalues and eigenvectors of the FIM. The eigenvectors corresponding to small eigenvalues define directions
in which the likelihood is expected to change very little.
Let v FIM be an eigenvector of the FIM I with a small
eigenvalue – its elements correspond to differences of the
parameters θ from their MAP values. It is convenient to
normalise these as fractional changes with respect to the
MAP by defining a vector ṽ FIM with elements

tlock
Wlock

2

1 FIM
v
θa∗ a

(C6)

Fig. 12 shows the posterior distributions of parameters for the C F model with step-like NPI. This complements Fig. 4(b) of the main text where similar results
are shown for the parameter β. In most cases, the posterior distributions overlap strongly with the priors, we

P
which is normalised such that a |ṽaFIM |2 = 1. Hence
large values of ṽaFIM indicate parameters that are significantly affected by the soft mode.
An example is given in Fig. 13(b). If one increases
γA and reduces γ1 appropriately, the result is a model
with the same (mean) infectious period. A similar effect is obtained by increasing γ2 and reducing γ3 . Due
to these degenerate directions in the parameter space, a
pure maximum likelihood estimation (MLE) approach to
inference of any model displaying soft modes potentially
leads to wrong results. Bayesian inference on the other
hand has the natural ability to remove soft modes by
virtue of the additional information provided by priors.
Finally we consider the effects of the inference window.
To complement Figs. 8 and 9, we show in Fig. 14 the
dependence of inferred parameters on the time period
used for inference (Fig. 9 shows similar results for the
parameters r, νL .) Most parameters depend weakly on
the time window, which indicates a robust forecast.

[1] N. M. Ferguson et al., Imperial College COVID-19 Response Team Report 9, http://doi.org/10.25561/77482
(2020).

[2] R. N. Thompson, T. D. Hollingsworth, V. Isham,
D. Arribas-Bel, B. Ashby, T. Britton, P. Challenor,
L. H. K. Chappell, H. Clapham, N. J. Cunniffe, A. P.

2
1
0

7

8

9
tinf

10

1

0

7

8

9

10

tinf

FIG. 14: Dependence of inferred parameters on time used for
inference, see also Fig. 9. Plots show posterior mean with
error bars showing posterior standard deviation. (C F model
variant, NPI-with-easing.)

17

[3]

[4]

[5]
[6]
[7]

[8]

[9]

[10]
[11]
[12]

[13]
[14]

[15]
[16]

Dawid, C. A. Donnelly, R. M. Eggo, S. Funk, N. Gilbert,
P. Glendinning, J. R. Gog, W. S. Hart, H. Heesterbeek,
T. House, M. Keeling, I. Z. Kiss, M. E. Kretzschmar,
A. L. Lloyd, E. S. McBryde, J. M. McCaw, T. J. McKinley, J. C. Miller, M. Morris, P. D. O’Neill, K. V. Parag,
C. A. B. Pearson, L. Pellis, J. R. C. Pulliam, J. V. Ross,
G. S. Tomba, B. W. Silverman, C. J. Struchiner, M. J.
Tildesley, P. Trapman, C. R. Webb, D. Mollison, and
O. Restif, Proc. Roy. Soc. B: Bio. Sci. 287, 20201405
(2020).
K. Prem, Y. Liu, T. W. Russell, A. J. Kucharski, R. M.
Eggo, N. Davies, S. Flasche, S. Clifford, C. A. B. Pearson,
J. D. Munday, S. Abbott, H. Gibbs, A. Rosello, B. J.
Quilty, T. Jombart, F. Sun, C. Diamond, A. Gimma,
K. van Zandvoort, S. Funk, C. I. Jarvis, W. J. Edmunds,
N. I. Bosse, J. Hellewell, M. Jit, and P. Klepac, The
Lancet Public Health 5, e261 (2020).
N. G. Davies, A. J. Kucharski, R. M. Eggo, A. Gimma,
W. J. Edmunds, T. Jombart, K. O’Reilly, A. Endo,
J. Hellewell, E. S. Nightingale, B. J. Quilty, C. I. Jarvis,
T. W. Russell, P. Klepac, N. I. Bosse, S. Funk, S. Abbott,
G. F. Medley, H. Gibbs, C. A. B. Pearson, S. Flasche,
M. Jit, S. Clifford, K. Prem, C. Diamond, J. Emery, A. K.
Deol, S. R. Procter, K. van Zandvoort, Y. F. Sun, J. D.
Munday, A. Rosello, M. Auzenbergs, G. Knight, R. M.
G. J. Houben, and Y. Liu, The Lancet Public Health 5,
e375 (2020).
S. M. Kissler, C. Tedijanto, E. Goldstein, Y. H. Grad,
and M. Lipsitch, Science 368, 860 (2020).
R. Singh and R. Adhikari, arXiv preprint
arXiv:2003.12055 (2020).
R. Verity, L. C. Okell, I. Dorigatti, P. Winskill, C. Whittaker, N. Imai, G. Cuomo-Dannenburg, H. Thompson, P. G. T. Walker, H. Fu, A. Dighe, J. T. Griffin,
M. Baguelin, S. Bhatia, A. Boonyasiri, A. Cori, Z. Cucunubá, R. FitzJohn, K. Gaythorpe, W. Green, A. Hamlet, W. Hinsley, D. Laydon, G. Nedjati-Gilani, S. Riley,
S. van Elsland, E. Volz, H. Wang, Y. Wang, X. Xi, C. A.
Donnelly, A. C. Ghani, and N. M. Ferguson, The Lancet
Infectious Diseases 20, 669 (2020).
P. J. Birrell, J. Blake, E. van Leeuwen, PHE
modelling cell, N. Gent,
and D. De Angelis,
medRxiv:2020.08.24.20180737 (2020).
N. G. Davies, P. Klepac, Y. Liu, K. Prem, M. Jit,
C. A. B. Pearson, B. J. Quilty, A. J. Kucharski, H. Gibbs,
S. Clifford, A. Gimma, K. van Zandvoort, J. D. Munday, C. Diamond, W. J. Edmunds, R. M. G. J. Houben,
J. Hellewell, T. W. Russell, S. Abbott, S. Funk, N. I.
Bosse, Y. F. Sun, S. Flasche, A. Rosello, C. I. Jarvis,
R. M. Eggo, and CMMID COVID-19 working group,
Nature Medicine 26, 1205 (2020).
R. Adhikari et al., arXiv:2005.09625 (2020).
K. J. Friston et al., arXiv:2004.04463 (2020).
N. T. J. Bailey, The Mathematical Theory of Infectious
Diseases and its Applications (Charles Griffin & Company Ltd, High Wycombe, UK, 1975).
O. Diekmann, J. A. P. Heesterbeek, and M. G. Roberts,
J. Royal Soc. Int. 7, 873 (2010).
M. J. Keeling and P. Rohani, Modeling Infectious Diseases in Humans and Animals (Princeton University
Press, 2011).
P. J. Birrell, X.-S. Zhang, R. G. Pebody, N. J. Gay, and
D. De Angelis, Scientific Reports 6, 29004 (2016).
H. Jeffreys, The Theory of Probability (Oxford University

Press, Oxford, 1939).
[17] A. Zellner, An Introduction to Bayesian Inference in
Econometrics (Johm Wiley and Sons, New York, 1996).
[18] D. J. C. MacKay, Information Theory, Inference
and Learning Algorithms (Cambridge University Press,
2003).
[19] P. D. O’Neill and G. O. Roberts, J. Roy. Stat. Soc.: Series
A 162, 121 (1999).
[20] A. Chatzilena, E. van Leeuwen, O. Ratmann,
M. Baguelin, and N. Demiris, Epidemics 29, 100367
(2019).
[21] J. Ross, T. Taimre, and P. Pollett, Theoretical Population Biology 70, 498 (2006).
[22] J. Ross, D. Pagendam, and P. Pollett, Theoretical Population Biology 75, 123 (2009).
[23] X. Xu, T. Kypraios, and P. D. O’Neill, Biostatistics 17,
619 (2016).
[24] E. Buckingham-Jeffery, V. Isham, and T. House, Math.
Biosci. 301, 111 (2018).
[25] S. C. Leite and R. J. Williams, Ann. Appl. Prob. 29,
1541 (2019).
[26] https://github.com/rajeshrinet/pyross.
[27] R. E. Kass and A. E. Raftery, J. Am. Stat. Assoc. 90,
773 (1995).
[28] A. E. Raftery, Sociological methodology 25, 111 (1995).
[29] D. J. C. MacKay, Neural Comp. 4, 415 (1992).
[30] K. M. Gamado, G. Streftaris, and S. Zachary, J. Math.
Biol. 69, 737 (2014).
[31] J. F. C. Kingman, J. Appl. Prob. 6, 1 (1969).
[32] R. M. Anderson, B. Anderson, and R. M. May, Infectious Diseases of Humans: Dynamics and Control (Oxford university press, 1992).
[33] D. R. McNeil and G. H. Weiss, Biometrika 64, 553 (1977).
[34] T. G. Kurtz, J. Chem. Phys. 57, 2976 (1972).
[35] T. G. Kurtz, Approximation of Population Processes
(SIAM, 1981).
[36] N. G. Van Kampen, Stochastic processes in physics and
chemistry (Elsevier, 1992).
[37] C. Gardiner, Stochastic Methods: A Handbook for the
Natural and Social Sciences, 4th ed. (Springer-Verlag,
Berlin/Heidelberg, 2009).
[38] T. McKinley, A. R. Cook, and R. Deardon, Int. J. Biostatistics 5 (2009).
[39] N. Hansen, Y. Akimoto, and P. Baudis, CMA-ES/pycma
on github. https://doi./org/10.5281/zenodo.2559634
(2019).
[40] V. Costanza and J. H. Seinfeld, J. Chem. Phys. 74, 3852
(1981).
[41] R. Gunawan, Y. Cao, L. Petzold, and F. J. Doyle, Biophys. J. 88, 2530–2540 (2005).
[42] D. Foreman-Mackey, D. W. Hogg, D. Lang,
and
J. Goodman, Pub. Astrom. Soc. Pac. 125, 306 (2013),
https://github.com/dfm/emcee.
[43] D. T. Gillespie, J. Phys. Chem. 81, 2340 (1977).
[44] Y. Cao, D. T. Gillespie, and L. R. Petzold, J. Chem.
Phys. 124, 044109 (2006).
[45] https://www.ons.gov.uk/peoplepopulationandcommunity/
birthsdeathsandmarriages/deaths/datasets/weeklyprovisional
figuresondeathsregisteredinenglandandwales (2020).
[46] F. Riccardo et al., medrxiv:2020.04.08.20056861v1
(2020).
[47] https://www.google.com/covid19/mobility/ (2020).
[48] K. Prem, A. R. Cook, and M. Jit, PLoS Comp. Biol. 13,
e1005697 (2017).

18
[49] L. Fumanelli, M. Ajelli, P. Manfredi, A. Vespignani, and
S. Merler, PLOS Comp. Biol. 8, e1002673 (2012).
[50] J. Mossong, N. Hens, M. Jit, P. Beutels, K. Auranen,
R. Mikolajczyk, M. Massari, S. Salmaso, G. S. Tomba,
J. Wallinga, J. Heijne, M. Sadkowska-Todys, M. Rosinska, and W. J. Edmunds, PLOS Medicine 5, e74 (2008).
[51] L. Malago and G. Pistone, in Proceedings of the 2015
ACM Conference on Foundations of Genetic Algorithms

XIII - FOGA 15 (ACM Press, 2015) p. 150–162.
[52] A. Gelman and X.-L. Meng, Stat. Sci. 13, 163 (1998).
[53] D. Frenkel and B. Smit, Understanding Molecular Simulation: From Algorithms to Applications (Elsevier, 2001).
[54] J. Skilling, Bayesian Anal. 1, 833 (2006).
[55] Y. M. Bar-On, R. Sender, A. I. Flamholz, R. Phillips,
and R. Milo, arXiv:2006.01283 (2020).

