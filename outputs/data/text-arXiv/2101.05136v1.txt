arXiv:2101.05136v1 [q-bio.QM] 13 Jan 2021

1

1

2

Leveraging Structured Biological Knowledge for
Counterfactual Inference: a Case Study of Viral
Pathogenesis
Somya

Bhargava3 ,

Jeremy Zucker1∗ , Kaushal Paneri2∗ , Sara Mohammad-Taheri3∗ ,
Pallavi Kolambkar3 , Craig Bakker1 , Jeremy Teuton1 , Charles Tapley Hoyt4 , Kristie
Oxford1 , Robert Ness5 and Olga Vitek3†

F

Abstract—Counterfactual inference is a useful tool for comparing outcomes of interventions on complex systems. It requires
us to represent the system in form of a structural causal model,
complete with a causal diagram, probabilistic assumptions on exogenous variables, and functional assignments. Specifying such
models can be extremely difficult in practice. The process requires substantial domain expertise, and does not scale easily to
large systems, multiple systems, or novel system modifications.
At the same time, many application domains, such as molecular
biology, are rich in structured causal knowledge that is qualitative
in nature. This manuscript proposes a general approach for
querying a causal biological knowledge graph, and converting
the qualitative result into a quantitative structural causal model
that can learn from data to answer the question. We demonstrate
the feasibility, accuracy and versatility of this approach using two
case studies in systems biology. The first demonstrates the appropriateness of the underlying assumptions and the accuracy
of the results. The second demonstrates the versatility of the
approach by querying a knowledge base for the molecular determinants of a severe acute respiratory syndrome coronavirus
2 (SARS-CoV-2 or SARS-CoV-2)-induced cytokine storm, and
performing counterfactual inference to estimate the causal effect
of medical countermeasures for severely ill patients.

Keywords— Biological expression language, structural causal
model, counterfactual inference, causal biological knowledge graph,
systems biology, SARS-CoV-2

1

I NTRODUCTION

Each time a cell senses changes in its environment, it marshals
a complex choreography of molecular interactions to initiate an
appropriate response. When a virus infects the cell, this delicate balance
∗

Equal contribution
Pacific Northwest National Laboratory, Richland, WA
2
Microsoft, Redmond, WA
3
Northeastern University, Boston, MA
4
Enveda Biosciences, Bonn, Germany
5
Altdeep, Boston, MA
†
Corresponding author: ovitek@neu.edu

1

is disrupted and can result in a cascade of systemic failures leading to
disease. In particular, severe acute respiratory syndrome coronavirus
2 (SARS-CoV-2), the novel pathogen responsible for the COVID-19
pandemic, has a complex etiology that differs in subtle and substantial
ways from previously studied viruses. To make informed decisions
about the risk that a new pathogen presents, it is imperative to rapidly
predict the determinants of pathogenesis and identify potential targets
for medical countermeasures. Current solutions for this task include
systems biology data-driven models, which correlate biomolecular
expression to pathogenicity, but cannot go beyond associations in
the data to reason about causes of the disease [1], [2]. Alternatively,
hypothesis-driven mathematical models capture causal relations, but are
hampered by limited parameter identifiability and predictive power [3],
[4].
We argue that counterfactual inference [5] helps bridge the gap
between data-driven and hypothesis-driven approaches. It enables
questions of the form: “Had we known the eventual outcome of
a patient, what would we have done differently?” At the heart of
counterfactual inference is a formalism known as a structural causal
model (SCM) [5], [6]. It represents prior domain knowledge in terms
of causal diagrams, assumes a probability distribution on exogenous
variables, and assigns a deterministic function to endogenous variables.
SCM are particularly attractive in systems biology, where structured
domain knowledge is extracted from the biomedical literature and is
readily available through advances in natural language processing [7],
[8], [9], large-scale automated assembly systems [10], and semiautomated curation workflows [11]. This knowledge is curated by
multiple organizations [12], [13], [14], [15], [16] and stored in
structured knowledge bases [17], [18], [19], [20]. It can be brought to
bear for answering causal questions regarding SARS-CoV-2.
This manuscript contributes a three-part algorithm that leverages
existing structured biological knowledge to answer counterfactual
questions about viral pathogenesis. Algorithm 1 formalizes biologically relevant questions as queries to an existing causal knowledge
graph. Algorithm 2 converts the query result into a structural causal
model. Algorithm 3 operationalizes the counterfactual inference by
interrogating the model with the observed data to estimate a causal
effect.
We illustrate the benefits of this approach using two case studies.
Case study 1 illustrates the increased precision of counterfactual
estimates, as compared to the ODE- and SDE-based forward simulation,
in a situation with known ground truth mechanisms of data generation.
Case study 2 demonstrates the automated construction of an SCM and
the value of counterfactual reasoning in novel situations with limited
treatment options (as is the case for SARS-CoV-2). It shows that
counterfactual inference enables more precise predictions regarding
who would be likely to survive without receiving treatment, who would

3

be likely to die even if they did receive treatment, and who would
likely survive only if they received treatment.

2 BACKGROUND
Biological signaling pathways Signaling pathways are composed of
entities that engage in activities [21]. Examples of entities are proteins
and metabolites, but also higher level biological processes such as an
immune response. Activities are the producers of change. Examples
include catalytic activity, kinase activity, or transcriptional activity.
The basic unit of causality in signaling pathways is a directed
molecular interaction, where the activity of an upstream molecule
increases or decreases the activity of a downstream molecule. For
example, the mitogen-activated protein kinase (MAPK) intracellular
signaling pathway is a causal chain of directed molecular interactions
shown in Eq. (1)
a(S1 ) → kin(p(Raf )) → kin(p(M ek)) → kin(p(Erk))

(1)

The interactions transmit information about a stimulus at the cell
surface to the nucleus, where proteins called transcription factors
activate an appropriate biological process [22]. A causal diagram of
MAPK consists of a signaling molecule S1 and three proteins Raf ,
M ek, and Erk, each of which engage in kinase activity. We represent
signaling molecule abundance with a(), protein abundance with p()
and the kinase activity of a protein with kin(). In the case of MAPK,
the abundance or activity of an upstream entity causes the abundance
or activity of a downstream entity to increase, and is represented
with a sharp edge →. The diagram is a abstraction showing that the
abundance of the signaling molecule S1 increases the kinase activity of
Raf , which increases the kinase activity of M ek, which increases the
kinase activity of Erk. In other cases, if the abundance or activity of
an upstream entity causes the abundance or activity of a downstream
entity to decrease, we represent this with a blunt edge ­.
Viral dysregulation Viral disruptions of a signaling pathway take
form of overactivation or repression of its activities. For example,
by amplifying the release of intercellular signaling molecules that
overstimulate the immune response, known as Cytokine Release
Syndrome (cytokine storm or CytokineStorm), a virus can cause severe
system-level cellular damage.
Quantitative modeling of biological processes with ODE/SDE Temporal dynamics of biological processes can be expressed quantitatively
using ordinary (or stochastic) differential equations. A small number of
high quality, validated models have been published in the literature and
stored in a computable form in repositories such as Biomodels [23],
[24]. For example, the MAPK signaling pathway in Eq. (1) is well
characterized. We denote R(t), M (t), and E(t) as the respective
amounts of active Raf , M ek, and Erk at time t; We denote TR ,
TM , and TE as their total amounts, which we assume do not change
act
inh
act
inh
act
inh
during the considered timeframe; vR
, vR
, vM
, vM
, vE
, and vE
are
experimentally derived activation or inhibition kinetic rate constants;
and S1 is the amount of the input signal. The system of ordinary
differential equations (ODEs) is specified as follows [25], [26]:
dR
act
inh
= vR
S1 (TR − R(t)) − vR
R(t)
(2)
dt
act 2
(v )
dM
act
inh
= M
R(t)2 (TM − M (t)) − vM
R(t)M (t) − vM
M (t)
inh
dt
vM
(v act )2
dE
act
inh
= Einh M (t)2 (TE − E(t)) − vE
M (t)E(t) − vE
E(t)
dt
vE

Given initial conditions, forward simulations from the ODEs can
be used to generate the temporal trajectories of the amounts of activated
proteins , such as R(t), M (t), and E(t) in the MAPK example. In
this manuscript we refer to such simulated data as observational data.
We define an ideal intervention as an event that fixes the amount of
an activated protein. For example, if we fix the kinase acivity of M ek
at M (t) = m, the second equality dM
in Eq. (2) becomes zero. We
dt

Raf

M ek

Erk

NRaf

fM ek

fErk

NM ek

NErk

(a)

Raf

m0

Erk

fErk

N̂Raf

N̂Erk

(b)

Fig. 1: Causal modeling of MAPK signaling pathway Circles are
variables, double circles are variables intervened upon, squares are
deterministic functional assignments, gray nodes are observed variables,
and white nodes are hidden variables. (a) Structural causal model.
NRaf , NM ek and NErk are statistically independent noise variables.
Root node Raf is only dependent on noise variable NRaf . Nonroot nodes M ek and Erk are dependent on their parent and on the
associated noise variable. (b) Counterfactual model. The intervention
fixes the count of phosphorylated M ek to m0 , such that M ek is no
longer dependent on Raf and NM ek . Given an observed data point,
counterfactual inference infers the noise variables N̂Raf , and N̂Erk .
can simulate data from Eq. (2) with dM
= 0, and refer to these as
dt
interventional data. Contrasting observational and interventional data
helps evaluate the outcome of the intervention [27].
The deterministic ODE ignore the fact that at low concentration,
stochasticity becomes a significant factor in determining the reaction
[28]. As the collisions between molecules participating in biochemical
process become stochastic, a stochastic model is required. In contrast to
ODE, a stochastic differential equation model or stochastic differential
equation (SDE) specifies biological process as a random process. For
example, in the case of MAPK, the random process of the reaction
M ek → Erk is specified with
dPE (t)
act
inh
= gE (t, vE
, vE
, M (t)), E(0) = e0
(3)
dt
where PE (t) is marginal probability density of E(t), function gE
determines the probability of a state change between E(t) and
E(s), s > t, e0 is initial condition, and M (t) is the value of its parent
Mek at t. Once stochastic differential equation are fully specified,
one can use, e.g. Gillespie’s stochastic simulation algorithm [29]
to simulate observational and interventional data, and evaluate the
outcomes of interventions.
Unfortunately, even simple ODEs such as the one in the MAPK
example are difficult to build de novo. This is nearly impossible for
novel and poorly studied systems that lack the existence or findability
of experimental information describing the structure or boundaries
of the process, kinetic equations governing their dynamics [30], rate
constants for these equations, or rules governing each agents’ states
and functions.

Equilibrium enzyme kinetics Simpler and more general quantitative
models can be specified when a reaction reaches the state of chemical
equilibrium [31]. One commonly used such model is Hill function in
the form of
PAn
X
X=β n
(4)
K + PAn
X
where X is the abundance of a protein in a causal diagram (such as Erk
in Eq. (1)), PAX is the set of its parents, n is a parameter interpreted
as the number of ligand binding sites of the protein, and β is the total
number of molecules of the protein. A special and frequently used case
of the Hill function, called Michaelis-Menten function, occurs when
n = 1. Although simple to use, these models are deterministic, and do
not describe the stochasticity that is a distinctive property of biological
systems at low concentrations.
Modeling biological processes with structural causal models The
stochastic nature of biological processes at steady-state can be

4

represented by an SCM such as in Fig. (1) (a) [27], [32]. SCMs
represent the dependencies between a child node X and its parents
PAX in terms of a deterministic function X = fX (PAX , NX ) called
structural assignment, and a noise variable NX . In Fig. (1) (a), fM ek
and fErk are linear or non-linear structural assignments, and NRaf ,
NM ek , and NErk are statistically independent noise variables with
defined probability distributions
Raf = NRaf ; M ek = fM ek (Raf ; NM ek )
Erk = fErk (M ek, NErk )

(5)

An ideal intervention in an SCM is performed on a functional assignment. For example, an ideal intervention on M ek sets M ek = m0 ,
defining a new SCM
Raf = NRaf ; M ek = m0 ; Erk = fErk (M ek, NErk )

(6)

An ideal intervention can also be thought of as a process of mutilating
the causal graph. For example, intervening on M ek eliminates its
dependence upon Raf , and therefore the edge from Raf to M ek is
removed as shown in Fig. (1)(b).
Counterfactual inference with SCM Beyond direct model-based
predictions, SCMs enable counterfactual inference, i.e., the process of
inferring the unseen outcomes of a hypothetical intervention given data
observed in absence of the intervention [5]. In the context of SCM,
counterfactuals are defined as operations
Ydo(T =t0 ) (u) , YMdo(T =t0 ) (u)

(7)

In other words, the outcome Y that individual u would have had she
received treatment t0 is defined as the value that Y would have in
a structural causal model M mutilated to replace T = fT (·) with
T = t0 .
For example, in the MAPK signaling pathway, we may be
interested in the counterfactual question: Having observed the kinase
activities of Raf = r, M ek = m, Erk = e, what would be the kinase
activity of Erk in a hypothetical experiment where the kinase activity
of M ek was fixed to m0 ? This counterfactual query is more formally
translated into
P (Erkdo(M ek=m0 ) |Raf = r, M ek = m, Erk = e)

(8)

The probability distribution in Eq. (8) is estimated with the following
steps:
1)

Abduction: Given observational data, estimate the posterior
distribution of the noise variables. In the MAPK example, we
estimate the posterior distribution of the noise variables:
N̂Raf ={NRaf |Raf = r, M ek = m, Erk = r}
N̂Erk ={NErk |Raf = r, M ek = m, Erk = r}

2)

3)

Several inference algorithms are available for this task, e.g.
Markov Chain Monte Carlo [33], Gibbs sampling [34], or
no-u-turn Hamiltoninan Monte Carlo (HMC) [35]. In recent
years, gradient-based inference algorithms such as stochastic
variational inference [36] have become popular, because they
can scale to larger models by converting an inference problem
into an optimization problem.
Intervention: Apply the intervention to the SCM to generate
a mutilated SCM as in Fig. (1)(b). In the MAPK SCM,
M ek = fM ek (Raf, NM ek ) is replaced with M ek = m0 as
shown in Fig. (1)(b).
Prediction: Generate samples from the mutilated SCM
using the estimated posterior distribution over the exogenous
variables N̂Raf and N̂Erk to obtain the counterfactual
distribution, as shown in Fig. (1)(b).

Causal effects We distinguish between two causal effects. The first is
the average treatment effect (ATE or ATE), defined as the difference
between the outcome of a hypothetical intervention and the observed

outcome in the entire population. In the MAPK example, the ATE of
Erk upon an intervention fixing Raf = r0 is:

Erkdo(Raf =r0 ) − Erk
(9)
This requires no observational data, and therefore the average treatment
effect (ATE or ATE) can be inferred with forward simulation.
On the other hand, the individual treatment effect (ITE or ITE)
is defined as the difference between the outcome of a hypothetical
intervention and the observed outcome for a specific individual or
context. In the MAPK example, the individual treatment effect of Erk
upon an intervention fixing Raf = r0 in a context where Raf = r,
M ek = m, Erk = e is:

Erkdo(Raf =r0 ) − Erk |Raf = r, M ek = m, Erk = e
(10)
The ITE shares stochastic components of the noise variables between
observational and interventional data, and is therefore often more
precise than a comparison based on a direct simulation [27].
In cases where domain knowledge is available to describe the
systems dynamics in the form of an SDE, the system at equilibrium
can be translated into an SCM to enable counterfactual reasoning and
estimation of the individual treatment effect [27], [37]. Unfortunately,
this process is challenging in novel and poorly studied systems, due to
our limited ability to establish the structure of the causal graph.
Structured knowledge graphs Although there exist a multitude
of biological knowledge bases that are manually curated from the
literature [12], [13], [14], [15], [16], the systems biology community
has coalesced around a small number of structured knowledge
representations that differ mainly in their intended purpose. For
example, the Biological Pathway Exchange Language (BioPAX) [17]
was designed for pathway database integration [17], and the Systems
Biology Graphical Notation (SBGN) [19] was designed for graphical
layout [19].
In contrast, the Biological Expression Language (BEL) [20] was
specifically designed for manual extraction and automated integration
of author statements about causal relationships among biological entities, biological processes, and cellular-level observable phenomena [11].
The syntax of a BEL statement is comprised of a triple in the form
of {subject, predicate, object}. Each subject and object represents an
activity or abundance whose entities are grounded using terms from
standard namespaces. If the subject directly increases the abundance
or the activity of the object, we represent this with =>, and for directly
decreasing relationships, we use =|. BEL statements can be chained
together from the object of the first statement to the subject of the next
statement, as shown in Fig. (2) for the case of the MAPK pathway.
BEL provides a number of valuable features for causal modeling.
First, the restriction of BEL edges to causal relations implies the
topology of the BEL graph can be reflected in the topology of the
causal model. Second, the language is expressive enough for humans
to manually curate a wide range of biological concepts, but formal
enough to serve as a training corpus for natural language processing
of biomedical literature (BioNLP) competitions [38]. Third, the BEL
ecosystem is sufficiently mature that causal knowledge represented in
other languages can be readily converted to BEL [39], [40].

3

M ETHODS

3.1

Notation, definitions and assumptions

Let X = {Xi } be a set of variables, such as molecular activities in a
signaling pathway. Let P = {Pj } be a set of causal predicates that
link these variables, such as increases, or regulates. Using this notation,
we define a knowledge graph K as a set of k triples
K = {Xi , Pj , Xi0 |Xi ∈ X, Pj ∈ P, Xi0 ∈ {X \ Xi }}kj=1
c

e

z

(11)

We define a causal query Q as a set {X , X , X } of variables that
are potential causes, effects and covariates of interest for the biological
investigation, where
Xc ⊂ X, Xe ⊂ X\Xc , and Xz ⊂ X\Xc \Xe

5

kin(p(fplx:RAF)) => kin(p(fplx:MEK))
kin(p(fplx:MEK)) => kin(p(fplx:ERK))

Fig. 2: Example BEL statement The statement details the processes in the MAPK signaling pathway in Eq. (1). The first line states that the
kinase activity of RAF directly increases the kinase activity of MEK. The second line states that kinase activity of MEK directly increases the
kinase activity of ERK.

Algorithm 1 Causal query to Biological Expression Language
(QUERY 2 BEL or https://github.com/bel2scm) algorithm
Inputs: knowledge graph K
causal query Q = {Xc , Xe , Xz }
Outputs: B

Algorithm 2 Biological Expression Language to Structural Causal
Models (BEL 2 SCM or https://github.com/bel2scm) algorithm
Inputs: BEL statements B
D ∼ P (X1 , ..., Xp )
Outputs: SCM M = {fi (PAi , Ni )}pi=1

1: procedure QUERY 2 BEL(Xc , Xe , Xz , K)
2:
I Get all pathways from cause to effect
c
e
e
3:
for each cause Xic ∈ X
 andc for eeach
 effect Xj ∈ X do
4:
find all pathways P Xi , Xj
5:
I Get all pathways from covariates to causes
c
c
6:
for each covariate Xiz ∈ Xz and for
 each cause Xj ∈ X do
7:
find all pathways P Xiz , Xjc
8:
I Get all pathways from covariates to effects
e
e
9:
for each covariate Xiz ∈ Xz and for
 each effect Xj ∈ X do
z
e
10:
find all pathways P Xi , Xj






11:
B = P Xic , Xje ∪ P Xiz , Xjc ∪ P Xiz , Xje
12:
return B

1: procedure BEL 2 SCM(B, D)
2:
M = {}
3:
Get network structure G from B.
4:
for each R ∈ R in G do
5:
I Use D to estimate parameters θ of P(R; θ)
6:
θ = arg maxθ P(R; θ | D)
7:
I Reparameterize P(R; θ) in terms of fR and NR
8:
NR ∼ N (0, 1)
−1
9:
fR (NR ) = FP(R;θ)
(NR )
10:
M.Add(fR (NR ))
11:
for each X ∈ {X \ R} in G do
12:
I Estimate parameters w and b of sigmoid function
13:
log( βXX−X ) = w0 PAX + b
14:
I Define distribution of NX from model residuals.
βX
15:
residual = X − 1+exp(−w
0 PA −b)
X
16:
NX ∼ N (0, M SE(residual))
17:
I Get fX (PAX , NX ) with additive NX .
18:
fX (PAX , NX ) = 1+exp(−wβ0XPA −b ) + NX
X
X
X
19:
M.Add(fX (PAX , NX )).
20:
return M

A pathway P(X1 , Xk0 +1 ), k ≤ k0 is a sequence of a subset of triples
from K, where the object of the previous triple is subject of the next
triple
{(X1 , P1 , X2 ) , (X2 , P2 , X3 ) , . . . , (Xk0 , Pk0 , Xk0 +1 )}

(12)

Our goal is to query the knowlege graph to generate a qualitative
causal model B that links the causes, the effects and the covariates
of interest. Importantly, the query result B induces a directed acyclic
graph G with p variables from X as nodes, and causal relations from
P as edges.
We assume that every variable in B is continuous. We denote
D = {X1j , X2j , ..., Xpj }m
j=1 the observational data of m samples
from the joint distribution P(X; θ). The distribution is specified in
terms of parameters θ. We denote R ⊂ X a set of nodes in G without
parents.

3.2 Querying a knowledge graph to obtain a qualitative
causal model
Given a biological knowledge graph K and a causal query of interest
Q, our first objective is to generate a qualitative causal model B
capable of answering the query. To this end, we need to explore all
potential directed acyclic paths in K from the cause to the effect in
Q, and then consider all covariates that may act as confounders of the
causal question. This is done with the steps in Alg. 1. The algorithm
can be implemented on any knowledge graph that represents causal
relationships as directed edges, such as BEL or the Systems Biology
Graphical Notation Activity Flow [19] (SBGN-AF) language [41].
In the case of MAPK, the qualitative causal model that is capable
of answering the counterfactual question in Eq. (8) corresponds
to the result of this query: Q = {Xc = kin(p(MEK)), Xe =
kin(p(ERK)), Xz = kin(p(RAF))}.
We execute Alg. 1 step 2 to obtain all pathways from the cause to
the effect:
kin(p(MEK)) → kin(p(ERK))
We execute Alg. 1 step 5 to obtain all pathways from the covariate to
the cause:
kin(p(RAF)) → kin(p(MEK))

We execute Alg. 1 step 8, but since there are no new pathways from
the covariate kin(p(RAF)) to the effect kin(p(ERK)), we obtain the
empty set. The final returned model is:
kin(p(RAF)) → kin(p(MEK)) → kin(p(ERK))

3.3 Compiling a qualitative causal model to a quantitative structural causal model
Our second objective is to express the qualitative causal structure in B
into a quantitative SCM, and estimate the parameters of the SCM from
experimental data. These steps are described in Algorithm 2.
Input The algorithm takes as input a BEL causal query result B and
observed measurements on its variables D.
Get network structure G from B (Alg. 2 line 3) Since a set of BEL
statements identifies parents and children, it induces a causal network
structure. We determine this structure by traversing BEL statements
with the breadth first search approach, starting with root variables (such
as Raf in Figure 2). For all the non-root variables, the algorithm waits
until all the parents are traversed.
For each root node R, use D to estimate parameters θ of
P(R; θ)(Alg. 2 line 5) In order to specify the SCM, we need to
define the type and parameters of the marginal probability distributions
of the root variables P(R; θ). The BEL statements provide prior
knowledge about the distribution in a parametric form. Therefore, this
step involves techniques such as maximum likelihood to estimate the
parameters of this distribution.
For example, in a stochastic MAPK system at equilibrium the
root variable the number of active Raf in a cell follows a Binomial
distribution. When the maximum number of active or inactive particles
in the system is large, the Binomial distribution can be approximated

6
0

the parent nodes, w is a 1 × q vector of weights, w is the transpose of
w, and b is a scalar bias. Parameters w and b of the sigmoid function
are estimated from the data, e.g. using smooth L1 loss function.
In the example of the MAPK pathway, fM ek has only one parent.
Therefore fM ek has the form

100

X

95

fM ek (Raf, NM ek ) =

90

85
Hill,n=1, k=30
Hill,n=2, k=30
Hill,n=3, k=30
sigmoid,w=.025,b=0.4
sigmoid,w=.1,b=0.3
sigmoid,w=.05,b=0.4

80
40

50

60
70
Parent of X

80

90

Fig. 3: Examples of Hill function and sigmoid function for two
variables X is a single nodenthat has a single parent PAX . We use the
PAX
Hill function (X = β K n +PA
n ) and sigmoid function as in Eq. (15)
X
to predict the value of X given its parent value. In the Hill function,
K is the activation rate, n defines the steepness of function and β
is fixed at 100. Blue lines correspond to Hill equation with K = 30
and n ∈ {1, 2, 3}. Brown lines correspond to sigmoid function where
b ∈ {0.4, 0.3, 0.4} and w ∈ {0.025, 0.1, 0.5}
2
with a Normal distribution with θRaf = (µRaf , σRaf
). We then
estimate θRaf using maximum likelihood from the observed Raf in
D.

For each root node R, reparameterize P(R; θ) in terms of fR
and NR (Alg. 2 line 7) The specification of an SCM requires us to
separate the deterministic and the stochastic components of variation
of each variable as shown in Fig. (1). We accomplish this using a
reparameterization technique popularized by variational autoencoders
[42], which was shown to make counterfactual inference consistent
with core biological assumptions [43]. In the case of root nodes, we
reparameterize P(R; θ) with Uniform(0,1), and then pass it to the
inverse CDF of P(R; θ), as follows
Original :
Reparametrized :

R ∼ P(R; θ)
NR ∼ Uniform(0, 1)
−1
fR (NR ) = FP(R;θ)
(NR )

(13)

−1
where FP(R;θ)
(NR ) is the inverse cumulative distribution function
of P(R; θ). In the case of MAPK, since Raf follows a Normal
distribution with parameters θRaf , the reparameterization simplifies
even further to

Original :
Reparametrized :

2
Raf ∼ N (µRaf , σRaf
)
(14)
NRaf ∼ N (0, 1)
fRaf (NRaf ) = σRaf NRaf + µRaf

For each X ∈ {X \ R}, estimate parameters w and b of sigmoid
function (Alg. 2 line 12) In order to specify the SCM for non-root
nodes, we need to define the form (polynomial, linear, non-linear,
sigmoid, etc.) of functional assignments linking the measurements
on the parent nodes to the measurements on the child. We chose the
functional assignment in the form of a sigmoid function


X
log
= w0 PAX + b
(15)
βX − X
where βX is the maximum number of activated protein molecules. For
a node X with q parents, PAX is a q × 1 vector of measurements on

(16)

We use the sigmoid function in Eq. (15) as a special case of the Hill
equation. The full parametric description of the Hill equation has a
nuanced precise biochemical interpretation. For example, the parameter
n represents the number of times a protein must be phosphorylated
before it becomes active and can therefore be obtained from domain
knowledge. However, it is difficult to estimate this parameter from data.
The sigmoid function maintains the Hill equation’s functions, but with
a reduced set of parameters that are easier to estimate. Fig. (3) shows
that the approximation is reasonable for a range of parameter values.
Define distribution of NX from model residuals (Alg. 2 line 14)
Similarly to the root variables, for non-root variables we assume
that the noise variables follow Normal distribution with 0 mean. The
variance of this distribution is estimated from the residuals of the
model fit in the previous step. For example, in the MAPK pathway,
fM ek has only one parent Raf . Therefore, the residuals of the sigmoid
curve fit for M ek are defined as
βM ek
residualM ek = M ek −
(17)
1 + exp(−wM ek Raf − b)
and the distribution of the noise variable is defined as NM ek ∼
N (0, M SE(residualM ek ))
Get fX (PAX , NX ) with additive NX (Alg. 2 line 17) The step
combines the sigmoid functional assignment and the independent noise
variable. In the example of M ek in the MAPK pathway, the step
outputs
fM ek (Raf, NM ek ) =

βM ek
+ NM ek
1 + exp(−wM ek Raf − b)

(18)

Add fX (PAX , NX ) to SCM (Alg. 2 line 19) The step iteratively
adds (fX , NX ) for all X ∈ X.
Output (Alg. 2 line 20) The algorithm returns a generative
structural causal model M = {fi (PAi , Ni )}pi=1 where PAi ⊂
X. For example, in the case of the MAPK model, it returns
[NRaf , NM ek , NErk , fRaf (NRaf ), fM ek (Raf, NM ek ),
fErk (M ek, NErk )].

3.4

Counterfactual inference procedure

The generated SCM enables counterfactual inference using a standard
procedure [5]. Given a new observation Dnew ,
1)
2)

Add R to M (Alg. 2 line 10) For each root node, we add the
corresponding function fR (NR ) and its noise variable NR to M. For
example, since MAPK has only one root node Raf , the Algorithm
adds fRaf (NRaf ) to M.

βM ek
+ NM ek
1 + exp(−wM ek Raf − b)

3)

Abduction: Update the probability P (NX ) to obtain
P (NX |Dnew ).
Action: Replace the equations determining the variables in
set Xc by Xc = xc0 .
Prediction: Sample from the modified model to generate the
target distribution Xedo(Xc =xc0 ) .

After generating the target distribution of the intervention model, we
estimate causal effects. Alg. 3 describes the detailed steps of both
counterfactual inference (with Dnew ) and forward simulation (if Dnew
is empty)

3.5

Implementation

Causal query to Biological Expression Language (QUERY 2 BEL
or https://github.com/bel2scm) was implemented manually using a
publicly available instance of BioDati Studio [44], then validated
using Integrated Dynamical Reasoner and Assembler (INDRA) [10]’s
interactive dialogue system Bob with BioAgents [10]. Parameter
estimation in Biological Expression Language to Structural Causal

7
E

Algorithm 3 Estimate causal effect on X upon intervening on X

C

Inputs: New data point Dnew
effect node X E
observational data for effect node DE ∈ Dnew
intervention value c
node to intervene upon X C
number of iteration I
network structure G
SCM M
Outputs: Causal Effect CE
new

E

C

1: procedure GET C AUSAL E FFECT(D
, E, D , X , c, I, G, M)
2:
N̂ = {}
3:
I Interventional data for effect node X E
4:
IDE = {}
5:
for I do
6:
for each X ∈ {X \ X C } in G do
7:
I Abduction: Apply stochastic variational inference
8:
N̂X = SV I(Dnew )
9:
N̂ .Add(N̂X )
10:
I Action: Apply intervention on X C
11:
CM = pyro.do(M, X C = c)
12:
I Get posterior of CM with importance sampling
13:
CM P = pyro.inf er.Importance(CM, N̂ )
14:
I Prediction: Get EmpiricalMarginal (EM) for X E
15:
CM M = pyro.inf er.EM (CM P, X E )
16:
IDE .Add(CM M )
17:
CE = IDE − DE
18:
return CE

Models (BEL 2 SCM or https://github.com/bel2scm) was implemented
in PyTorch. Let C be the number of nodes in causal graph G with
parents. Let k be the number of iterations for gradient descent, let N
be the number of samples in data, and let d be the maximum number of
parents in graph G. Computational complexity of parameter estimation
step is given by O(CkN d).
SCM-based counterfactual inference was performed with Pyro [45],
due to its ability to perform interventions on probabilistic models and scalability to larger models, as described in Alg. 3.
Specifically, the implementation relies on the following functionalities in Pyro. The pyro.do method is an implementation of Pearl’s do-operator used for causal inference. The
pyro.infer.SVI method performs abduction using stochastic variational inference with ELBO loss. The pyro.infer.Importance
method performs posterior inference by importance sampling. The
pyro.infer.EmpiricalMarginal method performs empirical
marginal distribution from the trace posterior’s model.
Experiments in this manuscript took between 13 to 82 seconds
depending on the graph size on a system with Intel Core i7 8th Gen
CPU, 16 GB RAM and Ubuntu 18.04 Operating System. The code is
available at https://github.com/bel2scm.

4 C ASE S TUDIES
Below we introduce two biological case studies investigated using the
approach proposed in this manuscript. The first case study allows us to
evaluate the accuracy of the results based on known ground truth. The
second uses counterfactual reasoning to pinpoint the mechanism by
which SARS-CoV-2 infection can lead to a cytokine storm in severely
ill coronavirus disease 2019 (COVID-19) patients. The details of the
case studies, parameter values of the simulations, and of the results are
at https://github.com/bel2scm.
4.1

Case study 1: the IGF signaling system

The system The insulin-like growth factor (IGF) signaling pathway
(Figure 4) regulates growth and energy metabolism of a cell. The IGF
system has been extensively investigated, and its dynamics are well
characterized in form of ODE and SDE models [25]. Activated by

cellular membrane

EGF

IGF
RasGap

SOS

Ras

PI3K

Raf

Akt

RafPP

p90
Mek

PP2A

Erk

nucleus

Fig. 4: Case Study 1: the IGF signaling system The insulin-like
growth factor (IGF) and epidermal growth factor (EGF) are receptors
of external stimuli, triggering downstream signaling pathways that
include the MAPK pathway. All the relationships between abundances
of activated proteins in this network are of the type increase, except for
the relationship between Akt and Raf which is of the type decrease.

external stimuli, insulin-like growth factor (IGF) or epidermal growth
factor (EGF) triggers a signaling event, which includes the MAPK
signaling pathway in Eq. (1). Similarly to Eq. (1), nodes in the system
are kinase activities, and edges represent whether the kinase activity of
the upstream protein directly increases or decreases the kinase activity
of the downstream protein. However, the system is larger and more
complex. It includes two different paths from Ras to Erk, one direct
and the other through P I3K and Akt. This challenges estimates of
outcomes of interventions. In this case study, we assume that the IGF
system has no unobserved confounders.
Intervention We considered two interventions. The first fixes the
kinase activity of M ek to 40. The second fixes the kinase activity of
Ras to 30.
Causal effects of interest We are interested in two causal questions.
First, what would have been the kinase activity of Erk had we
intervened to fix the kinase activity of M ek to 40? The second query
is as above, but with the intervention fixing the kinase activity of Ras
to 30. More formally, we are interested in the average treatment effect

Erkdo(M ek=40) − Erk
(19)

Erkdo(Ras=30) − Erk
(20)
Next, we introduce a new piece of information about a specific data
point generated from the ODE-based simulation. We wish to estimate
the causal effect of intervention for this specific data point. More
formally, we are interested in the individual treatment effect

Erkdo(M ek=40) − Erk |Dnew
(21)

new
Erkdo(Ras=30) − Erk |D
(22)
where Dnew is a new data point. We note that this counterfactual
inference can only be performed with an SCM. We wish to compare
these estimates of causal effects, in order to characterize the ability
of counterfactual inference via Dnew to improve the precision of the
estimates.
Evaluation The kinetic equations described by the ODE and SDE
represent the true underlying dynamics of the IGF signaling pathway.
Since the ODE and the SDE can estimate the causal effects by forward
simulation, we view the estimates as the ground truth. We then wish
to compare the estimates from the SCM against the ground-truth
estimates from the ODE and the SDE. Since an SCM represents causal

8

70
60
50
40

30

40

Samples from SDE
Samples from SCM
Fitted sigmoid line

50

60

Raf
Fig. 5: Case study 1: IGF model Scatter plot of M ek versus Raf .
Blue points are the data points generated by SDE. Yellow points are the
estimates from SCM. The red line is the fitted sigmoid curve in Alg. 2
line 12.

Case study 2: host response to viral infection

Intervention Originally developed to treat autoimmune disorders
such as rheumatoid arthritis [50], Tocilizumab (Toci or Toci) is an
immunosuppressive drug consisting of a recombinant monoclonal
antibody that targets the soluble Interleukin 6 receptor and can
effectively block the IL6 signal transduction pathway [51]. Tocilizumab
has emerged as a promising drug repurposing candidate to reduce
mortality in severely ill COVID-19 patients [52], [53].
Causal effect of interest We define a severely ill COVID-19 patient as
someone with CytokineStorm > 65. We are interested in the individual
treatment effect (ITE)
n
o
CytokineStormdo(T oci=0) − CytokineStorm |Dnew (23)
where Dnew is an observed patient who received Tocilizumab treatment
and became severely ill. We wish to characterize the severity of
cytokine storm which would have occurred had she not received the
treatment. We further wish to compare the ITE with the average
treatment effect (ATE or ATE)
n
o
CytokineStormdo(T oci=0) − CytokineStorm
(24)
Evaluation Tocilizumab is known to have a strong inhibitory effect on
soluble Interleukin 6 receptor. We therefore expect that the severity of
the cytokine storm would have been worse had the patient not received
treatment. Unfortunately, at the time of writing, there were no ODE or
SDE-based models of the pathway, nor were there publicly available
COVID-19 datasets quantifying the kinase activity of the Interleukin 6
Amplifier pathway at the single-cell level. Therefore, we simulated data
from a “ground-truth” sigmoidal structural causal model, where the
topology reflects the causal structure of the pathway, and the numeric
values of the parameters were fixed to reflect our prior qualitative
knowledge of the IL6-AMP pathway.
We evaluate the ITE the proposed approach in two ways. First, we
train the parameters of the SCM using the simulated data, and compare
the counterfactual inference of the ITE obtained from the “trained”
SCM to the counterfactual inference of the ITE from the “ground-truth”
SCM. This comparison allows us to characterize the impact of weight

1400

1400

1200

1200

1000

1000

Count

The system Retrospective studies have indicated that high levels of
pro-inflammatory cytokine Interleukin 6 (IL6 or IL6) are strongly
associated with severely ill COVID-19 patients [46]. One recently
proposed explanation for this is the viral induction of a positive
feedback loop, known as Interleukin 6 Amplifier (IL6-AMP or
IL6-AMP) [47]. IL6-AMP is stimulated by simultaneous activation of
nuclear factor kappa-light-chain-enhancer of activated B cell (NF-κB
or NF-κB) and Signal Transducer and Activator of Transcription 3
(STAT3 or STAT3) [48]. This in turn induces various pro-inflammatory
cytokines and chemokines, including Interleukin 6, which recruit
activated T cells and macrophages. This strengthens the Interleukin 6
Amplifier into a positive feedback loop leading to a cytokine storm [49],
which is believed to be responsible for the tissue damage observed in
patients with acute respiratory distress syndrome (ARDS) [47].

Count

4.2

80

Mek

relationships at steady state, we train the parameters of the SCM using
data generated from the ground-truth SDE after it has reached steady
state.
We consider two types of evaluations. First, we compare the
estimates of the forward simulation of the ODE and SDE with the
forward simulation of the SCM. This allows us to characterize the
impact of SCM specification and estimates of weights on the accuracy
of causal effects. We do not expect to see a substantial difference
between these two approaches for a correctly specified SCM. We
then compare the SCM-based counterfactual inference of causal
effects with the estimates based on forward simulation. We expect
that the counterfactual inference will provide more precise estimates,
illustrating the statistical efficiency of counterfactual inference as
compared to the forward simulation.

800

800

600

600

400

400
200

200
0 25

30

35

40

45

SOS

(a)

50

55

60

0

50

60

PI3K

70

80

(b)

Fig. 6: Case study 1: probability distributions of the root nodes
of IGF model (a) Histogram of SOS generated from SDE simulation
(b) As in (a), for P I3K .

estimation on the accuracy of causal effects. We expect that the need to
estimate the weights will inflate the variance of the estimates. Second,
we compare the estimates of ITE to the estimates of the ATE using the
trained SCM. This comparison allows us to characterize the statistical
efficiency of counterfactual inference when estimating causal effects.
We expect that the ITE will provide much more precise estimates.

5
5.1

R ESULTS
Case study 1: the IGF signaling system

Generating BEL causal model The BEL representation of the IGF
system was manually curated using BioDati studio [44], to match
the existing ODE and SDE. The BEL representation of the IGF
system specified all the node types as in category abundance. All
the relationships between parents and children nodes were of type
increase, except for the parent node Akt, where the relationship was
of type decrease.
Observational data We mimicked the process of collecting observational data by simulating kinase activity from the corresponding ODE
and SDE. The initial number of particles for the receptor was 37 for
EGF and 5 for IGF . The deterministic simulation numerically solved
the ODE using the deSolve [54] R package. The stochastic simulation
used the Gillespie algorithm [29] from the smfsb [55] R package.
Appropriateness of model assumptions SCM-based estimates of
functional assignments with sigmoid approximations were well within
the range of the SDE-based data (as shown for Raf and M ek in
Fig. (5)). Similar results were obtained for estimates of Ras, P I3K ,
AKT , Raf , and Erk. The fitted functional assignment had little
curvature. This indicates that a more complicated function with more
parameters, such as Hill equation, was unnecessary in this case.
To further evaluate the plausibility of the assumptions, Fig. (6)
shows the histograms of the SDE-generated abundances of root nodes,

9

Probability density

0.175
0.150
0.125

ODE
SDE
SCM with estimated
weights (ITE)

0.200
0.175

Probability density

ODE
SDE
SCM with estimated
weights (ITE)

0.200

0.150
0.125

0.100

0.100

0.075

0.075

0.050

0.050

0.025

0.025

0.000 25

20

15

10

5

0

5

10

Causal effect on Erk upon intervention on Mek

0.000 25

20

15

(a)

0.150
0.125

0.200
0.175

Probability density

Probability density

0.175

5

0

5

10

(b)

ODE
SDE
Forward simulation from SCM
with estimated weights (ATE)

0.200

10

Causal effect on Erk upon intervention on Ras

0.150

ODE
SDE
Forward simulation from SCM
with estimated weights (ATE)

0.125

0.100

0.100

0.075

Fig. 8: Case study 2: host response to viral infection Pointed edges

0.075

0.050

represent relationships of type increase; flat-headed edges represent
relationships of type decrease. Nodes SARS-COV2 and Toci are
external stimuli.

0.050

0.025

0.025

0.000 25

20

15

10

5

0

5

10

Causal effect on Erk upon intervention on Mek

(c)

0.000 25

20

15

10

5

0

5

10

Causal effect on Erk upon intervention on Ras

(d)

Fig. 7: Case study 1: estimated causal effects of the IGF signaling
pathway using Alg. 3. The ODE and SDE represent the true
underlying dynamics of the IGF signaling pathway. The ODE and
SDE-based forward simulation can only estimate the average treatment
effect. These estimates are viewed as ground truth. In contrast, an SCM
can estimate both the average treatment effect (ATE) and the individual
treatment effect (ITE). (a) Comparison of ITE vs ATE for Erk when
M ek is fixed. (b) Comparison of ITE vs ATE for Erk when Ras is
fixed. (c) Comparison of SCM, SDE and ODE estimates of the ATE
for Erk when M ek is fixed. (d) Comparison of SCM, SDE and ODE
estimates of the ATE on Erk when Ras is fixed.

which were not affected by functional assignments in SCM. The shape
of the histograms indicate that the assumption of Normal distribution
was plausible.
Accuracy of causal effects Fig. (7)(c) and (d) show that the average
treatment effects (ATEs or ATEs) on Erk of fixing M ek and Raf ,
based on forward simulation of ODE, SDE and SCM, were consistent.
Fig. (7)(a) and (b) show that the individual treatment effects (ITEs or
ITEs) based on counterfactual inference has a smaller variance than
the ATE. Since counterfactual inference reduces nuisance variation
by sharing stochastic components in contexts with and without
intervention, it increases the statistical efficiency of the estimation.
The individual treatment effect on Erk by fixing M ek was much
stronger than the ITE on Erk by fixing Ras for the following reason.
While M ek directly influences Erk (i.e., there is a single path from
M ek to Erk), Ras has two pathways to Erk. The path through AKT
has an inhibiting (deactivation) effect on Raf , and estimated negative
weights in the sigmoid function in Eq. (15). The alternative path, a
cascade from Ras to Erk, has the opposite (activating) effect on Erk.
The two paths mitigate the overall causal effect of Ras on Erk.

5.2

Case study 2: host response to viral infection

Generating BEL causal model The steps of the proposed Alg. 1
produced the qualitative causal model in Fig. (8), and the corresponding
BEL causal model B, as follows. In accordance with the inputs
to Alg. 1, we defined the knowledge base K as the Covid-19
knowledge network automatically assembled from the COVID-19
Open Research Dataset (CORD-19) [56] document corpus using
the INDRA workflow. We defined the cause Xc as sIL6Rα, the

effect Xe as cytokine storm, and the covariates Xz as SARS-CoV2 and Toci. Therefore the causal query of interest was defined as
Q = {sIL6Rα, CytokineStorm, {SARS-CoV-2, Toci}}.
Alg. 1 line 2 generated all pathways from soluble Interleukin 6 receptor to Cytokine Release Syndrome, resulting in
kin(p(sIL6Rα)) → kin(p(IL6-STAT3)) → bp(IL6-AMP) →
bp(CytokineStorm), where bp() is a biological process. Next, line
5 generated all pathways from Tocilizumab to soluble Interleukin
6 receptor: a(Toci) ­ kin(p(sIL6Rα)), where a() is the dosage
level of Tocilizumab. We then generated all pathways from severe
acute respiratory syndrome coronavirus 2 to soluble Interleukin 6
receptor: pop(SARS-CoV-2) ­ cat(ACE2) ­ a(Angiotensin II) →
kin(p(AGTR1)) → kin(p(ADAM17)) → kin(p(sIL6Rα)), where
pop() is the viral load of SARS-CoV-2 and cat() is the normal catalytic
activity of Angiotensin Converting Enzyme 2.
Line 8 found no new branches from Tocilizumab to Cytokine Release Syndrome. Finally, we generated all pathways
from severe acute respiratory syndrome coronavirus 2 to Cytokine Release Syndrome, which resulted in three new branches
pop(SARS-CoV-2) → kin(p(PRR)) → kin(p(NF-κB)) →
bp(IL6-AMP)), kin(pADAM17)) → p(EGF) → kin(p(EGFR)) →
kin(p(NF-κB)), and kin(p(ADAM17)) → kin(p(TNFα)) →
kin(p(NF-κB)).
Observational data We simulated observational data from a “groundtruth” sigmoidal structural causal model, where the topology reflects
the causal structure in Fig. (8), and the parameters reflect our
prior qualitative knowledge of the IL6-AMP pathway. The root
nodes SARS-CoV-2 and Tocilizumab were sampled from a Normal
distribution with mean of 50 and standard deviation of 10. The nonroot nodes were sampled from a sigmoid function as in Eq. (15). Since
we have prior qualitative knowledge that IL6-AMP is only activated
due to simultaneous activation of NF-κB and IL6-STAT3, we set the
threshold for activation above what could be achieved by NF-κB or
IL6-STAT3 alone. Since we also know that Toci is a strong inhibitor
of sIL6Rα, we set the inhibition coefficient to a large negative number.
The parameters of the sigmoid function were chosen to ensure that the
variables were in the desired range of 0–100. Finally, we randomly
generated two new individuals Dnew with Cytokine Release Syndrome
> 65 to represent severely ill patients. The first patient had a higher
viral load of SARS-CoV-2 and received a lower dose of Toci. The
second patient had a lower viral load of and received a higher dose of
Toci.
Estimation of individual-level treatment effect Fig. (9) evaluates the
SCM-based estimates of the individual treatment effect of withholding

10

0.40
0.35

SCM with known weights (ITE)
SCM with estimated
weights (ITE)

0.40
0.35

SCM with known weights (ITE)
SCM with estimated
weights (ITE)

0.30

Proability density

Proability density

0.30

0.25

0.25

0.20

0.20

0.15

0.15

0.10

0.10

0.05

0.05
0.00 10.0 7.5

5.0

2.5 0.0

2.5

5.0

7.5

0.00 10.0 7.5

5.0

2.5 0.0

2.5

5.0

7.5

Causal effect of setting Toci to 0 on cytokine storm

Causal effect of setting Toci to 0 on cytokine storm

(a)

(b)

Fig. 9: Case study 2: SCM-based estimates of the individual
treatment effect (ITE or ITE) using Alg. 3. Blue histogram: the ITE
estimated from the ground-truth SCM using Alg. 3. Yellow histogram:
the ITE estimated from the Alg. 2-trained SCM using Alg. 3. (a)
Patient has a high viral load and received a low dose of Tocilizumab.
(b) Patient has a low viral load and received a high dose of Tocilizumab.
Both patients were severely ill.

0.35

Proability density

0.30

Forward simulation from SCM
with estimated weights (ATE)
SCM with estimated
weights (ITE)

0.25

0.35
0.30

Forward simulation from SCM
with estimated weights (ATE)
SCM with estimated
weights (ITE)

0.25

0.20

0.20

0.15

0.15

0.10

0.10

0.05
0.00 10.0 7.5

0.40

Proability density

0.40

0.05
5.0

2.5 0.0

2.5

5.0

7.5

0.00 10.0 7.5

5.0

2.5 0.0

2.5

5.0

7.5

Causal effect of setting Toci to 0 on cytokine storm

Causal effect of setting Toci to 0 on cytokine storm

(a)

(b)

Fig. 10: Case study 2: SCM-based estimates of the average
treatment effect (ATE or ATE) and of the ITE using Alg. 3. Yellow
histogram: the ITE estimated using counterfactual inference. Brown
histogram: the ATE estimated using forward simulation. (a) Patient has
a high viral load and received a low dose of Tocilizumab. (b) Patient
has a low viral load and a received a high dose of Tocilizumab. Both
patients were severely ill.

treatment from two COVID-19 patients who were severely ill. The
distribution of the individual treatment effect obtained with the SCM
trained using Alg. 2 was consistent with, but had a slightly larger
variance then, the distribution of ITE obtained with the “ground truth"
SCM with known weights. Even though both patients had the same
severity of illness prior to the intervention, patient B was estimated to
have a more severe cytokine storm after Toci was withheld.
Fig. (10) further compared the individual treatment effect obtained
with the SCM trained using Alg. 2 with the average treatment
effect estimated from the same model using forward simulation. The
distribution of the individual treatment effect was patient-specific
and had smaller variance, thus illustrating the statistical efficiency of
counterfactual inference.

6

D ISCUSSION

We proposed a general approach that leverages structured qualitative
prior knowledge, automatically generates a quantitative SCM, and
enables answers to counterfactual research questions. In both case
studies, the use of the Biological Expression Language allowed us
to leverage large repositories of structured biological knowledge
to specify an SCM and perform counterfactual inference in an
automated manner, which would otherwise require a substantial manual

effort. The application to the IGF signaling system demonstrated the
appropriateness of the underlying assumptions, and the accuracy of the
results when compared to ODE- and SDE-based forward simulation.
The application to a study of host response to SARS-CoV-2 infection
demonstrated the feasibility, versatility and usefulness of this approach
as applied to an urgent public health issue. In particular, the approach
can help determine the amount of Tocilizumab (Toci or Toci) required
to reduce the severity of each individual’s cytokine storm. Furthermore,
in situations where treatment options are limited (as is the case SARSCoV-2), counterfactual estimates enable a more precise conclusion
regarding who would likely live without receiving the treatment, who
would likely die even if they did receive the treatment, and who would
likely live only after receiving the treatment.
The approach opens multiple directions for future research. In
particular, future work can extend the configurability of the BEL 2 SCM
algorithm by incorporating the rich type information in BEL, mapping
parent-child type signatures to functional forms such as post-nonlinear
models, neural networks, mass action kinetics and Hill equations, and
incorporating additional data types such as binary variables, categorical
variables, and continuous variables with constraints on their domains.
In some cases, the variables in the model may not be directly observable, but may nonetheless be characterized by means of detectable
molecular signatures. For example, even if interferon signaling may
not be directly observable using transcriptomics measurements, it may
still be possible to infer the activity of interferon signaling by an
upregulation of interferon stimulated genes (ISG). Future work will
focus on leveraging molecular signature databases to infer the activity
of variables in the model, and on learning and/or evaluating the models
using experimental data [57].
We also note that experimentalists typically formulate biological
processes as linear pathways (e.g., from S1 to Erk in the MAPK
example) that can be effectively perturbed and measured in a laboratory
setting. Yet such boundaries of biological processes are quite arbitrary,
and are therefore highly susceptible to confounders. One way to address
this issue is to search the knowledge graph for all common causes of
variables in the causal model, use an identification algorithm [58] to
find the minimal valid adjustment set of the augmented model, and
then prune all common causes that do not contribute to that set. This
approach will require us to tackle the issues of parameter and causal
identifiability in the presence of confounders.
In addition to unobserved confounders, the validity of causal
inferences can be threatened by feedback loops, model misspecification,
missing data, and out-of-sample distributions. To address the possibility
of feedback loops, we must consider the time scale at which these
feedbacks reach steady-state: fast timescale feedback loops can be
addressed with the chain graph interpretation of SCMs [59] [60];
intermediate timescale feedbacks can be addressed with non-recursive
structural causal models [5]; slow timescale feedback loops can be
handled by unrolling the structure of the SCM as is done with dynamic
Bayesian networks [61], or simply by representing the entire feedback
loop as a biological process, as we did with IL6-AMP. In the case of
model misspecification, we will investigate the ability of counterfactual
inference to improve the estimation [43]. For missing data, we can
leverage causal inference recoverability algorithms that have been
published recently [62], and for handling out-of-sample distributions,
we can leverage recent results applying causal inference to the problem
of external validity [63]. Future work will focus on addressing these
threats to validity when applied to real biological data.

ACKNOWLEDGMENTS
This work was supported by funds from the PNNL Mathematics
and Artificial Reasoning Systems Laboratory Directed Research
and Development Initiative. Knowledge curation environments were
provided by BioDati.com and Causaly.com. We would also like to
acknowledge Jessica Stothers and Rose Glavin at CoronaWhy.org
and Marek Ostaszewski at the COVID-19 Disease Map Initiative for
providing valuable feedback about the IL6-AMP model.

11

R EFERENCES
[1]

A. Pezeshki, I. G. Ovsyannikova, B. A. McKinney, G. A. Poland,
and R. B. Kennedy, “The role of systems biology approaches in
determining molecular signatures for the development of more
effective vaccines.” Expert Review of Vaccines, vol. 18, p. 253,
2019.

[2]

M. Pedragosa, G. Riera, V. Casella, A. Esteve-Codina, Y. Steuerman, C. Seth, G. Bocharov, S. Heath, I. Gat-Viks, J. Argilaguet,
and A. Meyerhans, “Linking cell dynamics with gene coexpression networks to characterize key events in chronic virus
infections,” Frontiers in Immunology, vol. 10, p. 1002, 2019.

[3]

V. K. Nguyen, F. Klawonn, R. Mikolajczyk, and E. A.
Hernandez-Vargas, “Analysis of practical identifiability of a viral
infection model,” Plos One, vol. 11, p. e0167568, 2016.

[4]

A. Arazi, W. F. Pendergraft, R. M. Ribeiro, A. S. Perelson, and
N. Hacohen, “Human systems immunology: hypothesis-based
modeling and unbiased data-driven approaches,” Seminars in
Immunology, vol. 25, p. 193, 2013.

[5]

J. Pearl, Causality: Models, Reasoning and Inference.
bridge, MA, USA„ 2013.

[6]

J. Peters, D. Janzing, and B. Schölkopf, Elements of Causal
Inference: Foundations and Learning Algorithms. MIT press,
2017.

[7]

J. F. Allen, M. Swift, and W. De Beaumont, “Deep semantic analysis of text,” Proceedings of the 2008 Conference on Semantics
in Text Processing, vol. 1, p. 343, 2008.

[8]

[9]

Cam-

D. D. McDonald, “Issues in the Representation of Real Texts:
The Design of Krisp,” Natural Language Processing and Knowledge Representation, p. 77, 2000.
M. A. Valenzuela-Escárcega, O. Babur, G. Hahn-Powell, D. Bell,
T. Hicks, E. Noriega-Atala, X. Wang, M. Surdeanu, E. Demir,
and C. T. Morrison, “Large-scale automated machine reading
discovers new cancer-driving mechanisms,” Database, vol. 2018,
p. 1, 2018.

[10] B. M. Gyori, J. A. Bachman, K. Subramanian, J. L. Muhlich,
L. Galescu, and P. K. Sorger, “From word models to executable
models of signaling networks using automated assembly,” Molecular Systems Biology, vol. 13, 2017.
[11] C. T. Hoyt, D. Domingo-Fernández, R. Aldisi, L. Xu, K. Kolpeja,
S. Spalek, E. Wollert, J. Bachman, B. M. Gyori, P. Greene,
and M. Hofmann-Apitius, “Re-curation and rational enrichment of knowledge graphs in Biological Expression Language,”
Database, vol. 2019, 2019.
[12] E. G. Cerami, B. E. Gross, E. Demir, I. Rodchenkov, O. Babur,
N. Anwar, N. Schultz, G. D. Bader, and C. Sander, “Pathway
Commons, a web resource for biological pathway data,” Nucleic
Acids Research, vol. 39, p. 685, 2011.
[13] A. Fabregat, S. Jupe, L. Matthews, K. Sidiropoulos, M. Gillespie,
P. Garapati et al., “The Reactome pathway knowledgebase,”
Nucleic Acids Research, vol. 46, p. D649, 2018.
[14] M. Kanehisa, M. Furumichi, M. Tanabe, Y. Sato, and K. Morishima, “KEGG: New perspectives on genomes, pathways, diseases and drugs,” Nucleic Acids Research, vol. 45, p. D353,
2017.
[15] L. Perfetto, L. Briganti, A. Calderone, A. C. Perpetuini, M. Iannuccelli, F. Langone, L. Licata, M. Marinkovic, A. Mattioni,
T. Pavlidou, D. Peluso, L. L. Petrilli, S. Pirró, D. Posca, E. Santonico, A. Silvestri, F. Spada, L. Castagnoli, and G. Cesareni,
“SIGNOR: A database of causal relationships between biological
entities,” Nucleic Acids Research, vol. 44, p. D548, 2016.

[16] D. N. Slenter, M. Kutmon, K. Hanspers, A. Riutta, J. Windsor, N. Nunes et al., “WikiPathways: a multifaceted pathway
database bridging metabolomics to other omics research.” Nucleic Acids Research, vol. 46, p. D661, 2018.
[17] E. Demir, M. P. Cary, S. Paley, K. Fukuda, C. Lemer, I. Vastrik
et al., “The BioPAX community standard for pathway data
sharing,” Nature Biotechnology, vol. 28, p. 1308, 2010.
[18] M. Hucka, F. T. Bergmann, A. Dräger, S. Hoops, S. M. Keating,
N. Le Novère, C. J. Myers, B. G. Olivier, S. Sahle et al.,
“The Systems Biology Markup Language (SBML): language
specification for level 3 version 2 core,” Journal of Integrative
Bioinformatics, vol. 15, 2018.
[19] N. Le Novere, M. Hucka, H. Mi, S. Moodie, F. Schreiber,
A. Sorokin, E. Demir, K. Wegner, M. I. Aladjem, S. M.
Wimalaratne et al., “The systems biology graphical notation,”
Nature Biotechnology, vol. 27, p. 735, 2009.
[20] T. Slater, “Recent advances in modeling languages for pathway
maps and computable biological networks,” Drug Discovery
Today, vol. 19, p. 193, 2014.
[21] P. Machamer, L. Darden, and C. F. Craver, “Thinking about
mechanisms,” Philosophy of Science, vol. 67, p. 1, 2000.
[22] Y. Li, J. Roberts, Z. AkhavanAghdam, and N. Hao, “Mitogenactivated protein kinase (MAPK) dynamics determine cell fate in
the yeast mating response,” The Journal of Biological Chemistry,
vol. 292, p. 20354, 2017.
[23] L. Chen, R. Wang, C. Li, and K. Aihara, Modeling Biomolecular
Networks in Cells: Structures and Dynamics. Springer Science
& Business Media, 2010.
[24] D. Gratie, B. Iancu, and I. Petre, “ODE analysis of biological
systems,” in International School on Formal Methods for the
Design of Computer, Communication and Software Systems,
2013, p. 29.
[25] F. Bianconi, E. Baldelli, V. Ludovini, L. Crino, A. Flacco, and
P. Valigi, “Computational model of EGFR and IGF1R pathways
in lung cancer: a systems biology approach for translational
oncology,” Biotechnology Advances, vol. 30, p. 142, 2012.
[26] E. K. Kim and E.-J. Choi, “Pathological roles of MAPK signaling pathways in human diseases,” Biochimica et Biophysica Acta
- Molecular Basis of Disease, vol. 1802, p. 396, 2010.
[27] R. Ness, K. Paneri, and O. Vitek, “Integrating Markov processes
with structural causal modeling enables counterfactual inference
in complex systems,” in Advances in Neural Information Processing Systems, 2019, p. 14211.
[28] K. Paneri, “Integrating markov process and structural causal
models enables counterfactual inference in complex systems,”
2019.
[29] D. T. Gillespie, “Exact stochastic simulation of coupled chemical
reactions,” The Journal of Physical Chemistry, vol. 81, p. 2340,
1977.
[30] S. K. Jha and C. J. Langmead, “Exploring behaviors of stochastic
differential equation models of biological systems using change
of measures,” BMC Bioinformatics, vol. 13, p. S8, 2012.
[31] U. Alon, An Introduction to Systems Biology: Design Principles
of Biological Circuits. CRC press, 2019.
[32] S. Bongers and J. M. Mooij, “From random differential equations
to structural causal models: the stochastic case,” in Proceedings
of Uncertainty in Artificial Intelligence, 2019.
[33] M. Jerrum, A. Sinclair, and D. S. Hochbaum, “The Markov chain
Monte Carlo method,” Approximation Algorithms for NP-hard
Problems, 1997.

12

[34] A. E. Gelfand, “Gibbs sampling,” Journal of the American
statistical Association, vol. 95, p. 1300, 2000.
[35] M. D. Hoffman and A. Gelman, “The No-U-Turn sampler:
adaptively setting path lengths in Hamiltonian Monte Carlo,”
Journal of Machine Learning Research, vol. 15, p. 1593, 2014.
[36] M. D. Hoffman, D. M. Blei, C. Wang, and J. Paisley, “Stochastic
variational inference,” The Journal of Machine Learning Research, vol. 14, p. 1303, 2013.
[37] T. Blom, S. Bongers, and J. M. Mooij, “Beyond structural causal
models: Causal constraints models,” in Proceedings of the 35th
Conference on Uncertainty in Artificial Intelligence, 2019.
[38] S. Madan, J. Szostak, R. Komandur Elayavilli, R. T.-H. Tsai,
M. Ali, L. Qian, M. Rastegar-Mojarad, J. Hoeng, and J. Fluck,
“The extraction of complex relationships and their conversion to
biological expression language (BEL) overview of the BioCreative VI (2017) BEL track.” Database: the Journal of Biological
Databases and Curation, vol. 2019, 2019.
[39] C. T. Hoyt, D. Domingo-Fernández, S. Mubeen, J. M. Llaó,
A. Konotopez, C. Ebeling, C. Birkenbihl, O. Muslu, B. English,
S. Müller, M. P. de Lacerda, M. Ali, S. Colby, D. Türei,
N. Palacio-Escat, and M. Hofmann-Apitius, “Integration of
structured biological data sources using biological expression
language,” BioRxiv, 2019.
[40] C. T. Hoyt, A. Konotopez, C. Ebeling, and J. Wren, “PyBEL:
a computational framework for biological expression language.”
Bioinformatics, vol. 34, p. 703, 2018.
[41] H. Mi, F. Schreiber, S. Moodie, T. Czauderna, E. Demir, R. Haw,
A. Luna, N. Le Novère, A. Sorokin, and A. Villéger, “Systems
Biology Graphical Notation: Activity Flow language Level 1
Version 1.2.” Journal of Integrative Bioinformatics, vol. 12, p.
265, 2015.
[42] D. J. Rezende, S. Mohamed, and D. Wierstra, “Stochastic
backpropagation and approximate inference in deep generative
models,” arXiv:1401.4082, 2014.
[43] R. Ness, K. Paneri, and O. Vitek, “Integrating Markov processes
with structural causal modeling enables counterfactual inference
in complex systems,” in Advances in Neural Information Processing Systems, 2019, p. 14234.
[44] “BioDati, inc.” [Online]. Available: https://studio.covid19.
biodati.com/
[45] E. Bingham, J. P. Chen, M. Jankowiak, F. Obermeyer, N. Pradhan, T. Karaletsos, R. Singh, P. Szerlip, P. Horsfall, and N. D.
Goodman, “Pyro: Deep Universal Probabilistic Programming,”
Journal of Machine Learning Research, 2018.
[46] Z. S. Ulhaq and G. V. Soraya, “Interleukin-6 as a potential
biomarker of COVID-19 progression.” Medecine et Maladies
Infectieuses, vol. 50, p. 382, 2020.
[47] T. Hirano and M. Murakami, “COVID-19: A new virus, but
a familiar receptor and cytokine release syndrome.” Immunity,
vol. 52, p. 731, 2020.
[48] M. Murakami and T. Hirano, “The pathological and physiological roles of IL-6 amplifier activation.” International Journal of
Biological Sciences, vol. 8, p. 1267, 2012.
[49] H. Ogura, M. Murakami, Y. Okuyama, M. Tsuruoka,
C. Kitabayashi, M. Kanamoto, M. Nishihara, Y. Iwakura, and
T. Hirano, “Interleukin-17 promotes autoimmunity by triggering
a positive-feedback loop via interleukin-6 induction,” Immunity,
vol. 29, p. 628, 2008.
[50] V. Oldfield, S. Dhillon, and G. L. Plosker, “Tocilizumab: a review
of its use in the management of rheumatoid arthritis.” Drugs,
vol. 69, p. 609, 2009.

[51] C. Zhang, Z. Wu, J.-W. Li, H. Zhao, and G.-Q. Wang, “Cytokine
release syndrome in severe COVID-19: Interleukin-6 receptor
antagonist Tocilizumab may be the key to reduce mortality,” International Journal of Antimicrobial Agents, vol. 55, p. 105954,
2020.
[52] E. A. Coomes and H. Haghbayan, “Interleukin-6 in COVID-19:
A systematic review and meta-analysis,” medRxiv, 2020.
[53] X. Xu, M. Han, T. Li, W. Sun, D. Wang, B. Fu, Y. Zhou,
X. Zheng, X. L. Y. Yang, X. Zhang, A. Pan, and H. Wei, “Effective Treatment of Severe COVID - 19 Patients with Tocilizumab,”
PNAS, vol. 117, p. 10970, 2020.
[54] K. E. R. Soetaert, T. Petzoldt, and R. W. Setzer, “Solving differential equations in R: package deSolve,” Journal of Statistical
Software, vol. 33, 2010.
[55] D. Wilkinson, “Package smfsb,” 2018.
[56] L. Lu Wang, K. Lo, Y. Chandrasekhar, R. Reas, J. Yang, D. Eide,
K. Funk, R. Kinney, Z. Liu, W. Merrill, P. Mooney, D. Murdick,
D. Rishi, J. Sheehan, Z. Shen, B. Stilson, A. D. Wade, K. Wang,
C. Wilhelm, B. Xie, D. Raymond, D. S. Weld, O. Etzioni, and
S. Kohlmeier, “CORD-19: The covid-19 open research dataset.”
arXiv, 2020.
[57] A. Liu, P. Trairatphisan, E. Gjerga, A. Didangelos, J. Barratt,
and J. Saez-Rodriguez, “From expression footprints to causal
pathways: contextualizing large signaling networks with CARNIVAL,” Systems Biology and Applications, vol. 5, p. 1, 2019.
[58] S. Tikka and J. Karvanen, “Identifying causal effects with theR
packagecausaleffect,” Journal of Statistical Software, vol. 76,
p. 1, 2017.
[59] S. L. Lauritzen and T. S. Richardson, “Chain graph models
and their causal interpretations,” Journal of the Royal Statistical
Society: Series B, vol. 64, p. 321, 2002.
[60] E. Sherman and I. Shpitser, “Identification and estimation of
causal effects from dependent data.” Advances in Neural Information Processing Systems, vol. 2018, p. 9446, 2018.
[61] D. Koller and N. Friedman, Probabilistic Graphical Models:
Principles and Techniques - Adaptive Computation and Machine
Learning. The MIT Press, 2009.
[62] R. Nabi, R. Bhattacharya, and I. Shpitser, “Full law identification
in graphical models of missing data: Completeness results,”
arXiv, 2020.
[63] E. Bareinboim and J. Pearl, “Causal inference and the datafusion problem.” Proceedings of the National Academy of Sciences of the United States of America, vol. 113, p. 7345, 2016.

