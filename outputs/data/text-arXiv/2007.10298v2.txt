L ANDMARK G UIDANCE I NDEPENDENT S PATIO - CHANNEL
ATTENTION AND C OMPLEMENTARY C ONTEXT I NFORMATION
BASED FACIAL E XPRESSION R ECOGNITION

arXiv:2007.10298v2 [cs.CV] 25 Jul 2020

A P REPRINT
Darshan Gera
darshangera@sssihl.edu.in

S Balasubramanian
sbalasubramanian@sssihl.edu.in

July 28, 2020

A BSTRACT
A recent trend to recognize facial expressions in the real-world scenario is to deploy attention based
convolutional neural networks (CNNs) locally to signify the importance of facial regions and, combine
it with global facial features and/or other complementary context information for performance gain.
However, in the presence of occlusions and pose variations, different channels respond differently,
and further that the response intensity of a channel differ across spatial locations. Also, modern
facial expression recognition(FER) architectures rely on external sources like landmark detectors for
defining attention. Failure of landmark detector will have a cascading effect on FER. Additionally,
there is no emphasis laid on the relevance of features that are input to compute complementary
context information. Leveraging on the aforementioned observations, an end-to-end architecture
for FER is proposed in this work that obtains both local and global attention per channel per spatial
location through a novel spatio-channel attention net (SCAN), without seeking any information from
the landmark detectors. SCAN is complemented by a complementary context information (CCI)
branch. Further, using efficient channel attention (ECA), the relevance of features input to CCI is also
attended to. The representation learnt by the proposed architecture is robust to occlusions and pose
variations. Robustness and superior performance of the proposed model is demonstrated on both inlab and in-the-wild datasets (AffectNet, FERPlus, RAF-DB, FED-RO, SFEW, CK+, Oulu-CASIA and
JAFFE) along with a couple of constructed face mask datasets resembling masked faces in COVID-19
scenario. Codes are publicly available at https://github.com/1980x/SCAN-CCI-FER.
Keywords Facial Expression Recognition · FER · Local Spatio-Channel Attention · SCAN · CNN · Occlusion-robust ·
Pose-invariant

1

Introduction

It is rightly said that face is the index of mind. The emotional states (calm, happy, anger, sad, fear, disgust, surprise,
contempt) of a person can be understood from the facial expressions of the person. In communication and socialinteraction, facial expression and body language, together with words, make the interaction more meaningful. In
analysing depression and mental related illness, longitudinal study of facial expressions play a vital role. In studentteacher interaction, facial expression can indicate attentiveness, teaching quality etc.
With the advancement in technology, there has been a continuous upsurge in the interest of researchers to enable
machines to recognize facial expressions. This field of research is called as facial expression recognition (FER).
Machines with FER capability has plethora of applications viz human-computer interaction [2], intelligent tutoring
systems [22], automatic driver alert systems [19] , mental health analysis [15], support systems for mentally retarded
children [37], computer animation [8] etc.
A way to enable machines to perform FER is to make them learn the facial expressions through examples. Traditional
works like [33], [6], [17], [23] focused on training machines for FER through examples collected in a controlled (in-lab)

A PREPRINT - J ULY 28, 2020

environment. Examples of such in-lab datasets are CK+ [8], Oulu-CASIA [57] and JAFFE [32]. However, machines
trained in controlled environment do not generalize well to real-world scenarios wherein the facial images contain
occlusions, vary in illumination, differ in pose etc. To tackle these challenges, large datasets in the order of millions of
facial images like AffectNet [36] collected from real-world scenarios (in-the-wild) have been made available. Despite
this, developing algorithms that are robust to occlusion, pose and illumination variation are not trivial. For example, the
object of occlusion could be internal (for eg., hands occluding the face) or external (for eg., a face mask or glasses), size
of occluder could vary and that any location in the image could be occluded. Similarly, extreme pose variations like
pose in profile facial images could misinform the algorithm due to loss of symmetry. Illumination variation can block
information proportional to the degree of illumination. Misinformation or loss of information is heavy on algorithms
as they have to search for appropriate regions containing relevant information, which could be minimal in size, to
discriminate well between different facial expressions. This is where attention mechanism pitches in.
Attention mechanism attempts to weigh relevant regions (for eg., non-occluded regions) heavier for further processing
than less relevant regions. This enhances the discriminating power of the algorithm for FER. Local attention is
particularly useful in this regard, especially in the presence of occlusions. In local attention, local patches or regions of
the input are focused upon. Their relevance is subsequently quantified through the attention mechanism. Consideration
of local patches make identification of relevant regions relatively easier since, for example, the object of occlusion
could cover certain local patches, thereby making them less relevant eventually as the machine learns. Local attention is
generally combined with global context obtained from the undivided attention weighted input for performance gain.
With the introduction of graphics processing units (GPUs) and since the renaissance of neural networks through
AlexNet [26] under the deep learning (DL) umbrella, deep convolutional neural networks (CNNs) have super-scaled the
performance in recognition problems [26], [40], [42], [45]. An important factor that drives the success of CNNs and in
fact any deep network is the large volume of data. With huge face datasets like MS-Celebrity face dataset [18], Casia
webface [53], VGGFace [39], VGGFace2 [5] etc. for face recognition(FR), the current trend for FER is to transfer
knowledge (weights) from pre-trained FR models to FER model and then fine-tune the weights on FER datasets like
AffectNet. Further, to account for occlusions, pose and illumination variations, attention mechanism is incorporated in
to the CNNs and the complete model is fine-tuned [30], [48], [13]. Specifically, local attention weighted features are
combined with complementary context information like global facial features for FER. This trend has significantly
improved the recognition rate in FER, for example from around 50% [54] to around 60% [13] on AffectNet dataset
though there is still a wide scope for improvement.
A particular issue has been with regard to how the attention mechanism is incorporated into the CNN. A very recent
work [43] has illustrated that in presence of wild scenarios like presence of occlusions, that are common in real-world
scenes, different channels of a CNN feature map respond differently to the input stimuli, and further that the response
intensity of a channel differ across spatial locations. However, attention based CNNs [30], [48], [13] for FER have either
applied constant attention weight across both channel and spatial dimensions, or applied per channel attention weight
that is constant across spatial dimensions, or per position attention weight that is constant across channel dimensions.
Further, some of these attention based CNNs [30], [13] define local attention based on external sources like landmark
detectors [55], [14]. Erratic behaviour of such sources will naturally pull down the performance, and such anomalous
behaviour is possible under challenging scenarios of presence of occlusions and pose and illumination variations. Also,
these attention based CNNs do not emphasize on the relevance of features input to the part of the model that extracts
complementary context information to local attention module.
Leveraging on these observations, an end-to-end architecture for FER is proposed in this work that obtains both local
and global attention per channel per spatial location, without seeking any information from the landmark detectors.
Further, using efficient channel attention (ECA) [49], the relevance of features input to compute complementary context
information is also attended to. The proposed architecture is robust to occlusion and pose variation. The branch of
the proposed architecture that computes attention is called as spatio-channel attention net (SCAN). The other branch,
that again operates on facial regions, is called as complementary context information (CCI) branch. The input to both
the branches is the high-level semantic representation of the face in the given facial image, obtained from a backbone
network (ResNet-50) that was pre-trained on a large face dataset (VGGFace 2). The details of the proposed architecture
will be presented in Section 3. In summary our contributions are as follows:
• A local-global attention branch called as SCAN that computes attention weight per channel per spatial location
manner across all considered local patches and the whole input to make FER model robust to occlusion and
pose variation. We also illustrate that the local attention branch can be shared across all local patches without
any significant performance dip. This makes the local attention branch lightweight.
• An enhanced complementary context information branch called CCI, enhanced by ECA, that provides richer
complementary information to SCAN.
2

A PREPRINT - J ULY 28, 2020

• An end-to-end architecture for FER devoid of dependence on external sources like landmark detectors to
define attention.
• Validation of the proposed architecture on variety of datasets, both in-lab and in-the-wild cases with superior
performance over the recent methods. Additionally, comparison against a baseline and state of the art method
on a couple of constructed masked-facial datasets resembling masked faces in COVID-19 scenario.

2

Related Work

Earlier works relied on hand-crafted features like deformable features, motion features and statistical features along with
traditional machine learning (ML) paradigms like SVM for FER [1], [24], [50]. These works validated their models on
in-lab datasets [31], [57], [32]. However, models trained for controlled environment do not generalize well outside that
environment. Current trend is being driven by DL paradigm with availability of huge volume of data collected in an
uncontrolled ‘in-the-wild’ setting. It is to be noted that in-the-wild datasets, though available for FER, are not upscaled
yet except for AffectNet [36]. However, as mentioned earlier, datasets for FR are very huge. So, a general strategy for
FER is to adopt transfer learning [38] from FR.
CNNs have stamped their supremacy with regard to performance on recognition problems. In fact, almost two decades
ago, CNNs have been found to be robust to some degree of affine transformations with regard to FER [34]. In [38], a twostage architecture is proposed for FER. In the first stage, parameters of FR model guides the learning of convolutional
layers of the FER model. In the subsequent stage, expression representation is learnt by addition of fully connected
(fc) layers, and further refinement. [27] addresses FER through an ensemble network with a novel pre-processing
transformation, that transforms image intensities into a 3d-space, facilitating robustness to illumination variation. While
[27] used an ensemble network, [21] uses an ensemble of supervisions through supervised scoring ensemble (SSE)
learning mechanism wherein, apart from the output layer, intermediate and shallow layers are also supervised. Spatial
information from facial expression images and differential information from changes between neutral and non-neutral
expressions have been fused together using multiple fusion strategies in [44] for FER. Multi-scale features obtained
using hybrid inception-residual units with concatenated rectified linear activations enabled the architecture in [52] to
capture variations in expression. A 2-channel CNN with one channel trained in an unsupervised fashion, and subsequent
information merge from both the channels aid FER in [20]. Apart from stand-alone CNNs, generative models where
CNNs define the generator and discriminator have also been used for FER. In [51], a facial image is viewed as a sum of
neutral and expressive component, and subsequently the residual expressive component is learnt using a de-expression
residual learning module under a generative model setting. Another generative model that suppreses identity while
preserving expression, to account for within subject variance, is proposed in [4]. While all these methods outperform
traditional hand-crafted features ML based methods, most of them still validate their analysis only on in-lab datasets.
They are not robust to challenges like presence of occlusions and pose variations that are common in ‘in-the-wild’
datasets. Incorporation of attention mechanism plays a vital role to face these challenges in FER.
Attention mechanism, an attempt to imitate how humans focus on salient regions in an image, has been successful in
many computer vision tasks including abnormal behaviour recognition [46] and visual explanation [16]. With regard
to FER robust to occlusions and pose variations, the recent works [30], [48], [13] have pushed up the performance.
In [30], unobstructedness or importance scores of local patches of feature maps corresponding to certain landmark
points are computed using self attention and the respective local feature maps are weighted by these scores. The
expectation is that, over training, patches corresponding to occluded areas in the image will receive low importance
and hence become less relevant. Parallely, global context is captured through self attention on the entire feature map.
Concatenation of local-global context is passed to a classifier for expression recognition. Region attention network
(RAN) [48] is conceptually similar to [30] but selects patches directly from the image input. RAN combined with a
region biased loss quantifies the importance of patches. Subsequently, a relation-attention module that relates local
and global context provides the expression representation for classification. It is to be noted that selection of patches
directly from the image input will increase time of inference. In [13], attention weights are generated as samples from a
Gaussian distribution centered at spatial locations of the feature map, corresponding to certain confident landmark
points, where the confidence score is provided by an external landmark detector. Selection of local patches follow [30].
Concurrently, complementary information is gathered from non-overlapping partitions of the feature map. Together, the
patch based information and the complementary information guide the classifier to report state-of-the-art results.
This work is also an attention based architecture for robust FER. It differs from [30], [48], [13] in the following aspects:
• [30] assigns a single attention weight to the entire feature map per patch. [48] assigns attention weight to every
feature per input crop but it works with a flattened vector thereby losing spatial information. [13] assigns
3

A PREPRINT - J ULY 28, 2020

spatially varying attention weights that are constant across channel dimensions, per patch. In this work, per
channel per spatial location attention weight per patch is defined through the proposed SCAN.
• [48],[13] uses landmark detector to define attention. The proposed model does not need external sources like
landmark detectors to define attention.
• [13] does not emphasize on the relevance of input feature maps to collect complementary information. The
proposed work uses ECA to attend to the relevance of input feature maps to CCI branch.
• [48] fixes patches at the level of image input, thereby potentially increasing the inference time, especially
when the number of patches are scaled up. The proposed work does not crop the input into multiple patches.

3
3.1

Proposed Model
Motivation

The proposed model is motivated by the attention based FER detailed in [30], [48], [13] and the key observation in [43].
A generic depiction of types of attention blocks in these attention based models is shown in Fig. 1.
The three types of attention blocks, in order, are adopted in [30], [48], [13] respectively. It can be noticed from Fig. 1

Figure 1: Generic description of attention mechanism in [30], [48], [13]
that either the attention weight is constant across spatial and channel dimensions (Type 1, [30]) or it is constant across
spatial dimensions (Type 2, [48]) or it is constant across channel dimensions (Type 3, [13]). However, it has been
illustrated in [43], that in presence of occlusions, different channels respond differently and further that, each channel
exhibits variation in intensity across spatial locations, for the given input stimuli.
For example, Fig.2 shows 8 chosen channels of the median relative difference in response between a clean image and
its occluded counterpart from the output of Conv_3x block in ResNet-50. Median is computed from a sample of 100
pairs of clean and occluded images with occlusion fixed at the same location across the entire sample. Clearly, some
channels display minimal response to occlusion while others show differing responses around the region of occlusion.

Figure 2: Channel response to occlusion. Top leftmost is a sample of occluded image. Other 8 images show heatmap of
median relative change in response of 8 channels across a sample of 100 clean and occluded pairs.

3.2

Spatio-Channel Attention Net(SCAN)

Based on the aforementioned observation, this work proposes an attention block that provides attention per channel
per spatial location for the given input feature map. This attention block is called as Spatio-Channel Attention Net.
The input-output pipeline of SCAN is shown in Fig. 3. Mathematically, let P be the C × H × W dimensional input
4

A PREPRINT - J ULY 28, 2020

feature map to SCAN. Let f be the non-linear function that models SCAN. In this work, f is defined to be a ‘same’
convolution operation with number of out channels same as that of input channels, followed by parametric ReLU
(PReLU) activation, batch normalization (BN) and a sigmoid activation (σ). Let OP be the attention weights of the
input feature map computed by SCAN. Then

Figure 3: Input output pipeline of SCAN
OP = SCAN (P ) = f (P ) = σ(BN (P ReLU (Conv(P ))))
(1)
where Conv is the ‘same’ convolution operation that takes a C × H × W input feature map and outputs C × H × W
attention weights.
Following the computation of attention weights, the input feature map is weighted. Let W P denote the weighted input
feature map. Then,
W P = P OP
(2)
where is the element-wise multiplication operator. For sake of convenience, it is assumed that this element-wise
multiplication is merged with SCAN. Hence the output of SCAN is W P for the input P . It is to be noted that the input
P could be a local patch from a feature map, or the entire feature map providing global context. For this reason, SCAN
is called as local-global attention branch.
When multiple patches from a feature map are input to SCAN, the learnable parameters in SCAN can either be shared
across all the input patches, or kept independent across patches. In this work, both shared as well as independent set of
SCAN parameters reported similar performance. This will be illustrated in Section 6. For further presentation, it is
assumed that parameters are independent across patches.
3.3

Complementary Context Information (CCI) Branch

While SCAN attends to relevant features locally and globally, extra complementary information to this would surely
enhance the discriminating ability of the model. Since transfer learning from FR is adopted for FER, the wealth of
information available in FR could be easily leveraged upon to extract complementary context information. Particularly,
information through feature maps from middle layers of the FR model could be used for this purpose. Middle layers are
likely to contain features surrounding parts of the face like eyes, nose, mouth etc. that are useful for FER. Final layers
generally contain identity specific features which are not suitable for FER.
Features from the middle layer may be redundant, and all the features may not be important for FER. To eliminate
redundancy and emphasize the important features, ECA [49] is applied to the feature map from middle layer. ECA is
a local cross-channel interaction mechanism without dimensionality reduction that computes channel-wise attention,
constant across spatial dimensions. ECA has shown that dimensionality reduction decreases the performance while
cross-channel interaction improves performance. It is to be noted that this philosophy is followed in SCAN as well. A
natural question here would be that why ECA here and why not SCAN. It is to be noted that the goal here is to obtain
complementary context information to the one provided by SCAN. Hence SCAN is not used here. Also, prior to using
the information from the middle layer of FR model to perform FER, the important features needs to be emphasized
and the redundancy needs to be eliminated. Hence channel-wise attention suffices here. In this regard, since ECA has
demonstrated its superiority over other attention methods, it is adopted here.
The CCI branch proposed in this paper is similar to the one in [13] but with prior feature emphasis by ECA. The
influence of ECA is illustrated in Section 6.7. The CCI branch is described as follows: Let F be the feature map from a
chosen middle layer of the base model trained for FR. Let OF be the output of CCI branch. Then,
OF = CCI(F ) = GAP (P ART IT ION (ECA(F )))
(3)
= {OF1 , OF2 , ..., OFk }
where PARTITION partitions the ECA weighted feature map into k non-overlapping blocks and GAP is global average
pooling. OFi is the output of GAP on ith block and it is a vector of features. Following [13], k is chosen to be 4 in this
work.
5

A PREPRINT - J ULY 28, 2020

3.4

Proposed Architecture

The complete proposed architecture is shown in Fig. 4. The input I is a 224 × 224 RGB image. It is processed by a

Figure 4: Complete Architecture of proposed Attention based Facial Expression Recognition Framework. For SCAN,
refer Fig. 3 (Best viewed in color)
pre-trained ResNet-50 model. For the SCAN branch, the output of Conv_3x block from ResNet-50 goes as input. This
is a 28 × 28 × 512 feature map, denoted by Fu . Next, Fu is partitioned into m non-overlapping blocks, each block
acting as a local patch. In this work, m is chosen to be 25 based on the ablation study reported in Section 6.9. This
results in 25 local patches. The output of SCAN from each of the 25 local patches is global average-pooled across
spatial dimensions and subsequently max-pooled across channel dimensions to provide the summary of the local context
in the form of a 512 dimensional vector, denoted by Vl . Also, the whole Fu is fed to SCAN and the output is global
average-pooled to capture global context in the form of another 512 dimensional vector, denoted by Vg . Vl and Vg are
concatenated and sent through an expression classifier based on cross-entropy loss denoted by Lu . It is to be noted
that the entire local and global context processing through SCAN is devoid of any information from external landmark
detectors.
For the CCI branch, the output of Conv_4x block from ResNet-50, denoted by Fl , goes as input. It has dimension
14 × 14 × 1024. As expressed in Eq. 3, the output of CCI is a set of k vectors {OF1 , OF2 , ..., OFk }. Subsequently, each
of OFi is densely connected to a 256 node layer and then goes through an expression classifier based on cross-entropy
loss, denoted by Li . The total loss from the CCI branch is
Ll =

k
X

Li

(4)

i=1

The overall loss from both the branches is given by
L = λ ∗ Lu + (1 − λ) ∗ Ll

(5)

where λ belongs to [0, 1]. In this work, we set λ to 0.2 based on the ablation study reported in Section 6.9.

4
4.1

Datasets
In-the-wild Datasets

AffectNet [36] is the largest facial expression dataset with around 0.4 million images manually labeled for the presence
of eight (neutral, happy, angry, sad, fear, surprise, disgust, contempt) facial expressions along with the intensity of
6

A PREPRINT - J ULY 28, 2020

valence and arousal. Since some papers in literature quote results only for first seven expressions (without contempt)
while few others quote for all eight expressions, to do a fair comparison, this work reports results on both the cases.
The former case is denoted by AffectNet-7 while the latter is denoted by AffectNet-8. Only maximum of 20000
images per expression are considered for training in both the cases. Test set sizes are 3500 and 4000 samples for both
the cases, respectively. Since the dataset has class imbalance, oversampling is used for training. Challenging test
subsets of AffectNet namely Occlusion-AffectNet and Pose-Affectnet provided by [48] are also considered. For the
Occlusion-Affectnet, each image is occluded with at least one type of occlusion: wearing mask, wearing glasses etc.
There are a total of 682 images. For the Pose-AffectNet, images with pose degrees larger than 30 and 45 are collected.
The number of images are 1949 and 985, respectively. RAF-DB [28, 29] contains 29672 facial images tagged with
basic or compound expressions by 40 independent taggers. In this work, only images with basic emotions are used,
including 12271 images as training data and 3068 images as test data. Like in AffectNet, challenging test subsets of
RAF-DB namely Occlusion-RAF-DB and Pose-RAF-DB given by [48] are also considered. The Occlusion-RAF-DB
has a total number of 735 images, while Pose-RAF-DB has 1248 and 558 images with pose larger than 30 and 45
degrees, respectively. FERPlus by [3] consists of 28558 training images, 3589 validation images and 3589 test
images. Each image is labeled with one of the eight expressions by 10 independent taggers. Similar to AffectNet,
challenging test subsets of FERPlus namely Occlusion-FERPlus and Pose-FERPlus [48] are also considered. The
Occlusion-FERPlus has a total number of 605 images, while Pose-FERPlus has 1171 and 634 images with pose
larger than 30 and 45 degrees, respectively. SFEW [12] contains selected frames from AFEW [11]. It contains 891
training images and 431 validation images covering unconstrained facial expressions, different head poses, ages, and
occlusions. FED-RO [30] is a recently released facial expression dataset with real world occlusions. Each image has
natural occlusions including sunglasses, medical mask, hands and hair. It contains 400 images labeled with seven
expressions for testing. This dataset is used only for testing the model.
4.2

In-lab Datasets

The Extended Cohn-Kanade dataset (CK+) [25, 31] contains 593 video sequences recorded from 123 subjects. The
first and last three frames of each video sequence are considered as the neutral and target expressions, resulting in 1254
and 1308 images for the cases of 7 and 8 expressions, respectively. Oulu-CASIA [57] dataset contains six prototypic
expressions from 80 people between 23 to 58 years old. The first and the last three frames are considered as the neutral
and target expressions, resulting in 1920 images. JAFFE [32] contains 213 images of 7 facial expressions posed by 10
Japanese female models. Each image has been rated on 6 emotion adjectives by 60 Japanese subjects.
4.3

Synthetic Covid-19 mask Datasets

In the background of covid-19 pandemic where worldwide restrictions have enforced people to mask their nose and
mouth regions, this work constructs two datasets from FERPlus and RAF-DB using the publicly available code1 ,
simulating masked faces in covid-19 scenario. Performance on these datasets are also reported.

5

Implementation Details

The proposed work is implemented in PyTorch2 using a single GeForce RTX 2080 Ti GPU with 11GB memory. The
backbone net of the proposed architecture is a pre-trained ResNet-50, trained on VGGFace2 [5]. Resnet-50 trained
on ImageNet [10] is also considered. All images are aligned using MTCNN3 [56] and then resized to 224x224. Input
to SCAN is output of Conv_3x block of backbone Resnet-50. Input to CCI is output of Conv_4x block of backbone
Resnet-50. Model is optimized by stochastic gradient descent (SGD) for 60 epochs. Learning rate (lr) of backbone is
initialized to 0.0001. With regard to SCAN and CCI, lr is initialized to 0.01 when trained on FERPlus and RAF-DB.
For AffectNet, lr is initialized to 0.001. For SFEW training, the proposed model trained on combination of AffectNet
and RAF-DB is fine tuned with lr set to 0.001 on SCAN and CCI branches. In case of in-lab datasets, lr for backbone,
SCAN and CCI are all set to 0.00001 while performing 10-fold cross-validation. In all cases, lr for the backbone, SCAN
and CCI branches are exponentially decayed by a factor of 0.95 every epoch. Momentum in SGD is set to 0.9 and
weight-decay is set to 0.001. Batch size is fixed at 64. Evaluation metric used is overall accuracy. Since FERPlus has
multiple labels per image, majority voting is adopted to choose the label.
1

https://github.com/X-zhangyang/Real-World-Masked-Face-Dataset/tree/master/wear_mask_to_face
https://pytorch.org
3
https://github.com/ZhaoJ9014/face.evoLVe.PyTorch
2

7

A PREPRINT - J ULY 28, 2020

6
6.1

Results and Discussions
Performance comparison on in-the-wild datasets with baselines

The baselines considered are Resnet-50 trained from scratch (denoted here by Baseline1), Resnet-50 pre-trained on
ImageNet (denoted here by Baseline2) and Resnet-50 pre-trained on VGGFace2 (denoted here by Baseline3). Table 1
displays the comparison results.
Table 1: Comparison of the proposed model against baselines on in-the-wild datasets
FERPlus
RAFDB
AffectNet-7
SFEW
Model
Max
Mean±Std
Max
Mean±Std
Max
Mean±Std
Max
Mean±Std
Baseline1 55.82 53.04±2.04 59.87 50.99±7.25 45.43 44.24±1.33 21.34 21.02 ± 0.2
Baseline2 79.75 78.45±0.75 74.45 73.87±0.6 57.86 57.73±0.15 31.09 27.98 ± 2.64
Baseline3 79.31 78.79±0.46 76.43 76.25±0.16 56.77 56.3±0.44 20.18 19.63 ± 0.31
Ours
89.42 89.13±0.25 89.02 88.50±0.16 65.14 64.7±0.28 58.93 56.80±1.33
Clearly, the proposed model outperforms all the baselines with a minimum of around 9% (in AffectNet-7) to a maximum
of around 39% (in SFEW) improvement over the best baseline. This indicates that pre-trained models from FR or
ImageNet cannot be directly used for FER. Different branches (like SCAN and CCI) for processing feature maps from
middle layers of the pre-trained model are necessary for enhancing performance on FER.
6.2

Comparison with state-of-the-art methods

The proposed model is compared with GACNN[30], RAN[48], OADN[13], FMPN[7] and SCN[47]. These are the
most recent state-of-the-art methods published in last one year. Table 2 reports the comparison of the proposed model
against these methods on in-the-wild datasets. As can be seen, except the proposed method, none of the other 5 methods
have reported results on all the datasets. From Table 2, it is vivid that the proposed model has outperformed all the
other models in all the datasets except RAF-DB. This clearly emphasizes that SCAN and CCI are vital for enhancing
performance. It is to be noted that all the state-of-the-art methods have quoted only their best performance. For
fair comparison, Table 2 highlights the best performance of our model across all the datasets. However, influence
of randomness in training is clearly quantified for our model in the last row of Table 1. Even while accounting for
randomness, the one standard deviation interval of accuracy of the proposed model is sharper, emphasizing its superior
generalizing capability.
Table 2: Performance comparison against state-of-the-art-methods on in-the-wild datasets
Model

FERPlus RAFDB
GACNN[30] 85.07
RAN[48]
89.16
86.9
OADN[13] 89.83
FMPN[7] SCN[47]
88.01
87.03
Ours
89.42
89.02
∗

6.3

Affect
Net-7
58.78
64.06
61.52∗
65.14

Affect
Net-8
59.5
60.23
61.73

In FMPN, neutral images are not considered.

SFEW
56.4
58.93

Performance on challenging test subsets of AffectNet, RAF-DB and FERPlus

To validate the robustness of the proposed method to presence of occlusions and pose variations, the performance of the
proposed method is tested on challenging test subsets of AffectNet, RAF-DB and FERPlus. It is also compared against
RAN, and OADN. Table 3 depicts the results. The proposed method exhibits superior robustness to occlusions and pose
variations, with around 2 to 5% gains in case of occlusions and around 1 to 7% gains in case of pose variations, over
RAN and OADN. To further validate the robustness to occlusions, the proposed method is tested on another real-world
occlusions dataset, namely FED-RO. Table 4 enumerates the results. Again, the proposed method stands tall among all
the state-of-the-art methods with a solid 2.3% advantage over the next best performing OADN.
8

A PREPRINT - J ULY 28, 2020

Table 3: Performance comparison on occlusions and pose variations subsets.
FERPlus
RAFDB
AffectNet-7
Model
Occ. Pose>30 Pose>45 Occ. Pose>30 Pose>45 Occ. Pose>30 Pose>45 Occ.
RAN[22] 83.63 82.23
83.63
82.72 86.74
85.2
58.5
OADN[23]84.57 88.52
87.50
64.02 61.12
61.08
Ours
86.12 88.89
88.15
85.03 89.82
89.07
67.06 62.64
61.31
63.69

AffectNet-8
Pose>30 Pose>45
53.9
53.19
60.41
60.86

Table 4: Performance comparison on FED-RO
Method
GACNN[30]
RAN[48]
OADN[13]
Ours
6.4

Average Accuracy
66.5
67.98
71.17
73.5

Expression discrimination

In order to obtain a clear picture of easily identifiable expressions and most difficult expressions to distinguish, confusion
matrices with regard to AffetNet-8, RAF-DB and FERPlus are plotted in Fig 5. More confusion matrices with regard to
occlusions and pose variations across all the aforementioned datasets plus confusion matrices with regard to SFEW and
FED-RO are presented in supplementary material. Happiness is the easiest expression to recognize in general except
in AffectNet-8 where contempt and disgust are relatively easier expressions to recognize. Fear is generally confused
with surprise and vice-versa except in FERPlus where fear is easily recognized along with happy expression. Presence
of contempt expression in AffectNet-8 drastically brings down recall on happy expression. Another observation is
that disgust is confused with anger sometimes, fear, sad and neutral other times. In general, negative expressions are
confused with negative expressions though sometimes they are confused with happy (like disgust getting confused
with happy in RAF-DB) or neutral (like contempt getting confused with neutral in FERPlus). Surprise can be happily
surprised positive emotion or a negative emotion. The possible reasons for such confusion could be: (i) some of
the negative emotions like disgust, contempt, sad are subtle to distinguish (ii) inconsistent annotation of expressions
by humans. A workaround to these issues and thereby to further enhance the performance would be to rely on a
hybrid approach that has an architecture like the proposed one in this paper and a meta-learner [47] that can suppress
uncertainties in annotations automatically. This is a future work to be carried out.

Figure 5: Confusion matrices for Ferplus, RAFDB and Affectnet8 datasets
6.5

Performance on in-lab datasets

Table 5 highlights the performance of the proposed method on CK+ and Oulu-CASIA datasets. 10-fold cross-validation
is carried out. The proposed model trained on combination of AffectNet and RAF-DB is fine-tuned during the crossvalidation. It is to be noted that there is no standard way of selection of expression images from the video sequences
9

A PREPRINT - J ULY 28, 2020

of CK+ and Oulu-CASIA. This work follows [9] in this regard. In Table 5, CK+8 corresponds to consideration of
all 8 expressions while CK+7 corresponds to only first 7 expressions (no contempt). Again, CK+7 for IACNN [35],
DeRL [51] and FMPN [7] corresponds to 7 expressions without contempt expression. The proposed method performs
Table 5: Performance comparison on in-lab datasets
Method
Baseline1
IACNN [35]
DeRL [51]
FMPN [7]
Teacher-ExpNet [9]
Ours
∗

CK+8
91.72
97.6
97.07

CK+7
95.37
97.30
98.06
97.31

Oulu-CASIA
82.71
88.0*
85.83
86.56

Only six expressions without neutral is considered.

almost on par with the state-of-the-art methods for in-lab datasets. It is to be noted that most of the compared methods
are specifically designed for in-lab datsets while the proposed method focuses on robustness to wild conditions like
occlusions and pose variations in the real-world. Despite this difference, the proposed method performs well on in-lab
datasets, which strengthens the generalizing capability of the proposed method. Apart from cross-validation through
fine-tuning, cross-evaluation is also performed directly on in-lab datasets. For this, the best model trained on AffectNet-7
is evaluated on CK+, Oulu-CASIA and JAFFE datasets. Results are displayed in Table 6.
Table 6: Cross-evaluation performance of the proposed method
Model
GACNN[30]
Ours

6.6

CK+7
91.64
91.04

Oulu-CASIA
58.18
58.49

JAFFE
56.33

Influence of SCAN

To study how good SCAN is, the proposed model is trained on AffectNet by replacing SCAN using: (i) a single attention
(SA), (ii) a spatial attention constant across channels (SPA), (iii) only local patch attention (LPA), (iv) only global
feature map attention (GA), (v) ECA. Table 7 elicits the comparison results. Definitely, SCAN has advantage over other
attention modules. Though the gain may not look pronounced, it is to be noted that the local patches input to SCAN are
of size around 5x5x512. The spatial size of 5x5 is small. However, a gain of around 0.3 to 1.2% achieved by SCAN
over other attention modules emphasize that even when spatial size is smaller, per channel per location attention pushes
up the performance and makes the model more robust. It is also found in our experiment that absence of attention
branch (absence of SCAN) brings down the performance of the model by 1.2 to 1.5% across the datasets.
Table 7: Influence of SCAN
Attention Mechanism
SA
SPA
LPA
GA
ECA
SCAN

6.7

AffectNet-7
64.0
64.43
64.4
64.71
64.54
65.14

AffectNet-8
60.7
61.35
61.23
61.05
61.18
61.73

Influence of CCI and ECA

To study how good is CCI branch, the proposed model is trained with and without CCI. The results are tabulated in
Table 8. It is very clear that without CCI, the performance drops down significantly, by 11 to 21%. This emphasizes that
wealth of information available from FR model must be put to use. In fact, in comparison to Table 1, it can be observed
that a couple of baselines perform better than the proposed model without CCI. The reason is that, in the absence of
CCI, the attention net SCAN alone cannot push the performance. SCAN operates on the output of the Conv_3x middle
layer from the backbone Resnet-50 and it only provides attention. It does not provide representation. The representation
10

A PREPRINT - J ULY 28, 2020

comes from CCI which has a dense layer preceding the classifier layer. Whereas in the baselines, the representation
learning/fine-tuning happens.
Further, weighting the features prior to use stresses important features and eliminates redundancies. To validate this
point, Table 9 shows performance of the model in the presence and absence of ECA before CCI branch. Incorporating
ECA before CCI branch does attain a significant gain of 2% over ECA-less CCI branch.
Table 8: Influence of CCI
Database
AffectNet-7
AffectNet-8
RAF-DB
FERPlus

Without CCI
43.74
42.63
73.79
77.21

With CCI
65.14
61.73
89.02
89.42

Table 9: Influence of ECA
Without ECA
With ECA
6.8

AffectNet-7
63.51
65.14

FERPlus
88.71
89.42

RAF-DB
86.34
89.02

Performance on Masked Datasets Simulating Covid-19 Scenario

Another study carried out keeping in mind the current COVID-19 pandemic is to evaluate how well the proposed
model perform when the regions of mouth and nose are masked. Of course, FED-RO is an already available real-world
occlusions dataset on which the proposed method had already been evaluated (see Table 4). However, it has variety
of occlusions and does not predominantly contain occlusions covering mouse and nose regions. The interest here is
to look at the performance of the proposed model exclusively on masked mouth and nose regions. Towards this end,
using the publicly available code 4 , two datasets have been constructed from the whole of RAF-DB and FERPlus. A
sample of constructed images are shown in Fig. 6. Table 10 displays the results on these synthetic masked datasets.
Row 3 in Table 10 corresponds to the performance of the proposed model initialized by weights from the associated
best performing proposed model on non-masked datasets. Similarly, row 4 corresponds to the performance of the
proposed model initialized by weights from the associated best performing proposed model on non-masked datasets,
and subsequently fine-tuned. Row 5 corresponds to the performance of the proposed model that is trained from scratch
on masked datasets.
Performance is compared with Baseline3 and RAN. Baseline1 and Baseline2 are not considered because they gave
lower results than Baseline3. Compared to Baseline3, the proposed model has done exceedingly well in being robust
to mask. Further, the proposed model has clearly outperformed RAN by around 3% and 10% on masked RAF-DB
and masked FERPlus, respectively. However, a dip of around 13 to 14% in performance is seen when compared to
performance on non-masked datasets (see Table 1). This is because some of the relevant regions like nose and mouth
regions are unavailable for discriminating between expressions. Further, fine-tuning parameters of non-masked model
does not perform as good as the one trained from scratch. Some kind of unlearning and fresh learning is required when
certain regions are completely blocked. This is not possible in fine-tuning. This experiment clearly suggests that new
ways need to be explored to tackle challenges as depicted here.

Figure 6: Example of synthetic masked face images for each of basic emotions from FERPlus dataset
6.9

Other Ablation Studies

In SCAN, each local patch goes through a separate convolutional unit (see Eq.1). In this regard, an experiment is
attempted where all the local patches share the convolutional parameters. The results are available in Table 11. Clearly,
shared parameters almost match the performance of SCAN with non-shared parameters. In fact, in RAF-DB, shared
4

https://github.com/X-zhangyang/Real-World-Masked-Face-Dataset/tree/master/wear_mask_to_face

11

A PREPRINT - J ULY 28, 2020
Table 10: Performance on masked RAF-DB and masked FERPlus datasets
Method
Baseline3
RAN(Trained from scratch) [48]
Ours(Pre-trained(Non-masked))
Ours(Pre-trained(Non-masked)+ Finetuned)
Ours(Trained from scratch)

Masked
RAF-DB
64.50
74.41
49.48
75.65
77.64

Masked
FERPlus
58.46
64.81
51.26
71.6
74.69

parameters outperform the non-shared SCAN. With shared parameters, downgrade by a factor of 25 in the number of
parameters for SCAN can be achieved, making SCAN lighter.
Table 11: Shared parameters vs non-shared parameters in SCAN
Model
FERPlus RAF-DB Affect Net-7 Affect Net-8 SFEW
Non-shared SCAN
89.42
89.02
65.14
61.73
58.93
89.25
89.11
64.43
60.47
56.61
Shared SCAN

FED-RO
73.5
72.75

λ, the loss weighting parameter (see Eq.5) is another hyperparameter to be tuned. Plot in Fig. 8 depicts the performance
against various values of λ. Setting λ = 1 is a worst option since the CCI branch becomes unavailable. Further, different
λ values, between 0.2 and 0.5 gave best performances for different datasets. For example, in AffectNet-7, the model
reached as high as 65.3 when λ equals 0.4. Similarly, in AffectNet-8, the model reached as high as 61.93 when λ equals
0.6. RAF-DB and FERPlus attained their best performance when λ is 0.2. So, to present results consistently across all
datasets, in this work λ is set to 0.2.
Next, the number of local patches ‘m’ to consider in SCAN is a hyperparameter. Plot in Fig 7 presents the performance
against number of partition blocks in SCAN that define the number of local patches ‘m’. The margin of difference
between different sizes is very thin. m=25 gave the best results.

Figure 7: Performance for different number of blocks for partition

Figure 8: Performance for different values of the loss weighting parameter(λ)

12

A PREPRINT - J ULY 28, 2020

6.10

Visualizations

In order to investigate the salient regions focused upon by the proposed model in the presence of occlusions and pose
variations, the attention weighted activation maps from Conv_3x are visualized using Grad-CAM[41] for Baseline3,
the proposed model without ECA and the proposed model with ECA. Fig. 9 shows the visualizations. Dark color
indicates high attention while lighter color indicates negligible attention. For Baseline3, either the attention is spread
over occluded parts (1st column, 2nd and 4th rows) or the attention is negligible all over. The proposed model without
ECA also sometimes focuses on irrelevant pars (ear region in 2nd column, 1st row) or misses out on relevant parts (like
missing out mouth region in 2nd to 4th rows). In comparison to Baseline3 and ECA-less case, the proposed model with
ECA attends on non-occluded and relevant parts for expression recognition. Though the predictions made by Baseline3
and the proposed model without ECA are correct on some of the cases in Fig. 9, it is to be noted that presence of ECA
provides attention that seems more natural. Also, the proposed model without ECA still has SCAN and the rest of the
CCI branch to propel it to provide better attention weights than Baseline3. More visualizations are provided in the
supplementary material.
Fig. 10 shows some of failure cases of the proposed method. It is to be noted that though the predictions are wrong,
attention has been given to relevant regions (except may be in image 4), avoiding occluded parts. Wrong predictions are
among confused pair of expressions. Usually, surprise is easily confused with happy and fear expressions and sad with
disgust. Such confused pairs sometimes arise due to inconsistent labeling by human taggers, and also some expressions
exhibiting compound emotions like happily surprised or fearfully sad. These failures open up more scope for research
in FER domain in future.

Figure 9: Comparison of activation maps captured for FED-RO images with and without ECA and Baseline3. True
label is indicated on left (in black) and predicted label on bottom of each image(in white).

Figure 10: Some examples of failures of our method from FED-RO dataset

7

Conclusions

In conclusion, the efficacy of per channel per location attention coupled with complementary context information
available through the knowledge transferred from middle layers of pre-trained FR model is demonstrated across both
in-the-wild and in-lab datasets through a variety of experiments and illustrations in this work. Two directions to look
into future are: (i) inconsistent annotations of FER datasets can bring down the performance. A hybrid approach of
13

A PREPRINT - J ULY 28, 2020

suppressing uncertainties in annotations combined an attention architecture similar to the one proposed in this work can
further boost performance of FER. (ii) Recognizing expressions from faces masked in mouth and nose regions that is
common in current COVID-19 pandemic requires definition of expressions based only on eyes and forehead regions.
The feasibility of this and subsequent incorporation of these definitions into a learning paradigm is a useful direction to
venture into.

Acknowledgments
We dedicate this work to Bhagawan Sri Sathya Sai Baba, Divine Founder Chancellor of Sri Sathya Sai Institute of
Higher Learning, PrasanthiNilyam, A.P., India.

References
[1] Lanitis A., Taylor C., and Cootes T.F. Automatic interpretation and coding of face images using flexible models.
IEEE Transactions on Pattern Analysis and Machine Intelligence, pages 743–756, 2002.
[2] F. Abdat, C. Maaoui, and A. Pruski. Human-computer interaction using emotion recognition from facial expression.
In 2011 UKSim 5th European Symposium on Computer Modeling and Simulation, pages 196–201, 2011.
[3] E. Barsoum, C. Zhang, C. C. Ferrer, and Z. Zhang. Training deep networks for facial expression recognition
with crowdsourced label distribution. In Proceedings of the 18th ACM International Conference on Multimodal
Interaction, page 279–283, 2016.
[4] J. Cai, Z. Meng, A. S. Khan, Z. Li, J. O’Reilly, and Y. Tong. Identity-free facial expression recognition using
conditional generative adversarial network. arXiv preprint, arXiv:1903.08051, 2019.
[5] Q. Cao, L. Shen, W. Xie, O. M. Parkhi, and A. Zisserman. Vggface2: A dataset for recognising face across pose
and age. International Conference on Automatic Face and Gesture Recognition, 2018.
[6] Shan CF, Gong SG, and McOwan PW. Facial expression recognition based on local binary patterns: A comprehensive study. Image and Vision Computing, 27:803–816, 2009.
[7] Yuedong Chen, Jianfeng Wang, Shikai Chen, Zhongchao Shi, and Jianfei Cai. Facial motion prior networks for
facial expression recognition. IEEE Visual Communications and Image Processing (VCIP), 2019.
[8] Hok chun Lo and R. Chung. Facial expression recognition approach for performance animation. IEEE Proceedings
Second International Workshop on Digital and Computational Video, 6:613–622, Feb 2001.
[9] Ilke Cugu, Eren Sener, and Emre Akbas. Microexpnet: An extremely small and fast model for expression
recognition from face images. arXiv preprint, arXiv:1711.07011, 2019.
[10] J. Deng, W. Dong, R. Socher, L.-J. Li, K. Li, and L. Fei-Fei. ImageNet: A Large-Scale Hierarchical Image
Database. In CVPR09, 2009.
[11] A. Dhall, R. Goecke, S. Lucey, and T. Gedeon. Acted facial expressions in the wild database. In Technical Report,
2011.
[12] A. Dhall, R. Goecke, S. Lucey, and T. Gedeon. Static facial expression analysis in tough conditions: Data,
evaluation protocol and benchmark. IEEE ICCV workshop BEFIT, 2011.
[13] Hui Ding, Peng Zhou, and Rama Chellappa. Occlusion-adaptive deep network for robust facial expression
recognition. arXiv preprint, arXiv:2005.06040v1, May 2020.
[14] X. Dong, Y. Yan, W. Ouyang, and Y. Yang. Style aggregated network for facial landmark detection. CVPR, page
379–388, 2018.
[15] Zixizng Fei, Erfu Yang, David Day-Uei, Stephen Butler, Winifred Ijomah, Xia Li, and Huiyu Zhou. Deep
convolution network based emotion analysis towards mental health care. Neurocomputing, 388:212–227, 2020.
[16] Hiroshi Fukui, Tsubasa Hirakawa, Takayoshi Yamashita, and Hironobu Fujiyoshi. Attention branch network:
Learning of attention mechanism for visual explanation. CVPR, 2019.
[17] Shih FY, Chuang CF, and Wang PSP. Performance comparisons of facial expression recognition in jaffe database.
International Journal of Pattern Recognition and Artificial Intelligence, 22:445–459, 2008.
[18] Yandong Guo, Lei Zhang, Yuxiao Hu, Xiaodong He, and Jianfeng Gao. Ms-celeb-1m: A dataset and benchmark
for large-scale face recognition. ECCV, 2016.
14

A PREPRINT - J ULY 28, 2020

[19] Satori Hachisuka, Kenji Ishida, Takeshi Enya, and Masayoshi Kamijo. Facial expression measurement for
detecting driver drowsiness. In Don Harris, editor, Engineering Psychology and Cognitive Ergonomics, pages
135–144, Berlin, Heidelberg, 2011. Springer Berlin Heidelberg.
[20] D. Hamester, P. Barros, and S. Wermter. Face expression recognition with a 2-channel convolutional neural
network. IEEE International Joint Conference on Neural Networks, pages 1–8, 2015.
[21] P. Hu, D. Cai, S. Wang, A. Yao, and Y. Chen. Learning supervised scoring ensemble for emotion recognition in the
wild. Proceedings of the 19th ACM International Conference on Multimodal Interaction., page 553–560, 2017.
[22] JihenKhalfallah and Jaleleddine Ben Hadj Slama. Facial expression recognition for intelligent tutoring systems in
remote laboratories platform. Procedia Computer Science, 73:274–281, 2015.
[23] Chen JK, Chen ZH, Chi ZR, and Fu H. Facial expression recognition based on facial components detection and
hog features. Abstracts of scientific cooperations international workshops on electrical and computer engineering
subfields, page 64–69, 2014.
[24] Mase K. Recognition of facial expressions for optical flow. IEICE Transactions on Special Issue on Computer
Vision and Its Applications, E74:3474–3483, 1991.
[25] T. Kanade, J. F. Cohn, and Y. Tian. Comprehensive database for facial expression analysis. In Proceedings of
the Foruth IEEE International Conference on Automatic Face and Gesture Recognition(FG’OO), pages 46–53,
Grenoble, France, 2000.
[26] A. Krizhevsky, I. Sutskever, and G. Hinton. Imagenet classification with deep convolutional neural networks.
Advances in Neural Information Processing Systems, 2012.
[27] G. Levi and T. Hassner. Emotion recognition in the wild via convolutional neural networks and mapped binary
patterns. Proceedings of the 2015 ACM on international conference on multimodal interaction, page 503–510,
2015.
[28] Shan Li and Weihong Deng. Reliable crowdsourcing and deep locality-preserving learning for unconstrained
facial expression recognition. IEEE Transactions on Image Processing, 28(1):356–370, 2019.
[29] Shan Li, Weihong Deng, and JunPing Du. Reliable crowdsourcing and deep locality-preserving learning for
expression recognition in the wild. In 2017 IEEE Conference on Computer Vision and Pattern Recognition
(CVPR), pages 2584–2593. IEEE, 2017.
[30] Yong Li, Jiabei Zeng, Shiguang Shan, and Xilin Chen. Occlusion aware facial expression recognition using cnn
with attention mechanism. IEEE Transactions on Image Processing, 28:2439–2450, May 2019.
[31] P. Lucey, J. F. Cohn, T. Kanade, J. Saragih, Z. Ambadar, and I. Matthews. The extended cohn-kanade dataset
(ck+): A complete dataset for action unit and emotion-specified expression. In Computer Vision and Pattern
Recognition Workshops(CVPRW), page 94–101, San Francisco, USA, 2010.
[32] Michael J. Lyons, Shigeru Akamatsu, Miyuki Kamachi, and Jiro Gyoba. Coding facial expressions with gabor
wavelets. 3rd IEEE International Conference on Automatic Face and Gesture Recognition, pages 200–205, 1998.
[33] Jaffar MA. Facial expression recognition using hybrid texture features based ensemble classifier. International
Journal of Advanced Computer Science and Applications(IJACSA), 6, 2017.
[34] M. Matsugu, K. Mori, Y. Mitari, and Y. Kaneda. Subject independent facial expression recognition with robust
face detection using a convolutional neural network. Neural Networks, 16:555–559, 2003.
[35] Z. Meng, P. Liu, J. Cai, S. Han, and Y. Tong. Identity-aware convolutional neural network for facial expression
recognition. FG, pages 558–565, 2017.
[36] Ali Mollahosseini, Behzad Hasani, and Mohammad H Mahoor. Affectnet: A database for facial expression,
valence, and arousal computing in the wild. IEEE Transactions on Affective Computing, 2017.
[37] Udayakumar N. Facial expression recognition system for autistic children in virtual reality environment. International Journal of Scientific and Research Publications, 6:613–622, Jun2016.
[38] Emilio Soria Olivas, Jose David Martin Guerrero, Marcelino Martinez Sober, Jose Rafael Magdalena Benedito, and
Antonio Jose Serrano Lope. Handbook Of Research On Machine Learning Applications and Trends: Algorithms,
Methods and Techniques. IGI Publishing, 701, E. Chocolate Avenue, Suite 200, Hershey PA, 2009.
[39] O. M. Parkhi, A. Vedaldi, and A. Zisserman. Deep face recognition. British Machine Vision Conference, 2015.
[40] Olga Russakovsky, Jia Deng, Jonathan Krause Hao Su, Sanjeev Satheesh, Sean Ma, Zhiheng Huang, Andrej
Karpathy, Aditya Khosla, Michael Bernstein, Alexander C. Berg, and Li Fei-Fei. Imagenet large scale visual
recognition challenge. International Journal of Computer Vision, 115:211–252, Dec 2015.
15

A PREPRINT - J ULY 28, 2020

[41] R. R. Selvaraju, M. Cogswell, A. Das, R. Vedantam, D. Parikh, , and D. Batra. Grad-cam: Visual explanations
from deep networks via gradient-based localization. https://arxiv.org/abs/1610.02391, 2016.
[42] Karen Simonyan and Andrew Zisserman. Very deep convolutional networks for large-scale image recognition.
International Conference on Learning Representations, 2015.
[43] Lingxue Song, Dihong Gong, Zhifeng Li, Changsong Liu, and Wei Liu. Occlusion robust face recognition based
on mask learning with pairwise differential siamese network. ICCV, 2019.
[44] N. Sun, Q. Li, R. Huan, J. Liu, and G. Han. Deep spatial-temporal feature fusion for facial expression recognition
in static images. Pattern Recognition Letters, 2017.
[45] Christian Szegedy, Wei Liu, Yangqing Jia, Pierre Sermanet, Scott Reed, Dragomir Anguelov, Dumitru Erhan,
Vincent Vanhoucke, , and Andrew Rabinovich. Going deeper with convolutions. IEEE Conference on Computer
Vision and Pattern Recognition (CVPR), June 2015.
[46] Nian Chi Tay, Connie Tee, Thian Song Ong, and Pin Shen Teh. Abnormal behavior recognition using cnn-lstm with
attention mechanism. IEEE 1st International Conference on Electrical, Control and Instrumentation Engineering,
2019.
[47] Kai Wang, Xiaojiang Peng, Jianfei Yang, Shijian Lu, and Yu Qiao. Suppressing uncertainties for large-scale facial
expression recognition. In 2020 IEEE Conference on Computer Vision and Pattern Recognition (CVPR). IEEE,
2020.
[48] Kai Wang, Xiaojiang Peng, Jianfei Yang, Debin Meng, and Yu Qiao. Region attention networks for pose and
occlusion robust facial expression recognition. IEEE Transactions on Image Processing, 29:4057– 4069, January
2020.
[49] Qilong Wang, Banggu Wu, Pengfei Zhu, Peihua Li, Wangmeng Zuo, and Qinghua Hu. Eca-net: Efficient channel
attention for deep convolutional neural networks. arXiv preprint, arXiv:1910.03151v4, April 2020.
[50] Shinohara Y. and Otsu N. Facial expression recognition using fisher weight maps. Proceedings of the Sixth IEEE
Conference on Automatic Face and Gesture Recognition, page 499–504, 2004.
[51] H. Yang, U. Ciftci, and L. Yin. Facial expression recognition by de-expression residue learning. CVPR, page
2168–2177, 2018.
[52] A. Yao, D. Cai, P. Hu, S. Wang, L. Sha, and Y. Chen. Holonet: towards robust emotion recognition in the wild.
Proceedings of the 18th ACM International Conference on Multimodal Interaction, page 472–478, 2016.
[53] D. Yi, Z. Lei, S. Liao, and S. Z. Li. Learning face representation from scratch. arXiv preprint, arXiv:1411.7923,
2014.
[54] J. Yu, Z. Lin, J. Yang, X. Shen, X. Lu, and T. S. Huang. Generative image inpainting with contextual attention.
CVPR, 2018.
[55] J. Zhang, M. Kan, S. Shan, and X. Chen. Occlusion-free face alignment: Deep regression networks coupled with
de-corrupt autoencoders. CVPR, page 3428–3437, June 2016.
[56] K. Zhang, Z. Zhang, Z. Li, and Y. Qiao. Joint face detection and alignment using multitask cascaded convolutional
networks. IEEE Signal Processing Letters, 23(10):1499–1503, 2016.
[57] G. Zhao, X. Huang, M. Taini, S. Z. Li, and M. Pietikainen. Facial expression recognition from near-infrared
videos. Image and Vision Computing, 29:607–619, 2011.

16

A PREPRINT - J ULY 28, 2020

1
1.1

Supplementary material
Effect of oversampling

In-the-wild datasets are highly imbalanced as it is difficult to annotate and collect images in categories like disgust and
contempt. So, oversampling is used to overcome it. Results on AffectNet-7 with and without oversampling are shown
in the Table 1 below:
Table 1: Performance on AffectNet-7 with and without oversampling

arXiv:2007.10298v2 [cs.CV] 25 Jul 2020

Dataset
With-oversampling
Without-oversampling
1.2

Accuracy
65.14
62.57

Inference time

The average inference time per 224 x 224 RGB image on the proposed model is calculated on GPU as well as on CPU.
These are displayed in the Table 2 below:
Table 2: Average inference time per image
GPU
CPU
1.3

Average time/image(sec)
0.03
0.12

Visualizations

Additional visualizations, continuing from main text, are provided in Fig. 1. Further, visualizations, as described in
main text, are also provided for masked FERPlus dataset in Fig. 2. It is clear that the proposed model did not focus on
masked area while baseline and RAN spreads around occluded area also.

Figure 1: Activation Maps for FEDRO dataset images using Baseline3(left), our model without ECA(middle) and with
ECA(right).
1.4

Confusion plots

More confusion plots for different datasets are available in Figures [3-8]. Happy expression is easily recognizable
across most of the datasets. Contempt expression could not be recognized well in FERPlus as number of samples for
this category is much less as compared to others. Even though oversampling has been used, it requires further enquiry
how performance can be improved. In SFEW dataset, disgust and anger are poorly recognized, again probably because
of imbalance. Fear and surprise are confused pair of expressions. Similarly, anger and sad are confused at times.
1

A PREPRINT - J ULY 28, 2020

Figure 2: Comparison of activation maps on our masked FERPlus dataset between Baseline3 (left image in each triplet),
RAN(middle image in each triplet) and our model (right image in each triplet). Image labels are displayed on extreme
left of each pair. Predicted labels are below images.

Figure 3: Confusion plots using cross-evaluation for CK+(7classes) and OuluCASIA datasets

Figure 4: Confusion plots for SFEW and FED-RO datasets

2

A PREPRINT - J ULY 28, 2020

Figure 5: Confusion plots for Occlusion, Pose30 and Pose45 subsets of FERPLUS

Figure 6: Confusion plots for Occlusion, Pose30 and Pose45 subsets of RAFDB

Figure 7: Confusion plots for Occlusion, Pose30 and Pose45 subsets of Affectnet on 7 classes

3

A PREPRINT - J ULY 28, 2020

Figure 8: Confusion plots for Occlusion, Pose30 and Pose45 subsets of Affectnet on 8 classes

4

