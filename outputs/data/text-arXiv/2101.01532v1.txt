Revealing the Transmission Dynamics of COVID-19:
A Bayesian Framework for !! Estimation
Xian Yang1,2#, Shuo Wang2#, Yuting Xing2, Ling Li3, Richard Yi Da Xu4,
Karl J. Friston5 and Yike Guo1,2*

Department of Computer Science, Hong Kong Baptist University, Hong
Kong Special Administrative Region, China

1

2

Data Science Institute, Imperial College London, UK

3

School of Computing, University of Kent, UK

Faculty of Engineering and Information Technology, University of Technology
Sydney, Australia
4

5

Institute of Neurology, University College London, UK

# Contribute equally

* Corresponding author: yikeguo@hkbu.edu.hk

ABSTRACT
In epidemiological modelling, the instantaneous reproduction number, !! , is important to
understand the transmission dynamics of infectious diseases. Current !! estimates often suffer
from problems such as lagging, averaging and uncertainties demoting the usefulness of !! . To
address these problems, we propose a new method in the framework of sequential Bayesian
inference where a Data Assimilation approach is taken for !! estimation, resulting in the stateof-the-art ‘DARt’ system for !! estimation. With DARt, the problem of time misalignment
caused by lagging observations is tackled by incorporating observation delays into the joint
inference of infections and !! ; the drawback of averaging is improved by instantaneous
updating upon new observations and a model selection mechanism capturing abrupt changes
caused by interventions; the uncertainty is quantified and reduced by employing Bayesian
smoothing. We validate the performance of DARt through simulations and demonstrate its
power in revealing the transmission dynamics of COVID-19.

1

INTRODUCTION
Epidemic modelling is important for understanding the evolving transmission dynamics and
responding to the emerging pandemic1–8. In particular, the instantaneous reproduction number
!! has drawn extensive attention and become an essential metric, indicating the trajectory of
prevalence9. !! is defined as the average number of secondary cases that could be generated
by a primary case, if conditions remained the same thereafter time #. There are two major
applications of !! : as a trend indicator for the nowcast of transmission10, and as a quantitative
metric for the retrospective assessment of intervention impacts6,11. Both applications depend
on a reliable system estimating the time-varying !! from appropriate epidemiological
observations with accuracy and timeliness. Inappropriate interpretation or imprecise estimation
of !! could furnish misleading information. Several systems

9,12–15

have been proposed to

estimate !! , however, in practice, this remains a challenging task due to the following issues16:
a. Lagging observations. Given a mathematic model of transmission dynamics, !!
estimation is to infer the time-varying parameters of the model based on epidemiological
observations, where the number of infections could be the ideal data source. However, the
actual infection number is unknown and can only be inferred from other epidemiological
observations (e.g., the daily confirmed cases). Such observations are lagging behind the
infection events due to inevitable time delays between an individual being infected and
reported (e.g., days for symptom onset17). Direct !! estimation from lagging observations
without adjusting for the time delay results in the temporal inaccuracy16,18. To address this
problem, a two-step strategy, first estimating infections from epidemiological observations
with a temporal transformation followed by !! estimation using epidemic models, has been
commonly used in practice18. The simple temporal shift of observations by the mean
observation delay turns out not sufficient for the relatively long observation delay nor the
rapidly changing transmission dynamics, which are seen in the COVID-19 pandemic18.
Backward convolution method (i.e., subtracting time delay, with a given distribution, from
each observation time) leads to an over-smooth reconstruction of infection and bias for !!
estimation9. More advanced deconvolution methods19 through inversing the observation
process are mathematically more accurate but sensitive to the optimisation procedure (e.g.,
stopping criterion) of the ill-posed inverse problem. In addition, the estimated result of
infection number is often calculated as a point estimate for the !! estimation so that the

2

uncertainty from the observation process is discarded20. As an alternative to the two-step
strategy, we are investigating a new Bayesian approach of jointly estimating both infection
number and !! with uncertainty from epidemiological observations with explicitly
parameterising observation delay.
b. Averaging inference. There are two general paradigms to deal with the challenge of
estimating time-varying parameters: 1) reformulating the problem into an inference of
static or quasi-static parameters, so that various methods for static parameter estimation
can be used; 2) developing inference methods for explicit time-varying parameter
estimation. For the first approach, the evolution of !! is usually parameterised with several
static parameters (e.g., the decay rate of an exponential !! 14). The quasi-static method is to
assume slow !! evolution that could be treated as static within a short period. For example,
Cori et al.13 proposed a sliding-window method ‘EpiEstim’ using a segment of observations
for averaging inference, with the assumption that !! keeps the same within the sliding
window. This assumption does not apply to the rapidly changing transmission dynamics
with interventions, and the window size affects the temporal and quantitative accuracy of
!! estimation. Best practices of selecting the sliding window are still under investigation18.
Instead of adopting a local sliding window, Flaxman et al.11 defined several intervention
periods according to intervention measures, assuming a constant !! within each period.
This requires additional information about the intervention timeline, which could be not
accurate, and the abrupt change is blurred. Although the technical challenges are
substantially reduced by inferring static parameters rather than a high-dimensional !! time
series, the fixed-form !! assumption or the averaging inference is not able to describe the
switching transmission dynamics that were common due to the intervention measures
imposed during the COVID-19 pandemic. In contrast to window-based methods, data
assimilation21 with sequential Bayesian inference22,23 is a window-free alternative that has
been less explored for !! estimation. Applying sequential Bayesian inference, data
assimilation supports instantaneous updating model states upon the arrival of new
observations. Moreover, the Bayesian model selection mechanism24 can be used for
modelling the switching transmission dynamics under interventions, avoiding the
drawback of averaging inference. This motivates us to employ the sequential Bayesian
approach for !! estimation.

3

c. Uncertainty. The confidence of !! estimation is of equal importance compared to the
estimate itself, especially when providing evidence for policymaking. The uncertainty of
!! estimates come from different sources, including the intrinsic uncertainties of epidemic
modelling, data observation and inference process. Firstly, the uncertainty of
epidemiological parameters affects the final !! estimates. For example, !! estimation is
found sensitive to the distribution of generation time intervals18. Secondly, the uncertainty,
resulting from systematic error (e.g., weekend misreporting) and random error (e.g.,
observation noise), in the observation process should be properly measured. During the
COVID-19 pandemic, we have seen different reporting standards across countries and
regions, with different levels of uncertainty. This is not only the uncertainty of observations,
but also that of the time delay between the infection event and the observation that affects
!! estimates. Thirdly, the uncertainty could be enlarged or smoothed in the inference
process. For example, the use of a sliding window could smooth the !! estimation but may
simultaneously miscalculate the uncertainty, due to the overfitting within the slidingwindow. To provide a reliable credible interval (CI) of !! estimates, the aforementioned
three types of uncertainty should all be handled and reported as part of the final !!
estimates. As a state-of-the-art package, EpiEstim (Version 2)25 allows users to account for
the uncertainty from epidemiological parameters by resampling over a range of plausible
values. However, the uncertainty from imperfect observations and the side effects
associated with the sliding window is not addressed. Recently, ‘EpiNow’15 was proposed
to integrate the uncertainty of observation process, but the inference is still based on the
sliding window. In this work, we deal with model and data uncertainty in the data
assimilation framework21 with a Bayesian smoothing mechanism to enable both the latest
and historical observations to be continuously integrated into !! estimation to alleviate
spurious variability.
In order to tackle these practical issues, we propose a comprehensive Bayesian data
assimilation system, namely ‘DARt’ (Data Assimilation for !! estimation), for joint estimates
of infections and !! together with their uncertainty. The evolution of the transmission
dynamics is described by a hierarchical transition process, which is informed by the newly
observed data through an observation process formulated with explicit observation delay. A
model selection mechanism is built in the transition process to detect abrupt changes under
interventions. The performance of the DARt system is validated and compared to the state-ofthe-art EpiEstim system through simulations and real-world applications, showing its power of
4

estimation and adequacy for practical use. We have made the system available online for broad
use in !! estimation for both research and policy assessment.

Results
1. DARt: A Data Assimilation System for $" Estimation
With DARt, we jointly estimate the number of incident infections (%! ), the instantaneous
reproduction number (!! ), and the change indicator (&! ) of the switching dynamics of !! . This
is achieved by the inference of the latent state '! , consisting of !! , %! and &! , with all available
observations (#:% up to the latest observation time ) within a data assimilation framework (see
Methods). In contrast to inferring the ‘pseudo’ dynamics (i.e., reformulating into a static/quasistatic problem), our proposed DARt system directly estimates the ‘real’ time-varying !! by
assimilating information from the observation with the model forecast.
As a data assimilation system, DARt consists of three main components: 1) a state transition
model – describing the evolution of latent states based on an epidemic renewal process; 2) an
observation function – linking the underlying latent states to lagging epidemiological
observations; and 3) a sequential Bayesian inference engine, as depicted in Figure 1 –
updating the state estimation with ongoing observations using forward Bayesian filtering
(Figure 1 (A)) and refining historical state estimates using all observations with backward
Bayesian smoothing (Figure 1 (B)).

5

Figure 1. Illustration of the inference of DARt system for !! estimation. The latent state
'! includes the number of infections (%! ), the instantaneous reproduction number (!! ),
and the change indicator (&! ) of abrupt change. The epidemiological observation is
denoted as (! , and is linked to the latent state via the observation function. For each time
step, the estimation of the latent state *('! |(#:! ) are constantly updated according to
ongoing reported observations using sequential Bayesian updating with forward filtering
and backward smoothing. (A) Forward filtering at each time step. The posterior state
estimation *('!&# |(#:!&# ) estimated from previous step # − 1 is transformed as the prior
*('! |(#:!&# ) for the current step #, where a time-varying renewal process is used as the
state transition model as detailed in Figure 7. Together with the likelihood *((! |'! )
obtained from epidemiological observation at the current step, the posterior of the current

6

step *('! |(#:! ) is estimated. At the same time, as shown in (B), backward smoothing is
to compute {*('! |(#:% )}%!'# , taking account of all the observations (#:% up to the time )
by applying a Bayesian smoothing method (see Methods).
§

State transition model

As shown in Figure 1(A), the latent state '! is updated with a state transition model based on
a time-varying renewal process26,27. Besides !! , %! , we introduce an auxiliary binary latent
variable &! to indicate the switching dynamics of !! under interventions without assuming a
pre-defined evolution pattern of !! (e.g., constant or exponential decay). &! = 0 indicates a
smooth evolution of !! corresponding to minimal or consistent interventions; &! = 1
indicates an abrupt change of !! corresponding to new interventions or outbreak. The smooth
evolution of !! is modelled as a Gaussian random walk while the abrupt change is
implemented through resetting the !! memory by assuming a uniform probability distribution
for the next time step of estimation. That provides an automatic way of framing a new epidemic
period as manually done in Ref11. The transition of &! is modelled as a discrete Markovian
process with fixed transition probabilities controlling the sensitivity of change detection.
Compared with the widely used two-step strategy (i.e., %! and !! are estimated successively),
the joint inference of !! and %! provides a comprehensive picture of the evolving epidemics
(see details in Methods).
§

Observation function

An observation function is designed as a convolution process, reflecting the fact that
observation (! at time # is linked with a series of infection numbers of lagging days by a time
delay distribution: (! = ∑( 6( %!&( where the kernel 6( is the probability that an individual
infected is observed after 7 days (see details in Methods). According to the observation types,
different observation delays such as incubation time, testing and reporting delay can be chosen
by selecting the corresponding kernel 6( . Therefore, through the observation function, the
lagging relationship between the latent state and observations are explicitly modelled to handle
the issue of temporal inaccuracy. This makes our !! estimates aligned with the timeline, which
is important for the retrospective analysis of policy impacts.

7

§

Sequential Bayesian inference engine

In DARt, the Bayesian inference has two phases: forward filtering and backward smoothing.
The forward filtering uses the up-to-date prior from the state transition model and the likelihood
determined by the latest observation to update the current latent state, by computing its
posterior following the Bayes rule. The backward smoothing works by looking back to refine
the previous state estimation when more observations have been accumulated to reduce the
uncertainty of !! estimation.
Forward filtering. For each new time step #, the latent state '! is continuously updated upon
the new observation (! , following Bayes rule: *('! |(#:! ) ∝ *('! |(#:!&# ) *((! |'! ), where
*('! |(#:!&# ) = ∫ *('! |'!&# )*('!&# |(#:!&# ) :'!&# is the prior forecasted by the state
transition model from the previous step # − 1, and *((! |'! ) is the likelihood determined by
the new observation (! under the forecasted state '! . This approach differs from the fixed prior
in the Bayesian inference of static parameters (e.g., the fixed gamma distribution adopted in
‘EpiEstim’). This filtering mechanism, as shown in Figure 1 (A), computes the posterior
distribution of the latent state by assimilating the forecast from the forward transition model
with the information from the new epidemiological observations. For the implementation of
this Bayesian updating process, we adopt a particle filter method23 to efficiently approximate
the posterior distribution through Sequential Monto Carlo (SMC) sampling (see details in
Method). This eschews any fixed-form assumptions for the posterior – of the sort used in
variational filtering and dynamic causal modelling28.
Backward smoothing. The estimated result *('! |(#:! ) from aforementioned forward filtering
only includes the past and present information flows, corresponding to the prior *('! |(#:!&# )
and likelihood *((! |'! ), respectively. The !! estimation would be accurate if all infections
related to !! are fully observed in (#:! . However, this is certainly not the case due to
observation delay. As a result, the !! estimate from forward filtering is with large uncertainty
inherited from the likelihood where the present observations include little up-to-date infection
information. In order to reduce the uncertainty in !! estimation from forward filtering, DARt
adopts the Bayesian backward smoothing technique, estimating the latent state at a time #
retrospectively, given all observations available till time ) () > #). Compared with other !!
estimation methods, DARt takes the advantage of additional information to smooth inference
results with reduced uncertainty caused by incomplete observations. More specifically, the
8

smoothing mechanism can be described as: given a sequence of observations (#:% up to time )
and filtering results *('! |(#:! ) , for all time # < ) , the state estimates are smoothed as:
,( *+'
*('! |(#:% ) = *('! |(#:! ) ∫ *('!)# |'! ) *+'!)# ,(#:%- :'!)# , where *('!)# |(#:% ) is the
!)#

#:!

,( *+'
smoothing results at time # + 1 where ∫ *('!)# |'! ) *+'!)# ,(#:%- :'!)# is the smoothing
!)#

#:!

factor, as shown in Figure 1(B). In this way, all the relevant observations are fully exploited to
enable us to reduce the uncertainty of !! estimation.
In summary, comparing with the sliding-window (i.e., averaging inference) approaches, our
sequential Bayesian updating mechanism of DARt features an instantaneous !! estimation and
smoothing uncertainty through the utilisation of all available observations.
2. Validation through simulation
Due to the lack of ground-truth !! in real-world epidemics, we present a set of experiments
based on synthetic data to establish the face validity of DARt system. Figure 2 illustrates the
design of simulation experiments where a synthesised !! , is adopted as the ground truth to
validate its estimated !>! . We also estimated !! using the state-of-the-art !! estimation package
EpiEstim25 to compare the effectiveness in overcoming three aforementioned issues (i.e.,
lagging, averaging and uncertainty).

Figure 2. Validation experiment of the DARt system on simulated data. First, the groundtruth !! sequence is synthesised using piecewise Gaussian random walk split by two

9

abrupt change points, simulating the drop of mean !! from 3.2 to 1.6 and then 0.8 under
two intensive interventions. The sequence of incident infection %! is simulated based on a
renewal process parameterised by the synthesised !! and starting with 5 infections on the
first day. The observation process includes applying a convolution kernel representing
the probabilistic observation delay to obtain the expectation of observation (!̅ and adding
Gaussian noise representing the reporting error to obtain the noisy ‘real’ observation (! .
The inputs (in grey) to the DARt system are the distributions of generation time,
observation kernel and simulated noisy observation (! . The system outputs are the
B! . These outputs are compared with the
estimated !>! , estimated @̂! and change indicator &
synthesised !! , %! and the time of abrupt changes. Also, the observation function is
applied to the estimated @̂! to compute the recovered observation (C! with uncertainty,
which is compared to the ‘real’ observation. This provides an indirect way to validate the
correctness of inference results. These comparisons results are shown in Figure 3.
Data synthesis. We first generated a synthesised !! curve from a piece-wise Gaussian random
walk mimicking the scenario of two successive interventions (Figure 3 (A)). To approximate
the early stage of exponential growth, the simulation started with !. = 3.2, which reflects the
basic reproduction number of COVID-19 and followed a Gaussian random walk
!!)# ~HIJKKLIM(!! , (0.05)/ ). At # = 20, we set !/. =1.6 indicating the mitigation outcome
of soft interventions. After soft interventions, the epidemic is still being uncontrolled with the
evolution of !! resuming to the Gaussian random walk as above. At # = 30, !! experienced
another abrupt decrease to a value under 1, where we set !0. =0.8 to indicate the suppression
effects of intensive interventions (e.g., lockdown). Afterwards, the epidemic is being controlled,
and the evolution of !! follows the same random walk as above.
With the simulated !! curve, we followed the renewal process using the generation time
distribution as reported by Ferretti et al.3 (i.e., the Weibull distribution with shape and scale
equal to 2.826 and 5.665 days respectively) to simulate the infected curve %! starting with 5
infections at # = 0. Then we generated the lagging observation curve of onset cases (!̅ using
the incubation time distribution3 (i.e., the lognormal distribution with log mean and standard
deviation of 1.644 and 0.363 days respectively) as the observation time delay. Throughout this
paper, both the generation time distribution and the incubation time distribution are truncated
and normalised, where values smaller than 0.1 are discarded. To simulate the real-world noisy
observations, we added Gaussian noise as (! ~HIJKKLIM((!̅ , 9(!̅ ).
10

Validation procedure and results. As shown in Figure 2, DARt takes inputs from simulated
observation (! , the distribution of generation time and observation delay, and produces the
B! ), which are validated via
estimated outputs (!>! , daily infection @̂! and the change indicator &
comparing with the synthesised !! , %! , and the dates of abrupt change, respectively. We also
obtained the recovered observation (C! (i.e., the observation result of estimated daily infection
@̂! ) and checked its consistency with the ‘real’ observation (! .
To compare with the state-of-the-art EpiEstim package25, we input the infection curve and the
distribution generation time to EpiEstim to estimate !! with a 7-day sliding window following
the recommended practice. It is noted that two approaches of preparing infection curve input
for EpiEstim were taken as common practice: 1) ‘plug-and-play’ use1 by taking observations
(! as the infection without adjusting for the observation delay; 2) the two-step strategy29 that
shift (! backwards in time by the median observation delay (5 days in the simulation). We
implemented both practices and compared with DARt.
All validation results are shown in Figure 3.

11

Figure 3. Validation results. (A) Synthesised !! , simulated %! and (! curves from the
evolution of transmission dynamics under two successive interventions. Validation
results are listed as follows. Correctness of $" estimation: (B) shows the comparison
of the synthesised !! with the DARt estimated !! , as well as and that of the EpiEstim
with backward shifted (! as its infection. The comparison indicates that DARt is more
robust to observation noise and the estimated !! matches the synthesised !! better with
relatively less degree of fluctuations. Moreover, DARt can respond to abrupt changes
instantaneously demonstrating its ability to overcome the weakness of averaging. The
probabilities of having abrupt changes are captured by &! as shown in green bars. Even
under observation noise, DARt can still acutely detect abrupt changes. Correctness of
P" estimation: (C) shows the simulated %! , DARt estimated %! , and %! of EpiEstim. We

12

can find that the DARt estimated %! with 95% CI match well the simulated %! . In contrast,
the EpiEstim result diverts from %! , indicating that, with the shifting the observation
curve to approximate infection numbers, EpiEstim results still suffer from the inaccuracy
of approximation. Accuracy in recovering observations Q" : (D) compares the
distribution of recovered (! from DARt with the simulated (! curve. The recovered (!
with 95% CI can generally match well the simulated (! without undesired local
fluctuations. Effectiveness of DARt smoothing: (E) illustrates the effectiveness of
backward smoothing by comparing the DARt estimated !! results with and without
smoothing, showing the expected smoothing effect of estimated !! with reduced CI.
Temporal accuracy of DARt: (F) shows the results from EpiEstim with and without
shifting the observation curve backwards. Although the time misalignment problem can
be alleviated by temporal shifting in EpiEstim, its inferred !! cannot match well to the
synthesised !! curve, failing to reflect two abrupt changes in a timely fashion.
3. Applicability to real-world data
We applied DARt to estimate !! in four different regions during the emerging pandemic. Each
region represents a distinct epidemic dynamic, allowing us to test the effectiveness and
robustness of DARt in each scenario. 1) Wuhan: When COVID-19 had the outbreak in the city,
the government responded with very stringent interventions such as a total lockdown. By
studying the !! evolution there during the early few months of this year, we can check the
capability of the system in detecting the expected abrupt change of !! . 2) Hong Kong: during
the year, the daily increase of reported cases in Hong Kong has been remaining at a low level
for most of the time with the maximum daily value under 200. As no stringent interventions
have been introduced in such a city with high-density population, this is an ideal scenario of
studying smooth change of !! with the risk of sudden resurgence. 3) United Kingdom: UK is
undergoing an intense secondary outbreak of COVID-19 with daily infections exceeding
10,000. Instantaneous !! estimation is very meaningful for this scenario for examining the
impacts of various proposed policies. We also applied DARt to estimate the distinct epidemic
curves of typical cities in England to reflect the local epidemic dynamics (see Supplementary
Materials). 4) Sweden: Sweden is a representative of countries that have less stringent
intervention policies and has a clear miss-reporting pattern repeated weekly. This makes
Sweden an ideal case to examine the robustness of DARt with considerable observation noise.

13

Figure 4. Epidemic dynamics in Wuhan (A), Hong Kong (B), United Kingdom (C) and
Sweden (D). The top row of each subplot shows the number of daily observations (in
yellow), the recovered daily observations (in blue) and the recovered daily infections (in
green). The consistency between the yellow line and blue line indirectly validated the
soundness of !! results. The bottom row compares the DARt !! estimation (in black)
with the EpiEstim results (in blue). !! = 1 is plotted in dash line for reference. The
distributions of all estimates from both DARt and EpiEstim are with 95% CI. The
probabilities of having abrupted changes (&! =1) are shown in green bars. For Wuhan, in
contrast with EpiEstim having a smooth decrease in !! around the lockdown time, the !!
curve from DARt experienced a sharp decrease showing the instantaneous response to
the intervention, which is also detected by &! . For Hong Kong, DARt can generate a
more stable !! than EpiEstim, especially during September and October when the
number of cases remained at a very low level. For the UK and Sweden, !! curves from
DARt and EpiEstim largely follow the same trend. However, CIs of !! from EpiEstim
are quite narrow (even cannot be easily observed from this figure), indicating the
underestimated uncertainty of estimation by EpiEstim.
14

Epidemic dynamics in these four regions. The inference results for !! and reconstructed
observations for these four countries are shown in Figure 4. For Wuhan, the observation data
are the number of onset cases compiled retrospectively from epidemic surveys, while for Hong
Kong, UK and Sweden, the observation data are the number of reported confirmed cases.
Throughout this paper, we use the onset-to-confirmed delay distribution from Ref30 together
with the distribution of incubation time proposed in Ref3 to approximate the observation delay.
As the ground-truth !! is not available, we validate the results by checking whether the
recovered distributions of observation well cover the observation curve of (! . As shown in the
top panel of each subplot in Figure 4, the CIs of recovered (! distributions (in blue) covered
most parts of the original observations (in yellow), showing the reliability of our !! estimation.
Figure 4 (A) shows the results using Wuhan’s onset data1. We observe that there was a sharp
decrease in Wuhan’s !! after 21st of Jan 2020, which is also indicated by &! as the probability
of abrupt changes peaked at this time (in green bars). Around that time, a strict lockdown
intervention has been enforced in Wuhan. This sharp decrease is likely to be the result of this
intervention, indicating its impact. The small offset between the exact lockdown date and the
time of sharp decrease might be due to noisy onset observations and approximated incubation
time distribution. After lockdown, !! decreased smoothly, indicating that people’s awareness
of the disease and the precaution measures taken had made an impact. Since the beginning of
Feb 2020, the value of !! remained below 1 for most of the time with the enforcement of
quarantine policy and increases in hospital beds to accept of all then diagnosed patients. It is
noted that the onset curve has a peak on 1st of Feb 2020, due to a major correction in reporting
standard. Neither !! nor %! curve from our model suffers from this fluctuation, showing its
robustness delivered by the smoothing mechanism. The results from Wuhan show our
switching mechanism can overcome the issue of averaging and automatically detect sharp
changes in epidemiological dynamics.
Figure 4 (B) shows the inferred results from Hong Kong reported confirmed cases31 since early
July. In Hong Kong, the number of infections remains low for the most time and the
government has continuously imposed soft interventions: for example, on 11th of July, the
Hong Kong government forbidden social gatherings with > 8 people in restaurants and pubs;
from 24 July, all citizens are required to wear masks in indoor places. We can see that the !!
curve has remained largely under 1 until November. In the middle of November 2020, a
dramatic increase in !! emerged indicating a new wave of outbreak. By looking at the
15

probabilities represented in green bars of Figure 4 (B), we can find that the start of the new
wave can be also detected by &! . The change in !! we have found is consistent with the official
reports about a newly imported case has triggered a new outbreak.
Figure 4 (C) shows the inference results from the United Kingdom’s reported confirmed cases32.
After a continuous decline during May and June 2020, the second wave of COVID-19 cases is
evidenced. Around the end of June, !! started climbing above 1 for the subsequent dates and
reached almost 1.5 at the end of August. At the beginning of September, shortly after the
reopening of schools at full capacity, a new wave of epidemic outbreak occurred. Then, a series
of interventions were introduced from late September and a national lockdown has enforced
on 5th of November, where !! curves kept decreasing and became lower than 1 after the
lockdown. With the end of lockdown on 2nd of December, the !! was again around 1. The
match between the time of changes in !! and the dates of interventions indicates the
effectiveness of DARt in policy impact monitoring. Moreover, there was a sharp increase in
the number of reported confirmed cases on 4th of October 2020 caused by miss reporting
between September 25 and October 2. The estimated !! didn’t experience a spike at that time,
indicating the robustness of DARt at the presence of observation noise.
Figure 4 (D) shows the inferred epidemic dynamics in Sweden from the daily reported data33.
We find that the daily reported cases in Sweden have shown periodic drop every 7 days that
are likely caused by misreporting. By looking at the results, we can find that the influence of
such periodic fluctuations has been smoothed by DARt to provide a consistent !! curve.
Comparing DARt performance with different types of observations. Figure 5 shows the
results of !! estimation using onsets and confirmed cases (Figure 5 (A)) as observations in
Hong Kong to estimate !! , respectively. We choose Hong Kong for illustration purpose since
both onset and reported confirmed cases are publicly accessible. The CIs of inferred results
from two different observations largely overlapped (Figure 5 (B)). For the emerging outbreak
started in mid-November, as the record of onset cases is not completely documented by the
government yet (especially for the recent week) and the tails of onset and confirmed curves in
Figure 5 (A) are different. This result reflects that, with a proper observation kernel according
to the observation types (e.g., onset, confirmed cases), DARt can make consistent estimation
from a wide range of observation types.

16

Figure 5. Comparison of estimated !! curves of Hong Kong using different observations.
(A) Observations of daily onset (black) and confirmed cases (red) used as the input are
compared in. (B) !! estimations with 95% CI inferred from onsets and confirmed cases
using DARt are in black and red, respectively. !! = 1 is plotted in dash line for reference.
Sensitivity to systematic observation errors. For Sweden, we observe a systematic
observation error that – on every Monday – the number of reported cases is significantly smaller
than the other days. This kind of observation noise could induce unnecessary fluctuations to !!
curves. Therefore, we used Sweden’s data to further illustrate the robustness of our scheme in
the presence of noise. The blue curves in Figure 6 (A), (B) and (C) are the results from EpiEstim
with the sliding-window size set to 7, 5 and 3 days, respectively. For comparison, the estimated
!! curve from DARt is shown as the black curve in each subplot. We found that EpiEstim is
sensitive to the choice of window size in this case. In contrast, DARt does not require a presetting of window size. To illustrate the robustness of our scheme to observation noise, we made
imputed reported numbers on all Mondays by the average of their neighbouring values. The
inference results are shown in Figure 6 (D), where the green curve is from the imputed
observations with systematic observation errors alleviated and the black curve is the results
directly using the raw observations. The results of DARt between using the raw observation
and imputed observation are almost indistinguishable, indicating its robustness at the presence
of observation noise.

17

Figure 6. Inference results for Sweden with different settings. (A)-(C) compare results
from DARt (black) and EpiEstim (blue) with sliding window ranging from 7, 5 and 3
days, respectively. These subplots show EpiEstim is sensitive to the setting of sliding
window width. (D) compares the DARt results using raw reported data (black) with using
imputed reported data (green). The similar results of DARt between using the raw
observation and imputed observation as the input indicate the robustness of DARt at the
presence of observation noise.
To summarise, DARt has been applied to four different regions for revealing the
transmission dynamics of COVID-19 to demonstrate its real-world applicability and
effectiveness. Consistent with the findings in the simulation study, DARt has shown its
advantage over the popular EpiEstim in the following aspects:
•

Instantaneity: Unlike EpiEstim which is sensitive to the width of the sliding window,
DARt is window-free following the sequential Bayesian inference approach. DARt

18

equips the change indicator to detect the sharp change !! , while EpiEstim is difficult
to reflect the abrupt epidemic change due to its averaging mechanism.
•

Robustness: With Bayesian smoothing, the !! curve from DARt is more stable at the
presence of observation noise, comparing with that of EpiEstim. Moreover, during
the period of low infection numbers (such as the period at the beginning of October
in Hong Kong), EpiEstim might generate pseudo peaks in !! while DARt can avoid
such fluctuation.

•

Temporal accuracy: EpiEstim requires manually shifting the observation curve
backwards by the median observation delay for !! estimation, while DARt
performed a joint estimation of !! and %! by explicitly encoding the lag into
observation kernels. This alleviates the bias of shifting and inappropriate settings and
interpretation from the ‘plug-and-play’ use of EpiEstim by non-experts.

Discussion and Conclusion
In this paper, we have proposed DARt by adopting a Bayesian inference scheme for estimating
!! . Our work provides a state-of-the-art !! estimation tool supporting a wide range of
observations. In the system, epidemic states can therefore be updated using newly observed
data, following a data assimilation process in the framework of sequential Bayesian belief
updating. For the model inference, a particle filtering/smoothing method is used to approximate
the !! distribution in both forward and backward directions of time, ensuring the !! at each
time step assimilates information from all time points. By taking the Bayesian approach, we
have emphasised the uncertainty in !! estimation by accommodating observation uncertainty
in likelihood mapping and introduced Bayesian smoothing to incorporate sufficient
information from observations. Our method provides a smooth !! curve together with its
posterior distribution. We have demonstrated that inferred !! curves can explain different
observations accurately. Our work is not only important in revealing the epidemical dynamics
but also useful in assessing the impact of interventions. The sequential inference mechanism
of !! estimation takes into account the accuracy of time alignment and provides an abrupt
change indicator. This method offers a promising method for intervention assessment,

19

comparing the approach of directly incorporating interventions as co-factors into epidemic
model11,34.
We have made some approximations to facilitate the implementation. First, the observation
time and generation time distributions are truncated into fixed and identical length.
Theoretically, these two distributions can be of any length, while most values are quite small.
In our state transition model, one variable of the latent state is a vectorised form of infection
numbers over a period. The purpose of vectorisation is to facilitate implementation by making
the transition process to be Markovian. The length of this vector variable is determined by the
length of effective observation time and the generation time distributions. Truncating these two
distributions to a limited length, by discarding small values, would facilitate the vectorisation.
Apart from truncation, we have assumed that these two distributions do not change during the
prevalence of disease. However, as we have discussed previously20, introducing interventions,
such as an increased testing capacity, would affect the observation time. The distribution of
generation time would also change as the virus is evolving. It is possible to extend our model
with time-varying observation function. For example, the testing capability and time-varying
mortality rate could also be considered in the observation process.
Second, we approximate the variance of observation error empirically. Given the variance of
observations is unknown and could change over time across different regions, the standard
deviation of the Gaussian likelihood function is not set to a fixed value in our scheme. We
estimate the region-specific time-varying observation variance from the observational data.
Although the empirical estimation yielded reasonable results for the four regions and cities in
the UK (see Supplementary Materials), it may generate some implausible results in some
scenarios; for example, when the epidemic is growing or resurging explosively, leading to an
overestimation of observation variance. An adaptive error variance inference should be
developed to tackle this issue.
The third approximation is implicit in the use of a particle filter to approximate the posterior
distributions over model state variables – including !! – with a limited number of samples (i.e.,
particles). Particle filtering makes no assumptions about the form of posterior distributions. On
the contrary, the variational equivalent of particle filter, namely variational filtering28 provides
an analytical approximation to the posterior probability and can be regarded as limiting
solutions to an idealised particle filter, with an infinite number of particles35. As not only the

20

mean value of !! but also its estimation uncertainty is important for advising governments on
policymaking, an analytical approximation to help properly quantify uncertainty is desirable.
Fourthly, change detection is approximated by the change indicator &! . The change indicator
is included as part of the latent state and inferred during particle filtering. This work opens a
venue to explore variational Bayesian inference for switching state models36. Crucially,
variational procedures enable us to assess model evidence (a.k.a. marginal likelihood) and
hence allow automatic model selection. Examples of Variational Bayes and model comparison
to optimise the parameters and structure of epidemic models can be found in previous studies37.
These variational procedures can be effectively applied to change detection.
Finally, the method outlined in the paper can, in principle, be applied to generative epidemic
models that include more latent states that underwrite the renewal process; for example, contact
rates, transmission strengths, et cetera. We envisage that such models would be considered
from observational, spatial-temporal and social perspectives. From the observational aspect,
multiple epidemic curves are generally available (e.g., daily onsets, deaths or confirmed cases).
This allows using different kinds of data to inform model parameters (and structure). This sort
of modelling may call for a generative model that explicitly includes the latent states generating
the data at hand (e.g., hospital admissions). Dynamic causal models37 are potential candidates
here because they extend conventional (SEIR) models to include spatial location, mobility,
hospitalisation et cetera. From the spatial-temporal perspective, one could construct a
homogeneously mixed spatial-temporal model with connected regions that share the same
model structure but with distinct model parameters38. Mobility information could then be used
to inform inter-regional spread, when suitably parameterised. From the socio-behavioural
aspect, one could build a comprehensive model by including epidemic-relevant behavioural
factors into the model, especially human mobility trends. This usually entails modelling
differential contact rates between subpopulations (or populations in specific locations) as a
function of other latent states: for example, modelling social distancing as a non-linear function
of the prevalence of infection39. Mobility is reflected in the use of public transportation,
people’s average walking distance, people’s attitude towards disease (cautious or passive), and
people’s lifestyle (e.g., work from home, take-away). All of these metrics are, to a greater or
lesser extent, available as empirical constraints on suitably structured generative models. By
considering different modelling factors, the estimation results of !! should be more accurate
and furnish more precise credible intervals.
21

In conclusion, our work provides a practical scheme for accurate and robust !! estimation. It
opens a new avenue to study epidemic dynamics within the Bayesian framework. We provide
an open-source !! estimation package as well as an associated Web service that may facilitate
other people’s research in computational epidemiology and the practical use for policy
development and impact assessment.

22

Methods
The DARt system estimates !! in the framework of data assimilation with a sequential
Bayesian inference approach. Three main components of DARt: 1) a state transition model describing the evolution of the latent state; 2) an observation function – defining an
observation process describing the relationship between the latent state and observations; 3) a
sequential Bayesian engine: statistical reason time-varying model parameters with
uncertainty by assimilating prior state information provided by the transition model and the
newly available observation. In this section, we first introduce the renewal process for
modelling epidemic dynamics, which is the fundamental of our state transition model. We then
describe the observation function, linking a sequence of infection numbers with the observation
data. Next, we present a detailed state transition model and propose the sequential Bayesian
update module.
1. Renewal process for modelling epidemic dynamics
Common !! estimation methods include compartment model-based methods (e.g., SIR and
SEIR 40 ) and time-since-infection models based on renewal process25. Their relationships are
discussed in Supplementary Materials Section 1.1. Comparative studies have been done in
Ref18 to show that EpiEstim, one of the renewal process-based methods, outperforms other
methods in terms of accuracy and timeliness. Given the renewal process, the key transition
equation derived from the process is:
%!

%! = !! R S( %!&(

(1)

('#

where %! is the number of incident infections on day #, )1 is the time span of the set {S( }, and
individual S( is the probability that the secondary infection case occurs 7 days after the
primary infection, describing the distribution of generation time9. The profile of S( is related
to the biological characteristics of the virus and is generally assumed time-independent during
the epidemic. Considering the simplicity and performance of applying the renewal process to
model epidemic dynamics, our work adopts Equation (1) as the basic transition function for
joint estimation of !! and %! .

23

2. Observation process
In epidemiology, the daily infection number %! cannot be measured directly but is reflected in
observations such as the case reports of onset, confirmed and deaths. There is an inevitable
time delay between the real date of infection and the date reporting, due to the incubation time,
report delay, etc. Taking account of this time delay, we model the observation process as a
convolution function between kernel 6, and the infection number in )2 most recent days.
%"

(! = R 6( %!&(

(2)

('3

where (! is the observation data, and 6( is the probability that an individual infected is
observed on day 7. )2 is the maximum dependency window. It is assumed that the past daily
infections before this window do not affect the current observation (! . Since there is a delay
between observation and infection, we suppose the most recent infection that can be observed
by (! is at the time # − :, where : is a constant determined by the distribution of observation
delay.
To accommodate various observation types (e.g., the number of daily reported cases, onsets,
deaths and infected cases), DARt will choose the appropriate time delay distributions
accordingly. For example, for the input of onsets, the infected-to-onsets time distribution is
chosen to be the kernel in the observation function. For the input of daily reported cases, the
infected-to-onset and the onset-to-report delays are used together as the kernel in the
observation function. These delay distributions can be either directly obtained from literature
or learned from case reports that contain individual observation delays3. Detailed descriptions
of the observation functions for different epidemic curves can be found in Supplementary
Materials (Section 1.2).

24

Figure 7. Illustration of the hierarchical transition process and observation process. The
most recent infection that can be observed by (! is at the time # ∗ = # − : where : is a constant
determined by the distribution of observation delay. Suppose )5 is the length of the vector
T! ∗ = [%! ∗ &%$ )# , %! ∗ &%$ )/ , … , %! ∗ ] such that (! is only relevant to T! ∗ and %! ∗ only depends on
T! ∗ &# via the renewal process. Therefore, )5 ≥ max()1 , )2 − : + 1). The case that )5 =
)2 − : + 1 is depicted in this figure.
3. Sequential Bayesian Inference
In Figure 8, we illustrate the Bayesian inference scheme of DARt with the following
descriptions.
§

State transition model

In our model, indirectly observable variables %! and !! are included in the latent state. The state
transition function for !! is commonly assumed to follow a Gaussian random walk or constant
within a sliding window as implemented in EpiEstim. This kind of simplification is not capable
of capturing an abrupt change in !! under stringent intervention measures. To address this
25

problem, we introduce an auxiliary binary latent variable &! to characterise and switch
between two distinct evolution patterns of !! – smooth transition (Mode I, &! = 0) and abrupt
change (Model II, &! = 1):
*(!! |!!&# , &! ) ~ \

](!!&# , ^6 / )
U[0, !!&# + ∆]

&! = 0
&! = 1

Mode I
Mode II

(3)

where ](!!&# , ^6 / ) is a Gaussian distribution with the mean value of !!&# and variance of
^6 / , describing the random walk with the randomness controlled by ^6 . U[0, !!&# + ∆] is a
uniform distribution between 0 and !!&# + ∆ allowing sharp decrease while limiting the
amount of increase. This is because we assume that !! can have a big decrease when
intervention is introduced but it is unlikely to increase dramatically as the characteristics of
disease would not change instantly.
The transition of the change indicator &! , is modelled as a discrete Markovian process with
fixed transition probabilities:
*(&! = 0|&!&# ) = *(&! = 0) = f

(4a)

*(&! = 1|&!&# ) = *(&! = 1) = 1 − f

(4b)

where f is a value close to and lower than 1. The above function means that the value of &! is
independent of &!&# , while the probability of Mode II (i.e., &! = 1) is quite small. This is
because it is unlikely to have frequent abrupt changes in !! .
For the incident infection %! , the state transition can be modelled based on Equation (1) as
*i%! j%!&# , … , %!&%! k. To make the transition process to be Markovian, we vectorise the infection
%

"
numbers as follows. Suppose the infection numbers {%!&( }('3
that can be observed in (! are all

contained in T! ∗ = [%! ∗ &%$ )# , %! ∗ &%$ )/ , … , %! ∗ ], where # ∗ = # − :, and the length of this vector
)5 is larger than or equal to )2 − : + 1. We also require )5 to be not smaller than )1 .
Therefore, all the historical information needed to infer %! ∗ is available from T! ∗ &# , i.e., T! ∗ only
depends on T! ∗ &# (i.e., being Markovian). The state transition process and observation process
are illustrated in Figure 7.

26

The latent state in our model is then defined as '! =< !! ∗ , T! ∗ , &! ∗ >, which contribute to (!
at time #. The state transition function of T! ∗ is therefore Markovian:
%!

%$ &#
(8)

(8)#)

*(T! ∗ |T! ∗ &# , !! ∗ ) = lmLKKmM(%! ∗ ; !! ∗ R S( %! ∗ &( ) o p(T! ∗ , T! ∗ &# )
('#

(5)

8'#

(8)

where T! ∗ is the q-th component of the latent variable T! ∗ and p(r, s) is the Kronecker delta
function (please refer to Supplementary Materials 2.3 for more details). With Equation (3)-(5),
the latent state transition function *('! |'!&# ) can be obtained as a Markov process:
*('! |'!&# ) = *(T! ∗ |T! ∗ &# , !! ∗ )*(!! ∗ |!! ∗ &# , &! ∗ )*(&! ∗ |&! ∗ &# )
§

(6)

Forward Filtering

We formulate the inference of the latent state '! =< !! ∗ , T! ∗ , &! ∗ > with the observations (!
as within a data assimilation framework. Sequential Bayesian approach (also called ‘filtering’)
is adopted to infer the time-varying latent state, which updates the posterior estimation using
the latest observations following the Bayes rule.
Let us denote the observation history between time 1 and # as (#:! = [(# , (/ , … , (! ]. Given that
previous estimation *('!&# |(#:!&# ) and new observation (! , we would like to update the
estimation of '! , i.e., *('! |(#:! ) following the Bayes rule with the assumption that (#:! is
conditionally independent of (#:!&# given '! :
*('! |(#:! ) =

*((! |'! )*('! |(#:!&# )
∫ *((! |'! )*('! |(#:!&# ):'!

(7)

where *('! |(#:!&# ) is prior and *((! |'! ) is the likelihood. The prior can be written in the
marginalised format:
*('! |(#:!&# ) = v *('! |'!&# )*('!&# |(#:!&# ) :'!&#

(8)

where '! is assumed to be conditionally independent of (#:!&# given '!&# , and the transition
*('! |'!&# ) is defined in Equation (6) based on the underlying renewal process. The likelihood

27

*((! |'! ) can be calculated assuming the observation uncertainty follows a Gaussian
distribution:
*((! |'! ) ~ ](x('! ), ^: / )

(9)

where x is the observation function with a kernel chosen accordingly to the types of
observations and ^: / is the variance of observation error estimated empirically. To show the
benefits of using this Gaussian likelihood function, we show the simulation results of using
Poisson likelihood without considering the observation noise. Results can be found in
Supplementary Figure 2, where the estimations fluctuate dramatically under noisy observation.
By substituting Equation (8) into Equation (7), we obtain the iterative update of *('! |(#:! )
given the transition *('! |'!&# ) and likelihood *((! |'! ):
*('! |(#:! ) =
§

*((! |'! ) ∫ *('! |'!&# )*('!&# |(#:!&# ) :'!&#
∬ *((! |'! ) ∫ *('! |'!&# )*('!&# |(#:!&# ) :'!&# :'!

(10)

Backward Smoothing

In DARt, we adopt backward smoothing to infer the latent state at a certain time, given all
observations relevant to the state. Based on the filtering results of *('! |(#:! ) for # ∈ {1, . . , )},
we can obtain the smoothing results *('! |(#:% ), where ) is the total number of observations.
To assimilate the information from subsequent observations, we use a standard backward pass
method:
*('! |(#:% ) = *('! |(#:! ) v *('!)# |'! )

*('!)# |(#:% )
:'!)#
*('!)# |(#:! )

(11)

which provides the iterative backward calculation of *('! |(#:% ) from time ) to time #. More
details can be found in Supplementary Materials (Section 2). For computational convenience,
particle methods are used to approximate the posterior distributions (details in Supplementary
Materials, Section 2.4). Detailed parameter settings can be found in Supplementary Materials,
Section 4.

28

Figure 8. Three components of DARt: state transition model, observation function and
sequential Bayesian update module with two phases (forward filtering and backward
smoothing). The latent state that can be observed in (! are defined as '! =<
!! ∗ , T! ∗ , &! ∗ > where !! ∗ is the instantaneous reproduction number, &! ∗ is a binary state
variable indicating different evolution patterns of !! ∗ , T! ∗ = [%! ∗ &%$ )# , %! ∗ &%$ )/ , … , %! ∗ ] is
a vectorised form of infection numbers %! , # ∗ indicates the most recent infection that can
be observed at time # is from the time # ∗ due to observation delay, and )5 is the length of
the vector T! ∗ such that (! is only relevant to T! ∗ and %! ∗ )# only depends on T! ∗ via the
renewal process.

29

Data availability
We obtained daily onset or confirmed cases of four different regions (Wuhan, Hong Kong,
Sweden, UK) from publicly available resources1,31–33 (accessed on 11th of December 2020).
For Wuhan, we adopted the daily number of onset patients from the retrospective study1 (from
the middle of December to early March). For UK data, we downloaded the daily report cases
(cases by date reported) from the official UK Government website for data and insights on
Coronavirus (COVID-19)32 (from early March to the end of November 2020). Data for UK
Cities were also downloaded from the same resource32 (from early August to the end of
November). For Sweden data, we downloaded the daily number of confirmed cases from the
European Centre for Disease Prevention and Control33 (from early March to the end of
November 2020). For Hong Kong, we downloaded the case reports from government website31
(from early July to the end of November 2020), including descriptive details of individual
confirmed case of COVID-19 infection in Hong Kong. For those asymptomatic patients whose
onset date are unknown, we applied their reported date as their onset date, and for those whose
onset date is unclear, we simply removed and neglected these records. Only local cases and
their related cases are considered, while imported cases and their related cases are excluded.

Code availability
We are releasing DARt as open-source software for epidemic research and intervention policy
design and monitoring. The source code of our method and our web service are publicly
available online (https://github.com/Kerr93/DARt).

30

References
1.

Pan, A. et al. Association of Public Health Interventions With the Epidemiology of the
COVID-19 Outbreak in Wuhan, China. JAMA 323, 1915 (2020).

2.

Li, R. et al. Substantial undocumented infection facilitates the rapid dissemination of
novel coronavirus (SARS-CoV-2). Science 368, 489–493 (2020).

3.

Ferretti, L. et al. Quantifying SARS-CoV-2 transmission suggests epidemic control
with digital contact tracing. Science (80-. ). 368, eabb6936 (2020).

4.

Neil M, F. et al. Impact of non-pharmaceutical interventions (NPIs) to reduce COVID19 mortality and healthcare demand. Imp. Coll. COVID-19 Response Team (2020).

5.

Cowling, B. J. et al. Impact assessment of non-pharmaceutical interventions against
coronavirus disease 2019 and influenza in Hong Kong: an observational study. Lancet
Public Heal. (2020).

6.

Lai, S. et al. Effect of non-pharmaceutical interventions to contain COVID-19 in
China. Nature (2020).

7.

Reiner, R. C. et al. Modeling COVID-19 scenarios for the United States. Nat. Med.
(2020).

8.

Chang, S. L., Harding, N., Zachreson, C., Cliff, O. M. & Prokopenko, M. Modelling
transmission and control of the COVID-19 pandemic in Australia. Nat. Commun. 11,
5710 (2020).

9.

Fraser, C. Estimating individual and household reproduction numbers in an emerging
epidemic. PLoS One 2, (2007).

10.

Wu, J. T., Leung, K. & Leung, G. M. Nowcasting and forecasting the potential
domestic and international spread of the 2019-nCoV outbreak originating in Wuhan,
China: a modelling study. Lancet 395, 689–697 (2020).

11.

Flaxman, S. et al. Estimating the effects of non-pharmaceutical interventions on
COVID-19 in Europe. Nature 1–5 (2020).

12.

Wallinga, J. & Teunis, P. Different epidemic curves for severe acute respiratory
syndrome reveal similar impacts of control measures. Am. J. Epidemiol. 160, 509–516
(2004).

13.

Cori, A., Ferguson, N. M., Fraser, C. & Cauchemez, S. A new framework and software
to estimate time-varying reproduction numbers during epidemics. Am. J. Epidemiol.
178, 1505–1512 (2013).

14.

Bettencourt, L. M. A. & Ribeiro, R. M. Real Time Bayesian Estimation of the
31

Epidemic Potential of Emerging Infectious Diseases. PLoS One 3, e2185 (2008).
15.

Abbott, S. et al. Estimating the time-varying reproduction number of SARS-CoV-2
using national and subnational case counts. Wellcome Open Res. 5, 112 (2020).

16.

Adam, D. A guide to R-the pandemic’s misunderstood metric. Nature 583, 346–348
(2020).

17.

He, X. et al. Temporal dynamics in viral shedding and transmissibility of COVID-19.
Nat. Med. (2020).

18.

Gostic, K. et al. Practical considerations for measuring the effective reproductive
number, Rt. medRxiv. (2020).

19.

Goldstein, E. et al. Reconstructing influenza incidence by deconvolution of daily
mortality time series. Proc. Natl. Acad. Sci. U. S. A. 106, 21825–21829 (2009).

20.

Wang, S. et al. A Bayesian Updating Scheme for Pandemics: Estimating the Infection
Dynamics of COVID-19. IEEE Comput. Intell. Mag. 15, 23–33 (2020).

21.

Asch, M., Bocquet, M. & Nodet, M. Data assimilation: methods, algorithms, and
applications. (2016).

22.

Chen, Z. Bayesian filtering: From Kalman filters to particle filters, and beyond.
Statistics (Ber). 182, 1–69 (2003).

23.

Doucet, A. & Johansen, A. M. A tutorial on particle filtering and smoothing: Fifteen
years later. in Handbook of nonlinear filtering vol. 12 3 (2009).

24.

Mark, C. et al. Bayesian model selection for complex dynamic systems. Nat. Commun.
9, (2018).

25.

Thompson, R. N. et al. Improved inference of time-varying reproduction numbers
during infectious disease outbreaks. Epidemics 29, (2019).

26.

Grassly, N. C. & Fraser, C. Mathematical models of infectious disease transmission.
Nat. Rev. Microbiol. 6, 477–487 (2008).

27.

Vynnycky, E. & White, R. An introduction to infectious disease modelling. (OUP
oxford, 2010).

28.

Friston, K. J. Variational filtering. Neuroimage 41, 747–766 (2008).

29.

Xihong Lin’s Group. Visualizing COVID-19’s Effective Reproduction Number (Rt).
http://metrics.covid19-analysis.org/.

30.

Leung, K., Wu, J. T., Liu, D. & Leung, G. M. First-wave COVID-19 transmissibility
and severity in China outside Hubei after control measures, and second-wave scenario
planning: a modelling impact assessment. Lancet 395, 1382–1393 (2020).

31.

HK Centre of Health Protection. Latest local situation of COVID-19. (2020).
32

32.

Department of Health and Social Care. Coronavirus (COVID-19) in the UK: Cases.
https://coronavirus.data.gov.uk/cases.

33.

European Centre for Disease Prevention and Control. Daily number of new reported
cases of COVID-19 by country worldwide.
https://www.ecdc.europa.eu/en/publications-data/download-todays-data-geographicdistribution-covid-19-cases-worldwide.

34.

Wu, J. T. et al. Estimating clinical severity of COVID-19 from the transmission
dynamics in Wuhan, China. Nat. Med. 26, 506–510 (2020).

35.

Friston, K., Stephan, K., Li, B. & Daunizeau, J. Generalised filtering. Math. Probl.
Eng. (2010).

36.

Ghahramani, Z. & Hinton, G. E. Variational learning for switching state-space models.
Neural Comput. (2000).

37.

Friston, K. J. et al. Testing and tracking in the UK: A dynamic causal modelling study.
Wellcome Open Res. 5, 144 (2020).

38.

Friston, K. J. et al. Second waves, social distancing, and the spread of COVID-19
across America. arXiv (2020).

39.

Friston, K. J., Costello, A. & Pillay, D. ‘Dark matter’ , second waves and
epidemiological modelling. medRxiv (2020).

40.

Cintrôn-Arias, A., Castillo-Chavez, C., Bettencourt, L. M. A., Lloyd, A. L. & Banks,
H. T. The estimation of the effective reproductive number from disease outbreak data.
Math. Biosci. Eng. 6, 261–282 (2009).

33

Supplementary Materials
Revealing the Transmission Dynamics of COVID-19:
A Bayesian Framework for !! Estimation
Xian Yang, Shuo Wang, Yuting Xing, Ling Li, Richard Yi Da Xu,
Karl J. Friston and Yike Guo

S1

Contents
1

Mathematical Models ................................................................................. 3

1.1 Time-varying Renewal Process ................................................................. 3
Origin of Instantaneous Reproduction Number !". ..................................... 3
Decomposition of the Infectiousness Profile................................................ 5
1.2 Observations of the Transmission Dynamics .......................................... 5
Formulation of the Observation Function. ................................................... 5
Observation Functions for Various Reports. ................................................ 6
2

Model Inference .......................................................................................... 8

2.1 Problem Formulation ................................................................................ 8
2.2 Inference Aims............................................................................................ 8
2.3 Bayesian Updating Scheme ....................................................................... 8
Forward filtering........................................................................................... 9
Backward smoothing .................................................................................. 11
2.4 Particle Methods ...................................................................................... 12
3

DARt Application to UK Cities ............................................................... 14

4

Experimental setting ................................................................................ 16

References ......................................................................................................... 17

S2

1 Mathematical Models
1.1 Time-varying Renewal Process
Origin of Instantaneous Reproduction Number !! . Both compartment models and timesince-infection models originate from the work of Kermack and McKendrick1 and can be
unified in the same mathematical framework2. Let us denote the numbers of susceptible and
recovered individuals at calendar time " by #(") and '(") (recovered individuals are not
denoted as !(") to avoid confusion with reproduction number). Taking account of different
phases of the infection period, we denote the number of infected individuals with an infectionage ( by )(", (). Thus, the overall number of currently infected individuals at time " is +(") =
!

∫" )(", () .( and the incident infection at time " is /(") = )(", 0). Governing equations of the
homogenous transmission2 are:
.#(")
= −2(")#(")
."
5

6
6
+ 8 )(", () = −9("))(", ()
6" 6(
!
.'(")
= ; 9(())(", () .(
."
"

)(", 0) = 2(")#(")

(S1)
(S2)
(S3)
(S4)

where 2(") is the rate at which susceptible individuals get infected at time ". This is given by
the infection rates per single infected individual >(() with an infection-age ( and the number
of infected individuals )(", () as:
!

2(") = ; >(() )(", () .(

(S5)

"

Similarly, 9(() is defined as the recovery rate with at infection-age (. By simplifying Equation
(S2) on the characteristic line (" = ( + @), we have:
.)(( + @, ()
= −9(())(( + @, ()
.(

(S6)

The solution to this ordinary differential equation is:
)(( + @, () = )(@, 0)B(()

(S7)

S3

where
#

B(() = DEF G− ; 9(H) .HI

(S8)

"

Thus we can link the infections with infection-age ( at time " to the incident infection at time
" − (:
)(", () = B(() )(" − (, 0)

(S9)

By substitute Equation (S5) and (S9) into Equation (S4), the incident infection /(") at time " is
!

/(") = ; #(") >(() B(() /(" − ().(

(S10)

"

Then we have the infectiousness profile >(", (), representing the effective rate at which an
infectious individual with infection-age ( produces secondary cases at time ":
>(", () = #(") >(() B(()

(S11)

The corresponding instantaneous reproduction number !(") is derived from the integral of
infectiousness profile >(", ():
$

!(") = ; >(", ().(

(S12)

"

It is the average number of people that someone infected at time " is expected to infect, if
conditions remain unchanged (i.e. susceptible population, infectiousness rate, recovery rate).
From the above derivation, we observe that the infectiousness profile >(", () and
corresponding instantaneous reproduction number !! are composed of three factors: #("),
>(() and B((). #(") represents the depletion of susceptible individuals: the decline of #(")
will reduce the susceptible population size leading to possible herd immunity. >(() represents
the infectiousness of individuals with infection-age (. This is related to biological (e.g. viral
shedding) and behavioural (e.g. contact rates) factors. B(() represents the recovery rate of
individuals with infection-age (: faster recovery will result in shorter infectiousness period and
smaller reproduction number. All three factors, #("), B(() and >(() can be altered by the
implementation of control measures along with time.

S4

Decomposition of the Infectiousness Profile. !! is determined by the evolution of the
infectiousness profile >(", () according to the Equation (S12). Further, the infectiousness
profile >(", () can be rewritten as:
>(", () = !(") L(", ()

(S13)

where L(", () = >(", ()/ ∫ >(", ().( is called the distribution of generation time, representing
the probability distribution of infection events as a function of infection-age (. That is, the
distribution of time interval between the primary infection and subsequent secondary infection.
In principle, the distribution of generation time is time-varying due to the three factors in
Equation (S11), which increases the complexity of parametric modelling. Most existing studies
assume a time-invariant generation time distribution (i.e. L(", () = L(() ) while the
introduction of control measures results in the change of !("). Under this assumption, Equation
(S10) can be rewritten as:
!

/(") = !(") ; L(() /(" − () .(

(S14)

"

This is the core formula for !! estimation from the infection data. That is,
!

!(") = /(")/ ; L(() /(" − () .(

(S15)

"

Or, we can have the corresponding discretised version:
!! =

/!
'!
∑%() L% /!&%

(S16)

where O* is the time span of the set {L% }. This decomposition of infectiousness profile into !!
and time-invariant generation time distribution L% is one of the fundamental formulae for !!
estimation in existing literature (e.g. the well-known package ‘EpiEstim’3 and this paper).

1.2 Observations of the Transmission Dynamics
Formulation of the Observation Function. The infection number /! is the ideal data source
for !! estimation according to Equation (S16). However, it is impossible to obtain the exact
number of real-time infections through intensive screening. Instead, the infections are usually
observed from the statistical reports of related events (i.e. epidemic curves) such as the daily
report of confirmed cases, onset cases and death number. There is an inevitable delay between
the infecting event occurred and being reported. That means these epidemic curves do not

S5

reflect the current incidence of infection /! . We clarify this by formulating the observation
function of the transmission dynamics. In the framework of data assimilation, /! is the state
variable of the dynamic epidemic system and its update is driven by the parameter !! as
described by Equation (S16). The aggregated reports S! (e.g., daily confirmed cases, deaths)
are the observing results of the state variable through an observation function T:
S! = T(/! )

(S17)

where T is the observation function and S! is the observation result.

Supplementary Figure 1. Illustrations of three types of observations and corresponding
distributions of time from the real infection date and observation.
Observation Functions for Various Reports. The format of the observation function T
depends on the type of reported data being used. In general, H is a convolutional operation
summing up the portion of infected cases weighted by the distribution of time delay between
being infected and reported. Confirmed reports S!+ , onset cases S!, and death reports S!- are
the three most used reports data for !! estimation4–6 (illustrated in Supplementary Figure 1).

S6

A. Onset Cases Reports. The reports of onset cases are usually compiled retrospectively from
epidemic surveys of confirmed cases, which can be represented as:
'"

S!, = U /!&% V%., = V ., ⨂/!

(S18)

%(/"

where V%., is the probability that the symptom onset occurs W days after the initial infection
date for a reported case, and ., indicates the S!, can only cover information of infections
former than ., days. The value of ., is determined by V ., . The distribution V ., is
determined by the biological factors of the virus and has been investigated in the previous
reports7, which is considered time-independent. We use the symbol ⨂ to denote the
convolution operation.
B. Confirmed Cases Reports. The epidemic curve of daily confirmed cases S!+ is observed
from
'#

S!+ = U /!&% V%.+ = V .+ ⨂/!

(S19)

%(/#

where V%.+ is the probability that a confirmed case is reported W days after the initial infection
date, and .+ has a similar definition with ., . The distribution V .+ includes two parts: the time
between infection to symptom onset V ., , and the time between symptom onset to reported
confirmation V ,+ :
V .+ = V ., ⨂V ,+

(S20)

The former part V ., is usually similar across regions while the latter time delay V ,+ varies a
lot due to test policies and screening capabilities8.
C. Death Reports. The epidemic curve of death S!- is observed from
'$

S!-

= X- U /!&% V%.- = X- V .- ⨂/!

(S21)

%(/$

where X- is the observed mortality rate of infected cases, V%.- is the probability that a
confirmed case is reported dead W days after the initial infection date, and .- has a similar
definition with ., . X- and V .- vary among different countries and periods due to capacities
of treatment5.

S7

2 Model Inference
2.1 Problem Formulation
The time-varying renewal process can be formulated through the framework of state space
hidden Markov models. The instantaneous reproduction number !! and daily incident
infections /! are the two latent variables of the state space models, whose dependence is
described by Equation (S16). Consider two evolution modes of !! : emerging smooth changes
when interventions are being steadily introduced/relaxed, and undergoing an abrupt change
due to intensive interventions (e.g., lockdown). We introduce another latent variable Y! to
automate the switch between these two modes, which will be discussed in detail in the next
section. The observations S! are the observed results of /! through Equation (S18), (S19) and
(S21). We are interested in inferring the evolution of !! (along with /! and Y! ) upon the realtime update of observations S! .

2.2 Inference Aims
As revealed in Equation (S14) and Equation (S17), the observations experience time delay with
respect to the update of the latent state, due to the lagging and averaging effects of convolution
in Equation (S18)-(S21). Thus, the changes of !! cannot be reflected in time, due to the
existence of incubation time and observation delay. In other words, accurate estimation of !!
at time " relies on future observations, which imposes the challenges of timely estimation.
Therefore, we focus on two inference aims:
1. Given the latest observation, how to give a near real-time estimate of !! and – equally
if not more important – how to assess the uncertainty of the results?
2. Upon update of the real-time observations, how to modify estimations at all previous
time steps and assess the uncertainties to make them more accurate taking into account
the new information?
These two aims correspond to the two fundamental questions in Bayesian updating, namely
the filtering and smoothing problems to be discussed in the next section.

2.3 Bayesian Updating Scheme
Z! =< !! ∗ , \! ∗ , Y! ∗ > is defined as the latent state observed by S! at time ". Since there is a
delay between observation and infection, we suppose the most recent infection that can be
observed by S! is at the time " ∗ = " − ., where . is a constant determined by the distribution

S8

of observation delay. Suppose O1 is the length of the vector \! ∗ = [/! ∗ &'& 2) , /! ∗ &'& 23 , … , /! ∗ ]
such that S! is only relevant to \! ∗ via Equation (S18)-(S21) and /! ∗ only depends on \! ∗ &) via
the renewal process. We formulate the estimate of the latent state Z! from the observed reports
S! as a data assimilation problem. A sequential Bayesian approach is adopted to infer timevarying latent state, which are composed of two phases: forward filtering and backward
smoothing.
Forward filtering: A sequential Bayesian updating approach is employed to infer the latest
latent state from the real-time observations. Let us denote the observation history between time
1 and " as S):! = [S) , S3 , … , S! ] . Given that previous estimation F(Z!&) |S):!&) ) and new
observation S! , we would like to update the estimation of Z! , i.e., F(Z! |S):! ) following the
Bayes rule:
F(Z! |S):! ) =

F(S! |Z! )F(Z! |S):!&) )
∫ F(S! |Z! )F(Z! |S):!&) ) .Z!

(S22)

where F(Z! |S):!&) ) is prior and F(S! |Z! ) is likelihood. The prior can be written in the
marginalised format:
F(Z! |S):!&) ) = ; F(Z! |Z!&) )F(Z!&) |S):!&) ) .Z!&)

(S23)

which utilised the Markovian properties. By substituting Equation (S23) to Equation (S22), we
obtain the iterative update of F(Z! |S):! ) given the transition F(Z! |Z!&) ) and likelihood
F(S! |Z! ):
F(Z! |S):! ) =

F(S! |Z! ) ∫ F(Z! |Z!&) )F(Z!&) |S):!&) ) .Z!&)
∬ F(S! |Z! ) ∫ F(Z! |Z!&) )F(Z!&) |S):!&) ) .Z!&) .Z!

(S24)

The likelihood can be calculated assuming an observation with Gaussian variance:
F(S! |Z! ) ~ d(T(Z! ), H+ 3 )

(S25)

where T is chosen accordingly to the types of reports and H+ 3 is the variance of observation
error that can be approximated empirically (detailed settings can be found in Supplementary
Section 4). As the likelihood function has explicitly considered observation noise, it is more
robust to noise compared to Poisson likelihood (used in EpiEstim). The results of using the
Poisson likelihood for the same synthesised data as in Figure 3 are shown in Supplementary
Figure 2, showing the benefits of considering observation noise in the likelihood.

S9

Supplementary Figure 2. Comparison between the simulation results using Poisson
likelihood and Gaussian likelihood in DARt (both with 95% CI).
Then we present the F(Z! |Z!&) ), i.e., the transition of the latent state Z! =< !! ∗ , , \! ∗ , Y! ∗ >
in details through analysing the evolution patterns of !! ∗ . When !! ∗ is evolving with smooth
changes, we use a Gaussian random walk to model this pattern, named Mode I corresponding
to Y! ∗ = 0. Under this mode, it is expected that !! ∗ is similar to the previous time !! ∗ &) . In
contrast, the evolution of !! ∗ can be altered significantly when intensive measures are induced.
For example, !! ∗ may experience an abrupt decrease due to the lockdown policy on time " ∗ .
Under this circumstance, the epidemic history does not provide much information about the
latest !! ∗ , where we name it as Mode II corresponding to Y! ∗ = 1.
Formally, the evolution of !! ∗ is described by the switching dynamics conditioned on Y! ∗ :
d(!! ∗ &) , H5 3 )
F(!! ∗ |!! ∗ &) ) ~ e
U[0, !! ∗ &) + ∆]

Y! ∗ = 0
Y! ∗ = 1

Mode I
Model II

(S26)

where d(!! ∗ &) , H5 3 ) is a Gaussian distribution with the mean value of !! ∗ &) and variance of
H5 3 , describing the random walk with the randomness controlled by H5 . U[0, !! ∗ &) + ∆] is a
uniform distribution between 0 and !! ∗ &) + ∆ allowing abrupt decrease while limiting the
amount of increase. This is because we assume that !! ∗ can undergo a big decrease when
intervention is introduced but it is unlikely to have a dramatic increase in one day as the
characteristics of disease would not change instantly. One exception is that for the regions
whose daily infection remains as low as around 0 after the intervention, and an imported super-

S10

spreader triggers a new outbreak. The !! ∗ value which was remained at a low level would
increase significantly. In this case, like the most recent outbreak in Hong Kong in November,
we set ∆ to be a large value, allowing an abrupt increase.
In our model, we assume a discrete Markovian chain process for Y! ∗ with the transition
probabilities listed in Supplementary Table 1, meaning that the probability of having an abrupt
change in !! ∗ is low. This assumption is realistic as most of the time the !! ∗ curve is
undergoing smooth change.
Supplementary Table 1. Transition probabilities of Y! ∗ .

"! ∗ = 0

"! ∗ = 1

"! ∗ −1 = 0

0.95

0.05

"! ∗ −1 = 1

0.95

0.05

Finally, we use the renewal process to provide transition of \! ∗ 2) :
'!

'& &)
(9)

(92))

F(\! ∗ |\! ∗ &) , !! ∗ ) = no)ppoq(/! ∗ ; !! ∗ U L% /! ∗ &% ) s t(\! ∗ , \! ∗ &) )
%()

(S27)

9()

(9)

where \! ∗ is the u-th component of the latent variable \! ∗ and t(E, v) is the Kronecker delta
function. /! ∗ is assumed to be drawn from a Poisson distribution with the mean equal to the
prediction from the renewal process using !! ∗ and \! ∗ &) . The overlaps between \! ∗ &) and \! ∗
(9)

'& &)

are w\! ∗ x

9()

(92))

= w\! ∗ &) x

'& &)
9()

= [/! ∗ &'& 2) , … , /! ∗ &) ], whose distributions are assumed to be

consistent. By substituting Equation (S26) and (S27) and Supplementary Table 1 into Equation
(S24), we have realised the sequential Bayesian update of the latent state Z! =< !! ∗ , \! ∗ , Y! ∗ >
for filtering.
Backward smoothing: To answer the second question that how to update previous estimations
when more subsequent observations are available, we formulate it as a smoothing problem in
the Bayesian updating framework. Based on the filtering results of F(Z! |S):! ), we can further
achieve the smoothing results F(Z! |S):' ), where O is the time index of the last observation. To
integrate the information from the subsequent observations, we use the backward pass method.
First, the joint distribution F(Z) , … , Z ' |S):' ) is decomposed as:

S11

'

F(Z) , … , Z ' |S):' ) = F(Z ' |S):' ) s

!()

= F(Z ' |S):' ) s

'
!()

F(Z! |Z!2) , S):' )

F(Z! |Z!2) , S):! )

(S28)

where
F(Z! |Z!2) , S):! ) =

F(Z!2) |Z! )F(Z! |S):! )
.
F(Z!2) |S):! )

(S29)

Then by integrating out Z) , … Z!&) , Z!2) , Z ' in Equation (S28)
F(Z! |S):' ) = F(Z! |S):! ) ; F(Z!2) |Z! )

F(Z!2) |S):' )
.Z!2)
F(Z!2) |S):! )

(S30)

which provides the iterative calculation of F(Z! |S):' ) from time O backwards to time ".

2.4 Particle Methods
The integrals in the filtering problem (Equation (S24)) and the smoothing problem (Equation
(S30)) are intractable, thus we introduce a Sequential Monte Carlo (SMC) method called
‘particle filter’ to infer the latent state9.
In Monte Carlo method, the continuous distribution of a random variable y~z(E) is
approximated by { independent samples with importance weights:
=

z(E) ≈ U } ; t< ' (E)

(S31)

;()

where z(E) is an arbitrary probability distribution and { independent samples y ; ~z(E) are
drawn from the distribution with the normalized importance weight } ; . t< ' (E) denotes the
Dirac delta mass located at the i-th sample y ; . These discrete samples are also called ‘particles’
in particle method, whose locations and weights are used to approximate the intractable integral.
If E is a time-dependent state variable, we can update the samples to approximate the
distribution through the Sequential Importance Sampling (SIS) technique10. The locations and
weights of the particles representing the target distribution are iteratively updated considering
the new observations. For the filtering problem, we can set F(Z):! |S):! ) as the target
)
3
=
distribution and use { particles {Z)! , Z3! , … , Z=
! } with importance weight {}! , }! , … , }! } at

time ". The SIS technique includes two steps: First, new positions of the particles Z! at time "
are proposed according to a proposal function ~(Z! |Z):!&) ) which can be the transition

S12

probability F(Z! |Z):!&) ). Next, the importance weight •(Z):! ) of the proposed particles are
calculated according to iteration in Equation (S22):
•(Z):! ) =

F(Z):! |S):! ) F(Z):!&) |S):!&) ) F(Z! |Z):!&) )F(S! |Z! )
=
~(Z):! )
~(Z):!&) )
~(Z! |Z):!&) )

= •(Z):!&) )

F(Z! |Z):!&) )F(S! |Z! )
= •(Z):!&) )F(S! |Z! )
~(Z! |Z):!&) )

(S32)

Therefore, the filtering results of F(Z):! |S):! ) can be numerically approximated by the
evolving particles and their importance weights. Similarly, the smoothing procedure of
Equation (S30) can be approximated by the particles.

S13

3 DARt Application to UK Cities
We applied DARt to monitor seven cities in England as shown in Supplementary Figure 3. All
these cities are undergoing the second wave of COVID-19, where their !! values are above 1
since August 2020 and keep fluctuating above 1 for most of the time. We can observe that cities
within the UK have distinct !! curves, reflecting that the country-wide !! curve shown in
Figure 4 (C) cannot be used to represent the epidemic dynamics across different local areas. In
epidemic modelling, we should also make efforts to utilise data collected from local areas for
fine-grained spatial modelling. On 22nd of September 2020, the UK government has enforced
interventions in England. It is observed that Leeds, Sheffield, Liverpool and Manchester have
a sharp decrease in !! around that time. The probability values of having abrupt changes (green
bars in Figure 4) for these cities around this day were larger than most other days, indicating
the detection of abrupt changes. Most cities maintained a lower !! level after this intervention.
On 5th of November 2020, another intervention had taken place so that !! values for most cities
became lower than 1. As the amounts of decrease in !! are within a small range, no sharp
changes in !! were observed such that the green bars in Figure 4 remained at a low level.

S14

Supplementary Figure 3. Epidemic dynamics in London, Leicester, Birmingham, Liverpool, Manchester, Sheffield and Leeds. The top row

of each subplot shows the number of daily observations (in yellow) and the recovered daily observations (in blue), which validates the !!

results. The bottom row shows the DARt results of !! curve with 95% CI (in black) and the probability of having abrupt changes (i.e., #! =
1) (in green). Two intervention dates in England are annotated in red dash lines.

S15

4 Experimental setting
In our experiments, the generation time and observation delay distributions are adopted from
the previous reports6,8. To truncate these distributions into a fixed length, we discard the time
points with the kernel values smaller than 0.1 resulting in the length of !! as 7. The initial guess
of "" at # = 0 is set to be uniformly distributed from 1 to 5. We set & = 0.1 for getting smooth
"" change in Model I. In Model II, we set ∆= 0.5 for most regions except Hong Kong. For
Hong Kong, when the average observation number of the recent 10 days is lower than 5 and
the current observation number suddenly increases over 10, we think there is a chance that a
newly imported case triggers a new outbreak, so we allow "" to have an abrupt increase. In
this case, we set the upper limit of "" to be a large value which is 5 in our experiment. For
implementing the particle filter, the number of particles is set to 200 for approximating
distributions.
The variance of observation error &# $ is estimated empirically. We first calculate the 7-day
moving average observations. By subtracting the moving average from the observation, we
obtain a difference curve, approximating random observation fluctuations. The next step is to
perform the 7-day moving average calculation again on the squared value of the difference
curve, where the resulted curve is regarded as the observation error variance. Finally, we use a
Gaussian distribution as the likelihood function (Equation (S25)), where its variance is
approximated by the observation error variance curve.

S16

References
1.

Kermack, W. O. & McKendrick, A. G. A contribution to the mathematical theory of
epidemics. Proc. R. Soc. London. Ser. A, Contain. Pap. a Math. Phys. Character 115,
700–721 (1927).

2.

Chowell, G., Hyman, J. M., Bettencourt, L. M. A. & Castillo-Chavez, C. Mathematical
and Statistical Estimation Approaches in Epidemiology. Mathematical and Statistical
Estimation Approaches in Epidemiology (Springer Netherlands, 2009).

3.

Cori, A., Ferguson, N. M., Fraser, C. & Cauchemez, S. A new framework and software
to estimate time-varying reproduction numbers during epidemics. Am. J. Epidemiol.
178, 1505–1512 (2013).

4.

Pan, A. et al. Association of Public Health Interventions With the Epidemiology of the
COVID-19 Outbreak in Wuhan, China. JAMA 323, 1915 (2020).

5.

Flaxman, S. et al. Estimating the effects of non-pharmaceutical interventions on
COVID-19 in Europe. Nature 1–5 (2020).

6.

Leung, K., Wu, J. T., Liu, D. & Leung, G. M. First-wave COVID-19 transmissibility
and severity in China outside Hubei after control measures, and second-wave scenario
planning: a modelling impact assessment. Lancet 395, 1382–1393 (2020).

7.

He, X. et al. Temporal dynamics in viral shedding and transmissibility of COVID-19.
Nat. Med. (2020).

8.

Ferretti, L. et al. Quantifying SARS-CoV-2 transmission suggests epidemic control
with digital contact tracing. Science (80-. ). 368, eabb6936 (2020).

9.

Doucet, A. & Johansen, A. M. A tutorial on particle filtering and smoothing: Fifteen
years later. in Handbook of nonlinear filtering 12, 3 (2009).

10.

Maceachern, S. N., Clyde, M. & Liu, J. S. Sequential importance sampling for
nonparametric Bayes models: The next generation. Can. J. Stat. (1999).

S17

