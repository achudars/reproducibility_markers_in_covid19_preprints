arXiv:2006.16487v1 [q-bio.PE] 30 Jun 2020

On the derivation of the renewal equation from an
age-dependent branching process: an epidemic modelling
perspective
Swapnil Mishra∗,1,† , Tresnia Berah∗,1 , Thomas A. Mellan∗,1 , H. Juliette T. Unwin1 ,
Michaela A Vollmer1 , Kris V Parag1 , Axel Gandy2 , Seth Flaxman2 , and Samir
Bhatt†
1

Department of Infectious Disease Epidemiology, Imperial College London
2

Department of Mathematics, Imperial College London
∗

†

Joint Authorship

Corresponding Author s.bhatt@imperial.ac.uk,
s.mishra@imperial.ac.uk

Abstract
Renewal processes are a popular approach used in modelling infectious disease outbreaks.
In a renewal process, previous infections give rise to future infections. However, while this
formulation seems sensible, its application to infectious disease can be difficult to justify from
first principles. It has been shown from the seminal work of Bellman and Harris [2] that the
renewal equation arises as the expectation of an age-dependent branching process. In this
paper we provide a detailed derivation of the original Bellman Harris process. We introduce
generalisations, that allow for time-varying reproduction numbers and the accounting of exogenous events, such as importations. We show how inference on the renewal equation is easy
to accomplish within a Bayesian hierarchical framework. Using off the shelf MCMC packages,
we fit to South Korea COVID-19 case data to estimate reproduction numbers and importations. Our derivation provides the mathematical fundamentals and assumptions underpinning
the use of the renewal equation for modelling outbreaks.

1

1

Introduction

Mathematical descriptions of infectious disease outbreaks are fundamental to forecasting and simulating the dynamics of epidemics, as well as to understanding the mechanics of how transmission
occurs. One popular approach to modelling infectious disease outbreaks is founded on renewal
processes and the renewal equation. A renewal process generalises a Poisson process to allow for
arbitrary (instead of exponential) holding or event waiting times. From an infectious disease perspective, these holding times model how new infections are generated across an epidemic. The
expected number of newly infections at some time is then given by the renewal equation [9]. While
this formulation seems sensible, its application to infectious disease can be difficult to justify from
first principles since it does not propose a formal mechanism for the generation of infectious events.
In the seminal work of [16], Kermack and McKendrick studied the number and distribution of
cases of an infectious disease as it is progressed through a population over time. They constructed
classes, called compartments, and modelled the propagation of infectious disease via interactions
among these compartments. The result is the popular susceptible-infected-recovered (SIR) model,
variants of which are widely used in epidemiology. SIR models provide an intuitive mechanism for
understanding disease transmission, and in the original derivation of [16], they were found to be
similar to the Volterra equation [23]. The Volterra equation is equal to the renewal equation when
a convolution operator is applied. This link has been used to justify the role of renewal equations in
modelling epidemic processes [11, 8, 21, 6]. However, the connection between the renewal equation
and compartmental models is neither intuitive nor simple and the consequences of the differing
assumptions behind both mathematical descriptions can be difficult to assess, especially when the
number of compartments or renewal parameters becomes large [7, 22].
The renewal equation may also be derived by treating every new infection event as a birth in
the infected population. The Euler-Lotka equation from ecology [19], which tracks the numbers
of females in an age-structured population, can then be shown to yield the standard renewal
equation of epidemiology [11]. While this derivation is simple and intuitive, it is somewhat limited.
Specifically, it remains unclear how to properly incorporate repeated, imported infections, which
can significantly impact the time-course of an epidemic. A stronger and more transparent link
between the physical process underlying an infectious outbreak and the formulation of the renewal
model is therefore warranted.
Bellman and Harris elegantly captured this underlying infection mechanism by formulating an

2

age-dependent branching process [2]. Branching processes describe how individuals stochastically
propagate their numbers over time. In epidemiology, age-insensitive branching processes, such as
the fundamental Galton-Watson process, which discretise the propagation process into generations,
have provided tractable yet intuitive ways of modelling the spread of an infectious disease [1,
12]. However, these approaches, while useful, lack the flexibility and realism of the more general
Bellman-Harris processes [2, 3]. Age-dependence allows for the variable time between exposure to a
pathogen and the onset of symptoms to be properly modelled and provides a framework for encode
useful information on the biology of the infecting pathogen, such as incubation periods and nonmonotonic infectiousness. Given these advantages, it is surprising that only a few epidemiological
studies have considered Bellman-Harris approaches [4].
To understand the Bellman-Harris process we consider a homogeneous or well-mixed population,
in which members can randomly infect one another. Let t ∈ R+ , be a positive real number
representing time. We introduce a positive random variable τ ∈ R+ with probability distribution
Rτ
g(τ ) and cumulative distribution G(τ ) = t=0 g(t)dt. After some random period τ, an infected
individual can infect n ∈ I+ (positive integers) other individuals with probability qn . We are
interested in characterising the number of newly infected individuals at time t, which we denote
Z(t). However, as each time trajectory of Z(t) is one possible reality (or sample-path) from the
epidemic process, we more broadly aim to calculate and subsequently model, the average number
of new infection events at time t, E[Z(t)].
Direct calculation of E[Z(t)] requires the manipulation of a generally intractable integral. Consequently, we adopt a generating function based approach, which allows the expectation to be
obtained through derivatives. Generating functions are extremely useful but often hard to understand. They are perhaps best described by Pólya: A generating function is a device somewhat
similar to a bag. Instead of carrying many little objects detachedly, which could be embarrassing, we
put them all in a bag, and then we have only one object to carry, the bag. By using generating functions, we can use a single mathematical object to represent the complexity of the Bellman-Harris
process.
In this paper we explore and exploit the relationship between the Bellman-Harris process and
the renewal model approach to infectious disease with the aim of clarifying and understanding the
dynamical assumptions underpinning the renewal process. Particularly, we re-derive the generating
function of the Bellman-Harris process describing Z(t) with offspring distribution qn . This leads
to an integral equation, the expectation of which recovers the renewal formulation of epidemiology

3

[11]. While this result in itself is not completely new (e.g. it was solved for binary offspring
distributions in [2, 3]), we introduce two key generalisations. The first extends the Bellman-Harris
process to allow for time-varying reproduction numbers, while the second provides a rigorous means
of accounting for exogenous events, such as importations or zoonoses.
Further, we show how our approach provides a flexible framework for extending both the observation models (i.e. the count noise around E[Z(t)] and the effective reproduction number
parametrisations, commonly employed in epidemic renewal model studies [8, 21, 22]. Specifically,
we provide functionality for modelling negative binomial and Laplace distributed noise and for
fitting autoregressive, polynomial and spline-based descriptions of the reproduction number. All
source code is provided at https://github.com/mrc-ide/bhrp

2

Deriving the general Bellman-Harris integral equation

Part of the difficulty in understanding the Bellman-Harris equation is the list of objects needed to
derive it and their assumptions. We start by listing them here for reference:

• Z(t) is a stochastic counting process for the number of infected individuals, n ∈ I+ , existing
at time t ∈ R+ . We are trying to estimate the expectation E[Z(t)].
• τ ∈ R+ is a real random variable for the time taken to infect another individual. In infectious
disease epidemiology, τ is generally called the serial interval distribution or offspring distribution[13]. τ has a probability measure, distributed by τ ∼ g(τ ), with cumulative distribution
function G(τ ). A crucial assumption is that for each infected individual the distribution of
g is the same and independent of other infected individuals and examples of g are shown in
figure 1.
• qn is the probability that an individual infects n other individuals. It is clear here that qn
corresponds to the stochastic basic reproductive number and qn (t) to the stochastic timevarying reproductive number. The expected value of qn is the expected reproductive number
that is ubiquitously used.
• For an arbitrary variable |s| ≤ 1, the generating function for the infection probabilities
P+∞
n
{qn }n is: h(s) =
n=0 qn s . For infection probabilities to be time dependent h(s, t) =
P+∞
n
n=0 qn (t)s .
4

• We also introduce probabilities pr (t) of having r infected individuals at time t : pr (t) =
P (Z(t) = r). We can therefore write the generating function for an arbitrary variable |s| ≤ 1
P∞
and the number of infected individuals Z(t) as: F (s, t) = r=1 pr (t)sr .
Given the above expressions and the generating functions h(s, t) and F (s, t), we first need an
expression for pr (t) = P [Z(t) = r], the probability that there are r infected individuals at time
t. Deriving an expression for pr (t) is challenging because there are many facets to evaluating this
probability. To aid understanding we will explain how to arrive at an expression for pr (t) and give a
simple example for the binary case, where each individual infects two others. The first consideration
is that any infected individual could infect n others (in time), and therefore we need to first sum over
P∞
all possible infection probabilities n=0 qn (t). The next consideration is that there are many ways
to arrive at pr (t) and so we need to account for all the combinations of n integers {i1 , i2 , . . . , in }
such that we can have r infections i.e. i1 + i2 + . . . + in = r. Therefore, we want to sum over all
P
Qn
the ways to get r and multiply these probabilities:
i1 +i2 +...+in =r
k=1 pik (t − τ ). τ appears in
this equation because the r infections have occurred at some time τ before t. Finally, we need to
Rt
integrate (average over) all the possible times τ at which the infections occurred, that is τ =0 ·dG(τ ).
In the binary case, much simplifies and the first sum disappears because each individual always
infects 2 others and the summation is not necessary i.e. n 6= 2, qn = 0, and q2 = 1. The second
P
sum is also simply i1 +i2 =r because two individuals are always infected. Therefore, if we wanted
to know the probability of seeing say 4 infections at time t in the binary case, we would need to
sum over {p1 (t − τ ) ∗ p3 (t − τ ), p3 (t − τ ) ∗ p1 (t − τ ), p2 (t − τ ) ∗ p2 (t − τ )} and integrate τ with respect
to the cumulative distribution function. In this binary case it is useful to notice that after the
first infected individual infects two others, the process is self similar; a useful intuition therefore
is to count taxa on a binary tree. Note that the Bellman Harris formulation is general and that
if G is a step function we have the Galton-Watson family tree model and if G is exponentially
distributed we have a Markov branching model. Putting all these constituents together, we can
arrive at an expression for pr (t) that integrates (or averages) over incorporates the full uncertainty
of when previous infections occurred and how many there were at that time. In what follows
we will consider an extension of the original Bellman Harris formulation with qn (t), that is the
probability of an individual infecting n others varies with time such that
!
Z t Y
∞
n
X
X
pr (t) =
pik (t − τ )dG(τ ) .
qn (t)
n=0

i1 +i2 +...+in =r

(1)

τ =0 k=1

Another intuition that may help the reader is that in the above equation, the terms in the braces are
the coefficients of the generating function h(s, t), which therefore have the standard interpretation
5

of the probability of seeing r infections while factoring all the ways r can appear i.e. pr .
Now that we have an expression for pr (t), we can arrive at the generating function F (s, t) through
multiplication with sr , over all possible values for r. Since we start with one infected individual,
r ≥ 2. Also we note that sr can be decomposed into its constituents sr = si1 si2 . . . sin :
!
Z t Y
∞
∞ X
∞
n
X
X
X
r
pr (t)s =
qn (t)
pik (t − τ )dG(τ ) sr
r=2

=

r=2 n=0

i1 +i2 +...+in =r

∞ X
∞
X

X

qn (t)

r=2 n=0

Z

t

=

Z

qn (t)

τ =0 n=0

∞ 
X
r=2

t

!

n
Y

ik

pik (t − τ )s dG(τ )

(3)

τ =0 k=1

i1 +i2 +...+in =r

∞
X

(2)

τ =0 k=1

X

n
Y

ik

pik (t − τ )s



!
dG(τ ) .

(4)

i1 +i2 +...+in =r k=1

The interchange of sums and integrals is a consequence of Fubini/Tonelli conditions (i.e all the
above functions are positive and the integral with respect to τ converges absolutely).
To simplify the above equation, we can now refactor the individual constituents of r - the indices
{i1 + i2 + . . . + in = r}. In this simplified notation, the fact that r is made up of a multitude
of infection branches is hidden to simplify subsequent derivation. However the reader should
remember that r is comprised of many possible branches and combinations.
n

∞
∞ 
n

X
X
X
Y
pik (t − τ )sik = 
pr (t − τ )sr  ,
r=2

{z

|

(5)

r=2

i1 +i2 +...+in =r k=1

}

To see how equation 5 is arises, note that:
∞
X

pr sr

n

=

r=0

=

=

∞ 
X

X

pi1 pi2 . . . pin sr

r=0 i1 +...+in =r
∞ 
X
X

pi1 pi2 . . . pin si1 si2 . . . sin

r=0 i1 +...+in =r
∞ 
n
X
Y
X
r=0



k

pik si



(6)


.

(8)

i1 +...+in =r k=1

so that the generating function F (s, t) can be written more compactly as

n
Z t X
∞
∞
∞
X
X
pr (t)sr =
qn (t) 
pr (t − τ )sr  dG(τ ).
r=2

(7)

τ =0 n=0

(9)

r=2

To simplify equation 9, we need to remember several choices we have made and defined. First if
P∞
we define the generating function of Z(t) as F (s, t) = r=2 pr (t)sr , then clearly for some other
6

time t − τ , the generating function is:
F (s, t − τ ) =

∞
X

pr (t − τ )sr .

(10)

r=2

Finally, remembering that the generating function for infection probabilities is h(s, t) =

P∞

n
n=0 qn (t)s ,

we can rewrite:
∞
X
r=2

pr (t)sr =

Z



t

∞
X


τ =0


Z
n

dG(τ ) =
qn (t) F (s, t − τ )


h F (s, t − τ ), t dG(τ ).

(11)

τ =0

n=0

|

t

{z

}

h(F (s,t−τ ),t)

Notice in this equation that the under brace can be simplified using the generating function h,
P+∞
h(s, t) = n=0 qn (t)sn . While this step can seem confusing, it is simply using the two generating
functions and noticing recursive relationships. To finally arrive at the generating function F (s, t) =
P∞
r
r=1 pr (t)s , we need to take equation 11 and sum from r = 1. For r = 1, p1 (t) = 1 − G(t), or
the probability of the index case not infecting anyone. F (1, t) is therefore F (1, t) = (1 − G(t))s1
from the definition of our generating function. Putting this all together we arrive at the celebrated
Bellman-Harris integral equation:

F (s, t) = 1 − G(t) s +

Z

t


h F (s, t − τ ), t dG(τ ).

(12)

τ =0

Normally the Bellman-Harris equation is derived with qn not qn (t) resulting in the more familiar
Z t


F (s, t) = 1 − G(t) s +
h F (s, t − τ ) dG(τ ).
(13)
τ =0

We have derived both expressions to show how the expected basic reproductive number and timevarying reproductive numbers (a fundamental metric in infectious disease modelling) can arise.
This will be shown when taking expectations below.

3

The renewal equation

At first glance the generating function in equations 12 and 13 seems impenetrable and unsolvable.
However, by exploiting the favorable properties of generating functions, we can easily calculate the
moments of Z(t) by calculating the derivatives of the generating function at s = 1.
Remember, the generating function of the number of infected individuals at time t, Z(t), is
P∞
r
r=1 pr (t)s . We denote the first moment (mean) of the generating function as the first derivative
7

evaluated at s = 1:
F (s, t) = E[sZ(t) ] =

∞
X

pr (t)sr

(14)

r=1
∞

E[Z(t)] = f (t) =

X
∂F (s, t)
|s=1 =
rpr (t).
∂s
r=1

(15)

Here f (t) is the average or expected number of infected individuals at time t. To get f (t) we take
the first derivative of the Bellman-Harris integral equation (12), and get:
Z t

∂F (s, t − τ ) ∂h
∂F (s, t)
F (s, t − τ ), t g(τ )dτ.
= 1 − G(t) +
∂s
∂s
∂s
τ =0
Now, by using the properties of generating functions and evaluating at s = 1
Z t

∂F (s, t)
∂h
∂F
|s=1 = f (t) = 1 − G(t) +
(1, t − τ )
F (1, t − τ ), t g(τ )dτ.
∂s
∂s
∂s
τ =0 |
{z
}

(16)

(17)

f (t−τ )

P∞

P∞
pr (t−τ )1r = r=1 pr (t−τ ) = 1,
P∞
n−1
so to compute
and the derivative of the generating function h(s, t), is ∂h
n=1 nqn (t)s
∂s (s, t) =
From the definition of the generating function F (1, t−τ ) =

r=1

the average number of individuals a infected individual infects we again take the derivative of the
generating function and evaluate at s = 1,
∞
X
 ∂h
∂h
F (1, t − τ ), t =
(1, t) =
nqn (t) = Rt .
∂s
∂s
n=1

(18)

This quantity is a the time-varying reproductive number. If we did this derivation using a fixed,
time invariant qn , then the expected value would have been
∞
X
 ∂h
∂h
nqn = R0 .
F (1, t − τ ) =
(1) =
∂s
∂s
n=1

(19)

These two equations show clearly how the basic and time-varying reproductive number arises from a
carefully designed stochastic counting process. There is a clear intuition how reproductive numbers
arise: first we design a time dependent branching process where there is a stochastic number, n,
individuals that can be infected in time. Taking the expected value of qn from the first derivative
of its generating function evaluated at s = 1 gives us the expected reproductive numbers - or the
average number of infections a given individual infects. In this paper we show that this can be
made time varying by changing qn to qn (t).
Incorporating Rt we get a renewal equation for the first moment of Z(t):
Z t
E[Z(t)] = f (t) = 1 − G(t) + Rt
f (t − τ )g(τ )dτ,

(20)

τ =0

where the term 1 − G(t) is the survival probability of the first infection or index infection. This
term arises from p1 (t), or the probability of seeing the first infection at time t.
8

4

Imported or exogenous sources of infection

In the renewal equation, there are two major components. The first term arises from p1 (t), or the
probability of seeing the first infection at time t. By assuming this first infection occurs straight
away, this term disappears and we derive the renewal equation widely used in epidemic modelling
[8, 21]. Even when not making this assumption, the survival function tends to zero with time and
therefore does not not contribute to the epidemic, but simply starts it. And once started, the
second convolutional term in the renewal equation accounts for secondary cases and the chain of
new infections - a convolution of its own history with some serial interval distribution. However,
while the second term, that arises as a logical consequence from an age-dependent branching
process, and does intuitively represent secondary infections in an outbreak, there is no term in the
renewal equation for repeated seed infections or an exogenous source. There is only ever one seed
infection or index case.
Exogenous sources are an important component in epidemic modelling, and account for infections
entering from outside a system. Depending on the scale of modelling, it can represent zoonosis
events, or importations from one geographic region to another by flights, etc. The splitting of the
epidemic into exogenous and endogenous components, to our knowledge, is not formally defined in
any previous renewal frameworks. From a intuitive view, not having these components separated
means we only ever look at part of the epidemic. Consider the case of an influenza epidemic. A
person flies in from a country experiencing an outbreak, this person then travels to a city where
secondary infection occurs. The reproductive number and convolution part of the renewal equation
describes this process, but does not account for repeated introductions from other individuals flying
in. Similarly, just looking at flights would only show part of the picture. This phenomenon is very
general and observed in multiple disciplines [25].
In this section we will derive a renewal equation that accounts of exogenous sources at arbitrary
times. It is useful to visualise the terms in the renewal equation (Figure 1) to see how it can easily
be extended to include an exogenous component. Let us first consider a hypothetical scenario, or
a new disease occurring in a homogeneously mixed immunologically naive population. We say this
1

2

new disease has a serial interval distribution that is Rayleigh (g(τ ) = στ e− 2 στ ) with σ = 1. The
renewal equation is
Z
f (t)

=

t

f (t − τ )g(τ )dτ

1 − G(t) + R0

(21)

τ =0

= µ(t) + R0 f ∗ g(t)
9

(22)

a

b
1.0
0.8
0.6
0.4

Expected number infected, f(t)

0.0

0.2

1.2
1.0
0.8
0.6
0.4
0.2
0.0

Expected number infected, f(t)

H(t-s1)(1-G(t-s1))

1.2

1-G(t)

0.0

0.5

1.0

1.5

2.0

0.0

0.5

Time, (t)

c

3

d

H(t-si)(1-G(t-s1))

2.0

1.5

2.0

H(t-s1)

2.0
1.5
1.0

Expected number infected, f(t)

0.0

0.5

3.5
3.0
2.5
2.0
1.5
1.0
0.5
0.0

Expected number infected, f(t)

1.5

2.5

i=1

1.0
Time, (t)

0.0

0.5

1.0

1.5

2.0

0.0

0.5

Time, (t)

1.0
Time, (t)

Figure 1: 4 different exogenous terms (a) 1−G(t) (b) H(t−si )(1−G(t−si )) (c)

Pn

i=1

H(t−si )(1−G(t−si ))

and (d) H(t − si )α, with R0 = {0.5, 0.8, 1, 1.2}, with serial interval distribution from a Rayleigh(1)

.

10

where ∗ is a condensed convolution notation. We can solve the renewal equation using quadrature
and see how the expected number of infected individuals evolves through time. Figure 1a shows
the solution to equation 21 for an the index case starting at t = 0, and for R0 = {0.5, 0.8, 1, 1.2}.
However, equally, we can solve the renewal equation for a single index case starting at some future
time t = s1 ,
f (t)

=

(1 − G(t − s1 ))H(t − s1 ) + R0 f ∗ g(t)

= µ(t − s1 ) + R0 f ∗ g(t),
where here we have introduced the Heaviside step function,

0, x < s
i
H(x)
1, x > s
i

(23)
(24)

(25)

for importation time si . Figure 1b shows this delayed importation, where the whole process shifts
to start after s1 , after which it is identical to the unshifted version.
And sum multiple renewal processes with exogenous inputs at different times i.e.:
f (t)

=
=
=

n
X
i=1
n
X
i=1
n
X

fi (t)

(26)


H(t − si ) 1 − G(t − si ) + R0 f ∗ g(t)

(27)

µ(t − si ) + R0 f ∗ g(t)

(28)

i=1

Here exogenous sources occur at times si , and the endogenous process begins at s1 . Our superposition of multiple renewal processes differs from the S-renewal process[26] in that we do not consider
differing convolutional terms. We justify this by saying there is no difference in the exogenous
infections, they are the same disease as the endogenous ones, except they have entered the system
from the outside and not as a secondary infection. To our knowledge this is a new derivation of
the superposition renewal equation. To understand the dynamics of this superposition. In Figure
1c there are three exogenous events at times s1 = 0.1, s2 = 0.4, s3 = 1. These exogenous infections
seed the epidemic and allow it to increase. It is easy to see that an arbitrary function can be used
in place of the Heaviside step function. As an example, figure 1d shows the example of a constant
rate of importation at all times t, i.e. α(1 − G(t − s1 )). In this figure the number of infections does
not reduce beyond the exogenous rate. This derivation justifies the use of an exogenous term in
the renewal equation and specifies how to create one.

11

There are two considerations to note, first, this exogenous term can be used to estimate when
the first case occurred in an epidemic. Second, when performing inference, an analytic expression
for the Heaviside function such as

1
1+e2kx

for an arbitrary large k can be used. Our final renewal

equation is:
Z
E[Z(t)] = f (t) =

+ R0
|
exogenous
µ(t)
|{z}

t

τ =0

f (t − τ )g(τ )dτ
{z
}

(29)

endogenous

It is of interest here to note that equation 29 has deep connections with other counting processes
such as Hawkes self-exciting stochastic processes [15]. Indeed, in a nice convergence of theory, it
has been shown that the expected value of the Hawkes intensity function results in exactly the
same renewal equation we have derived [24].

5

Inference using the renewal equation

The renewal equation 29 can be solved in closed form for a few special cases such as an exponential
G(t) (Markov branching process), and often the equation is studied in lim t → ∞. In such cases
the Laplace transform is taken to simplify the convolution to a product. Numerically, quadrature
can be used, which results in solving a system of linear equations or using approaches like the
Trapezium rule.
Often however, data is not continuous and binned into hourly, daily etc counts. For discrete data,
the equation can be represented in binned form as:
f (t) = µ(t) + Rt

X

f (t − τ )g(τ )

(30)

τ <t

In this binned discrete form, the model for f can be thought of as an Autoregression with coefficients
determined by the serial interval distribution g(τ ). Once again this is a convergence of theory,
[24] show that the expectation of the intensity function of a Hawkes process results exactly in
equation 29, and [17, 18] have shown that a binned Hawkes process is an AR(∞) process, that
can be approximated by an AR(p), with p lags. Therefore the renewal equation, in discrete form,
is therefore deeply connected to standard time series approaches. These time series approaches
are very effective [20] in forecasting but do not yield useful information about the underlying
epidemiological mechanism and are largely ”black box”. Using the discrete renewal equation can
have all the benefits of time series forecasting but is built from a mechanism rooted in infectious
disease epidemiology and therefore has explainable and interpretable dynamics.
12

Equation 30 is highly flexible, and complicated non-parametric functions can be used for µ(t), and
Rt . From a computational complexity view, equation 30 is quadratic O(n2 ), which is limiting,
but given the discretisation of time can handle most epidemic data. The equation is also easy to
evaluate and is therefore amenable to implementation in state-of-the-art Bayesian MCMC software
such as Stan. In a Bayesian Hierarchical framework a general model would be:
θ, φ, µt , Rt
f (t)

∼ p(·)
= µt + Rt

(31)
X

f (t − τ )g(τ )

(32)

τ <t

y

∼ p(f (t), φ)

(33)

In this hierarchical Bayesian framework, the first line are the prior distributions for hyperparameters θ, φ, µt and Rt . θ is a hyperparameter for the serial interval distribution, and can be given
vague or strong priors, or fixed (given known biology). φ is a parameter for variance or overdispersion. µ(t) is the exogenous component, that models the number of new infections entering the
modelled system at time t. It can incorporate information on movement etc. Rt is modelled by
some function such as a stochastic process, polynomials, splines etc. The second line is the discrete
binned renewal equation. We note here, g(τ ) can be multivariate and incorporate information
on genetics or spatial distance. Typically, g(τ ) is a Rayleigh, Log Normal, or Gamma distribution[8]. Equivalently, µ(t) can spatially vary and can be modelled effectively by log Gaussian Cox
Processes. The third and final line is the likelihood function, which for aggregated count data is
generally negative binomial, i.e.


y 
φ
f (t)
y+φ−1
φ
y∼
.
y
f (t) + φ
f (t) + φ

(34)

Our negative binomial is the reparameterisation where the location parameter, or mean, is our
renewal equation E[y] = f (t) and the variance is E[(y − E[y])2 ] = f (t) +

f (t)2
φ .

The unnormalised

posterior distribution is then
p(θ, φ, µt , Rt |y) ∝ p(y|f (t), φ)p(f (t)|θ, µt , Rt )p(θ)p(µt )p(Rt )p(φ).

(35)

Posterior expectations can be calculated through approximate inference or via full MCMC sampling.

13

6

Fitting a renewal model to South Korea data from the
COVID-19 pandemic

We fit a discrete renewal process with an exogenous component to COVID-19 case data for South
Korea. Given the high testing capacity in South Korea, case data is generally considered reliable.
However extensions can be included to model death data [10]. We consider g(τ ) to be the serial
interval distribution and fixed as Gamma[5] i.e:
g ∼ Gamma(6.5, 0.62).
R s+0.5
The serial interval distribution is discretised as gs = s−0.5 g(τ )dτ for s = 2, 3, ..., and g1 =
R 1.5
g(τ )dτ . We paramaterise the time-varying reproduction number as Rt = exp(t ), with the
0
exponential to ensure positivity. t is a AR(2) process that starts with 1 ∼ N (−1, 0.1), and
2 ∼ N (−1, σt∗ ):
t ∼ N (ρ1 t−1 + ρ2 t−2 , σt∗ ) for t = {3, 4, 5, . . . },

(36)

with independent priors on ρ1 and ρ2 that are normal distributions conditioned to be in [0, 1];
the prior for ρ1 is a N (0.8, .05) distribution constrained to the unit interval and the prior for
ρ2 is a N (0.1, 0.05) distribution constrained to the unit interval. The prior for σt , the standard
deviation of the stationary distribution of t is chosen as σt ∼ N + (0, 1). The standard deviation of the weekly updates to achieve this standard deviation of the stationary distribution is
p
σt∗ = σt 1 − ρ21 − ρ22 − 2ρ21 ρ2 /(1 − ρ2 ). Other stochastic processes such as a Gaussian process
or random walks could also be readily used. The exogenous component, accounting for importations into South Korea was modelled for the first t = {1, . . . , 40} days, from 2019/12/31 upto
2020/02/04 where travel restrictions were imposed [14]. We choose independent daily effects for
µt ∼ Exponential(0.5). The posterior distribution is then found through equation 35. Estimates
from this model are shown in Figure 2. For South Korea, there was a rapid rise in cases with
a large Rt in early January, followed by a reduction and a period of Rt below 1.0. During this
period, the cases numbers reduced so there were some days where no new cases were observed. In
June, South Korea started experiencing smaller second waves with Rt greater than 1.0 for short
periods of time. Throughout this time our importation model fits a small but non-zero number of
expected importations.

14

Infections

900

600

300

0
Jan

Apr

Jul

Reproduction Number

Days

10.0

1.0

0.1

Jan

Apr

Jul

Imported Infections

Days

6

4

2

0
Jan 01

Jan 15

Feb 01

Days

Figure 2: Top: Observed cases (red), predicted cases (blue line), and 95% credible interval (blue
ribbon). Middle: Estimated reproduction number (green line) with 95% credible interval (green
ribbon). Bottom: Estimated importations (orange line) with 95% credible interval (orange ribbon).

15

7

Conclusion

In this paper we have derived from first principles how the renewal equation arises from a stochastic
age-dependent branching process. In this derivation we show how the time-varying reproduction
number emerges, and how it is possible to incorporate the exogenous infections such as importations
or zoonoses. We then highlight how to perform full Bayesian inference over the renewal equation
and provide an example modelling COVID-19 case data in South Korea.
The renewal equation is deeply connected with other approaches in epidemiology such as SEIR
models [7], Hawkes processes [24], and autoregressive processes [17]. The benefit of the more
complicated derivation we have showcased in this paper is that it allows the ability to disentangle
what is possible to model in the renewal equation by referring to the underlying assumptions in the
age-dependent branching process. For example, it does not seem principled, within the renewal
equation, to allow the serial interval distribution to be time varying. To do so would result in
a very different generating function. Rather, the serial interval distribution is interpreted as a
fundamental property of a given pathogen; changes in the rate of transmission happen through the
time-varying reproduction number.
Our derivation provides a means to incorporate more complex epidemiological processes within the
renewal process but ensuring that these additions can be considered from a principled mathematical
foundation.

16

8

Funding

SB would like to acknowledge the NIHR BRC Imperial College NHS Trust Infection and COVID
themes the Academy of Medical sciences Springboard award and the Bill and Melinda Gates
Foundation.

References
[1]

R. Bartoszynski. “Branching Processes and the Theory of Epidemics”. In: Proceedings of the
Fifth Berkeley Symposium on Mathematical Statistics and Probability (1967).

[2]

R. Bellman and T. E. Harris. “On the Theory of Age-Dependent Stochastic Branching Processes”. In: Proceedings of the National Academy of Sciences (1948). issn: 0027-8424. doi:
10.1073/pnas.34.12.601.

[3]

R. Bellman and T. Harris. “On Age-Dependent Binary Branching Processes”. In: The Annals
of Mathematics (1952). issn: 0003486X. doi: 10.2307/1969779.

[4]

A. T. Bharucha-Reid. “On the Stochastic Theory of Epidemics”. In: Proceedings of the Third
Berkeley Symposium on Mathematical Statistics and Probability, Volume 4: Contributions
to Biology and Problems of Health. Berkeley, Calif.: University of California Press, 1956,
pp. 111–119. url: https://projecteuclid.org/euclid.bsmsp/1200502550.

[5]

Q. Bi et al. “Epidemiology and transmission of COVID-19 in 391 cases and 1286 of their
close contacts in Shenzhen, China: a retrospective cohort study”. In: The Lancet Infectious
Diseases (2020). issn: 14744457. doi: 10.1016/S1473-3099(20)30287-5.

[6]

S. Cauchemez et al. “Unraveling the drivers of MERS-CoV transmission”. In: Proceedings of
the National Academy of Sciences of the United States of America (2016). issn: 10916490.
doi: 10.1073/pnas.1519235113.

[7]

D. Champredon, J. Dushoff, and D. J. Earn. “Equivalence of the Erlang-distributed SEIR epidemic model and the renewal equation”. In: SIAM Journal on Applied Mathematics (2018).
issn: 00361399. doi: 10.1137/18M1186411.

[8]

A. Cori et al. “A new framework and software to estimate time-varying reproduction numbers
during epidemics”. In: American Journal of Epidemiology (2013). issn: 00029262. doi: 10.
1093/aje/kwt133.

17

[9]

W. Feller. “On the Integral Equation of Renewal Theory”. In: The Annals of Mathematical
Statistics (1941). issn: 0003-4851. doi: 10.1214/aoms/1177731708.

[10]

S. Flaxman et al. “Estimating the effects of non-pharmaceutical interventions on COVID-19
in Europe”. In: Nature (2020). issn: 14764687. doi: 10.1038/s41586-020-2405-7.

[11]

C. Fraser. “Estimating individual and household reproduction numbers in an emerging epidemic”. In: PLoS ONE (2007). issn: 19326203. doi: 10.1371/journal.pone.0000758.

[12]

W. Getz and J. Lloyd-Smith. “Basic methods for modeling the invasion and spread of contagious diseases”. In: 2006. doi: 10.1090/dimacs/071/05.

[13]

N. C. Grassly and C. Fraser. Mathematical models of infectious disease transmission. 2008.
doi: 10.1038/nrmicro1845.

[14]

T. Hale et al. “Oxford COVID-19 Government Response Tracker, Blavatnik School of Government.” In: Working Paper (2020).

[15]

A. G. Hawkes. “Spectra of some self-exciting and mutually exciting point processes”. In:
Biometrika 58.1 (1971), pp. 83–90. issn: 00063444. doi: 10.1093/biomet/58.1.83.

[16]

W. O. Kermack and A. G. McKendrick. “A Contribution to the Mathematical Theory of
Epidemics”. In: Proceedings of the Royal Society A: Mathematical, Physical and Engineering
Sciences 115.772 (1927), pp. 700–721. issn: 1364-5021. doi: 10.1098/rspa.1927.0118. url:
http://rspa.royalsocietypublishing.org/cgi/doi/10.1098/rspa.1927.0118.

[17]

M. Kirchner. “Hawkes and INAR processes”. In: Stochastic Processes and their Applications
(2015). issn: 03044149. doi: 10.1016/j.spa.2016.02.008.

[18]

M. Kirchner. “An estimation procedure for the Hawkes process”. In: Quantitative Finance
(2017). issn: 14697696. doi: 10.1080/14697688.2016.1211312.

[19]

A. J. Lotka. “Studies on the mode of growth of material aggregates”. In: American Journal
of Science (1907). issn: 0002-9599. doi: 10.2475/ajs.s4-24.141.199.

[20]

S. Makridakis, E. Spiliotis, and V. Assimakopoulos. “The M4 Competition: Results, findings,
conclusion and way forward”. In: International Journal of Forecasting (2018). issn: 01692070.
doi: 10.1016/j.ijforecast.2018.06.001.

[21]

P. Nouvellet et al. “A simple approach to measure transmissibility and forecast incidence”.
In: Epidemics (2018). issn: 18780067. doi: 10.1016/j.epidem.2017.02.012.

18

[22]

K. V. Parag and C. A. Donnelly. “Adaptive Estimation for Epidemic Renewal and Phylogenetic Skyline Models”. In: bioRxiv (2019). doi: 10.1101/703751. url: https://www.
biorxiv.org/content/early/2019/07/16/703751.

[23]

A. Polyanin. Handbook of Integral Equations. 1998. doi: 10.1201/9781420050066.

[24]

M. A. Rizoiu et al. “Expecting to be HIP: Hawkes intensity processes for social media
popularity”. In: 26th International World Wide Web Conference, WWW 2017. 2017. isbn:
9781450349130. doi: 10.1145/3038912.3052650.

[25]

D. Sornette. “Endogenous versus Exogenous Origins of Crises”. In: Extreme Events in Nature
and Society. 2006. doi: 10.1007/3-540-28611-x{\_}5.

[26]

C. Y. Teresalam and J. P. Lehoczky. “Superposition of renewal processes”. In: Advances in
Applied Probability (1991). issn: 0001-8678. doi: 10.2307/1427512.

19

