A C OMPARTMENT M ODEL OF H UMAN M OBILITY AND E ARLY
C OVID -19 DYNAMICS IN NYC

arXiv:2102.01821v1 [stat.AP] 3 Feb 2021

A P REPRINT
Ian Frankenburg
UCLA Department of Biostatistics
University of California, Los Angeles
Los Angeles, CA 90095-1772
ian.frankenburg@ucla.edu
Sudipto Banerjee
UCLA Department of Biostatistics
University of California, Los Angeles
Los Angeles, CA 90095-1772
sudipto@ucla.edu

January 26th, 2021

A BSTRACT
In this paper, we build a mechanistic system to understand the relation between a reduction in human
mobility and Covid-19 spread dynamics within New York City. To this end, we propose a multivariate
compartmental model that jointly models smartphone mobility data and case counts during the first 90
days of the epidemic. Parameter calibration is achieved through the formulation of a general Bayesian
hierarchical model to provide uncertainty quantification of resulting estimates. The open-source
probabilistic programming language Stan is used for the requisite computation. With the additional
benefit of modeling a mechanism by which human mobility and infection counts relate, we find our
simple and interpretable model is able to recover epidemiological parameters that are consistent with
current literature.
Keywords Compartmental modeling, Bayesian Inference, nonlinear multivariate analysis, ordinary differential
equations, Covid-19

1

Introduction

The global Covid-19 pandemic has underscored the importance of mathematical and statistical models in understanding
disease dynamics, assessing policy efficacy, and examining counterfactual scenarios to formulate thorough cost-benefit
analyses. Lockdown measures can have drastic impact on individual well-being as well as society and the economy at
large (Bonaccorsi et al., 2020), (Cutler and Summers, 2020). Therefore a retrospective study of Covid-19 lockdown and
mitigation measures can help policymakers and public health officials understand to what end such efforts were effective.
The formulation of a mechanistic compartmental model is a pathway towards such goals. In this article, we review
compartmental model methodology, construct our new Bayesian hierarchical model, and discuss numerical methods
relevant for implementation and fitting to real-world data. The new compartmental model is a simple modification of the
classical susceptible-infectious-removed (SIR) model and enables a mechanistic correspondence between smartphone
mobility data and infection dynamics. This can provide evidence of how reduced mobility due to early lockdowns or
mitigation measures within New York City influenced Covid-19 spread dynamics. Case count data is obtained from the
official website of the City of New York, available at https://www1.nyc.gov/site/doh/covid/covid-19-data.
page. Population transit mobility data is obtained from https://covid19.apple.com/mobility and consists of
anonymized Apple iPhone transit usage reported as a percent relative to baseline. Starting from the day after Governor

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

A P REPRINT

Andrew Cuomo declared a state of emergency in New York State on March 7th, 2020, both the raw case count and
transit mobility time series are presented below. Our end goal is then to establish a relationship between these two
series.

Figure 1: Raw Data

2

Background

Mathematical modeling in epidemiology has a long history, famously dating back to the eighteenth century with the
work of Bernoulli (Dietz and Heesterbeek, 2002) or the mid-nineteenth century through John Snow’s modeling of the
cholera outbreak in London (Shiode et al., 2015). However, at the turn of the early twentieth century, mathematical
epidemiology turned to the modern theory of dynamical systems analysis to understand outbreak evolution. In this
section, we review the popular SIR model and subsequent mathematical analysis used to glean both qualitative and
quantitative understanding of the dynamical system. This simple framework provides the necessary foundation for more
complicated compartmental models with more population states. For examples of other compartment models designed
to study early Covid-19 outbreak dynamics, see (Hao et al., 2020) or (Wang et al., 2020a).
2.1

SIR Compartmental Model

In modeling population-level data with a compartmental system, the population is typically subdivided into separate
homogeneous groups. Here we focus on reviewing the simple SIR model developed in 1927 by A. G. McKendrick
and W. O. Kermack to model a plague outbreak in Bombay (Kermack and McKendrick, 1927). In such a model, the
population is divided into susceptible (S), infectious (I), and removed (R) groups. Individuals then progress through
the various states at certain rates over time. The mathematical description of this changing system is the coupled set of
ordinary differential equations

dS(t)


= −βS(t)I(t)/N



 dt
dI(t)
(1)
= βS(t)I(t)/N − γI(t)

dt




 dR(t) = γI(t).
dt
The progression of the disease throughout the population depends upon the contact rate between susceptible and
infectious individuals, the probability of transmission upon contact, and the prevalence of disease. To mathematically
capture these factors and express the rate of new infections, let λ be defined as a per capita contact rate among individuals.
In this way, λS(t) will give the average number of susceptible contacts over time. Now let p be the probability that a
contact results in a new infection. Finally, the prevalence of the disease at time t is by definition I(t)/N . Combining
these terms gives pλS(t)I(t)/N as the incidence rate. In defining the effective contact rate β as the product of the per
capita contact rate λ and transmission probability p, the necessary form in equation (1) is recovered.
The remaining parameter γ is interpreted by considering that 1/γ is the average sojourn time of an individuals within
compartment I. It should also be noted the population is fixed throughout time since N = S + I + R. This can
alternatively be seen since adding the terms in (1) gives zero. With meaning associated to the compartmental parameters,
we next turn to an overview of the mathematical analysis involved in analyzing the basic SIR dynamical system.
2

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

2.2

A P REPRINT

Linear Stability Analysis and the Basic Reproductive Number

The system of differential equations in (1) are nonlinear, arising from the term S(t)I(t). Linear stability analysis
is the workhorse to understand the behavior of nonlinear dynamical systems and has a fundamental connection to
the basic reproductive number R0 , popularized recently through media coverage of the Covid-19 pandemic. R0 is
defined roughly to be the expected number of subsequent infections resulting from a single infected individual. In this
section, we briefly review linear stability analysis and make the connection to R0 . In the next section, we highlight the
computation of R0 for a general class of compartmental models.
A steady state or equilibrium of a dynamical system is a point x∗ where the system of differential equations evaluated at
x∗ is zero for all t. In this way, compartmental contents within the system are not changing over time. In the SIR model
of (1), an important steady state is the so-called disease-free equilibrium of {(S ∗ , 0, 0) : S ∗ ≥ 0}. A natural subsequent
question is the behavior of the system around small perturbations of the equilibrium. In computing the Jacobian about
such a point, we linearize and are afforded tractable analysis. A heuristic justification arises from considering a Taylor
expansion of the system about the disease-free equilibrium and ignoring high-order terms since the perturbation is
assumed small. After dropping the explicit dependence on time t from equation (1) to avoid clutter, the Jacobian of the
system is computed as


∂ Ṡ
 ∂S

 ∂ I˙
J=
 ∂S

 ∂ Ṙ
∂S

∂ Ṡ
∂I
∂ I˙
∂I
∂ Ṙ
∂I


∂ Ṡ

∂R 

−βI/N
∂ I˙ 
 =  βI/N
0
∂R 

∂ Ṙ 

−βS/N
βS/N − γ
γ


0
0 .
0

(2)

∂R

Through elementary matrix operations, J can be transformed to a triangular matrix. The eigenvalues are then found
from inspection. Evaluating the Jacobian J at (S ∗ , 0, 0) to linearize about the steady state results in eigenvalues of
λ1 = 0 and λ2 = βS ∗ /N − γ. The sign of these eigenvalues then determine the stability of the equilibrium point. The
eigenvalue of λ1 is ignored, as it corresponds to a line of equilibrium values S ∗ . In this way, the second eigenvalue of
λ2 is of main interest. If N/S ∗ < β/γ, then λ2 > 0 and the steady state is unstable; otherwise it is stable. In epidemic
terms, an outbreak occurs if the disease-free equilibrium is unstable. This ratio β/γ acts as a bifurcation parameter
in determining if an outbreak will occur and is thus afforded the fancy title of basic reproductive number. Letting
the equilibrium point S ∗ be the population size so that S ∗ = N , a simple relation emerges: if R0 > 1 the disease
continues to spread but dies out otherwise. The effective reproductive number Rt then extends R0 by accounting for a
changing susceptible population over time and is defined as Rt := R0 S(t)/N . A general method to compute R0 for
more elaborate compartmental models will be discussed in the next subsection.
2.3

Spectral Radius or Next Generation Matrix Method

For general compartment models that extend the simplistic SIR framework, computing the basic reproductive number
can be difficult. (Diekmann et al., 2009) and (Heffernan et al., 2005) describe a general method to compute R0 called
the Next Generation Matrix or Spectral Radius Method, which we briefly review and compute for the SIR model.
Let dX(t)/dt represent a general coupled system of differential equations describing a compartmental model with
n components and m infectious states. Define a vector-valued F(X(t)) to be a function where each component
specifies flow rate into one of the respective m infected compartments. Similarly, define a function V(X(t)) where
each component specifies the flow rate out of a respective infectious compartment.
Next, F and V are linearized about the disease-free equilibrium point by computing the Jacobian. (Diekmann et al.,
2009) prove the Jacobian with respect to each infectious state will take the form

J(F) =

A 0
0 0




and J(V) =

B
∗


0
,
∗

(3)

where A and B are m × m matrices. The next generation matrix is then defined as AB−1 . The basic reproductive
value of R0 is subsequently the spectral radius or largest eigenvalue of the next generation matrix. In the case of the
SIR model, F(X(t)) := −βSI/N , while V(X(t)) := γI. It follows that the necessary Jacobians evaluated at the
disease-free equilibrium of (N, 0, 0) results in AB−1 = β/γ and agree with the previous section.
3

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

3

A P REPRINT

Methods

In this section, we detail the construction of our compartmental model designed to formulate an understanding of
how reduction in human mobility might have altered early infection dynamics within New York City. The model is
parsimonious, in that it consists of only four compartments and shares many well-established mathematical properties
of the SIR model discussed in the background section. The dynamical system proposed comprises a closed population
divided into susceptible, lockdown (L), infectious, and removed states. Since the time horizon under investigation is
short, we choose to ignore demographic factors such as birth, death, and migration. Below is a visualization of the
population progression through the different states.

Figure 2: Proposed SLIR compartmental model
The system of differential equations describing the changing system are

dS(t)


= −βS(t)I(t)/N − aS(t) + bL(t)


dt



dL(t)



= aS(t) − bL(t)
dt

dI(t)


= βS(t)I(t)/N − γI(t)


dt




 dR(t) = γI(t),
dt

(4)

with initial conditions of S(0) = N − i0 , L(0) = 0, I(0) = i0 , and R(0) = 0. An important qualitative feature of our
model is that susceptible individuals are temporarily moved into the lockdown compartment to reflect social distancing,
mitigation measures, and reduced mobility. Over time, individuals are reintroduced into the susceptible population out
of the lockdown state. Through an application of the next generation matrix method described in section 2, R0 can be
seen to be equivalent to the standard SIR model, i.e. R0 = β/γ.
3.1

A Bayesian Hierarchical Model

We present our methodology in a general hierarchical framework to facilitate Bayesian inference of compartmental
system parameters in equation (4). In this hierarchical formulation, we can be explicit about the role of the mechanistic
system, requisite numerical integration, and underlying process parameters. This section will construct the statistical
model piece-by-piece. The hierarchy of connected components in the model can be visualised bottom-up as follows,
System Parameters −→ Compartmental Mechanistic Model −→ Observed Data.
We first establish notation to represent the mechanistic system of differential equations in the middle of the hierarchy.
Let the equations in (4) be denoted by F, where




−γR0 S(t)I(t)/N − aS(t) + bL(t)
S(t)


aS(t) − bL(t)
d
 L(t) 


and F(X(t), t) = 
X(t) = F(X(t), t), where X(t) = 
 (5)

I(t)
dt


γR0 S(t)I(t)/N − γI(t)
R(t)
γI(t)
and we have suppressed the dependence of {R0 , γ, a, b} in F(X(t), t). The system is reparameterized in terms of R0
rather than β to be more epidemiologically interpretable and results from a simple transformation of β = γR0 . To
4

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

A P REPRINT

recover the system states X(t), the system of differential equations must be solved. Given fixed values of R0 , γ, a, and
b, the solution to the system of differential equations is a vector-valued function
Z
X(t) = F(X(t), t; R0 , γ, a, b)dt.
(6)
This solution will be necessary to connect with the observed data.
The top of the hierarchy is described by formulating a measurement process for the two outcome variables. Let the
first outcome of interest be labeled YL (t) and represent the percent of the population removed from the susceptible
compartment by adhering to mitigation protocol. The subscript L is used for a reminder that this data is used to gain
information on the lockdown compartment. Likewise, the second outcome is labeled YI (t) and denotes the observed
case counts over time. To model observation error in YL (t), we choose a Beta distribution dependent upon a parameter
φ1 to control dispersion, i.e.,

YL (t)|L(t), φ1 ∼ Beta φ1 L(t)/N, φ1 (1 − L(t)/N ) .
(7)
Notice L(t) is necessarily scaled by the population size N to respect the support of the beta distribution. As we seek to
inform the L compartment through cell phone mobility data, the beta distribution is a natural choice because the data
will be anonymized and reported as a percentage of nominal movement. This parameterization of the beta distribution
has expectation and variance
E[YL (t)|L(t), φ1 ] = L(t)/N

L(t)/N 1 − L(t)/N
.
Var(YL (t)|L(t), φ1 ) =
φ1 + 1
To model observation noise in YI (t), we use a negative binomial to account for overdispersion,
YI (t)|I(t), φ1 ∼ Negative Binomial(I(t), φ2 ).

(8)

Stan provides an alternative parameterization of the negative binomial called neg_binomial_2 with first two moments
of
E[YI (t)|I(t), φ2 ] = I(t)
Var(YI (t)|I(t), φ2 ) = I(t) +

I(t)2
.
φ2

In this way, φ2 is viewed as a dispersion parameter. The full hierarchical description of the model can be completed by
introducing prior distributions on the system parameters governing the differential equations. Writing the model in full,

YL (t)|L(t), φ1 ∼ Beta φ1 L(t)/N, φ1 (1 − L(t)/N )
YI (t)|I(t), φ2 ∼ Negative Binomial(I(t), φ2 )
dX(t)
= F(X(t), t; R0 , γ, a, b)
dt
R0 |γ ∼ log-normal(0, 1)
γ ∼ Uniform(0, 1)
φ1 ∼ Inverse Gamma(0.1, 0.1)
φ2 ∼ Inverse Gamma(0.1, 0.1)
a ∼ Beta(1, 20)
b ∼ Uniform(0, 1).

(9)

The prior distributions on system parameters are weakly-informative. However, the prior distribution on a might at
first appear suspect. Through prior predictive checks, we find that placing a uniform prior on a results in the SLIR
model a priori favoring no epidemic breakout, as susceptibilities are removed from the population too quickly. Since the
classical SIR model is a special case of our SLIR model as a → 0, we place mass closer to 0 through the Beta(1,20)
distribution to ensure the model generates reasonable predictions before seeing the data.
3.2

Numerical Solvers

The hierarchical model of the previous section crucially depends upon the numerical solution to a coupled set of
differential equations. We briefly review the popular numerical integration schemes and connect them with our
5

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

A P REPRINT

hierarchical model of the compartmental system in (4). In practice, solutions to the SIR model are numerically
approximated and entail specific computational challenges. Runge-Kutta (RK) is a classical numerical method (Struthers
and Potter, 2019; Press et al., 2007) in which we employ to numerically solve this set of nonlinear differential equations.
RK generalizes the well-known Euler method for iteratively solving systems of differential equations. In the following,
we formulate the RK method in vector notation for the proposed SLIR compartmental model.
Consider X(t) in (5). From the fundamental theorem of Calculus, we know that
Z t+∆t
X(t + ∆t) = X(t) +
F(X(u), u)du .

(10)

t

Given the initial value X(t0 ) at time t0 , numerically solving for X(t) amounts to constructing a sequence {Xn :
n = 0, 1, . . . , T }, where Xn := X(tn ) and tn = tn−1 + ∆t are equispaced time points for n = 0, 1, . . . , T , by
approximating the integral of F(X(t), t) in (10). Using this approximation, a sequence is generated starting from some
t0 as,
Z tn +∆t
(11)
Xn+1 = Xn +
F(X(u), u)du .
tn

where the initial condition X0 := X(t0 ) is given. There are several customary choices for such approximations, but for
most practical purposes one need not look beyond the following:

Z t+∆t
(∆t)F(X(t), t)
(Euler)

(∆t)
F(X(t), t)dt =
(12)
(F(X(t),
t)
+
F(X(t
+
∆t),
t
+
∆t))
(Trapezoidal)
 2
t
(∆t)F(X(t + (∆t)/2), t + (∆t)/2)
(Midpoint or Modified Euler) .
Euler’s approximation (first equation in (12)) is the simplest of the approximations which yields Euler’s Method. In this
case, the sequence is constructed as
Xn+1 = Xn + (∆t)F(Xn , tn ) for n = 0, 1, . . . , T − 1 .

(13)

Starting with X0 , each element of the sequence in (13) is computed since F(Xn , tn ) is available. The spacing between
the time points, ∆t, is specified by the user and controls the resolution of the numerical solution.
Euler’s approximation is easy to execute and based upon a first order Taylor expansion. It is also the least accurate. The
Trapezoidal and Modified Euler approximations in (12) are based upon numerical integration using trapezoidal areas and
the midpoint approximation. Both these methods help improve Euler’s method with the Modified Euler outperforming
the trapezoidal rule in terms of accuracy. However, the Trapezoidal and the Modified Euler methods involve Xn+1 and
Xn+1/2 := X(tn+1/2 ) with tn+1/2 := tn + (∆)t/2, respectively, which are unknown at iteration n. In fact, Xn+1
is the very quantity we wish to compute at iteration n. Therefore, we substitute these unknown quantities with their
first order (Euler) approximations in (13) that are available at iteration
 n. For each n we compute an = F (Xn , tn ),
bn = F (Xn + (∆t)an , tn+1 ) and cn = F Xn + (∆t/2)an , tn+1/2 and transition from Xn to Xn+1 as

n)
Xn + (∆t) (an +b
(Trapezoidal) ;
2
Xn+1 =
for n = 0, 1, . . . , T − 1 ,
(14)
Xn + (∆t)cn
(Modified Euler)
Both methods in (14) deliver noticeable improvements over Euler’s method in (13). Numerical results from (14) are
much smaller in magnitude and grow less quickly. This can be explained by observing that while (13) depends only
upon the data available at tn (only one data point), the two methods in (14) use current data at tn along with estimates
of the slope at a point that lies in the future. While these estimates are computed using only the currently available data,
they still produce substantially improved estimates.
Higher order Taylor expansions produce other iterative schemes. Thus, second order methods emerge from
(∆t)2 d
F(X(t), t) + O((∆t)2 ) .
2 dt
A second order iterative scheme corresponding to (15) updates
(
)


(∆t)2 ∂F
∂F
d
Xn+1 = Xn + (∆t)F(Xn , tn ) +
+
X(t)
,
2
∂t t=tn
∂X X=Xn dt
t=tn
X(t + ∆t) = X(t) + (∆t)F(X(t), t) +

(15)

(16)

where

we have used the multivariable chain-rule of derivatives to evaluate the derivative of F(X(t), t) with respect to t,
∂F
is the matrix with (i, j)-th element being the partial derivative of the i-th element of F(X(t), t) with respect
∂X
6

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

A P REPRINT

d
= F(Xn , tn ). Unfortunately, computing (16) requires the derivatives of
X(t)
dt
t=tn
F(X(t), t) and may, in general, be numerically cumbersome.
to the j-th variable in X, and

The Runge-Kutta methods are among the most conspicuous of numerical methods for solving systems of ordinary
differential equations. The underlying idea is to achieve the same accuracy as Taylor series updates without requiring
higher order derivatives of F(X(t)). We can motivate this approach from the earlier methods. In (14), the Trapezoidal
and Modified Euler methods define the updates using an , bn and cn that are completely specified. In particular, observe
that the Trapezoidal method updates using a weighted average of an and bn . Instead of prescribing an and bn , the
Runge-Kutta approach prefers to find weighted averages to ensure that the approximation matches that from a Taylor
series expansion such as in (15) or (16). Therefore, a second-order Runge-Kutta method (RK2) writes
Xn+1 = Xn + (∆t) {ω1 an + ω2 F(Xn + (∆t)βan , tn + (∆t)α)}

(17)

and seeks to find ω1 , ω2 , α and β so that the approximation matches (16). Substituting the first-order expansion,


∂F
∂F
F(Xn + (∆t)βan , tn + α(∆t)) = F(Xn , tn ) + (∆t)β
an + (∆t)α
+ O((∆t)2 )
∂X X=Xn
∂t t=tn
(
)
(18)




∂F
∂F
∂F d
2
an + (∆t)α
+
+ O((∆t) ) ,
= an + (∆t)β
X(t)
∂X X=Xn
∂t t=tn
∂X dt
t=tn
into the right hand side of (17) and comparing with the expansion (16) we find that the two expansions are equivalent if
ω1 + ω2 = 1 ;

ω2 β = ω2 α = 1/2 .

(19)

RK2 specifies ω1 = ω2 = 1/2 and α = β = 1, which, when substituted into (17), yields the Trapezoidal approximation.
More generally, the explicit RK methods of order s specify updating schemes
Xn+1 = Xn + (∆t)

s
X

ωi ki ,

(20)

i=1



Pi−1
where k1 = F(Xn , tn + (∆t)α1 ), and ki = F Xn + (∆t) j=1 βij kj , tn + (∆t)αi for i = 2, . . . , s. The coefficients are found from an s-th order Taylor expansion. A popular choice sets α1 = 0 and solves
s
X
i=1

ωi = 1 and

i−1
X

βij = αi for i = 2, 3, . . . , s .

(21)

j=1

In particular, the RK4 method specifies the following values in (20):
 
 
"
# 1
1
ω1
β
21
2
ω  1 2
β31 β32
s = 4 ;  2 =   ;
= 0
ω3
2
6
β41 β42 β43
0
ω
1
4


1
2

0

 ;
1

 
 
α1
0
α2  1 1
α  = 1 .
3
2
α4
2

(22)

The appropriate step size ∆t is hard to determine. An advantage of Stan’s implementation is an adaptive step size is used
by comparing the solution obtained using the four term approximation of above as well as a five term approximation. If
these approximations agree, the algorithm proceeds, otherwise a new step size is calculated. More details can be found
in the user manual (Stan Development Team, 2020), but the result is a fast, efficient procedure of high accuracy.
3.3

Hamiltonian Monte Carlo and the No-U-Turn Sampler

Our choice of implementation in Stan, as opposed to more traditional BUGS or JAGS (Plummer, 2003), is pragmatic.
First, the latter languages are declarative and built upon graphical models. In contrast, Stan is a fully imperative
programming language. Additionally, built-in differential equation routines are included such as the Runge-Kutta
numerical solver described in the previous section. This makes the software implementation of our model more natural
and readable.
More importantly, however, the parameters in a nonlinear compartmental model are often highly correlated, as
demonstrated in below in Figure 3.
7

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

A P REPRINT

Figure 3: Example posterior correlation between R0 and γ
Hamiltonian Monte Carlo (HMC) is more equipped to sample from complex posterior distributions with high autocorrelations than standard Metropolis schemes. The most popular presentation of Hamiltonian Monte Carlo is by way of
analogy with statistical mechanics. Let θ be an arbitrary d-dimensional parameter vector. To sample efficiently from the
posterior of θ after conditioning on data, an idealized physical system is introduced to leverage the geometry of the
underlying manifold on which θ lives. We will not embark upon a comprehensive development of HMC here, referring
the reader to excellent introductory expository articles by Neal (2012) and Betancourt (2018). Instead, we provide a
heuristic account of the HMC algorithm and why it works.
We begin by recalling the more conspicuous Metropolis random walk and the concept of detailed balance. Let p(θ | Y)
be the posterior distribution from which we wish to sample. As it may be difficult to directly sample from p(θ | Y), the
Metropolis random-walk algorithm constructs a Markov chain with p(θ | Y) as its stationary distribution. Given an
initial value θ (0) , at iteration t we draw a “proposed” value θ ∗ from a symmetric distribution q(· | θ (t−1) ). A simple yet
effective choice for many applications is q(· | θ (t−1) ) = N (· | θ (t−1) , V), where V is a fixed variance covariance matrix
that helps tune the algorithm, although in general the proposal can be generated from!any symmetric distribution. After
p(θ ∗ | Y)
generating θ ∗ we simulate a coin with probability of heads min 1,
and set θ (t) = θ ∗ if it is a head.
(t−1)
p(θ
| Y)
Otherwise we set θ (t) = θ (t−1) . That p(θ | Y) is indeed the desired stationary distribution can be seen as follows. Let
us assume that the current state θ (t−1) = a is a draw from p(θ | Y) and consider the possibility of moving to θ (t) = b.
This conditional probability is given by the transition probability that a value of b is proposed from q(· | a) and that this
value is accepted. Hence,




p(b | Y)
p(b | Y)
T (a → b) = P (θ (t) = b | θ (t−1) = a) = q(b | a) min 1,
= min q(b | a), q(b | a)
. (23)
p(a | Y)
p(a | Y)
The form of the transition probability in (23) implies time-reversibility (or detailed balance) in the following sense:


p(b | Y)
P (θ (t−1) = a, θ (t) = b) = P (θ (t−1) = a)T (a → b) = p(a | Y) min q(b | a), q(b | a)
p(a | Y)
= min (p(a | Y)q(b | a), q(b | a)p(b | Y)) = min (p(a | Y)q(a | b), q(a | b)p(b | Y))


p(a | Y)
= p(b | Y)q(a | b) min
, 1 = P (θ (t−1) = b)T (b → a)
p(b | Y)
= P (θ (t−1) = b, θ (t) = a) ,
(24)
where we have used the symmetry q(a | b) = q(b | a) in the fourth equality in (24). It follows that the draw of θ (t) is
also from p(θ | Y) because
Z
Z
(t)
(t−1)
(t)
P (θ = b) = P (θ
= a, θ = b)da = P (θ (t−1) = b, θ (t) = a)da = P (θ (t−1) = b) = p(b | Y) .
(25)
The underlying idea behind HMC is that instead of generating the proposed value from a random distribution, we use
a deterministic symplectic integrator to propose θ ∗ . This symplectic integrator is designed based upon Hamiltonian
dynamics. Suppose that we wish to sample from p(θ | Y), where θ ∈ Rd . We introduce an auxiliary variable r ∈ Rd so
8

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

A P REPRINT

that we can efficiently sample from the joint density p(θ, r | Y). If (θ (t) , r(t) ) ∼ p(θ, r | Y), then
Z
Z
P (θ (t) = b) = P (θ (t) = b, r(t) = u)du = p(b, u | Y)du = p(b | Y) .
Hence, sampling from the joint density p(θ, r | Y) results in samples from p(θ | Y).
The auxiliary variable, r, is also called the “momentum” in Hamilton dynamics. For our purposes, it suffices to specify
that p(θ, r | Y) = p(θ | Y) × p(r). Therefore, p(r | θ, Y) = p(r) which means that r is independent
of the data Y and

the model parameters θ. More specifically, we assume that p(r) = N (r | 0, Id ) ∝ exp − 12 r> r . Therefore,
1
log p(θ, r | Y) = constant + log p(θ | Y) − r> r .
2

(26)

The above density can be looked upon as a physical system subject to Hamiltonian dynamics, where θ is a particle’s
position in Rd and r is the particle’s momentum.
In order to sample from (26), a simple HMC algorithm proceeds closely on the lines of the Metropolis random walk
described earlier, but replaces the random generation of a proposed value for θ by a symplectic integrator constructed
from Hamiltonian dynamics. With the current state (θ (t−1) , r(t−1) ), we begin iteration t by drawing the momentum
variable r∗ ∼ N (0, Id ). Setting r(t) = r∗ we perform L steps of a symplectic integrator (also known as “leapfrog”),
where each step comprises the following:


(27)
r(t+/2) = r(t) + ∇θ L(θ); θ (t−1+) = θ (t−1) + r(t+/2) ; r(t+) = r(t+/2) + ∇θ L(θ) ,
2
2
where L(θ) = log p(θ | Y). Let θ̃ and r̃ be the output of (27) at the end of L steps. The values of θ̃ and r̃ are
considered the “proposed” values
at iteration t and accepted as (θ (t) , r(t) ) = (θ̃, −r̃) with acceptance probability
!
p(θ̃ | Y)p(r̃)
min 1,
. This last Metropolis step together with the negation of the momentum variable in the
p(θ (t−1) | Y)p(r∗ )
final update ensures time-reversibility as in (24) and, as seen in (25), maintains p(θ | Y) as the stationary distribution.
We provide some further intuition on the time-reversibility of the simple HMC algorithm. The key to this result is
that the leapfrog iteration in (27) preserves volumes. To be slightly more precise, let D be a small region in the (θ, r)
space and suppose the L leapfrog steps maps D to a region D̃. Then D and D̃ both have the same volume. We write the
transition probability from D to D̃ as
!



exp(−H(D̃))
T (D → D̃) = (δV ) min 1,
= (δV ) min 1, exp −H(D̃) + H(D)
,
(28)
exp(−H(D))
Z
p(θ, r)dθdr = exp (−H(D)). If (θ (t−1) , r∗ is drawn from the
where δV represents the volume of D and D̃, and
ZD
joint density in (26), then P ((θ (t−1) , r∗ ) ∈ D) =
p(θ, r)dθdr = exp (−H(D)). Therefore,
D

P ((θ

(t−1)

∗

, r ) ∈ D, (θ

(t)

, r ) ∈ D̃) = P ((θ (t−1) , r∗ ) ∈ D)T (D → D̃)



= exp (−H(D)) (δV ) min 1, exp −H(D̃) + H(D)



= (δV ) min exp (−H(D)) , exp −H(D̃)
(t)

(29)

= P ((θ (t−1) , r∗ ) ∈ D̃, (θ (t) , r(t) ) ∈ D) ,
where the last equality follows from the symmetry in the expression above it.
This procedure, while maintaining the stationary distribution through time-reversibility, introduces a host of complexities.
Perhaps most importantly, tuning the many parameters needed in this process is inherently difficult. This motivated the
development of an automatic procedure known as the No-U-Turn-Sampler (NUTS) (Hoffman and Gelman, 2011). This
algorithm achieves significant efficiency over the simple HMC algorithm described above by either explicitly avoiding
a U-turn to previously explored region or terminating after a pre-defined number of exploration steps. In this way, the
algorithm is guaranteed to only explore new areas of the space. This efficient exploration results in typically faster
convergence and higher effective sample sizes per iteration as compared to classical MCMC.
9

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

4

A P REPRINT

Analysis and Results

In this section, we present two simulation studies and conclude with the New York City analysis. First, the proposed
SLIR compartmental model is used to generatively simulate data from two lockdown scenarios that affect human
mobility differently. We then fit our Bayesian model to asses whether the true parameter values are adequately recovered.
After, we analyze the real-world mobility and case count data that initially inspired the model formulation.

4.1

Simulated Data

To illustrate the nonlinear dynamics of which our model can capture, the first simulation reflects the idealized scenario
of strict adherence to lockdown and mitigation measures, when population movement is quickly reduced in the early
stages of the outbreak and remains reduced for the next 90 days. In this case, individuals move from the S compartment
to the L compartment quickly and are slowly reintroduced into the susceptible population so that population movement
decreases to about 60% relative to baseline within the first 20 days.
In the second scenario, we consider weak adherence to mitigation measures and illustrate the substantial change in
dynamics by only altering the speed of flow back into the susceptible population from the L compartment. In this case,
the peak percentage of the population in the lockdown compartment is 30% but quickly diminishes. In both simulations,
the population size is fixed to N = 10, 000, and the true data-generating process is shown below as a dashed red line.
The median of the posterior predictive distribution and 95% credible intervals are shown in blue.

Figure 4: Model Fit to Simulated Data

We fit our model to both scenarios using Stan’s NUTS algorithm with 4 chains and 5,000 iterations each, the first half
of which are discarded as warm-up. The convergence of the parameter chains are judged by inspecting the trace plots
and R̂ values, as reported in the table below.
10

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

Experiment
Simulation 1

Simulation 2

Parameter

Truth

Median

95% Credible Interval

R̂

R0
γ
a
b

5
0.1
0.05
0.02

4.93
0.09
0.042
0.017

4.720 - 5.130
0.086 - 0.097
0.039 - 0.05
0.015 - 0.019

1.00
1.00
1.00
1.00

R0
γ
a
b

5
0.1
0.05
0.1

4.79
0.099
0.045
0.095

4.59 - 5.00
0.096 - 0.104
0.04 - 0.051
0.086 - 0.106

1.00
1.00
1.00
1.00

A P REPRINT

Table 1: Model Fit and Parameter Summaries

In both cases, the Bayesian hierarchical model is able to infer the structural parameters of the SLIR model. Notice the
change in case counts of both scenarios resulting from different susceptible population sizes.

4.2

New York City Analysis

The entire lead-up thus far was requisite background material for compartmental model inference and application to realworld data. As mentioned in the introduction, our main motivation for this article was to understand how a reduction in
mobility affected early Covid-19 dynamics specifically within NYC. For convenience, we restate the data sources. Case
counts are reported by the official website of the City of New York, available at https://www1.nyc.gov/site/doh/
covid/covid-19-data.page and mobility data is hosted at https://covid19.apple.com/mobility. Since the
Apple mobility data reflects a percent decrease in movement, it must first be transformed by subtraction from unity
to adhere with the SLIR compartmental model structure. In other words, to prepare the mobility data for use in the
hierarchical model, it must first be subtracted from one so that it no longer represents a percent decrease in transit
mobility but rather a percent increase in individuals adhering to mitigation measures. Finally, we mention again that
although the first case of Covid-19 in New York City was recorded on February 29th, we align our movement and case
data to begin on March 8th, 2020, the day after Governor Andrew Cuomo declared a state of emergency in New York
State.
To achieve parameter calibration, we fit in Stan our full hierarchical model using four chains run for 10,000 iterations
each. We discard the first 5,000 as warm-up. Sufficient posterior exploration is assessed by examining parameter chain
plots below and assessing R̂ values, shown in Table 2.

Figure 5: Trace plots
11

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

Experiment
NYC Analysis

Parameter

Median

95% Credible Interval

R̂

R0
γ
a
b

5.13
0.212
0.115
0.0215

4.841 - 5.448
0.191 - 0.234
0.106 - 0.124
0.019 - 0.024

1.00
1.00
1.00
1.00

A P REPRINT

Table 2: Model Fit and Parameter Summaries

The fitted time series are presented below on the right, along with the raw data used to train the model. On the left, prior
predictive distributions are included to illustrate the degree in which Bayesian learning occurs after observing the data.
We also include the fit of an SIR model to illustrate its inability to capture the dynamics.

Figure 6: Model Fit to Case Counts and Transit Mobility Data

To asses the structural fit of our hypothesized SLIR mechanism, we next interpret parameter values to ensure they are
logical and consistent with outside literature. The R0 estimate is cross-referenced with those of other popular online
models. Using only death statistics as reported by Johns Hopkins University, (Gu, 2020) embeds a SEIR model in a
machine learning framework for many regions across the United States and 70 countries. In this work, R0 is estimated
for NYC to be between 5.0 and 5.8, in close agreement with our model. As an additional point of reference, (Systrom
et al., 2020) provide an alternative model that does not assume a mechanistic SEIR structure and instead relies on curve
fitting the smoothed data. This model is available at https://rt.live. R0 is estimated to be 5.26 with a confidence
interval of approximately 4.5-6. The SLIR estimate of R0 and the Rt curve are plotted below.
12

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

A P REPRINT

Figure 7: R0 and Rt
The posterior of γ has a median value of 0.21 and a 95% credible interval of (0.191, 0.234). From this, we arrive at an
estimate of approximately 5 days for the average infectious removal time. This estimate could be reasonable assuming
asymptomatic or presymptomatic transmission is possible and that individuals isolate at the onset of symptoms; see
(Gandhi et al., 2020) for evidence. Outside work estimates symptom onset time to also be around 5 days. For example,
(Lauer et al., 2020) use 181 confirmed Covid-19 cases to estimate a median symptom onset time of 5.1 days with a
95% confidence interval (4.5, 5.8) days. A systematic review by (Madjid et al., 2020) estimates a mean symptom onset
time of 5.2 days with a 95% confidence interval of (4.1, 7.0) days. These estimates provide credence in establishing a
correspondence between population movement reduction and infection dynamics with the mechanistic SLIR model.

5
5.1

Discussion and Future Work
New York City Analysis

In this work, we have formulated a basic extension of the classical SIR model to jointly fit cell phone transit mobility
data and case counts. By jointly modeling two outcome variables, we establish a mechanistic correspondence between
reduced mobility and infection dynamics. The applied analysis and findings, however, are limited to NYC during
the first 90 days. The disease progression throughout the region was well-approximated by deterministic dynamics
and modeling with a simple compartment system. In other geographic regions, the dynamics might not be as suitably
well-behaved or understood. It is difficult to capture the myriad of factors contributing to disease spread throughout a
population, and often a stochastic model may be more appropriate. Additionally, the time horizon considered in our
applied analysis is relatively short. As a disease progresses throughout the population and becomes more widespread,
the strategy of informing the susceptible population numbers through cell phone mobility data becomes more difficult.
It is also worth consideration about whether in general smartphone mobility data can be considered a representative
sample of individuals’ adherence to mitigation protocols. It is therefore difficult to build a quantitative understanding of
the dynamics between lockdown measures and disease progression over long periods of time. A direction for future
research is to establish modeling strategies for such scenarios. This will introduce additional challenges of accounting
for population immunity, vaccinations, and natural seasonality effects.
5.2

Stochastic Model Extensions

We briefly discuss for both discrete and continuous time how the deterministic SLIR model can be relaxed through
a state-space (or Hidden Markov Model) framework, where stochasticity is introduced into the underlying driving
epidemic process. We first discuss a discrete-time extension by modifying equation (9) so that the numerical solution
to dX(t)
is embedded within a likelihood function at the discrete observation time points. In this way, equation (9)
dt
is modified to include p(X(t)|θ, R0 , γ, a, b), where θ is introduce to accommodate new parameters. In other words,
stochasticity is introduced to the driving dynamics through the choice of suitable probability distribution that is a
function of the numerical solution of the system of differential equations. This approach has been successfully applied
to forecast seasonal influenza (Osthus et al., 2017), (Dukic et al., 2012), as well as to assess Covid-19 interventions in
China (Wang et al., 2020b) and Japan (Kobayashi et al., 2020).
An alternative approach is to incorporate continuous-time stochasticity directly by expressing dX(t) as a stochastic
differential equation (SDEs) (Øksendal, 2003). In this case, one modification of equation (9) could be
dX(t) = µ(X(t), t)dt + L(X(t), t)dW(t),
(30)
>
where W(t) = (W1 (t), W2 (t), W3 (t), W4 (t)) is a vector of standard Wiener processes or Brownian motions, µ is
some vector-valued function, and L is a compatible matrix. Depending on the structure of µ, there may or may not exist
13

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

A P REPRINT

an explicit solution. A SDE that affords a closed form solution is the Ornstein-Uhlenbeck (OU) process. See (Chatzilena
et al., 2019) for Stan code in the case where the infectious compartment of the SIR model is endowed an OU process to
allow for random fluctuations. See also (Wang et al., 2018) for an analysis of the susceptible-infectious-susceptible
model where time-varying parameters are introduced through an OU process. In both examples, the analytic nature of
the solution to the SDE enables efficient implementation in Stan or alternative software. In cases where no closed-form
solution to (30) exists, inference in such a system is closely related to Bayesian filtering and smoothing, amenable to
such methods as the Kalman filter and extensions (Särkkä and Solin, 2019). The New York City data was captured well
by deterministic dynamics, but often elsewhere disease progression is not suitably captured within such a framework.
Bayesian inference for SDEs modeling infectious disease dynamics is thus an attractive area of future research.

References
M. Betancourt. A conceptual introduction to hamiltonian monte carlo, 2018. 8
G. Bonaccorsi, F. Pierri, M. Cinelli, A. Flori, A. Galeazzi, F. Porcelli, A. L. Schmidt, C. M. Valensise, A. Scala,
W. Quattrociocchi, and F. Pammolli. Economic and social consequences of human mobility restrictions under
covid-19. Proceedings of the National Academy of Sciences, 117(27):15530–15535, 2020. ISSN 0027-8424. doi:
10.1073/pnas.2007658117. URL https://www.pnas.org/content/117/27/15530. 1
A. Chatzilena, E. van Leeuwen, O. Ratmann, M. Baguelin, and N. Demiris. Contemporary statistical inference for
infectious disease models using stan. Epidemics, 29:100367, 2019. ISSN 1755-4365. doi: https://doi.org/10.1016/j.
epidem.2019.100367. URL http://www.sciencedirect.com/science/article/pii/S1755436519300325.
14
D. M. Cutler and L. H. Summers. The covid-19 pandemic and the $16 trillion virus. JAMA, 324(15):1495–1496, 10
2020. ISSN 0098-7484. doi: 10.1001/jama.2020.19759. URL https://doi.org/10.1001/jama.2020.19759. 1
O. Diekmann, J. Heesterbeek, and M. Roberts. The construction of next-generation matrices for compartmental epidemic
models. Journal of the Royal Society, Interface / the Royal Society, 7:873–85, 11 2009. doi: 10.1098/rsif.2009.0386.
3
K. Dietz and J. Heesterbeek. Daniel bernoulli’s epidemiological model revisited. Mathematical biosciences, 180:1–21,
11 2002. doi: 10.1016/S0025-5564(02)00122-0. 2
V. Dukic, H. Lopes, and N. Polson. Tracking epidemics with google flu trends data and a state-space seir model. Journal
of The American Statistical Association, 107, 12 2012. doi: 10.1080/01621459.2012.713876. 13
M. Gandhi, D. Yokoe, and D. Havlir. Asymptomatic transmission, the achilles’ heel of current strategies to control
covid-19. New England Journal of Medicine, 382, 04 2020. doi: 10.1056/NEJMe2009758. 13
Y. Gu. Covid-19 projections using machine learning, 2020. URL https://covid19-projections.com. 12
X. Hao, S. Cheng, D. Wu, T. Wu, X. Lin, and C. Wang. Reconstruction of the full transmission dynamics of covid-19 in
wuhan. Nature, 584:1–7, 08 2020. doi: 10.1038/s41586-020-2554-8. 2
J. Heffernan, R. Smith, and L. Wahl. Perspectives on the basic reproductive ratio. Journal of the Royal Society, Interface
/ the Royal Society, 2:281–93, 10 2005. doi: 10.1098/rsif.2005.0042. 3
M. Hoffman and A. Gelman. The no-u-turn sampler: Adaptively setting path lengths in hamiltonian monte carlo.
Journal of Machine Learning Research, 15, 11 2011. 9
W. O. Kermack and A. G. McKendrick. A contribution to the mathematical theory of epidemics. Proceedings of the
Royal Society of London A: mathematical, physical and engineering sciences, 115(772):700–721, 1927. 2
G. Kobayashi, S. Sugasawa, H. Tamae, and T. Ozu. Predicting intervention effect for covid-19 in japan: state space
modeling approach. BioScience Trends, 14, 05 2020. doi: 10.5582/bst.2020.03133. 13
S. Lauer, K. Grantz, Q. Bi, F. Jones, Q. Zheng, H. Meredith, A. Azman, N. Reich, and J. Lessler. The incubation period
of coronavirus disease 2019 (covid-19) from publicly reported confirmed cases: Estimation and application. Annals
of internal medicine, 172, 03 2020. doi: 10.7326/M20-0504. 13
M. Madjid, P. Safavi-Naeini, S. Solomon, and O. Vardeny. Potential effects of coronaviruses on the cardiovascular
system: A review. JAMA Cardiology, 5, 03 2020. doi: 10.1001/jamacardio.2020.1286. 13
R. Neal. Mcmc using hamiltonian dynamics. Handbook of Markov Chain Monte Carlo, 06 2012. doi: 10.1201/b10905-6.
8
B. Øksendal. Stochastic Differential Equations: An Introduction with Applications. Hochschultext / Universitext.
Springer, 2003. ISBN 9783540047582. URL https://books.google.com/books?id=kXw9hB4EEpUC. 13
14

A Compartment Model of Human Mobility and Early Covid-19 Dynamics in NYC

A P REPRINT

D. Osthus, K. Hickmann, P. Caragea, D. Higdon, and S. Del Valle. Forecasting seasonal influenza with a state-space sir
model. The Annals of Applied Statistics, 11:202–224, 03 2017. doi: 10.1214/16-AOAS1000. 13
M. Plummer. Jags: A program for analysis of bayesian graphical models using gibbs sampling, 2003. 7
W. H. Press, S. A. Teukolsky, W. T. Vetterling, and B. P. Flannery. Numerical Recipes 3rd Edition: The Art of Scientific
Computing. Cambridge University Press, USA, 3 edition, 2007. ISBN 0521880688. 6
N. Shiode, S. Shiode, E. Rod-Thatcher, S. Rana, and P. Vinten-Johansen. The mortality rates and the space-time
patterns of john snow’s cholera epidemic map. International Journal of Health Geographics, 14:21, 06 2015. doi:
10.1186/s12942-015-0011-y. 2
Stan Development Team. Stan Modeling Language Users Guide and Reference Manual, Version 2.21.0. 2020. URL
http://mc-stan.org/. 7
A. Struthers and M. Potter. Differential Equations: For Scientists and Engineers. 01 2019. ISBN 978-3-030-20505-8.
doi: 10.1007/978-3-030-20506-5. 6
K. Systrom, T. Vladek, and M. Krieger, 2020. URL https://github.com/rtcovidlive/covid-model. 12
S. Särkkä and A. Solin. Applied Stochastic Differential Equations. Institute of Mathematical Statistics Textbooks.
Cambridge University Press, 2019. doi: 10.1017/9781108186735. 14
C. Wang, L. Liu, X. Hao, H. Guo, Q. Wang, J. Huang, N. He, H. Yu, X. Lin, A. Pan, S. Wei, and T. Wu. Evolving
epidemiology and impact of non-pharmaceutical interventions on the outbreak of coronavirus disease 2019 in wuhan,
china. 03 2020a. doi: 10.1101/2020.03.03.20030593. 2
L. Wang, Y. Zhou, J. He, B. Zhu, F. Wang, L. Tang, M. Eisenberg, and P. X. Song. An epidemiological forecast model and
software assessing interventions on covid-19 epidemic in china. medRxiv, 2020b. doi: 10.1101/2020.02.29.20029421.
URL https://www.medrxiv.org/content/early/2020/03/03/2020.02.29.20029421. 13
W. Wang, Z. Ding, and Z. Gui. A stochastic differential equation sis epidemic model incorporating ornstein–uhlenbeck
process. Physica A: Statistical Mechanics and its Applications, 509, 06 2018. doi: 10.1016/j.physa.2018.06.099. 14

15

